(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{6535:(e,t,a)=>{"use strict";a.d(t,{C8:()=>l,OG:()=>r,PW:()=>o,RW:()=>i,ZK:()=>c,s2:()=>n});var s=a(82489);let r=async()=>{let e=(await (0,s.Lf)()).transaction(s.RN,"readonly").objectStore(s.RN).getAll();return new Promise((t,a)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>a(e.error)})},n=async e=>{let t=(await (0,s.Lf)()).transaction(s.RN,"readonly").objectStore(s.RN).get(e);return new Promise((e,a)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>a(t.error)})},l=async e=>{if(!e||0===e.length)return[];let t=(await (0,s.Lf)()).transaction(s.RN,"readonly").objectStore(s.RN),a=[],r=e.map(e=>new Promise((s,r)=>{let n=t.get(e);n.onsuccess=()=>{n.result&&a.push(n.result),s()},n.onerror=()=>r(n.error)}));return await Promise.all(r),a},i=async e=>{let t=(await (0,s.Lf)()).transaction(s.RN,"readwrite").objectStore(s.RN),a=(0,s.$C)(),r={...e,id:a},n=t.add(r);return new Promise((e,t)=>{n.onsuccess=()=>e(a),n.onerror=()=>t(n.error)})},c=async e=>{let t=(await (0,s.Lf)()).transaction(s.RN,"readwrite").objectStore(s.RN).put(e);return new Promise((e,a)=>{t.onsuccess=()=>e(),t.onerror=()=>a(t.error)})},o=async e=>{let t=(await (0,s.Lf)()).transaction(s.RN,"readwrite").objectStore(s.RN).delete(e);return new Promise((e,a)=>{t.onsuccess=()=>e(),t.onerror=()=>a(t.error)})}},13772:(e,t,a)=>{Promise.resolve().then(a.bind(a,47552))},47552:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ec});var s=a(95155),r=a(12115),n=a(80644),l=a(52873),i=a(7860),c=a(83013),o=a(76959),d=a(1077),x=a(62709),u=a(66695),h=a(30285),m=a(87481),j=a(62177),p=a(90221),f=a(55594),v=a(6535),w=a(15510),g=a(22604),y=a(69415),N=a(44218),b=a(2868),C=a(54165),D=a(17759),S=a(62523),P=a(88539),A=a(14636),E=a(90648),k=a(59434),z=a(51920),L=a(25318),R=a(50286),$=a(91721),_=a(83662),I=a(965),F=a(73158),M=a(58049);function T(e){let{className:t,classNames:a,showOutsideDays:r=!0,...n}=e;return(0,s.jsx)(M.hv,{showOutsideDays:r,className:(0,k.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,k.cn)((0,h.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,k.cn)((0,h.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(I.A,{className:(0,k.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(F.A,{className:(0,k.cn)("h-4 w-4",t),...a})}},...n})}T.displayName="Calendar";var O=a(66424);function q(e){let{items:t,onSelectItem:a,trigger:n,title:l}=e,[i,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(""),x=(0,r.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())),[t,o]),u=e=>{a(e),c(!1),d("")};return(0,s.jsxs)(C.lG,{open:i,onOpenChange:c,children:[(0,s.jsx)(C.zM,{asChild:!0,children:n}),(0,s.jsxs)(C.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,s.jsx)(C.c7,{children:(0,s.jsx)(C.L3,{children:l})}),(0,s.jsx)(S.p,{placeholder:"Search...",value:o,onChange:e=>d(e.target.value),className:"mb-4 shrink-0"}),(0,s.jsx)(O.F,{className:"flex-1 border rounded-md p-2",children:x.map(e=>(0,s.jsx)(h.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>u(e),children:e.name},e.id))})]})]})}var G=a(59409),B=a(19209);function X(e){let{children:t,onLocationSelect:a}=e,[n,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)([]),[o,d]=(0,r.useState)(null),[x,u]=(0,r.useState)(null),[m,j]=(0,r.useState)(null);return(0,r.useEffect)(()=>{n&&(0,g.xW)().then(e=>{c(e),e.length>0&&d(e[0].id)})},[n]),(0,r.useEffect)(()=>{o?(0,g.zU)(o).then(e=>{u(e||null),j(null)}):u(null)},[o]),(0,s.jsxs)(C.lG,{open:n,onOpenChange:l,children:[(0,s.jsx)(C.zM,{asChild:!0,children:t}),(0,s.jsxs)(C.Cf,{className:"max-w-4xl h-[80vh] flex flex-col",children:[(0,s.jsx)(C.c7,{children:(0,s.jsx)(C.L3,{children:"Select a Location"})}),(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 border-b",children:[(0,s.jsxs)(G.l6,{value:o||"",onValueChange:d,children:[(0,s.jsx)(G.bq,{className:"w-[250px]",children:(0,s.jsx)(G.yv,{placeholder:"Select a map..."})}),(0,s.jsx)(G.gC,{children:i.map(e=>(0,s.jsx)(G.eb,{value:e.id,children:e.name},e.id))})]}),(0,s.jsx)("div",{className:"flex-1 text-right text-sm text-muted-foreground",children:m?"Selected: Q:".concat(m.q,", R:").concat(m.r):"Click a tile to select it"})]}),(0,s.jsx)("div",{className:"flex-1 relative bg-background/50",children:x?(0,s.jsx)(B.A,{grid:x.tiles,hexSize:20,className:"w-full h-full",onHexClick:j,selectedHex:m,onGridUpdate:()=>{},onHexHover:()=>{},activeTool:"data",paintMode:"brush",paintColor:"",paintIcon:null,paintIconColor:"",isCtrlPressed:!1,isEyedropperActive:!1,onEyedropperClick:()=>{}}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,s.jsx)("p",{children:"Select a map to view it."})})}),(0,s.jsxs)(C.Es,{children:[(0,s.jsx)(h.$,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),(0,s.jsx)(h.$,{onClick:()=>{o&&m&&(a({mapId:o,hex:m}),l(!1))},disabled:!m,children:"Confirm Location"})]})]})]})}let U=f.z.object({title:f.z.string().min(1,"Title is required."),description:f.z.string().optional(),tags:f.z.array(f.z.string()).optional(),startDate:f.z.date({required_error:"A start date is required."}),endDate:f.z.date().optional(),location:f.z.object({mapId:f.z.string(),hex:f.z.object({q:f.z.number(),r:f.z.number(),s:f.z.number()})}).optional()}).superRefine((e,t)=>{e.endDate&&e.startDate>e.endDate&&t.addIssue({path:["endDate"],message:"End date cannot be before start date."})});function W(e){let{isOpen:t,onOpenChange:a,onSaveSuccess:n,event:l,defaultCalendarId:i,initialDate:o}=e,{toast:d}=(0,m.dj)(),[x,u]=(0,r.useState)([]),[f,I]=(0,r.useState)([]),[F,M]=(0,r.useState)([]),[O,G]=(0,r.useState)([]),[B,W]=(0,r.useState)(null),[Z,J]=(0,r.useState)(null);(0,r.useEffect)(()=>{Promise.all([(0,v.OG)(),(0,w.vq)(),(0,g.xW)(),(0,y.Qg)()]).then(e=>{let[t,a,s,r]=e;u(t),I(a),G(s),M(r)})},[]);let K=(0,j.mN)({resolver:(0,p.u)(U),defaultValues:{title:"",description:"",tags:[],startDate:new Date,endDate:void 0,location:void 0}}),{watch:V}=K,H=V("startDate");(0,r.useEffect)(()=>{if(l&&t)if(K.reset({title:l.title,description:l.description,tags:l.tags||[],startDate:new Date(l.startDate),endDate:new Date(l.endDate),location:l.location}),l.party?W(l.party):W(null),l.location&&O.length>0){var e;let t=(null==(e=O.find(e=>e.id===l.location.mapId))?void 0:e.name)||"Unknown Map";J({...l.location,mapName:t})}else J(null);else!l&&t&&(K.reset({title:"",description:"",tags:[],startDate:new Date,endDate:void 0,location:void 0}),W(null),J(null))},[l,t,K,o,O]);let Q=async e=>{let t;B&&(t={type:B.type,id:B.id,name:B.name});let a={title:e.title,calendarId:i,description:e.description||"",startDate:e.startDate.toISOString(),endDate:(e.endDate||e.startDate).toISOString(),tags:e.tags||[],party:t,location:Z?{mapId:Z.mapId,hex:Z.hex}:void 0};try{e.tags&&await (0,N.JE)(e.tags,"calendar"),l?(await (0,b._1)({...a,id:l.id}),d({title:"Event Updated"})):(await (0,b.UU)(a),d({title:"Event Created"})),n()}catch(e){d({variant:"destructive",title:"Save Failed",description:"Could not save event."})}};return(0,s.jsx)(C.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(C.Cf,{children:[(0,s.jsxs)(C.c7,{children:[(0,s.jsx)(C.L3,{children:l?"Edit Event":"Add New Event"}),(0,s.jsx)(C.rr,{children:l?"Editing event on ".concat((0,c.GP)(new Date(l.startDate),"PPP")):"Create a new event."})]}),(0,s.jsx)(D.lV,{...K,children:(0,s.jsxs)("form",{onSubmit:K.handleSubmit(Q),className:"space-y-4",children:[(0,s.jsx)(D.zB,{name:"title",control:K.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(D.eI,{children:[(0,s.jsx)(D.lR,{children:"Title"}),(0,s.jsx)(D.MJ,{children:(0,s.jsx)(S.p,{...t})}),(0,s.jsx)(D.C5,{})]})}}),(0,s.jsx)(D.zB,{name:"description",control:K.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(D.eI,{children:[(0,s.jsx)(D.lR,{children:"Description"}),(0,s.jsx)(D.MJ,{children:(0,s.jsx)(P.T,{...t})})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(D.zB,{name:"startDate",control:K.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(D.eI,{className:"flex flex-col",children:[(0,s.jsx)(D.lR,{children:"Start Date"}),(0,s.jsxs)(A.AM,{children:[(0,s.jsx)(A.Wv,{asChild:!0,children:(0,s.jsx)(D.MJ,{children:(0,s.jsxs)(h.$,{variant:"outline",className:(0,k.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,c.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"}),(0,s.jsx)(z.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(A.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(T,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e<new Date("0001-01-01T00:00:00"),initialFocus:!0})})]}),(0,s.jsx)(D.C5,{})]})}}),(0,s.jsx)(D.zB,{name:"endDate",control:K.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(D.eI,{className:"flex flex-col",children:[(0,s.jsx)(D.lR,{children:"End Date (Optional)"}),(0,s.jsxs)(A.AM,{children:[(0,s.jsx)(A.Wv,{asChild:!0,children:(0,s.jsx)(D.MJ,{children:(0,s.jsxs)(h.$,{variant:"outline",className:(0,k.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,c.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"}),(0,s.jsx)(z.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(A.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(T,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e<(H||new Date("0001-01-01T00:00:00")),initialFocus:!0})})]}),(0,s.jsx)(D.C5,{})]})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(D.lR,{children:"Responsible Party (Optional)"}),B?(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[B.name," ",(0,s.jsxs)("span",{className:"text-sm text-muted-foreground capitalize",children:["(",B.type,")"]})]}),(0,s.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(null),children:(0,s.jsx)(L.A,{className:"h-4 w-4"})})]}):(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[(0,s.jsx)(q,{items:f,onSelectItem:e=>W({...e,type:"faction"}),trigger:(0,s.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,s.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Faction"]}),title:"Select a Faction"}),(0,s.jsx)(q,{items:x,onSelectItem:e=>W({...e,type:"creature"}),trigger:(0,s.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,s.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Creature"]}),title:"Select a Creature"}),(0,s.jsx)(q,{items:F,onSelectItem:e=>W({...e,type:"npc"}),trigger:(0,s.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,s.jsx)($.A,{className:"h-4 w-4 mr-2"}),"NPC"]}),title:"Select an NPC"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(D.lR,{children:"Location (Optional)"}),Z?(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,s.jsxs)("p",{className:"font-semibold text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Map:"})," ",Z.mapName,(0,s.jsx)("span",{className:"text-muted-foreground ml-2",children:"Tile:"})," Q:",Z.hex.q,", R:",Z.hex.r]}),(0,s.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>J(null),children:(0,s.jsx)(L.A,{className:"h-4 w-4"})})]}):(0,s.jsx)(X,{onLocationSelect:e=>{var t;let{mapId:a,hex:s}=e,r=(null==(t=O.find(e=>e.id===a))?void 0:t.name)||"Unknown Map";J({mapId:a,mapName:r,hex:s})},children:(0,s.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full mt-2",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"})," Select Location on Map"]})})]}),(0,s.jsx)(D.zB,{name:"tags",control:K.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(D.eI,{children:[(0,s.jsx)(D.lR,{children:"Tags"}),(0,s.jsx)(D.MJ,{children:(0,s.jsx)(E.F,{value:t.value||[],onChange:t.onChange,tagSource:"calendar",placeholder:"Add tags..."})})]})}}),(0,s.jsxs)(C.Es,{children:[(0,s.jsx)(h.$,{type:"button",variant:"ghost",onClick:()=>a(!1),children:"Cancel"}),(0,s.jsx)(h.$,{type:"submit",children:"Save Event"})]})]})})]})})}var Z=a(90010),J=a(26126),K=a(56013),V=a(18046),H=a(10518),Q=a(18763),Y=a(77223),ee=a(82489);let et=async()=>{let e=(await (0,ee.Lf)()).transaction(ee.qo,"readonly").objectStore(ee.qo).getAll();return new Promise((t,a)=>{e.onsuccess=()=>{t(e.result.sort((e,t)=>e.name.localeCompare(t.name)))},e.onerror=()=>a(e.error)})},ea=async e=>{let t=(await (0,ee.Lf)()).transaction(ee.qo,"readwrite").objectStore(ee.qo),a=(0,ee.$C)(),s={...e,id:a},r=t.add(s);return new Promise((e,t)=>{r.onsuccess=()=>e(a),r.onerror=()=>t(r.error)})},es=async e=>{let t=(await (0,ee.Lf)()).transaction(ee.qo,"readwrite").objectStore(ee.qo).put(e);return new Promise((e,a)=>{t.onsuccess=()=>e(),t.onerror=()=>a(t.error)})},er=async e=>{let t=(await (0,ee.Lf)()).transaction([ee.qo,ee.$],"readwrite"),a=t.objectStore(ee.qo),s=t.objectStore(ee.$),r=s.index("by_calendar");return new Promise((n,l)=>{a.delete(e).onerror=l;let i=r.openKeyCursor(IDBKeyRange.only(e));i.onsuccess=()=>{let e=i.result;e&&(s.delete(e.primaryKey),e.continue())},i.onerror=l,t.oncomplete=()=>n(),t.onerror=()=>l(t.error)})};var en=a(20031),el=a(22346);function ei(e){let{calendars:t,onCalendarsUpdate:a}=e,[n,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(""),[o,d]=(0,r.useState)(null),[x,u]=(0,r.useState)(""),{toast:j}=(0,m.dj)(),p=async()=>{if(i.trim())try{let e=await ea({name:i.trim()});j({title:"Calendar Created",description:'"'.concat(i,'" has been added.')}),c(""),a(e),l(!1)}catch(e){j({variant:"destructive",title:"Error",description:"Failed to create calendar."})}},f=e=>{d(e.id),u(e.name)},v=()=>{d(null),u("")},w=async()=>{if(o&&x.trim())try{await es({id:o,name:x.trim()}),j({title:"Calendar Renamed"}),a(),v()}catch(e){j({variant:"destructive",title:"Error",description:"Failed to rename calendar."})}},g=async e=>{try{await er(e),j({title:"Calendar Deleted"}),a()}catch(e){j({variant:"destructive",title:"Error",description:"Failed to delete calendar and its events."})}};return(0,s.jsxs)(C.lG,{open:n,onOpenChange:l,children:[(0,s.jsx)(C.zM,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",children:(0,s.jsx)(K.A,{className:"h-5 w-5"})})}),(0,s.jsxs)(C.Cf,{children:[(0,s.jsxs)(C.c7,{children:[(0,s.jsx)(C.L3,{children:"Manage Calendars"}),(0,s.jsx)(C.rr,{children:"Add, rename, or delete your calendars."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.p,{placeholder:"New calendar name...",value:i,onChange:e=>c(e.target.value)}),(0,s.jsxs)(h.$,{onClick:p,disabled:!i.trim(),children:[(0,s.jsx)(V.A,{className:"h-4 w-4"})," Add"]})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(e=>(0,s.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:o===e.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.p,{value:x,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&w()},className:"h-8",autoFocus:!0}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(h.$,{size:"icon",className:"h-7 w-7",onClick:w,"aria-label":"Save",children:(0,s.jsx)(H.A,{className:"h-4 w-4"})}),(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:v,"aria-label":"Cancel",children:(0,s.jsx)(L.A,{className:"h-4 w-4"})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,s.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>f(e),"aria-label":"Edit",children:(0,s.jsx)(Q.A,{className:"h-4 w-4"})}),(0,s.jsxs)(Z.Lt,{children:[(0,s.jsx)(Z.tv,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,s.jsx)(Y.A,{className:"h-4 w-4 text-destructive"})})}),(0,s.jsxs)(Z.EO,{children:[(0,s.jsxs)(Z.wd,{children:[(0,s.jsx)(Z.r7,{children:"Are you sure?"}),(0,s.jsxs)(Z.$v,{children:['This will permanently delete the "',e.name,'" calendar and all of its events.']})]}),(0,s.jsxs)(Z.ck,{children:[(0,s.jsx)(Z.Zr,{children:"Cancel"}),(0,s.jsx)(Z.Rx,{onClick:()=>g(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function ec(){var e;let[t,a]=(0,r.useState)([]),[j,p]=(0,r.useState)([]),[f,v]=(0,r.useState)("all"),[w,g]=(0,r.useState)(new Date),[y,N]=(0,r.useState)(new Date),[C,D]=(0,r.useState)(!1),[S,P]=(0,r.useState)(null),{toast:A}=(0,m.dj)(),E=async e=>{try{let t=await et();if(0===t.length){let e=await ea({name:"Default"}),t=[{id:e,name:"Default"}];p(t),v(e),a([]);let s=new Date("0001-01-01T00:00:00");g(s),N(s);return}p(t);let s=e;t.find(t=>t.id===e)||"all"===e||(s="all",v("all"));let r=await (0,b.bj)(s);if(a(r),r.length>0){let e=[...r].sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime()),t=(0,n.o)(new Date(e[0].startDate));g(t),N(t)}else{let e=new Date("0001-01-01T00:00:00");g(e),N(e)}}catch(e){A({variant:"destructive",title:"Error",description:"Failed to load calendar data."})}},k=e=>{e?v(e):E(f)};(0,r.useEffect)(()=>{E(f)},[f]);let z=e=>{P(e),D(!0)},L=async e=>{try{await (0,b.At)(e),A({title:"Event Deleted"}),k()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to delete event."})}},R=(0,r.useMemo)(()=>w?t.filter(e=>(0,l.v)(w,{start:(0,n.o)(new Date(e.startDate)),end:(0,n.o)(new Date(e.endDate))})).sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime()):[],[t,w]),$=(0,r.useMemo)(()=>t.flatMap(e=>(0,i.k)({start:(0,n.o)(new Date(e.startDate)),end:(0,n.o)(new Date(e.endDate))})),[t]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(en.GB,{children:[(0,s.jsx)(x.A,{children:(0,s.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,s.jsx)(en.Bx,{style:{"--sidebar-width":"380px"},children:(0,s.jsxs)("div",{className:"p-4 space-y-4 h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(G.l6,{value:f,onValueChange:v,children:[(0,s.jsx)(G.bq,{className:"flex-1",children:(0,s.jsx)(G.yv,{placeholder:"Select a calendar"})}),(0,s.jsxs)(G.gC,{children:[(0,s.jsx)(G.eb,{value:"all",children:"All Calendars"}),j.map(e=>(0,s.jsx)(G.eb,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsx)(ei,{calendars:j,onCalendarsUpdate:k})]}),(0,s.jsx)(h.$,{onClick:()=>{P(null),D(!0)},children:"Add Event"}),(0,s.jsx)(el.w,{}),(0,s.jsxs)(u.Zp,{className:"flex-1 flex flex-col min-h-0",children:[(0,s.jsx)(u.aR,{children:(0,s.jsxs)(u.ZB,{children:["Events for ",w?(0,c.GP)(w,"PPP"):"..."]})}),(0,s.jsx)(u.Wu,{className:"flex-1 min-h-0",children:(0,s.jsx)(O.F,{className:"h-full",children:R.length>0?(0,s.jsx)("div",{className:"space-y-4 pr-4",children:R.map(e=>(0,s.jsxs)(u.Zp,{className:"bg-card-foreground/5",children:[(0,s.jsx)(u.aR,{className:"pb-2",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("div",{children:(0,s.jsx)(u.ZB,{className:"text-lg",children:e.title})}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>z(e),children:(0,s.jsx)(Q.A,{className:"h-4 w-4"})}),(0,s.jsxs)(Z.Lt,{children:[(0,s.jsx)(Z.tv,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",children:(0,s.jsx)(Y.A,{className:"h-4 w-4 text-destructive"})})}),(0,s.jsxs)(Z.EO,{children:[(0,s.jsxs)(Z.wd,{children:[(0,s.jsx)(Z.r7,{children:"Are you sure?"}),(0,s.jsxs)(Z.$v,{children:['This will permanently delete "',e.title,'".']})]}),(0,s.jsxs)(Z.ck,{children:[(0,s.jsx)(Z.Zr,{children:"Cancel"}),(0,s.jsx)(Z.Rx,{onClick:()=>L(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})}),(0,s.jsxs)(u.Wu,{children:[(0,s.jsxs)(u.BT,{className:"text-xs",children:["From: ",(0,c.GP)(new Date(e.startDate),"P")," To: ",(0,c.GP)(new Date(e.endDate),"P")]}),e.description&&(0,s.jsx)("p",{className:"text-sm mt-2",children:e.description}),e.party&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Party: ",(0,s.jsxs)("span",{className:"font-semibold text-accent",children:[e.party.name," (",e.party.type,")"]})]}),e.location&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[(0,s.jsx)(_.A,{className:"h-3 w-3"})," Location set"]}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map(e=>(0,s.jsx)(J.E,{variant:"secondary",children:e},e))})]})]},e.id))}):(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No events for this day."})})})]})]})}),(0,s.jsx)(en.sF,{className:"flex-1 flex flex-col overflow-hidden bg-background/50",children:(0,s.jsx)(d.Ay,{onChange:e=>{e instanceof Date&&g(e)},value:w,activeStartDate:y,onActiveStartDateChange:e=>{let{activeStartDate:t}=e;return t&&N(t)},minDate:new Date("0001-01-01T00:00:00"),maxDate:new Date(new Date().getFullYear()+100,11,31),tileContent:e=>{let{date:t,view:a}=e;return"month"===a&&$.some(e=>(0,o.r)(e,t))?(0,s.jsx)("div",{className:"event-dot"}):null},className:"w-full h-full",weekStartsOn:1,next2Label:null,prev2Label:null})})]})}),(0,s.jsx)(W,{isOpen:C,onOpenChange:D,onSaveSuccess:()=>{k(),D(!1),P(null)},event:S,defaultCalendarId:"all"===f?(null==(e=j[0])?void 0:e.id)||"":f,initialDate:w||new Date})]})})}},69415:(e,t,a)=>{"use strict";a.d(t,{ES:()=>n,NV:()=>l,Pb:()=>c,Qg:()=>r,T2:()=>i});var s=a(82489);let r=async()=>{let e=(await (0,s.Lf)()).transaction(s.Xc,"readonly").objectStore(s.Xc).getAll();return new Promise((t,a)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>a(e.error)})},n=async e=>{let t=(await (0,s.Lf)()).transaction(s.Xc,"readonly").objectStore(s.Xc).get(e);return new Promise((e,a)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>a(t.error)})},l=async e=>{let t=(await (0,s.Lf)()).transaction(s.Xc,"readwrite").objectStore(s.Xc),a=(0,s.$C)(),r={...e,id:a},n=t.add(r);return new Promise((e,t)=>{n.onsuccess=()=>e(a),n.onerror=()=>t(n.error)})},i=async e=>{let t=(await (0,s.Lf)()).transaction(s.Xc,"readwrite").objectStore(s.Xc).put(e);return new Promise((e,a)=>{t.onsuccess=()=>e(),t.onerror=()=>a(t.error)})},c=async e=>{let t=(await (0,s.Lf)()).transaction(s.Xc,"readwrite").objectStore(s.Xc).delete(e);return new Promise((e,a)=>{t.onsuccess=()=>e(),t.onerror=()=>a(t.error)})}}},e=>{var t=t=>e(e.s=t);e.O(0,[222,676,670,49,451,720,347,516,352,441,684,358],()=>t(13772)),_N_E=e.O()}]);
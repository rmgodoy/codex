"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3690],{23690:(e,s,t)=>{t.r(s),t.d(s,{default:()=>q});var l=t(95155),a=t(12115),r=t(6195),i=t(20031),n=t(47906),c=t(34239),d=t(62523),o=t(30285),x=t(66424),h=t(22346),j=t(87481),m=t(34301),u=t(75074),p=t(9572),f=t(20203),g=t(73926),v=t(85057),N=t(59409),w=t(90648),b=t(8643);function y(e){let{onSelectRace:s,onNewRace:t,selectedRaceId:r,dataVersion:i,filters:n,setFilters:y,onClearFilters:C}=e,[S,z]=(0,a.useState)([]),[R,k]=(0,a.useState)(!0),{toast:T}=(0,j.dj)();(0,a.useEffect)(()=>{(async()=>{k(!0);try{z(await (0,c.E1)())}catch(e){T({variant:"destructive",title:"Error",description:"Could not fetch races from database."})}finally{k(!1)}})()},[i,T]);let A=(0,a.useMemo)(()=>{let e=S.filter(e=>{let s=e.name.toLowerCase().includes(n.searchTerm.toLowerCase()),t=!0,l=n.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return l.length>0&&(t=!!e.tags&&l.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>e.name.localeCompare(s.name));return"desc"===n.sortOrder&&e.reverse(),e},[S,n]);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)(o.$,{onClick:t,className:"w-full",children:[(0,l.jsx)(m.A,{})," New Race"]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(u.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(d.p,{placeholder:"Search races...",value:n.searchTerm,onChange:e=>y.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,l.jsxs)(b.Nt,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(b.R6,{asChild:!0,children:(0,l.jsxs)(o.$,{variant:"ghost",className:"-ml-2",children:[(0,l.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Filters"]})}),(0,l.jsx)(o.$,{variant:"ghost",size:"sm",onClick:C,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,l.jsx)(b.Ke,{className:"space-y-2 pt-2",children:(0,l.jsx)(w.F,{value:n.tagFilter?n.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>y.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"race"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(v.J,{children:"Sort by"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(N.l6,{value:n.sortBy,onValueChange:e=>y.setSortBy(e),children:[(0,l.jsx)(N.bq,{children:(0,l.jsx)(N.yv,{placeholder:"Sort by"})}),(0,l.jsx)(N.gC,{children:(0,l.jsx)(N.eb,{value:"name",children:"Name"})})]}),(0,l.jsxs)(o.$,{variant:"ghost",size:"icon",onClick:()=>y.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===n.sortOrder?(0,l.jsx)(f.A,{className:"h-4 w-4"}):(0,l.jsx)(g.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,l.jsx)(h.w,{}),(0,l.jsx)(x.F,{className:"flex-1",children:(0,l.jsx)("div",{className:"p-4",children:R?(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading races..."}):A.length>0?(0,l.jsx)("ul",{className:"space-y-1",children:A.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(r===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"No races found."})})})]})}var C=t(62177),S=t(90221),z=t(55594),R=t(66695),k=t(88539),T=t(90010),A=t(17759),E=t(12543),$=t(18763),B=t(77223),F=t(25318),I=t(18046),L=t(53054),D=t(68856),Z=t(26126);let J=z.z.object({id:z.z.string(),title:z.z.string().min(1,"Trait title is required"),description:z.z.string().min(1,"Trait description is required")}),V=z.z.object({name:z.z.string().min(1,"Race name is required"),appearance:z.z.string().optional(),location:z.z.string().optional(),description:z.z.string().optional(),traits:z.z.array(J).optional(),tags:z.z.array(z.z.string()).optional()}),M={name:"",appearance:"",location:"",description:"",traits:[],tags:[]};function O(e){let{raceId:s,isCreatingNew:t,onSaveSuccess:r,onDeleteSuccess:i,onEditCancel:x,onBack:m,dataVersion:u}=e,{toast:p}=(0,j.dj)(),[f,g]=(0,a.useState)(t),[v,N]=(0,a.useState)(!t&&!!s),[b,y]=(0,a.useState)(null),z=(0,n.a)(),J=(0,C.mN)({resolver:(0,S.u)(V),defaultValues:M}),{fields:O,append:q,remove:G}=(0,C.jz)({control:J.control,name:"traits"});(0,a.useEffect)(()=>{(async()=>{if(t){J.reset(M),y(null),g(!0),N(!1);return}if(!s){g(!1),N(!1),y(null);return}N(!0),g(!1);try{let e=await (0,c.OR)(s);e?(J.reset(e),y(e)):y(null)}catch(e){p({variant:"destructive",title:"Error",description:"Could not load race data."})}finally{N(!1)}})()},[s,t,J,p,u]);let W=()=>{t?x():b&&(J.reset(b),g(!1))},_=async e=>{try{let l={...e,tags:e.tags||[],traits:e.traits||[]},a=e.tags||[];if(a.length>0&&await (0,c.JE)(a,"race"),t){let s=await (0,c.fn)(l);p({title:"Race Created!",description:"".concat(e.name," has been added.")}),r(s)}else s&&(await (0,c.v1)({...l,id:s}),p({title:"Save Successful",description:"".concat(e.name," has been updated.")}),r(s));g(!1)}catch(e){p({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},U=async()=>{if(s)try{await (0,c.ZZ)(s),p({title:"Race Deleted",description:"The race has been removed."}),i()}catch(e){p({variant:"destructive",title:"Deletion Failed",description:"Could not delete the race."})}};return v?(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(R.Zp,{children:[(0,l.jsx)(R.aR,{children:(0,l.jsx)(D.E,{className:"h-8 w-48"})}),(0,l.jsx)(R.Wu,{children:(0,l.jsx)(D.E,{className:"h-40 w-full"})})]})}):s||t?!f&&b?(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(R.Zp,{children:[(0,l.jsx)(R.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[z&&m&&(0,l.jsx)(o.$,{variant:"ghost",size:"icon",onClick:m,className:"shrink-0 -ml-2 -mt-1",children:(0,l.jsx)(E.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{children:(0,l.jsx)(R.ZB,{className:"text-3xl font-bold",children:b.name})})]}),(0,l.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[(0,l.jsx)($.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,l.jsx)(R.Wu,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"General Description"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:b.description||"Not specified."})]}),(0,l.jsx)(h.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"General Appearance"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:b.appearance||"Not specified."})]}),(0,l.jsx)(h.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Typical Location"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:b.location||"Not specified."})]}),(0,l.jsx)(h.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Traits"}),b.traits.length>0?(0,l.jsx)("ul",{className:"space-y-2",children:b.traits.map(e=>(0,l.jsxs)("li",{children:[(0,l.jsxs)("span",{className:"font-bold",children:[e.title,":"]})," ",e.description]},e.id))}):(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"No traits defined."})]}),b.tags&&b.tags.length>0&&(0,l.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:b.tags.map(e=>(0,l.jsx)(Z.E,{variant:"secondary",children:e},e))})})]})}),(0,l.jsx)(R.wL,{children:(0,l.jsxs)(T.Lt,{children:[(0,l.jsx)(T.tv,{asChild:!0,children:(0,l.jsx)(o.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(B.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(T.EO,{children:[(0,l.jsxs)(T.wd,{children:[(0,l.jsx)(T.r7,{children:"Are you sure?"}),(0,l.jsxs)(T.$v,{children:['This will permanently delete "',b.name,'".']})]}),(0,l.jsxs)(T.ck,{children:[(0,l.jsx)(T.Zr,{children:"Cancel"}),(0,l.jsx)(T.Rx,{onClick:U,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(R.Zp,{children:(0,l.jsx)(A.lV,{...J,children:(0,l.jsxs)("form",{onSubmit:J.handleSubmit(_),className:"space-y-6",children:[(0,l.jsx)(R.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[z&&m&&(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:x,className:"shrink-0 -ml-2",children:(0,l.jsx)(E.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{children:(0,l.jsx)(R.ZB,{children:t?z?"New Race":"Create New Race":"Editing: ".concat(J.getValues("name")||"...")})})]}),!z&&(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:W,className:"text-muted-foreground hover:text-foreground",children:(0,l.jsx)(F.A,{className:"h-5 w-5"})})]})}),(0,l.jsxs)(R.Wu,{className:"space-y-6",children:[(0,l.jsx)(A.zB,{name:"name",control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"Name"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(d.p,{...s})}),(0,l.jsx)(A.C5,{})]})}}),(0,l.jsx)(A.zB,{name:"description",control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"General Description"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(k.T,{...s,rows:4})})]})}}),(0,l.jsx)(A.zB,{name:"appearance",control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"General Appearance"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(k.T,{...s,rows:3})})]})}}),(0,l.jsx)(A.zB,{name:"location",control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"Typical Location"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(k.T,{...s,rows:2})})]})}}),(0,l.jsx)(h.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Traits"}),(0,l.jsxs)(o.$,{type:"button",size:"sm",variant:"outline",onClick:()=>q({id:crypto.randomUUID(),title:"",description:""}),children:[(0,l.jsx)(I.A,{className:"h-4 w-4 mr-2"})," Add Trait"]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[O.map((e,s)=>(0,l.jsxs)("div",{className:"border p-4 rounded-md bg-muted/50 space-y-3 relative",children:[(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-7 w-7 text-muted-foreground hover:text-destructive",onClick:()=>G(s),children:(0,l.jsx)(B.A,{className:"h-4 w-4"})}),(0,l.jsx)(A.zB,{name:"traits.".concat(s,".title"),control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"Title"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(d.p,{...s})}),(0,l.jsx)(A.C5,{})]})}}),(0,l.jsx)(A.zB,{name:"traits.".concat(s,".description"),control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsx)(A.lR,{children:"Description"}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(k.T,{...s,rows:2})}),(0,l.jsx)(A.C5,{})]})}})]},e.id)),0===O.length&&(0,l.jsx)("p",{className:"text-center text-sm text-muted-foreground py-4",children:"No traits added yet."})]})]}),(0,l.jsx)(h.w,{}),(0,l.jsx)(A.zB,{name:"tags",control:J.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(A.eI,{children:[(0,l.jsxs)(A.lR,{className:"flex items-center gap-2",children:[(0,l.jsx)(L.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,l.jsx)(A.MJ,{children:(0,l.jsx)(w.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"race"})}),(0,l.jsx)(A.C5,{})]})}})]}),(0,l.jsxs)(R.wL,{className:"flex items-center gap-2",children:[!t&&(0,l.jsxs)(T.Lt,{children:[(0,l.jsx)(T.tv,{asChild:!0,children:(0,l.jsx)(o.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(B.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(T.EO,{children:[(0,l.jsxs)(T.wd,{children:[(0,l.jsx)(T.r7,{children:"Are you sure?"}),(0,l.jsxs)(T.$v,{children:['This will permanently delete "',J.getValues("name"),'".']})]}),(0,l.jsxs)(T.ck,{children:[(0,l.jsx)(T.Zr,{children:"Cancel"}),(0,l.jsx)(T.Rx,{onClick:U,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,l.jsx)("div",{className:"flex-grow"}),!z&&(0,l.jsx)(o.$,{type:"button",variant:"outline",onClick:W,children:"Cancel"}),(0,l.jsx)(o.$,{type:"submit",children:t?"Create Race":"Save Changes"})]})]})})})}):(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(R.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,l.jsxs)(R.Wu,{className:"text-center pt-6",children:[(0,l.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a race to view"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}function q(e){let{selectedId:s}=e,[t,c]=(0,a.useState)(s||null),[d,o]=(0,a.useState)(!1),[x,h]=(0,a.useState)(0),[j,m]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[f,g]=(0,a.useState)("name"),[v,N]=(0,a.useState)("asc"),[w,b]=(0,a.useState)(!1),C=(0,n.a)(),[S,z]=(0,a.useState)("list");(0,a.useEffect)(()=>{b(!0),s&&(c(s),C&&z("editor"))},[s,C]);let R={searchTerm:j,tagFilter:u,sortBy:f,sortOrder:v},k={setSearchTerm:m,setTagFilter:p,setSortBy:g,setSortOrder:N},T=()=>{m(""),p(""),g("name"),N("asc")},A=()=>h(e=>e+1),E=e=>{c(e),o(!1),C&&z("editor")},$=()=>{c(null),o(!0),C&&z("editor")},B=e=>{A(),c(e),o(!1),C&&z("editor")},F=()=>{A(),c(null),o(!1),C&&z("list")},I=()=>{d&&(o(!1),c(null),C&&z("list"))};return w?C?(0,l.jsx)(r.A,{showSidebarTrigger:!1,children:(0,l.jsx)("div",{className:"h-full w-full",children:"list"===S?(0,l.jsx)(y,{onSelectRace:E,onNewRace:$,selectedRaceId:t,dataVersion:x,filters:R,setFilters:k,onClearFilters:T}):(0,l.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,l.jsx)("div",{className:"p-4 sm:p-6",children:(0,l.jsx)(O,{raceId:t,isCreatingNew:d,onSaveSuccess:B,onDeleteSuccess:F,onEditCancel:I,onBack:()=>{z("list"),c(null),o(!1)},dataVersion:x},null!=t?t:d?"new":"placeholder")})})})}):(0,l.jsx)(i.SidebarProvider,{children:(0,l.jsx)(r.A,{children:(0,l.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,l.jsx)(i.Bx,{style:{"--sidebar-width":"380px"},children:(0,l.jsx)(y,{onSelectRace:E,onNewRace:$,selectedRaceId:t,dataVersion:x,filters:R,setFilters:k,onClearFilters:T})}),(0,l.jsx)(i.sF,{className:"flex-1 overflow-y-auto",children:(0,l.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,l.jsx)(O,{raceId:t,isCreatingNew:d,onSaveSuccess:B,onDeleteSuccess:F,onEditCancel:I,dataVersion:x},null!=t?t:d?"new":"placeholder")})})]})})}):null}}}]);
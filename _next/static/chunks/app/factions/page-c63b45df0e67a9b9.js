(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3950],{8643:(e,s,t)=>{"use strict";t.d(s,{Ke:()=>n,Nt:()=>a,R6:()=>r});var l=t(27242);let a=l.bL,r=l.R6,n=l.Ke},9572:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(40157).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},53010:(e,s,t)=>{Promise.resolve().then(t.bind(t,71608))},68856:(e,s,t)=>{"use strict";t.d(s,{E:()=>r});var l=t(95155),a=t(59434);function r(e){let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",s),...t})}},71608:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>J});var l=t(95155),a=t(12115),r=t(15019),n=t(62523),i=t(30285),c=t(66424),d=t(22346),o=t(87481),x=t(34301),h=t(75074),u=t(9572),m=t(20203),j=t(73926),f=t(85057),p=t(59409),v=t(90648),g=t(8643);function N(e){let{onSelectFaction:s,onNewFaction:t,selectedFactionId:N,dataVersion:w,filters:y,setFilters:b,onClearFilters:C}=e,[S,F]=(0,a.useState)([]),[k,A]=(0,a.useState)(!0),{toast:E}=(0,o.dj)();(0,a.useEffect)(()=>{(async()=>{A(!0);try{F(await (0,r.vq)())}catch(e){E({variant:"destructive",title:"Error",description:"Could not fetch factions from database."})}finally{A(!1)}})()},[w,E]);let z=(0,a.useMemo)(()=>{let e=S.filter(e=>{let s=e.name.toLowerCase().includes(y.searchTerm.toLowerCase()),t=!0,l=y.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return l.length>0&&(t=!!e.tags&&l.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>e.name.localeCompare(s.name));return"desc"===y.sortOrder&&e.reverse(),e},[S,y]);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)(i.$,{onClick:t,className:"w-full",children:[(0,l.jsx)(x.A,{})," New Faction"]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(h.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(n.p,{placeholder:"Search factions...",value:y.searchTerm,onChange:e=>b.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,l.jsxs)(g.Nt,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(g.R6,{asChild:!0,children:(0,l.jsxs)(i.$,{variant:"ghost",className:"-ml-2",children:[(0,l.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Filters"]})}),(0,l.jsx)(i.$,{variant:"ghost",size:"sm",onClick:C,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,l.jsx)(g.Ke,{className:"space-y-2 pt-2",children:(0,l.jsx)(v.F,{value:y.tagFilter?y.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>b.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"faction"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(f.J,{children:"Sort by"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(p.l6,{value:y.sortBy,onValueChange:e=>b.setSortBy(e),children:[(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Sort by"})}),(0,l.jsx)(p.gC,{children:(0,l.jsx)(p.eb,{value:"name",children:"Name"})})]}),(0,l.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>b.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===y.sortOrder?(0,l.jsx)(m.A,{className:"h-4 w-4"}):(0,l.jsx)(j.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,l.jsx)(d.w,{}),(0,l.jsx)(c.F,{className:"flex-1",children:(0,l.jsx)("div",{className:"p-4",children:k?(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading factions..."}):z.length>0?(0,l.jsx)("ul",{className:"space-y-1",children:z.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(N===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"No factions found."})})})]})}var w=t(62177),y=t(90221),b=t(55594),C=t(66695),S=t(88539),F=t(90010),k=t(17759),A=t(12543),E=t(18763),z=t(77223),B=t(25318),T=t(53054),$=t(68856),R=t(26126),L=t(47906);let D=b.z.object({name:b.z.string().min(1,"Faction name is required"),description:b.z.string().optional(),goals:b.z.string().optional(),tags:b.z.array(b.z.string()).optional()}),I={name:"",description:"",goals:"",tags:[]};function Z(e){let{factionId:s,isCreatingNew:t,onSaveSuccess:c,onDeleteSuccess:x,onEditCancel:h,onBack:u}=e,{toast:m}=(0,o.dj)(),[j,f]=(0,a.useState)(t),[p,g]=(0,a.useState)(!t&&!!s),[N,b]=(0,a.useState)(null),Z=(0,L.a)(),O=(0,w.mN)({resolver:(0,y.u)(D),defaultValues:I});(0,a.useEffect)(()=>{(async()=>{if(t){O.reset(I),b(null),f(!0),g(!1);return}if(!s){f(!1),g(!1),b(null);return}g(!0),f(!1);try{let e=await (0,r.vR)(s);e?(O.reset(e),b(e)):b(null)}catch(e){m({variant:"destructive",title:"Error",description:"Could not load faction data."})}finally{g(!1)}})()},[s,t,O,m]);let V=()=>{t?h():N&&(O.reset(N),f(!1))},J=async e=>{try{let l={...e,tags:e.tags||[]},a=e.tags||[];if(a.length>0&&await (0,r.JE)(a,"faction"),t){let s=await (0,r.sB)(l);m({title:"Faction Created!",description:"".concat(e.name," has been added.")}),c(s)}else s&&(await (0,r.mu)({...l,id:s}),m({title:"Save Successful",description:"".concat(e.name," has been updated.")}),c(s));f(!1)}catch(e){m({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},_=async()=>{if(s)try{await (0,r.Bx)(s),m({title:"Faction Deleted",description:"The faction has been removed."}),x()}catch(e){m({variant:"destructive",title:"Deletion Failed",description:"Could not delete the faction."})}};return p?(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(C.Zp,{children:[(0,l.jsx)(C.aR,{children:(0,l.jsx)($.E,{className:"h-8 w-48"})}),(0,l.jsx)(C.Wu,{children:(0,l.jsx)($.E,{className:"h-40 w-full"})})]})}):s||t?!j&&N?(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(C.Zp,{children:[(0,l.jsx)(C.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[Z&&u&&(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2 -mt-1",children:(0,l.jsx)(A.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{children:(0,l.jsx)(C.ZB,{className:"text-3xl font-bold",children:N.name})})]}),(0,l.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>f(!0),children:[(0,l.jsx)(E.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,l.jsx)(C.Wu,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Description"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:N.description||"No description provided."})]}),(0,l.jsx)(d.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Goals"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:N.goals||"No goals provided."})]}),N.tags&&N.tags.length>0&&(0,l.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:N.tags.map(e=>(0,l.jsx)(R.E,{variant:"secondary",children:e},e))})})]})}),(0,l.jsx)(C.wL,{children:(0,l.jsxs)(F.Lt,{children:[(0,l.jsx)(F.tv,{asChild:!0,children:(0,l.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(z.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(F.EO,{children:[(0,l.jsxs)(F.wd,{children:[(0,l.jsx)(F.r7,{children:"Are you sure?"}),(0,l.jsxs)(F.$v,{children:['This will permanently delete "',N.name,'". This action cannot be undone.']})]}),(0,l.jsxs)(F.ck,{children:[(0,l.jsx)(F.Zr,{children:"Cancel"}),(0,l.jsx)(F.Rx,{onClick:_,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(C.Zp,{children:(0,l.jsx)(k.lV,{...O,children:(0,l.jsxs)("form",{onSubmit:O.handleSubmit(J),className:"space-y-6",children:[(0,l.jsx)(C.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[Z&&u&&(0,l.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:h,className:"shrink-0 -ml-2",children:(0,l.jsx)(A.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{children:(0,l.jsx)(C.ZB,{children:t?Z?"New Faction":"Create New Faction":"Editing: ".concat(O.getValues("name")||"...")})})]}),!Z&&(0,l.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:V,className:"text-muted-foreground hover:text-foreground",children:(0,l.jsx)(B.A,{className:"h-5 w-5"})})]})}),(0,l.jsxs)(C.Wu,{className:"space-y-6",children:[(0,l.jsx)(k.zB,{name:"name",control:O.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Name"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(n.p,{...s})}),(0,l.jsx)(k.C5,{})]})}}),(0,l.jsx)(k.zB,{name:"description",control:O.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Description"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(S.T,{...s,rows:4})})]})}}),(0,l.jsx)(k.zB,{name:"goals",control:O.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Goals"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(S.T,{...s,rows:4})})]})}}),(0,l.jsx)(k.zB,{name:"tags",control:O.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsxs)(k.lR,{className:"flex items-center gap-2",children:[(0,l.jsx)(T.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(v.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"faction"})}),(0,l.jsx)(k.C5,{})]})}})]}),(0,l.jsxs)(C.wL,{className:"flex items-center gap-2",children:[!t&&(0,l.jsxs)(F.Lt,{children:[(0,l.jsx)(F.tv,{asChild:!0,children:(0,l.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(z.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(F.EO,{children:[(0,l.jsxs)(F.wd,{children:[(0,l.jsx)(F.r7,{children:"Are you sure?"}),(0,l.jsxs)(F.$v,{children:['This will permanently delete "',O.getValues("name"),'".']})]}),(0,l.jsxs)(F.ck,{children:[(0,l.jsx)(F.Zr,{children:"Cancel"}),(0,l.jsx)(F.Rx,{onClick:_,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,l.jsx)("div",{className:"flex-grow"}),!Z&&(0,l.jsx)(i.$,{type:"button",variant:"outline",onClick:V,children:"Cancel"}),(0,l.jsx)(i.$,{type:"submit",children:t?"Create Faction":"Save Changes"})]})]})})})}):(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(C.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,l.jsxs)(C.Wu,{className:"text-center pt-6",children:[(0,l.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a faction to view"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}var O=t(6195),V=t(20031);function J(e){let{selectedId:s}=e,[t,r]=(0,a.useState)(s||null),[n,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(0),[o,x]=(0,a.useState)(""),[h,u]=(0,a.useState)(""),[m,j]=(0,a.useState)("name"),[f,p]=(0,a.useState)("asc"),[v,g]=(0,a.useState)(!1),w=(0,L.a)(),[y,b]=(0,a.useState)("list");(0,a.useEffect)(()=>{g(!0),s&&(r(s),w&&b("editor"))},[s,w]);let C={searchTerm:o,tagFilter:h,sortBy:m,sortOrder:f},S={setSearchTerm:x,setTagFilter:u,setSortBy:j,setSortOrder:p},F=()=>{x(""),u(""),j("name"),p("asc")},k=()=>d(e=>e+1),A=e=>{r(e),i(!1),w&&b("editor")},E=()=>{r(null),i(!0),w&&b("editor")},z=e=>{k(),r(e),i(!1),w&&b("editor")},B=()=>{k(),r(null),i(!1),w&&b("list")},T=()=>{n&&(i(!1),r(null),w&&b("list"))};return v?w?(0,l.jsx)(O.A,{showSidebarTrigger:!1,children:(0,l.jsx)("div",{className:"h-full w-full",children:"list"===y?(0,l.jsx)(N,{onSelectFaction:A,onNewFaction:E,selectedFactionId:t,dataVersion:c,filters:C,setFilters:S,onClearFilters:F}):(0,l.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,l.jsx)("div",{className:"p-4 sm:p-6",children:(0,l.jsx)(Z,{factionId:t,isCreatingNew:n,onSaveSuccess:z,onDeleteSuccess:B,onEditCancel:T,onBack:()=>{b("list"),r(null),i(!1)}},null!=t?t:n?"new":"placeholder")})})})}):(0,l.jsx)(V.SidebarProvider,{children:(0,l.jsx)(O.A,{children:(0,l.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,l.jsx)(V.Bx,{style:{"--sidebar-width":"380px"},children:(0,l.jsx)(N,{onSelectFaction:A,onNewFaction:E,selectedFactionId:t,dataVersion:c,filters:C,setFilters:S,onClearFilters:F})}),(0,l.jsx)(V.sF,{className:"flex-1 overflow-y-auto",children:(0,l.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,l.jsx)(Z,{factionId:t,isCreatingNew:n,onSaveSuccess:z,onDeleteSuccess:B,onEditCancel:T},null!=t?t:n?"new":"placeholder")})})]})})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[3373,8439,5636,6430,7242,9609,6004,7737,9516,8441,1684,7358],()=>s(53010)),_N_E=e.O()}]);
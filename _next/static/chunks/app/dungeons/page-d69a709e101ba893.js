(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8],{36697:(e,s,t)=>{"use strict";t.d(s,{HN:()=>o,SP:()=>n,TG:()=>l,_w:()=>a,xX:()=>i});var r=t(82489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},74691:(e,s,t)=>{"use strict";t.d(s,{Ap:()=>n,Dp:()=>l,Ld:()=>i,qp:()=>a,vm:()=>o});var r=t(82489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},82373:(e,s,t)=>{Promise.resolve().then(t.bind(t,99012))},95376:(e,s,t)=>{"use strict";t.d(s,{J0:()=>n,OO:()=>o,RT:()=>a,sO:()=>i,yV:()=>l});var r=t(82489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.Qu,"readonly").objectStore(r.Qu).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.Qu,"readonly").objectStore(r.Qu).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.Qu,"readwrite").objectStore(r.Qu),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.Qu,"readwrite").objectStore(r.Qu).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.Qu,"readwrite").objectStore(r.Qu).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},98638:(e,s,t)=>{"use strict";t.d(s,{S9:()=>i,gL:()=>o,rD:()=>a,vV:()=>n,wo:()=>l});var r=t(82489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},99012:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ez});var r=t(95155),n=t(12115),a=t(62709),l=t(20031),i=t(95376),o=t(62523),c=t(30285),d=t(66424),u=t(22346),h=t(87481),m=t(34301),x=t(75074),j=t(20203),g=t(73926),p=t(85057),f=t(59409),v=t(90648);function w(e){let{onSelectDungeon:s,onNewDungeon:t,selectedDungeonId:a,dataVersion:l,filters:w,setFilters:y,onClearFilters:N}=e,[b,C]=(0,n.useState)([]),[S,k]=(0,n.useState)(!0),{toast:R}=(0,h.dj)();(0,n.useEffect)(()=>{(async()=>{k(!0);try{C(await (0,i.J0)())}catch(e){R({variant:"destructive",title:"Error",description:"Could not fetch dungeons from database."})}finally{k(!1)}})()},[l,R]);let z=(0,n.useMemo)(()=>{let e=b.filter(e=>{let s=e.name.toLowerCase().includes(w.searchTerm.toLowerCase()),t=!0,r=w.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return r.length>0&&(t=!!e.tags&&r.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>{if("threatRating"===w.sortBy){var t,r;let n=(null!=(t=e.threatRating)?t:0)-(null!=(r=s.threatRating)?r:0);if(0!==n)return n}return e.name.localeCompare(s.name)});return"desc"===w.sortOrder&&e.reverse(),e},[b,w]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)(c.$,{onClick:t,className:"w-full",children:[(0,r.jsx)(m.A,{})," New Dungeon"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(o.p,{placeholder:"Search dungeons...",value:w.searchTerm,onChange:e=>y.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(p.J,{children:"Filter"}),(0,r.jsx)(c.$,{variant:"ghost",size:"sm",onClick:N,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,r.jsx)(v.F,{value:w.tagFilter?w.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>y.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"dungeon"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(p.J,{children:"Sort by"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(f.l6,{value:w.sortBy,onValueChange:e=>y.setSortBy(e),children:[(0,r.jsx)(f.bq,{children:(0,r.jsx)(f.yv,{placeholder:"Sort by"})}),(0,r.jsxs)(f.gC,{children:[(0,r.jsx)(f.eb,{value:"name",children:"Name"}),(0,r.jsx)(f.eb,{value:"threatRating",children:"Threat Rating"})]})]}),(0,r.jsxs)(c.$,{variant:"ghost",size:"icon",onClick:()=>y.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===w.sortOrder?(0,r.jsx)(j.A,{className:"h-4 w-4"}):(0,r.jsx)(g.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,r.jsx)(u.w,{}),(0,r.jsx)(d.F,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4",children:S?(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading dungeons..."}):z.length>0?(0,r.jsx)("ul",{className:"space-y-1",children:z.map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(a===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,r.jsxs)("span",{className:"text-xs opacity-70",children:["(TR ",e.threatRating,")"]})]})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No dungeons found."})})})]})}var y=t(62177),N=t(90221),b=t(55594),C=t(36697),S=t(44218);let k={I:{name:"Bleak",targetNumber:10,threatRating:"2d6 x 10",threatRange:"20 to 120"},II:{name:"Sinister",targetNumber:12,threatRating:"2d6 x 20",threatRange:"40 to 240"},III:{name:"Frightening",targetNumber:15,threatRating:"2d6 x 30",threatRange:"60 to 360"},IV:{name:"Harrowing",targetNumber:18,threatRating:"2d6 x 40",threatRange:"80 to 480"},V:{name:"Nightmarish",targetNumber:20,threatRating:"2d6 x 50",threatRange:"100 to 600"}},R={Tiny:{rooms:"2D4 (~5)",treasureRoll:"2D6 X HOSTILITY"},Small:{rooms:"4D4 (~10)",treasureRoll:"4D6 X HOSTILITY"},Medium:{rooms:"6D4 (~15)",treasureRoll:"6D6 X HOSTILITY"},Large:{rooms:"8D4 (~20)",treasureRoll:"8D6 X HOSTILITY"},Huge:{rooms:"10D4 (~25)",treasureRoll:"10D6 X HOSTILITY"}},z=Object.keys(k),I=Object.keys(R);var A=t(66695),T=t(88539),L=t(90010),M=t(17759),P=t(18046),D=t(12543),E=t(21816),$=t(18763),V=t(77223),B=t(25318),F=t(81203),O=t(53054),X=t(32137),G=t(67805),Z=t(68856),J=t(47906),H=t(54165),W=t(47262),K=t(26126);let Q=b.z.object({instanceId:b.z.string(),roomId:b.z.string(),position:b.z.object({x:b.z.number(),y:b.z.number()})}),_=b.z.object({from:b.z.string().min(1,"A 'from' room must be selected."),to:b.z.string().min(1,"A 'to' room must be selected.")}),q=b.z.object({name:b.z.string().min(1,"Dungeon name is required"),description:b.z.string().optional(),hostility:b.z.enum(z),size:b.z.enum(I),threatRating:b.z.coerce.number(),treasureValue:b.z.coerce.number(),tags:b.z.array(b.z.string()).optional(),rooms:b.z.array(Q),connections:b.z.array(_)}),Y=e=>{let{onAddRooms:s,existingRoomIds:t}=e,[a,l]=(0,n.useState)(!1),[i,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(new Set),[x,j]=(0,n.useState)("");(0,n.useEffect)(()=>{a&&(0,C.SP)().then(u)},[a]);let g=(0,n.useMemo)(()=>i.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())&&!t.has(e.id)),[i,x,t]);return(0,r.jsxs)(H.lG,{open:a,onOpenChange:l,children:[(0,r.jsx)(H.zM,{asChild:!0,children:(0,r.jsxs)(c.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Add Room"]})}),(0,r.jsxs)(H.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,r.jsx)(H.c7,{children:(0,r.jsx)(H.L3,{children:"Select Rooms"})}),(0,r.jsx)(o.p,{placeholder:"Search rooms...",value:x,onChange:e=>j(e.target.value),className:"mb-4 shrink-0"}),(0,r.jsx)(d.F,{className:"flex-1 border rounded-md p-2",children:(0,r.jsx)("div",{className:"space-y-1",children:g.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md",children:[(0,r.jsx)(W.S,{id:"room-".concat(e.id),onCheckedChange:()=>m(s=>{let t=new Set(s);return t.has(e.id)?t.delete(e.id):t.add(e.id),t}),checked:h.has(e.id)}),(0,r.jsx)("label",{htmlFor:"room-".concat(e.id),className:"flex-1",children:(0,r.jsx)("p",{className:"font-semibold",children:e.name})})]},e.id))})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4 shrink-0",children:[(0,r.jsx)(c.$,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),(0,r.jsx)(c.$,{onClick:()=>{s(i.filter(e=>h.has(e.id))),l(!1),m(new Set)},disabled:0===h.size,children:"Add Selected"})]})]})]})},U={name:"",description:"",hostility:"I",size:"Tiny",threatRating:0,treasureValue:0,tags:[],rooms:[],connections:[]};function ee(e){let{dungeonId:s,isCreatingNew:t,onSaveSuccess:a,onDeleteSuccess:l,onEditCancel:d,onRunDungeon:m,onBack:x,dataVersion:j}=e,{toast:g}=(0,h.dj)(),[p,w]=(0,n.useState)(t),[b,H]=(0,n.useState)(!t&&!!s),[W,Q]=(0,n.useState)(null),[_,ee]=(0,n.useState)([]),es=(0,n.useMemo)(()=>new Map(_.map(e=>[e.id,e])),[_]),et=(0,J.a)(),er=(0,y.mN)({resolver:(0,N.u)(q),defaultValues:U}),{control:en,watch:ea,setValue:el,getValues:ei}=er,{fields:eo,append:ec,remove:ed}=(0,y.jz)({control:en,name:"rooms"}),{fields:eu,append:eh,remove:em}=(0,y.jz)({control:en,name:"connections"}),ex=ea("rooms");(0,n.useEffect)(()=>{el("treasureValue",ex.reduce((e,s)=>{let t=es.get(s.roomId);return e+((null==t?void 0:t.totalTreasureValue)||0)},0))},[ex,es,el]),(0,n.useEffect)(()=>{(0,C.SP)().then(ee)},[]),(0,n.useEffect)(()=>{(async()=>{if(t){er.reset(U),Q(null),w(!0),H(!1);return}if(!s){w(!1),H(!1),Q(null);return}H(!0),w(!1);try{let e=await (0,i.RT)(s);e?(er.reset(e),Q(e)):Q(null)}catch(e){g({variant:"destructive",title:"Error",description:"Could not load dungeon data."})}finally{H(!1)}})()},[s,t,er,g,j]);let ej=()=>{t?d():W&&(er.reset(W),w(!1))},eg=async e=>{try{var r;let n={...e,tags:e.tags||[]};(null==(r=e.tags)?void 0:r.length)&&await (0,S.JE)(e.tags,"dungeon");let l=s;t?(l=await (0,i.yV)(n),g({title:"Dungeon Created!"})):s&&(await (0,i.sO)({...n,id:s}),g({title:"Save Successful"})),l&&a(l),w(!1)}catch(e){g({variant:"destructive",title:"Save Failed"})}},ep=async()=>{if(s)try{await (0,i.OO)(s),g({title:"Dungeon Deleted"}),l()}catch(e){g({variant:"destructive",title:"Deletion Failed"})}},ef=(0,n.useMemo)(()=>new Set(eo.map(e=>e.roomId)),[eo]),ev=ea("hostility"),ew=ea("size");return b?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(A.Zp,{children:[(0,r.jsx)(A.aR,{children:(0,r.jsx)(Z.E,{className:"h-8 w-48"})}),(0,r.jsx)(A.Wu,{children:(0,r.jsx)(Z.E,{className:"h-40 w-full"})})]})}):s||t?!p&&W?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(A.Zp,{children:[(0,r.jsx)(A.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[et&&x&&(0,r.jsx)(c.$,{variant:"ghost",size:"icon",onClick:x,className:"shrink-0 -ml-2 -mt-1",children:(0,r.jsx)(D.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(A.ZB,{className:"text-3xl font-bold",children:W.name}),(0,r.jsxs)(A.BT,{className:"flex flex-wrap gap-x-4",children:[(0,r.jsxs)("span",{children:["Hostility: ",k[W.hostility].name]}),(0,r.jsxs)("span",{children:["Size: ",W.size]}),(0,r.jsxs)("span",{children:["TR: ",W.threatRating]}),(0,r.jsxs)("span",{children:["Treasure: ",W.treasureValue]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,r.jsxs)(c.$,{variant:"default",size:"sm",onClick:()=>m(W.id),children:[(0,r.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Run"]}),(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,r.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Edit"]})]})]})}),(0,r.jsxs)(A.Wu,{className:"space-y-6",children:[W.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,r.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:W.description})]}),(0,r.jsx)(u.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:["Rooms (",W.rooms.length,")"]}),(0,r.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:W.rooms.map(e=>{var s;return(0,r.jsx)("li",{className:"text-accent",children:(null==(s=es.get(e.roomId))?void 0:s.name)||"Unknown Room"},e.instanceId)})})]}),W.tags&&W.tags.length>0&&(0,r.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:W.tags.map(e=>(0,r.jsx)(K.E,{variant:"secondary",children:e},e))})})]}),(0,r.jsx)(A.wL,{children:(0,r.jsxs)(L.Lt,{children:[(0,r.jsx)(L.tv,{asChild:!0,children:(0,r.jsx)(c.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(L.EO,{children:[(0,r.jsxs)(L.wd,{children:[(0,r.jsx)(L.r7,{children:"Are you sure?"}),(0,r.jsxs)(L.$v,{children:['This will permanently delete "',W.name,'".']})]}),(0,r.jsxs)(L.ck,{children:[(0,r.jsx)(L.Zr,{children:"Cancel"}),(0,r.jsx)(L.Rx,{onClick:ep,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(A.Zp,{children:(0,r.jsx)(M.lV,{...er,children:(0,r.jsxs)("form",{onSubmit:er.handleSubmit(eg),className:"space-y-6",children:[(0,r.jsx)(A.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[et&&x&&(0,r.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:ej,className:"shrink-0 -ml-2",children:(0,r.jsx)(D.A,{className:"h-5 w-5"})}),(0,r.jsx)(A.ZB,{children:t?"Create New Dungeon":"Editing: ".concat(er.getValues("name")||"...")})]}),!et&&(0,r.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:ej,className:"text-muted-foreground hover:text-foreground",children:(0,r.jsx)(B.A,{className:"h-5 w-5"})})]})}),(0,r.jsxs)(A.Wu,{className:"space-y-6",children:[(0,r.jsx)(M.zB,{name:"name",control:en,render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsx)(M.lR,{children:"Dungeon Name"}),(0,r.jsx)(M.MJ,{children:(0,r.jsx)(o.p,{...s})}),(0,r.jsx)(M.C5,{})]})}}),(0,r.jsx)(M.zB,{name:"description",control:en,render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsx)(M.lR,{children:"Description"}),(0,r.jsx)(M.MJ,{children:(0,r.jsx)(T.T,{...s,rows:3})})]})}}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(M.zB,{control:en,name:"hostility",render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsx)(M.lR,{children:"Hostility"}),(0,r.jsxs)(f.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,r.jsx)(M.MJ,{children:(0,r.jsx)(f.bq,{children:(0,r.jsx)(f.yv,{})})}),(0,r.jsx)(f.gC,{children:z.map(e=>(0,r.jsxs)(f.eb,{value:e,children:[e,": ",k[e].name]},e))})]}),(0,r.jsx)(M.C5,{})]})}}),(0,r.jsx)(M.zB,{control:en,name:"size",render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsx)(M.lR,{children:"Size"}),(0,r.jsxs)(f.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,r.jsx)(M.MJ,{children:(0,r.jsx)(f.bq,{children:(0,r.jsx)(f.yv,{})})}),(0,r.jsx)(f.gC,{children:I.map(e=>(0,r.jsx)(f.eb,{value:e,children:e},e))})]}),(0,r.jsx)(M.C5,{})]})}})]}),(0,r.jsxs)(A.Zp,{className:"p-4 bg-muted/50",children:[(0,r.jsx)(A.aR,{className:"p-0 pb-2",children:(0,r.jsxs)(A.ZB,{className:"text-base flex items-center gap-2",children:[(0,r.jsx)(F.A,{className:"h-5 w-5"})," Target Values"]})}),(0,r.jsxs)(A.Wu,{className:"p-0 text-sm text-muted-foreground grid grid-cols-2 md:grid-cols-3 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"Rooms: "}),R[ew].rooms]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"Treasure: "}),R[ew].treasureRoll]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"TR Range: "}),k[ev].threatRange]})]})]}),(0,r.jsx)(M.zB,{name:"tags",control:en,render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsxs)(M.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,r.jsx)(M.MJ,{children:(0,r.jsx)(v.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"dungeon"})}),(0,r.jsx)(M.C5,{})]})}}),(0,r.jsx)(u.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground flex items-center gap-2",children:[(0,r.jsx)(X.A,{className:"h-5 w-5"}),"Rooms"]}),(0,r.jsx)(Y,{onAddRooms:e=>{let s=eo.length;e.forEach((e,t)=>{let r=s+t,n=130*Math.floor(r/4),a=r%4*200+(Math.random()-.5)*40,l=n+(Math.random()-.5)*40;ec({instanceId:crypto.randomUUID(),roomId:e.id,position:{x:a,y:l}})})},existingRoomIds:ef})]}),(0,r.jsxs)("div",{className:"space-y-2 pr-2",children:[eo.map((e,s)=>{var t;return(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-card-foreground/5 rounded-md",children:[(0,r.jsx)("p",{className:"flex-1 font-semibold",children:(null==(t=es.get(e.roomId))?void 0:t.name)||"Unknown Room"}),(0,r.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ed(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})]},e.id)}),0===eo.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No rooms added."})]}),(0,r.jsx)(M.zB,{control:en,name:"treasureValue",render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{className:"mt-2",children:[(0,r.jsx)(M.lR,{children:"Total Treasure Value"}),(0,r.jsx)(M.MJ,{children:(0,r.jsx)(o.p,{type:"number",...s,readOnly:!0,className:"w-24 bg-muted border-none"})})]})}})]}),(0,r.jsx)(u.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground flex items-center gap-2",children:[(0,r.jsx)(G.A,{className:"h-5 w-5"}),"Connections"]}),(0,r.jsxs)(c.$,{type:"button",size:"sm",variant:"outline",onClick:()=>eh({from:"",to:""}),disabled:eo.length<2,children:[(0,r.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Add Connection"]})]}),(0,r.jsxs)("div",{className:"space-y-2 pr-2",children:[eu.map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-start gap-2 p-2 bg-card-foreground/5 rounded-md",children:[(0,r.jsx)(M.zB,{control:en,name:"connections.".concat(s,".from"),render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsxs)(f.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,r.jsx)(M.MJ,{children:(0,r.jsx)(f.bq,{children:(0,r.jsx)(f.yv,{placeholder:"From Room..."})})}),(0,r.jsx)(f.gC,{children:eo.map(e=>{var s;return(0,r.jsx)(f.eb,{value:e.instanceId,children:(null==(s=es.get(e.roomId))?void 0:s.name)||"..."},e.instanceId)})})]}),(0,r.jsx)(M.C5,{})]})}}),(0,r.jsx)("span",{className:"pt-2",children:"->"}),(0,r.jsx)(M.zB,{control:en,name:"connections.".concat(s,".to"),render:e=>{let{field:s}=e;return(0,r.jsxs)(M.eI,{children:[(0,r.jsxs)(f.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,r.jsx)(M.MJ,{children:(0,r.jsx)(f.bq,{children:(0,r.jsx)(f.yv,{placeholder:"To Room..."})})}),(0,r.jsx)(f.gC,{children:eo.map(e=>{var s;return(0,r.jsx)(f.eb,{value:e.instanceId,children:(null==(s=es.get(e.roomId))?void 0:s.name)||"..."},e.instanceId)})})]}),(0,r.jsx)(M.C5,{})]})}}),(0,r.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>em(s),className:"text-muted-foreground hover:text-destructive shrink-0 self-center",children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})]},e.id)),0===eu.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No connections added."})]})]})]}),(0,r.jsxs)(A.wL,{className:"flex items-center gap-2",children:[!t&&(0,r.jsxs)(L.Lt,{children:[(0,r.jsx)(L.tv,{asChild:!0,children:(0,r.jsx)(c.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(L.EO,{children:[(0,r.jsxs)(L.wd,{children:[(0,r.jsx)(L.r7,{children:"Are you sure?"}),(0,r.jsxs)(L.$v,{children:['This will permanently delete "',ei("name"),'".']})]}),(0,r.jsxs)(L.ck,{children:[(0,r.jsx)(L.Zr,{children:"Cancel"}),(0,r.jsx)(L.Rx,{onClick:ep,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,r.jsx)("div",{className:"flex-grow"}),!et&&(0,r.jsx)(c.$,{type:"button",variant:"outline",onClick:ej,children:"Cancel"}),(0,r.jsx)(c.$,{type:"submit",children:t?"Create Dungeon":"Save Changes"})]})]})})})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(A.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,r.jsx)(A.Wu,{className:"text-center pt-6",children:(0,r.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a dungeon to view or create one."})})})})}var es=t(74211),et=t(93306),er=t(77581),en=t(57916);t(11687);var ea=t(88251),el=t.n(ea),ei=t(87189),eo=t(74691),ec=t(98638),ed=t(73336),eu=t(8531),eh=t(86438),em=t(67554),ex=t(73503),ej=t(98917),eg=t(22945);function ep(e,s){var t,r,n,a,l,i;let{width:o,height:c,positionAbsolute:d}=e,u=s.positionAbsolute,h=(null!=o?o:0)/2,m=(null!=c?c:0)/2,x=(null!=(t=null==d?void 0:d.x)?t:0)+h,j=(null!=(r=null==d?void 0:d.y)?r:0)+m,g=(null!=(n=null==u?void 0:u.x)?n:0)+(null!=(a=s.width)?a:0)/2,p=(null!=(l=null==u?void 0:u.y)?l:0)+(null!=(i=s.height)?i:0)/2,f=(g-x)/(2*h)-(p-j)/(2*m),v=(g-x)/(2*h)+(p-j)/(2*m),w=1/(Math.abs(f)+Math.abs(v)),y=w*f,N=w*v;return{x:h*(y+N)+x,y:m*(-y+N)+j}}function ef(e,s){var t,r,n,a;let l={...e.positionAbsolute,...e},i=Math.round(null!=(t=l.x)?t:0),o=Math.round(null!=(r=l.y)?r:0),c=Math.round(s.x),d=Math.round(s.y);return c<=i+1?"left":c>=i+(null!=(n=l.width)?n:0)-1?"right":d<=o+1?"top":d>=o+(null!=(a=l.height)?a:0)-1?"bottom":"top"}let ev=e=>{let{fromNode:s,toX:t,toY:n}=e;if(!s)return null;let{x:a,y:l}=function(e,s){var t,r,n,a,l,i;let{width:o,height:c,positionAbsolute:d}=e,u=s.positionAbsolute,h=(null!=o?o:0)/2,m=(null!=c?c:0)/2,x=(null!=(t=null==d?void 0:d.x)?t:0)+h,j=(null!=(r=null==d?void 0:d.y)?r:0)+m,g=(null!=(n=null==u?void 0:u.x)?n:0)+(null!=(a=s.width)?a:0)/2,p=(null!=(l=null==u?void 0:u.y)?l:0)+(null!=(i=s.height)?i:0)/2,f=(g-x)/(2*h)-(p-j)/(2*m),v=(g-x)/(2*h)+(p-j)/(2*m),w=1/(Math.abs(f)+Math.abs(v)),y=w*f,N=w*v;return{x:h*(y+N)+x,y:m*(-y+N)+j}}(s,{id:"target-node",width:1,height:1,positionAbsolute:{x:t,y:n}}),[i]=(0,es.Fp)({sourceX:a,sourceY:l,sourcePosition:"bottom",targetX:t,targetY:n,targetPosition:"top"});return(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{fill:"none",stroke:"hsl(var(--primary))",strokeWidth:1.5,className:"animated",d:i}),(0,r.jsx)("circle",{cx:t,cy:n,fill:"#fff",r:3,stroke:"hsl(var(--primary))",strokeWidth:1.5})]})},ew={visibility:"hidden"},ey={floating:function(e){let{id:s,source:t,target:a,markerEnd:l,style:i}=e,o=(0,es.Pj)((0,n.useCallback)(e=>e.nodeInternals.get(t),[t])),c=(0,es.Pj)((0,n.useCallback)(e=>e.nodeInternals.get(a),[a]));if(!o||!c)return null;let d=ep(o,c),u=ep(c,o),h=ef(o,d),m=ef(c,u),[x]=(0,es.Fp)({sourceX:d.x,sourceY:d.y,sourcePosition:h,targetX:u.x,targetY:u.y,targetPosition:m});return(0,r.jsx)(es.tE,{id:s,path:x,markerEnd:l,style:i})}},eN={dungeonRoom:function(e){let{data:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.h7,{type:"source",position:es.yX.Top,style:ew}),(0,r.jsx)(es.h7,{type:"source",position:es.yX.Right,style:ew}),(0,r.jsx)(es.h7,{type:"source",position:es.yX.Bottom,style:ew}),(0,r.jsx)(es.h7,{type:"source",position:es.yX.Left,style:ew}),(0,r.jsx)(es.h7,{type:"target",position:es.yX.Top,style:ew}),(0,r.jsx)(es.h7,{type:"target",position:es.yX.Right,style:ew}),(0,r.jsx)(es.h7,{type:"target",position:es.yX.Bottom,style:ew}),(0,r.jsx)(es.h7,{type:"target",position:es.yX.Left,style:ew}),(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-center p-2",children:s.label})]})}},eb=new(el()),eC={"elk.algorithm":"force","elk.force.iterations":"1000","elk.force.alpha":"1","elk.force.gravity":"0.01","elk.spacing.nodeNode":"120"},eS=(e,s)=>{let t={id:"root",layoutOptions:eC,children:e.map(e=>{var s,t;return{id:e.id,width:(null==(s=e.style)?void 0:s.width)||150,height:(null==(t=e.style)?void 0:t.height)||80}}),edges:s.map(e=>({id:e.id,sources:[e.source],targets:[e.target]}))};return eb.layout(t).then(s=>e.map(e=>{var t;let r=null==(t=s.children)?void 0:t.find(s=>s.id===e.id);return(null==r?void 0:r.x)&&(null==r?void 0:r.y)&&(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(e.position={x:r.x,y:r.y}),e})).catch(s=>(console.error("ELK layout error:",s),e))};function ek(e){var s;let{dungeon:t,onEndDungeon:a}=e,[l,i]=(0,n.useState)(!0),[o,m]=(0,n.useState)(null),[x,j]=(0,n.useState)(null),[g,p]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),[w,y]=(0,n.useState)(0),[N,b]=(0,n.useState)([0]),{toast:S}=(0,h.dj)(),[k,R,z]=(0,es.ck)([]),[I,T,L]=(0,es.fM)([]),{fitView:M}=(0,es.VH)(),$=(0,n.useCallback)(()=>{eS(k,I).then(e=>{R(e),window.requestAnimationFrame(()=>{M({duration:800,padding:.1})})})},[k,I,R,M]),V=Math.floor(w/3)+1,B=null!=(s=N[w])?s:0,F=e=>{let s=Math.max(0,Math.min(10,B+e)),t=[...N];t[w]=s,b(t)},O=(0,n.useCallback)((e,s)=>{if(!s){p(null),v(null);return}p(s.id),v(null)},[p,v]);(0,n.useEffect)(()=>{if(g){let e=new Set([g]);t.connections.forEach(s=>{s.from===g&&e.add(s.to),s.to===g&&e.add(s.from)}),setTimeout(()=>{M({nodes:Array.from(e).map(e=>({id:e})),duration:600,padding:.2})},10)}},[g,t.connections,M]),(0,n.useEffect)(()=>{(async()=>{i(!0);let e=await (0,C.SP)(),s=new Map(e.map(e=>[e.id,e])),t=e.flatMap(e=>e.features.flatMap(e=>e.encounterIds)),r=await Promise.all(t.map(e=>(0,ei.eq)(e).catch(()=>null)));e.flatMap(e=>e.features.flatMap(e=>e.treasureIds));let n=await (0,eo.Ap)();e.flatMap(e=>e.features.flatMap(e=>e.alchemicalItemIds));let a=await (0,ec.vV)();j({rooms:s,encounters:new Map(r.filter(e=>null!==e).map(e=>[e.id,e])),treasures:new Map(n.map(e=>[e.id,e])),alchemicalItems:new Map(a.map(e=>[e.id,e]))}),i(!1)})()},[t]);let X=(0,n.useMemo)(()=>t&&x?t.rooms.map(e=>{let s=x.rooms.get(e.roomId);return{id:e.instanceId,position:{x:0,y:0},data:{label:(null==s?void 0:s.name)||"Loading..."},style:{background:"hsl(var(--card))",color:"hsl(var(--card-foreground))",border:"2px solid",borderColor:"hsl(var(--border))",width:150,height:80,borderRadius:"var(--radius)",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"},type:"dungeonRoom"}}):[],[t,x]),G=(0,n.useMemo)(()=>t?t.connections.map(e=>({id:"edge-".concat(e.from,"-").concat(e.to),source:e.from,target:e.to,type:"floating",style:{strokeWidth:2,stroke:"hsl(var(--border))"}})):[],[t]);(0,n.useEffect)(()=>{X.length>0&&eS(X,G).then(e=>{R(e),T(G),setTimeout(()=>{M({duration:800,padding:.1})},100)})},[X,G,R,T,M]),(0,n.useEffect)(()=>{R(e=>e.map(e=>{let s=e.id===g;return{...e,style:{...e.style,background:s?"hsl(var(--primary))":"hsl(var(--card))",color:s?"hsl(var(--primary-foreground))":"hsl(var(--card-foreground))",borderColor:s?"hsl(var(--ring))":"hsl(var(--border))"}}})),T(e=>e.map(e=>{let s=g&&(e.source===g||e.target===g);return{...e,animated:s,style:{...e.style,strokeWidth:s?2.5:1.5,stroke:s?"hsl(var(--primary))":"hsl(var(--border))"}}}))},[g,R,T]);let J=(0,n.useMemo)(()=>{if(!g||!x)return null;let e=t.rooms.find(e=>e.instanceId===g);return e?x.rooms.get(e.roomId):null},[g,t,x]),H=(0,n.useMemo)(()=>f&&x&&x.encounters.get(f)||null,[f,x]),W=async e=>{let s=null==x?void 0:x.encounters.get(e);s?m(s):S({variant:"destructive",title:"Error",description:"Could not find encounter data."})};return o?(0,r.jsx)(ed.A,{encounter:o,onEndEncounter:()=>m(null)}):l?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,r.jsx)(Z.E,{className:"h-48 w-48"})}):(0,r.jsxs)("div",{className:"flex flex-col h-screen w-full bg-background/50",children:[(0,r.jsxs)("header",{className:"py-4 px-6 border-b border-border flex items-center justify-between shrink-0 bg-background/80 backdrop-blur-sm sticky top-0 z-20",children:[(0,r.jsx)("h1",{className:"text-xl md:text-3xl font-bold text-primary-foreground",children:t.name}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Alert"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>{let e=[...N];e[w]=0,b(e)},title:"Reset Alert",children:(0,r.jsx)(eu.A,{className:"h-3 w-3"})})]}),(0,r.jsxs)("div",{className:"text-lg font-bold flex items-center gap-1",children:[(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>F(-1),disabled:B<=0,children:(0,r.jsx)(eh.A,{className:"h-4 w-4"})}),B,(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>F(1),disabled:B>=10,children:(0,r.jsx)(P.A,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Round / Action"}),(0,r.jsxs)("div",{className:"text-lg font-bold",children:[V," / ",w%3+1]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>{y(e=>Math.max(0,e-1))},disabled:0===w,children:"Prev Action"}),(0,r.jsx)(c.$,{variant:"default",size:"sm",onClick:()=>{y(e=>{let s=e+1;return b(e=>{var t;let r=[...e],n=null!=(t=e[e.length-1])?t:0;return s>=r.length&&(r[s]=n),r}),s})},children:"Next Action"})]}),(0,r.jsx)(c.$,{variant:"outline",size:"icon",onClick:$,title:"Re-Layout",children:(0,r.jsx)(em.A,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"destructive",onClick:a,children:"End Dungeon"})]})]}),(0,r.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(J||H)&&(0,r.jsxs)("div",{className:"w-[380px] border-r border-border bg-card p-4 flex flex-col",children:[H?(0,r.jsxs)(c.$,{variant:"ghost",className:"self-start mb-2 -ml-2",onClick:()=>v(null),children:[(0,r.jsx)(D.A,{className:"h-4 w-4 mr-2"})," Back to Room Details"]}):(0,r.jsxs)(c.$,{variant:"ghost",className:"self-start mb-2 -ml-2",onClick:()=>{p(null),v(null)},children:[(0,r.jsx)(D.A,{className:"h-4 w-4 mr-2"})," Back to Dungeon View"]}),(0,r.jsx)(d.F,{className:"flex-1",children:H?(0,r.jsxs)(A.Zp,{children:[(0,r.jsxs)(A.aR,{children:[(0,r.jsx)(A.ZB,{children:H.name}),(0,r.jsxs)(A.BT,{children:["TR: ",H.totalTR]})]}),(0,r.jsxs)(A.Wu,{children:[(0,r.jsxs)(c.$,{className:"w-full",onClick:()=>W(H.id),children:[(0,r.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Run Encounter"]}),(0,r.jsx)("p",{className:"mt-4 text-sm whitespace-pre-wrap",children:H.sceneDescription})]})]}):J?(0,r.jsxs)(A.Zp,{children:[(0,r.jsxs)(A.aR,{children:[(0,r.jsx)(A.ZB,{children:J.name}),(0,r.jsx)(A.BT,{children:J.size})]}),(0,r.jsxs)(A.Wu,{className:"space-y-4",children:[(0,r.jsx)("p",{children:J.description}),(0,r.jsx)(u.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"Features"}),J.features.map(e=>(0,r.jsxs)("div",{className:"p-2 border-b",children:[(0,r.jsx)("p",{className:"font-bold",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.encounterIds.map(e=>{var s;return(0,r.jsxs)(c.$,{variant:"link",className:"p-0 h-auto text-accent",onClick:()=>v(e),children:[(0,r.jsx)(ex.A,{className:"h-4 w-4 mr-1"}),null==x||null==(s=x.encounters.get(e))?void 0:s.name]},e)}),e.treasureIds.map(e=>{var s;return(0,r.jsxs)("p",{className:"text-sm flex items-center gap-1",children:[(0,r.jsx)(ej.A,{className:"h-4 w-4"}),null==x||null==(s=x.treasures.get(e))?void 0:s.name]},e)}),e.alchemicalItemIds.map(e=>{var s;return(0,r.jsxs)("p",{className:"text-sm flex items-center gap-1",children:[(0,r.jsx)(eg.A,{className:"h-4 w-4"}),null==x||null==(s=x.alchemicalItems.get(e))?void 0:s.name]},e)})]},e.id))]})]})]}):null})]}),(0,r.jsx)("div",{className:"flex-1 relative overflow-hidden bg-gradient-to-br from-background to-muted/20",children:(0,r.jsxs)(es.Gc,{nodes:k,edges:I,onNodesChange:z,onEdgesChange:L,onNodeClick:O,onPaneClick:()=>O(null,null),fitView:!0,nodesDraggable:!0,nodeTypes:eN,edgeTypes:ey,connectionLineComponent:ev,children:[(0,r.jsx)(et.H,{}),(0,r.jsx)(er.o,{pannable:!0,zoomable:!0,nodeStrokeWidth:3,nodeColor:e=>{var s;return(null==(s=e.style)?void 0:s.background)||"#fff"}}),(0,r.jsx)(en.V,{variant:"dots",gap:16,size:1})]})})]})]})}function eR(e){return(0,r.jsx)(es.Ln,{children:(0,r.jsx)(ek,{...e})})}function ez(){let[e,s]=(0,n.useState)("preparation"),[t,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),[x,j]=(0,n.useState)(0),[g,p]=(0,n.useState)(""),[f,v]=(0,n.useState)(""),[y,N]=(0,n.useState)("name"),[b,C]=(0,n.useState)("asc"),[S,k]=(0,n.useState)(!1),R=(0,J.a)(),[z,I]=(0,n.useState)("list");(0,n.useEffect)(()=>{k(!0)},[]);let A={searchTerm:g,tagFilter:f,sortBy:y,sortOrder:b},T={setSearchTerm:p,setTagFilter:v,setSortBy:N,setSortOrder:C},L=()=>{p(""),v(""),N("name"),C("asc")},M=()=>j(e=>e+1),P=e=>{o(e),m(!1),R&&I("editor")},D=()=>{o(null),m(!0),R&&I("editor")},E=e=>{M(),o(e),m(!1),R&&I("editor")},$=()=>{M(),o(null),m(!1),R&&I("list")},V=()=>{u&&(m(!1),o(null),R&&I("list"))},{toast:B}=(0,h.dj)(),F=async e=>{try{let t=await (0,i.RT)(e);t?(d(t),s("live")):B({variant:"destructive",title:"Error",description:"Could not find dungeon to run."})}catch(e){B({variant:"destructive",title:"Error",description:"Failed to load dungeon data."})}};return"live"===e&&c?(0,r.jsx)(eR,{dungeon:c,onEndDungeon:()=>{d(null),s("preparation")}}):S?R?(0,r.jsx)(a.A,{showSidebarTrigger:!1,children:(0,r.jsx)("div",{className:"h-full w-full",children:"list"===z?(0,r.jsx)(w,{onSelectDungeon:P,onNewDungeon:D,selectedDungeonId:t,dataVersion:x,filters:A,setFilters:T,onClearFilters:L}):(0,r.jsx)("div",{className:"p-4 sm:p-6 h-full w-full overflow-y-auto",children:(0,r.jsx)(ee,{dungeonId:t,isCreatingNew:u,onSaveSuccess:E,onDeleteSuccess:$,onEditCancel:V,onRunDungeon:F,onBack:()=>{I("list"),o(null),m(!1)},dataVersion:x},null!=t?t:u?"new":"placeholder")})})}):(0,r.jsx)(l.GB,{children:(0,r.jsx)(a.A,{children:(0,r.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,r.jsx)(l.Bx,{style:{"--sidebar-width":"380px"},children:(0,r.jsx)(w,{onSelectDungeon:P,onNewDungeon:D,selectedDungeonId:t,dataVersion:x,filters:A,setFilters:T,onClearFilters:L})}),(0,r.jsx)(l.sF,{className:"flex-1 overflow-y-auto",children:(0,r.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,r.jsx)(ee,{dungeonId:t,isCreatingNew:u,onSaveSuccess:E,onDeleteSuccess:$,onEditCancel:V,onRunDungeon:F,dataVersion:x},null!=t?t:u?"new":"placeholder")})})]})})}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[294,702,238,222,194,160,49,830,22,347,516,806,441,684,358],()=>s(82373)),_N_E=e.O()}]);
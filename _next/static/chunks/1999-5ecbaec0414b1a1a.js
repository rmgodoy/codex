"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1999],{31841:(e,a,s)=>{s.d(a,{V:()=>h});var t=s(95155),i=s(12115),l=s(30285),n=s(54165),r=s(62523),c=s(66424),d=s(47262),o=s(85057);function h(e){let{items:a,initialSelectedIds:s=[],onConfirm:h,trigger:m,title:u}=e,[x,p]=(0,i.useState)(!1),[j,v]=(0,i.useState)(""),[f,g]=(0,i.useState)(new Set(s));(0,i.useEffect)(()=>{x&&g(new Set(s))},[x,s]);let N=(0,i.useMemo)(()=>a.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())),[a,j]),w=(e,a)=>{g(s=>{let t=new Set(s);return a?t.add(e):t.delete(e),t})};return(0,t.jsxs)(n.lG,{open:x,onOpenChange:p,children:[(0,t.jsx)(n.zM,{asChild:!0,children:m}),(0,t.jsxs)(n.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(n.c7,{children:(0,t.jsx)(n.L3,{children:u})}),(0,t.jsx)(r.p,{placeholder:"Search...",value:j,onChange:e=>v(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:N.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(d.S,{id:"item-select-".concat(e.id),checked:f.has(e.id),onCheckedChange:a=>w(e.id,!!a)}),(0,t.jsx)(o.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(n.Es,{className:"pt-4",children:[(0,t.jsx)(l.$,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),(0,t.jsx)(l.$,{onClick:()=>{h(Array.from(f)),p(!1)},children:"Confirm"})]})]})]})}},91999:(e,a,s)=>{s.r(a),s.d(a,{default:()=>eF});var t=s(95155),i=s(12115),l=s(46855),n=s(19209),r=s(53648),c=s(87481),d=s(47906),o=s(66695),h=s(8643),m=s(30285),u=s(21887),x=s(60704),p=s(59434);let j=x.bL,v=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(x.B8,{ref:a,className:(0,p.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i})});v.displayName=x.B8.displayName;let f=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(x.l9,{ref:a,className:(0,p.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i})});f.displayName=x.l9.displayName;let g=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(x.UC,{ref:a,className:(0,p.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i})});g.displayName=x.UC.displayName;var N=s(7146),w=s(85057),y=s(59409),b=s(54165),C=s(56013),I=s(18046),A=s(10518),k=s(25318),S=s(18763),E=s(77223),M=s(62523),F=s(90010),P=s(54059),z=s(70154);let D=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(P.bL,{className:(0,p.cn)("grid gap-2",s),...i,ref:a})});D.displayName=P.bL.displayName;let q=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(P.q7,{ref:a,className:(0,p.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...i,children:(0,t.jsx)(P.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(z.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});function $(e){let{maps:a,onMapsUpdate:s}=e,[l,n]=(0,i.useState)(!1),[d,o]=(0,i.useState)(""),[h,u]=(0,i.useState)("radial"),[x,p]=(0,i.useState)(20),[j,v]=(0,i.useState)(30),[f,g]=(0,i.useState)(20),[y,P]=(0,i.useState)(null),[z,$]=(0,i.useState)(""),{toast:R}=(0,c.dj)(),J=async()=>{let e,a;if(!d.trim())return void R({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name."});if("radial"===h){if(!x||x<=0)return void R({variant:"destructive",title:"Invalid Input",description:"Please provide a valid radius."});e=(0,N.Xk)(x),a={name:d.trim(),shape:"radial",radius:x,tiles:e,paths:[]}}else{if(!j||j<=0||!f||f<=0)return void R({variant:"destructive",title:"Invalid Input",description:"Please provide valid width and height."});e=(0,N.z0)(j,f),a={name:d.trim(),shape:"rectangular",width:j,height:f,tiles:e,paths:[]}}try{let e=await (0,r.Ys)(a);R({title:"Map Created",description:"'".concat(d,"' has been added.")}),o(""),p(20),v(30),g(20),s(e),n(!1)}catch(e){R({variant:"destructive",title:"Error",description:"Failed to create map."})}},L=e=>{P(e.id),$(e.name)},T=()=>{P(null),$("")},U=async()=>{if(!y||!z.trim())return;let e=a.find(e=>e.id===y);if(e)try{await (0,r.cA)({...e,name:z.trim()}),R({title:"Map Renamed"}),s(),T()}catch(e){R({variant:"destructive",title:"Error",description:"Failed to rename map."})}},V=async e=>{try{await (0,r.GY)(e),R({title:"Map Deleted"}),s()}catch(e){R({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(b.lG,{open:l,onOpenChange:n,children:[(0,t.jsx)(b.zM,{asChild:!0,children:(0,t.jsx)(m.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(C.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(b.Cf,{children:[(0,t.jsxs)(b.c7,{children:[(0,t.jsx)(b.L3,{children:"Manage Maps"}),(0,t.jsx)(b.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-4 p-3 border rounded-md",children:[(0,t.jsx)(w.J,{children:"New Map"}),(0,t.jsx)(M.p,{placeholder:"New map name...",value:d,onChange:e=>o(e.target.value)}),(0,t.jsxs)(D,{value:h,onValueChange:e=>u(e),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(q,{value:"radial",id:"radial"}),(0,t.jsx)(w.J,{htmlFor:"radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(q,{value:"rectangular",id:"rectangular"}),(0,t.jsx)(w.J,{htmlFor:"rectangular",children:"Rectangular"})]})]}),"radial"===h?(0,t.jsx)(M.p,{placeholder:"Radius",type:"number",value:x,onChange:e=>p(parseInt(e.target.value,10)||0)}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(M.p,{placeholder:"Width",type:"number",value:j,onChange:e=>v(parseInt(e.target.value,10)||0)}),(0,t.jsx)(M.p,{placeholder:"Height",type:"number",value:f,onChange:e=>g(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(m.$,{onClick:J,className:"w-full",children:[(0,t.jsx)(I.A,{className:"h-4 w-4"})," Add Map"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:y===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.p,{value:z,onChange:e=>$(e.target.value),onKeyDown:e=>{"Enter"===e.key&&U()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(m.$,{size:"icon",className:"h-7 w-7",onClick:U,"aria-label":"Save",children:(0,t.jsx)(A.A,{className:"h-4 w-4"})}),(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:T,"aria-label":"Cancel",children:(0,t.jsx)(k.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>L(e),"aria-label":"Edit",children:(0,t.jsx)(S.A,{className:"h-4 w-4"})}),(0,t.jsxs)(F.Lt,{children:[(0,t.jsx)(F.tv,{asChild:!0,children:(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(E.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(F.EO,{children:[(0,t.jsxs)(F.wd,{children:[(0,t.jsx)(F.r7,{children:"Are you sure?"}),(0,t.jsxs)(F.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(F.ck,{children:[(0,t.jsx)(F.Zr,{children:"Cancel"}),(0,t.jsx)(F.Rx,{onClick:()=>V(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}q.displayName=P.q7.displayName;var R=s(22346);function J(e){let{maps:a,selectedMapId:s,setSelectedMapId:l,activeMap:n,handleMapsUpdate:d,handleMapUpdate:o}=e,[h,u]=(0,i.useState)(null),{toast:x}=(0,c.dj)();(0,i.useEffect)(()=>{n?u({name:n.name,shape:n.shape||"radial",radius:n.radius||20,width:n.width||30,height:n.height||20}):u(null)},[n]);let p=async()=>{let e,a;if(n&&h){if(!h.name.trim())return void x({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if("radial"===h.shape){if(isNaN(h.radius)||h.radius<=0||h.radius>100)return void x({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});e=(0,N.YS)(n.tiles,h.radius),a={...n,name:h.name,shape:"radial",radius:h.radius,width:void 0,height:void 0,tiles:e}}else{if(isNaN(h.width)||h.width<=0||h.width>200||isNaN(h.height)||h.height<=0||h.height>200)return void x({variant:"destructive",title:"Validation Error",description:"Width and Height must be between 1 and 200."});e=(0,N.z0)(h.width,h.height,n.tiles),a={...n,name:h.name,shape:"rectangular",width:h.width,height:h.height,radius:void 0,tiles:e}}try{await (0,r.cA)(a),o(a),x({title:"Map settings saved!"})}catch(e){x({variant:"destructive",title:"Save failed"})}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(y.l6,{value:s||"",onValueChange:l,children:[(0,t.jsx)(y.bq,{className:"flex-1",children:(0,t.jsx)(y.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(y.gC,{children:a.map(e=>(0,t.jsx)(y.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)($,{maps:a,onMapsUpdate:d})]})]}),(0,t.jsx)(R.w,{}),n&&h?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(M.p,{id:"map-name",value:h.name,onChange:e=>u(a=>a?{...a,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"Shape"}),(0,t.jsxs)(D,{value:h.shape,onValueChange:e=>u(a=>a?{...a,shape:e}:null),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(q,{value:"radial",id:"edit-radial"}),(0,t.jsx)(w.J,{htmlFor:"edit-radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(q,{value:"rectangular",id:"edit-rectangular"}),(0,t.jsx)(w.J,{htmlFor:"edit-rectangular",children:"Rectangular"})]})]})]}),"radial"===h.shape?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(M.p,{id:"map-radius",type:"number",value:h.radius,onChange:e=>u(a=>a?{...a,radius:parseInt(e.target.value)||0}:null),min:"1",max:"100"})]}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{htmlFor:"map-width",children:"Width"}),(0,t.jsx)(M.p,{id:"map-width",type:"number",value:h.width,onChange:e=>u(a=>a?{...a,width:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{htmlFor:"map-height",children:"Height"}),(0,t.jsx)(M.p,{id:"map-height",type:"number",value:h.height,onChange:e=>u(a=>a?{...a,height:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]})]}),(0,t.jsx)(m.$,{onClick:p,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]})}var L=s(49864),T=s(74466),U=s(124);let V=(0,T.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});i.forwardRef((e,a)=>{let{className:s,variant:i,size:l,...n}=e;return(0,t.jsx)(U.b,{ref:a,className:(0,p.cn)(V({variant:i,size:l,className:s})),...n})}).displayName=U.b.displayName;let B=(0,T.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),W=i.createContext({size:"default",variant:"default"}),H=i.forwardRef((e,a)=>{let{className:s,variant:i,size:l,children:n,...r}=e;return(0,t.jsx)(L.bL,{ref:a,className:(0,p.cn)(B({variant:i,className:s})),...r,children:(0,t.jsx)(W.Provider,{value:{variant:i,size:l},children:n})})});H.displayName=L.bL.displayName;let G=i.forwardRef((e,a)=>{let{className:s,children:l,variant:n,size:r,...c}=e,d=i.useContext(W);return(0,t.jsx)(L.q7,{ref:a,className:(0,p.cn)(V({variant:d.variant||n,size:d.size||r}),s),...c,children:l})});G.displayName=L.q7.displayName;var O=s(18186),Z=s(68715),_=s(66049),K=s(57946),Y=s(23767),Q=s(20427),X=s(43152),ee=s(83662),ea=s(55166),es=s(82643),et=s(86950),ei=s(10366),el=s(10947),en=s(47326),er=s(17657),ec=s(11133),ed=s(78082);let eo=ed.Kq,eh=ed.bL,em=ed.l9,eu=i.forwardRef((e,a)=>{let{className:s,sideOffset:i=4,...l}=e;return(0,t.jsx)(ed.UC,{ref:a,sideOffset:i,className:(0,p.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});eu.displayName=ed.UC.displayName;let ex=[{name:"Home",component:O.A},{name:"Trees",component:Z.A},{name:"Mountain",component:_.A},{name:"Castle",component:K.A},{name:"TowerControl",component:Y.A},{name:"Tent",component:Q.A},{name:"Waves",component:X.A},{name:"MapPin",component:ee.A},{name:"Landmark",component:ea.A},{name:"Skull",component:es.A},{name:"Building",component:et.A}],ep=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function ej(e){let a="erase"===e.paintMode;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"Paint Mode"}),(0,t.jsxs)(H,{type:"single",value:e.paintMode,onValueChange:a=>{a&&e.setPaintMode(a)},className:"w-full",children:[(0,t.jsxs)(G,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(ei.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(G,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(el.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(G,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(en.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("fieldset",{disabled:a||e.isEyedropperActive,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(M.p,{id:"color-picker",type:"color",value:e.paintColor,onChange:a=>e.setPaintColor(a.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(w.J,{children:"Terrain Colors"}),(0,t.jsx)(eo,{children:(0,t.jsxs)(eh,{children:[(0,t.jsx)(em,{asChild:!0,children:(0,t.jsx)(m.$,{variant:e.isEyedropperActive?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>e.setIsEyedropperActive(e=>!e),children:(0,t.jsx)(er.A,{className:"h-4 w-4"})})}),(0,t.jsx)(eu,{children:(0,t.jsx)("p",{children:"Pick Tile Properties (or hold Alt)"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ep.map(a=>{let{name:s,color:i}=a;return(0,t.jsxs)(m.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>e.setPaintColor(i),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:i}}),(0,t.jsx)("span",{className:"ml-2",children:s})]},s)})})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(w.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!e.isIconColorAuto&&(0,t.jsx)(eo,{children:(0,t.jsxs)(eh,{children:[(0,t.jsx)(em,{asChild:!0,children:(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>e.setIsIconColorAuto(!0),children:(0,t.jsx)(ec.A,{className:"h-4 w-4"})})}),(0,t.jsx)(eu,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(M.p,{id:"icon-color-picker",type:"color",value:e.manualIconColor,onChange:a=>{e.setManualIconColor(a.target.value),e.setIsIconColorAuto(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:ex.map(a=>{let{name:s,component:i}=a;return(0,t.jsx)(m.$,{variant:"outline",size:"icon",onClick:()=>e.setPaintIcon(e=>e===s?null:s),className:(0,p.cn)(e.paintIcon===s&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(i,{className:"h-5 w-5"})},s)})}),e.paintIcon&&(0,t.jsxs)(m.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>e.setPaintIcon(null),children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}var ev=s(52354),ef=s(47219),eg=s(66424);function eN(e){let{activeMap:a,onPathUpdate:s,pathDrawingId:i,setPathDrawingId:l}=e,n=(e,t)=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,...t}:a))},r=e=>{i===e&&l(null),s(((null==a?void 0:a.paths)||[]).filter(a=>a.id!==e))},c=e=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,points:a.points.slice(0,-1)}:a))};return a?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(m.$,{onClick:()=>{let e={id:crypto.randomUUID(),name:"Path ".concat(((null==a?void 0:a.paths)||[]).length+1),color:"#FFD700",strokeWidth:3,points:[]};s([e,...(null==a?void 0:a.paths)||[]]),l(e.id)},className:"w-full",children:[(0,t.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Add New Path"]}),(0,t.jsx)(R.w,{}),(0,t.jsx)(eg.F,{className:"h-96",children:(0,t.jsx)("div",{className:"space-y-3 pr-2",children:(a.paths||[]).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-md bg-muted/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(M.p,{value:e.name,onChange:a=>n(e.id,{name:a.target.value}),className:"h-8 flex-1"}),(0,t.jsxs)(F.Lt,{children:[(0,t.jsx)(F.tv,{asChild:!0,children:(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(F.EO,{children:[(0,t.jsxs)(F.wd,{children:[(0,t.jsx)(F.r7,{children:"Delete Path?"}),(0,t.jsxs)(F.$v,{children:['Are you sure you want to delete "',e.name,'"? This cannot be undone.']})]}),(0,t.jsxs)(F.ck,{children:[(0,t.jsx)(F.Zr,{children:"Cancel"}),(0,t.jsx)(F.Rx,{onClick:()=>r(e.id),className:"bg-destructive",children:"Delete"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.J,{children:"Color:"}),(0,t.jsx)(M.p,{type:"color",value:e.color,onChange:a=>n(e.id,{color:a.target.value}),className:"h-8 w-16 p-1"}),(0,t.jsx)(w.J,{children:"Width:"}),(0,t.jsx)(M.p,{type:"number",value:e.strokeWidth,min:"1",max:"20",onChange:a=>n(e.id,{strokeWidth:parseInt(a.target.value,10)||1}),className:"h-8 flex-1"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(m.$,{variant:i===e.id?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>l(a=>a===e.id?null:e.id),children:[i===e.id?(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(ev.A,{className:"h-4 w-4 mr-2"}),i===e.id?"Drawing...":"Draw Path"]}),(0,t.jsx)(m.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>c(e.id),disabled:0===e.points.length,"aria-label":"Remove last point",children:(0,t.jsx)(ef.A,{className:"h-4 w-4"})})]})]},e.id))})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to manage paths."})}var ew=s(83013),ey=s(38914),eb=s(86318),eC=s(50286),eI=s(51920),eA=s(31841),ek=s(26126),eS=s(99865);function eE(e){let{worldSlug:a}=(0,ey.q)(),{activeMap:s,selectedHex:l,allDungeons:n,allFactions:r,allCities:c,allEvents:d,handleUpdateTileData:o,handleUpdateCityLinks:h}=e,u=(0,i.useMemo)(()=>null==s?void 0:s.tiles.find(e=>e.hex.q===(null==l?void 0:l.q)&&e.hex.r===(null==l?void 0:l.r)),[s,l]),x=(0,i.useMemo)(()=>new Map(n.map(e=>[e.id,e])),[n]),p=(0,i.useMemo)(()=>new Map(r.map(e=>[e.id,e])),[r]),j=(0,i.useMemo)(()=>new Map(c.map(e=>[e.id,e])),[c]),v=(0,i.useMemo)(()=>u&&s?d.filter(e=>e.location&&e.location.mapId===s.id&&e.location.hex.q===u.hex.q&&e.location.hex.r===u.hex.r&&e.location.hex.s===u.hex.s):[],[u,s,d]);if(!l||!u)return(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."});let f=e=>{let s=encodeURIComponent(JSON.stringify(e.startDate));return"#/".concat(a,"/calendar?selectedId=").concat(e.calendarId,"&selectedDate=").concat(s)};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",l.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",l.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",l.s]})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(w.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(et.A,{className:"h-4 w-4"}),"Cities"]}),(0,t.jsx)(eA.V,{title:"Link Cities",items:c,initialSelectedIds:u.data.cityIds||[],onConfirm:e=>h(l,e),trigger:(0,t.jsx)(m.$,{size:"sm",variant:"outline",children:(0,t.jsx)(eb.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(u.data.cityIds||[]).map(e=>{var s;return(0,t.jsx)("a",{href:"#/".concat(a,"/cities/").concat(e),children:(0,t.jsx)(ek.E,{variant:"secondary",className:"hover:bg-accent/50",children:null==(s=j.get(e))?void 0:s.name})},e)})})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(w.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(ee.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(eA.V,{title:"Link Dungeons",items:n,initialSelectedIds:u.data.dungeonIds||[],onConfirm:e=>o(l,{dungeonIds:e}),trigger:(0,t.jsx)(m.$,{size:"sm",variant:"outline",children:(0,t.jsx)(eb.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(u.data.dungeonIds||[]).map(e=>{var s;return(0,t.jsx)("a",{href:"#/".concat(a,"/dungeons/").concat(e),children:(0,t.jsx)(ek.E,{variant:"secondary",className:"hover:bg-accent/50",children:null==(s=x.get(e))?void 0:s.name})},e)})})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(w.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(eC.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(eA.V,{title:"Link Factions",items:r,initialSelectedIds:u.data.factionIds||[],onConfirm:e=>o(l,{factionIds:e}),trigger:(0,t.jsx)(m.$,{size:"sm",variant:"outline",children:(0,t.jsx)(eb.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(u.data.factionIds||[]).map(e=>{var s;return(0,t.jsx)("a",{href:"#/".concat(a,"/factions/").concat(e),children:(0,t.jsx)(ek.E,{variant:"secondary",className:"hover:bg-accent/50",children:null==(s=p.get(e))?void 0:s.name})},e)})})]}),(0,t.jsx)(R.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(w.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(eI.A,{className:"h-4 w-4"}),"Events"]}),v.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:v.map(e=>{try{return(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("a",{href:f(e),className:"font-semibold text-sm text-accent hover:underline",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,ew.GP)((0,eS.$k)(e.startDate),"P")," - ",(0,ew.GP)((0,eS.$k)(e.endDate),"P")]})]},e.id)}catch(a){return console.error("Error formatting date for event:",e,a),(0,t.jsxs)("div",{className:"p-1 rounded bg-destructive/20",children:[(0,t.jsx)("p",{className:"font-semibold text-sm text-destructive-foreground",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-destructive-foreground",children:"Invalid date format"})]},e.id)}})}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]})}function eM(e){let a=(0,d.a)(),[s,l]=(0,i.useState)(!a);return(0,i.useEffect)(()=>{l(!a)},[a]),(0,t.jsx)(h.Nt,{open:!a||s,onOpenChange:a?l:void 0,className:"fixed z-10 w-80 shadow-lg top-20 left-4",children:(0,t.jsxs)(o.Zp,{children:[(0,t.jsx)(o.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),a&&(0,t.jsx)(h.R6,{asChild:!0,children:(0,t.jsxs)(m.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(h.Ke,{children:(0,t.jsx)(o.Wu,{children:(0,t.jsxs)(j,{value:e.activeTool,onValueChange:a=>e.setActiveTool(a),className:"w-full",children:[(0,t.jsxs)(v,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(f,{value:"settings",children:"Settings"}),(0,t.jsx)(f,{value:"paint",children:"Paint"}),(0,t.jsx)(f,{value:"path",children:"Path"}),(0,t.jsx)(f,{value:"data",children:"Data"})]}),(0,t.jsx)(g,{value:"settings",className:"mt-4 space-y-4",children:(0,t.jsx)(J,{...e})}),(0,t.jsx)(g,{value:"paint",className:"mt-4",children:(0,t.jsx)(ej,{...e})}),(0,t.jsx)(g,{value:"path",className:"mt-4",children:(0,t.jsx)(eN,{activeMap:e.activeMap,onPathUpdate:e.handlePathUpdate,pathDrawingId:e.pathDrawingId,setPathDrawingId:e.setPathDrawingId})}),(0,t.jsx)(g,{value:"data",className:"mt-4",children:(0,t.jsx)(eE,{...e})})]})})})]})})}function eF(){let[e,a]=(0,i.useState)([]),[s,d]=(0,i.useState)(null),[o,h]=(0,i.useState)(null),[m,u]=(0,i.useState)(null),[x,j]=(0,i.useState)("settings"),[v,f]=(0,i.useState)("brush"),[g,N]=(0,i.useState)("#8A2BE2"),[w,y]=(0,i.useState)(null),[b,C]=(0,i.useState)(null),[I,A]=(0,i.useState)("#E0D6F0"),[k,S]=(0,i.useState)(!0),[E,M]=(0,i.useState)("#E0D6F0"),[F,P]=(0,i.useState)([]),[z,D]=(0,i.useState)([]),[q,$]=(0,i.useState)([]),[R,J]=(0,i.useState)([]),[L,T]=(0,i.useState)(!1),[U,V]=(0,i.useState)(!1),{toast:B}=(0,c.dj)();(0,i.useEffect)(()=>{let e=e=>{"Alt"===e.key&&(e.preventDefault(),T(!0))},a=e=>{"Alt"===e.key&&T(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]);let W=(0,i.useCallback)(async e=>{let t=(await (0,r.xW)()).sort((e,a)=>e.name.localeCompare(a.name));if(a(t),e)return void d(e);s&&!t.some(e=>e.id===s)?d(t.length>0?t[0].id:null):!s&&t.length>0?d(t[0].id):0===t.length&&(d(null),h(null))},[s]);(0,i.useEffect)(()=>{W(),(0,r.J0)().then(P),(0,r.vq)().then(D),(0,r.bj)().then($),(0,r.HV)().then(J)},[]),(0,i.useEffect)(()=>{s?((0,r.zU)(s).then(e=>{e&&h(e)}),u(null),C(null)):h(null)},[s]);let H=e=>{let a=parseInt((e=e.replace("#","")).substring(0,2),16),s=parseInt(e.substring(2,4),16);return(.2126*a+.7152*s+.0722*parseInt(e.substring(4,6),16))/255};(0,i.useEffect)(()=>{k?M(H(g)>.5?"#000000":"#FFFFFF"):M(I)},[k,g,I]);let G=(0,i.useCallback)(e=>{h(e),(0,r.cA)(e).catch(()=>{B({variant:"destructive",title:"Auto-save failed."})})},[B]),O=(0,i.useCallback)(e=>{o&&G({...o,tiles:e})},[o,G]),Z=(0,i.useCallback)(async(e,a)=>{if(!o)return;let s=o.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);if(!s)return;let t=new Set(s.data.cityIds||[]),i=new Set(a),l=a.filter(e=>!t.has(e)),n=Array.from(t).filter(e=>!i.has(e)),c=[],d=new Map;for(let e of n){let a=R.find(a=>a.id===e);a&&c.push((0,r.b4)({...a,location:void 0}))}for(let a of l){let s=R.find(e=>e.id===a);if(s){if(s.location&&s.location.mapId===o.id){let e="".concat(s.location.hex.q,",").concat(s.location.hex.r);if(!d.has(e)){let a=o.tiles.find(e=>e.hex.q===s.location.hex.q&&e.hex.r===s.location.hex.r);d.set(e,{q:s.location.hex.q,r:s.location.hex.r,cityIds:(null==a?void 0:a.data.cityIds)||[]})}let t=d.get(e);t.cityIds=t.cityIds.filter(e=>e!==a)}c.push((0,r.b4)({...s,location:{mapId:o.id,hex:e}}))}}let h="".concat(e.q,",").concat(e.r);d.has(h)||d.set(h,{q:e.q,r:e.r,cityIds:s.data.cityIds||[]}),d.get(h).cityIds=a;let m=o.tiles.map(e=>{let a="".concat(e.hex.q,",").concat(e.hex.r);return d.has(a)?{...e,data:{...e.data,cityIds:d.get(a).cityIds}}:e});await Promise.all(c),G({...o,tiles:m}),(0,r.HV)().then(J)},[o,R,G]),_=(0,i.useCallback)(e=>{o&&G({...o,paths:e})},[o,G]),K=(0,i.useCallback)(e=>{o&&b&&_((o.paths||[]).map(a=>a.id===b?{...a,points:[...a.points,e]}:a))},[o,b,_]);return(0,t.jsx)(l.A,{children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[o?(0,t.jsx)(n.A,{mapData:o,hexSize:25,className:(0,p.cn)("w-full h-full",(U||L&&"paint"===x&&"brush"===v)&&"cursor-crosshair"),style:{touchAction:"none"},onGridUpdate:O,onHexClick:u,onAddPointToPath:K,activeTool:x,paintMode:v,paintColor:g,paintIcon:w,paintIconColor:E,selectedHex:m,isCtrlPressed:!1,isAltPressed:L,isShiftPressed:!1,isEyedropperActive:U,onEyedropperClick:e=>{if(!o)return;let a=o.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);a&&(N(a.data.color||"#8A2BE2"),y(a.data.icon||null),a.data.iconColor&&(A(a.data.iconColor),S(!1))),V(!1),B({title:"Tile properties copied to brush."})},pathDrawingId:b}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(eM,{maps:e,selectedMapId:s,setSelectedMapId:d,activeMap:o,handleMapsUpdate:e=>{W(e)},handleMapUpdate:G,activeTool:x,setActiveTool:j,paintMode:v,setPaintMode:f,paintColor:g,setPaintColor:N,isEyedropperActive:U,setIsEyedropperActive:V,isIconColorAuto:k,setIsIconColorAuto:S,manualIconColor:I,setManualIconColor:A,paintIcon:w,setPaintIcon:y,pathDrawingId:b,setPathDrawingId:C,handlePathUpdate:_,selectedHex:m,allDungeons:F,allFactions:z,allCities:R,allEvents:q,handleUpdateTileData:(e,a)=>{if(o){let s=o.tiles.map(s=>s.hex.q===e.q&&s.hex.r===e.r?{...s,data:{...s.data,...a}}:s);G({...o,tiles:s})}},handleUpdateCityLinks:Z})]})})}}}]);
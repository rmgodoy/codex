"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1625],{81625:(e,s,l)=>{l.r(s),l.d(s,{default:()=>D});var t=l(95155),a=l(12115),r=l(99982),i=l(20031),n=l(47906),c=l(53648),d=l(23062),o=l(62523),x=l(30285),h=l(66424),m=l(22346),u=l(87481),j=l(34301),p=l(75074),f=l(20203),g=l(73926),v=l(85057),N=l(59409),y=l(90648);function w(e){let{onSelectItem:s,onNewItem:l,selectedItemId:r,dataVersion:i,filters:n,setFilters:w,onClearFilters:C}=e,[b,F]=(0,a.useState)([]),[S,z]=(0,a.useState)(!0),{toast:k}=(0,u.dj)();(0,a.useEffect)(()=>{(async()=>{z(!0);try{let e=await (0,c.vV)();F(e)}catch(e){k({variant:"destructive",title:"Error",description:"Could not fetch alchemy items from database."})}finally{z(!1)}})()},[i,k]);let I=(0,a.useMemo)(()=>{let e=b.filter(e=>{let s=e.name.toLowerCase().includes(n.searchTerm.toLowerCase()),l="all"===n.tierFilter||e.tier===n.tierFilter,t="all"===n.typeFilter||e.type===n.typeFilter,a=!0,r=n.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return r.length>0&&(a=!!e.tags&&r.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&l&&t&&a}),s={lesser:1,greater:2},l=e.sort((e,l)=>{if("tier"===n.sortBy){let t=(s[e.tier]||0)-(s[l.tier]||0);if(0!==t)return t}if("cost"===n.sortBy){let s=e.cost-l.cost;if(0!==s)return s}return e.name.localeCompare(l.name)});return"desc"===n.sortOrder&&l.reverse(),l},[b,n]);return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)(x.$,{onClick:l,className:"w-full",children:[(0,t.jsx)(j.A,{})," New Alchemical Item"]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(o.p,{placeholder:"Search items...",value:n.searchTerm,onChange:e=>w.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(v.J,{children:"Filter"}),(0,t.jsx)(x.$,{variant:"ghost",size:"sm",onClick:C,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,t.jsxs)(N.l6,{value:n.typeFilter,onValueChange:w.setTypeFilter,children:[(0,t.jsx)(N.bq,{children:(0,t.jsx)(N.yv,{placeholder:"Filter by type"})}),(0,t.jsxs)(N.gC,{children:[(0,t.jsx)(N.eb,{value:"all",children:"All Types"}),d.Yh.map(e=>(0,t.jsx)(N.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,t.jsxs)(N.l6,{value:n.tierFilter,onValueChange:w.setTierFilter,children:[(0,t.jsx)(N.bq,{children:(0,t.jsx)(N.yv,{placeholder:"Filter by tier"})}),(0,t.jsxs)(N.gC,{children:[(0,t.jsx)(N.eb,{value:"all",children:"All Tiers"}),d.ag.map(e=>(0,t.jsx)(N.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,t.jsx)(y.F,{value:n.tagFilter?n.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>w.setTagFilter(e.join(",")),placeholder:"Tags (e.g. buff, damage)",tagSource:"alchemicalItem"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(v.J,{children:"Sort by"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(N.l6,{value:n.sortBy,onValueChange:e=>w.setSortBy(e),children:[(0,t.jsx)(N.bq,{children:(0,t.jsx)(N.yv,{placeholder:"Sort by"})}),(0,t.jsxs)(N.gC,{children:[(0,t.jsx)(N.eb,{value:"name",children:"Name"}),(0,t.jsx)(N.eb,{value:"tier",children:"Tier"}),(0,t.jsx)(N.eb,{value:"cost",children:"Cost"})]})]}),(0,t.jsxs)(x.$,{variant:"ghost",size:"icon",onClick:()=>w.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===n.sortOrder?(0,t.jsx)(f.A,{className:"h-4 w-4"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,t.jsx)(m.w,{}),(0,t.jsx)(h.F,{className:"flex-1",children:(0,t.jsx)("div",{className:"p-4",children:S?(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading items..."}):I.length>0?(0,t.jsx)("ul",{className:"space-y-1",children:I.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(r===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,t.jsxs)("span",{className:"text-xs opacity-70 capitalize",children:["(",e.tier,")"]})]})},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"No items found."})})})]})}var C=l(62177),b=l(90221),F=l(55594),S=l(66695),z=l(88539),k=l(90010),I=l(17759),A=l(12543),E=l(18763),B=l(77223),T=l(25318),V=l(53054),$=l(68856),R=l(26126);let L=F.z.object({name:F.z.string().min(1,"Item name is required"),type:F.z.enum(d.Yh),tier:F.z.enum(d.ag),cost:F.z.coerce.number().min(1,"Cost must be at least 1"),effect:F.z.string().min(1,"Effect is required"),tags:F.z.array(F.z.string()).optional()}),J={name:"",type:"potion",tier:"lesser",cost:2,effect:"",tags:[]};function Z(e){let{itemId:s,isCreatingNew:l,onSaveSuccess:r,onDeleteSuccess:i,onEditCancel:h,onFilterByClick:m,onBack:j}=e,{toast:p}=(0,u.dj)(),[f,g]=(0,a.useState)(l),[v,w]=(0,a.useState)(!l&&!!s),[F,Z]=(0,a.useState)(null),q=(0,n.a)(),D=(0,C.mN)({resolver:(0,b.u)(L),defaultValues:J}),M=D.watch("tier");(0,a.useEffect)(()=>{if(f){let e="lesser"===M?2:3;D.getValues("cost")!==e&&D.setValue("cost",e)}},[M,D,f]),(0,a.useEffect)(()=>{(async()=>{if(l){D.reset(J),Z(null),g(!0),w(!1);return}if(!s){g(!1),w(!1),Z(null);return}w(!0),g(!1);try{let e=await (0,c.rD)(s);e?(D.reset(e),Z(e)):Z(null)}catch(e){p({variant:"destructive",title:"Error",description:"Could not load item data."})}finally{w(!1)}})()},[s,l,D,p]);let O=()=>{l?h():F&&(D.reset(F),g(!1))},W=async e=>{try{let t,a={...e,tags:e.tags||[]},i=e.tags||[];if(i.length>0&&await (0,c.JE)(i,"alchemicalItem"),l)t=await (0,c.wo)(a),p({title:"Item Created!",description:"".concat(e.name," has been added.")});else{if(!s)return;t=s,await (0,c.S9)({...a,id:s}),p({title:"Save Successful",description:"".concat(e.name," has been updated.")})}r(t),g(!1)}catch(e){p({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},_=async()=>{if(s)try{await (0,c.gL)(s),p({title:"Item Deleted",description:"The alchemical item has been removed."}),i()}catch(e){p({variant:"destructive",title:"Deletion Failed",description:"Could not delete the item."})}};return v?(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsxs)(S.Zp,{children:[(0,t.jsx)(S.aR,{children:(0,t.jsx)($.E,{className:"h-8 w-48"})}),(0,t.jsx)(S.Wu,{children:(0,t.jsx)($.E,{className:"h-40 w-full"})})]})}):s||l?!f&&F?(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsxs)(S.Zp,{children:[(0,t.jsx)(S.aR,{children:(0,t.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[q&&j&&(0,t.jsx)(x.$,{variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2 -mt-1",children:(0,t.jsx)(A.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(S.ZB,{className:"text-3xl font-bold",children:F.name}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm capitalize",children:[(0,t.jsx)("button",{onClick:e=>m({typeFilter:F.type},e),className:"hover:underline p-0 bg-transparent text-muted-foreground",children:F.type}),(0,t.jsx)("button",{onClick:e=>m({tierFilter:F.tier},e),className:"hover:underline p-0 bg-transparent text-muted-foreground",children:F.tier}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Cost: ",F.cost]})]})]})]}),(0,t.jsxs)(x.$,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[(0,t.jsx)(E.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,t.jsx)(S.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:F.effect}),F.tags&&F.tags.length>0&&(0,t.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:F.tags.map(e=>(0,t.jsx)("button",{onClick:s=>m({tagFilter:e},s),className:"bg-transparent border-none p-0 m-0",children:(0,t.jsx)(R.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,t.jsx)(S.wL,{children:(0,t.jsxs)(k.Lt,{children:[(0,t.jsx)(k.tv,{asChild:!0,children:(0,t.jsx)(x.$,{type:"button",variant:"destructive",size:"sm",children:(0,t.jsx)(B.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(k.EO,{children:[(0,t.jsxs)(k.wd,{children:[(0,t.jsx)(k.r7,{children:"Are you sure?"}),(0,t.jsxs)(k.$v,{children:['This will permanently delete "',F.name,'".']})]}),(0,t.jsxs)(k.ck,{children:[(0,t.jsx)(k.Zr,{children:"Cancel"}),(0,t.jsx)(k.Rx,{onClick:_,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsx)(S.Zp,{children:(0,t.jsx)(I.lV,{...D,children:(0,t.jsxs)("form",{onSubmit:D.handleSubmit(W),className:"space-y-6",children:[(0,t.jsx)(S.aR,{children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[q&&j&&(0,t.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:O,className:"shrink-0 -ml-2",children:(0,t.jsx)(A.A,{className:"h-5 w-5"})}),(0,t.jsx)("div",{children:(0,t.jsx)(S.ZB,{children:l?q?"New Item":"Create New Alchemical Item":"Editing: ".concat(D.getValues("name")||"...")})})]}),!q&&(0,t.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:O,className:"text-muted-foreground hover:text-foreground",children:(0,t.jsx)(T.A,{className:"h-5 w-5"})})]})}),(0,t.jsxs)(S.Wu,{className:"space-y-6",children:[(0,t.jsx)(I.zB,{name:"name",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"Name"}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(o.p,{...s})}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(I.zB,{name:"type",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"Type"}),(0,t.jsxs)(N.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,t.jsx)(I.MJ,{children:(0,t.jsx)(N.bq,{children:(0,t.jsx)(N.yv,{})})}),(0,t.jsx)(N.gC,{children:d.Yh.map(e=>(0,t.jsx)(N.eb,{value:e,className:"capitalize",children:e},e))})]})]})}}),(0,t.jsx)(I.zB,{name:"tier",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"Tier"}),(0,t.jsxs)(N.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,t.jsx)(I.MJ,{children:(0,t.jsx)(N.bq,{children:(0,t.jsx)(N.yv,{})})}),(0,t.jsx)(N.gC,{children:d.ag.map(e=>(0,t.jsx)(N.eb,{value:e,className:"capitalize",children:e},e))})]})]})}}),(0,t.jsx)(I.zB,{name:"cost",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"Cost"}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(o.p,{type:"number",...s,readOnly:!0,className:"bg-muted"})}),(0,t.jsx)(I.C5,{})]})}})]}),(0,t.jsx)(I.zB,{name:"effect",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsx)(I.lR,{children:"Effect"}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(z.T,{...s,rows:4})}),(0,t.jsx)(I.C5,{})]})}}),(0,t.jsx)(I.zB,{name:"tags",control:D.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(I.eI,{children:[(0,t.jsxs)(I.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(V.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,t.jsx)(I.MJ,{children:(0,t.jsx)(y.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"alchemicalItem"})}),(0,t.jsx)(I.C5,{})]})}})]}),(0,t.jsxs)(S.wL,{className:"flex items-center gap-2",children:[!l&&(0,t.jsxs)(k.Lt,{children:[(0,t.jsx)(k.tv,{asChild:!0,children:(0,t.jsx)(x.$,{type:"button",variant:"destructive",size:"sm",children:(0,t.jsx)(B.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(k.EO,{children:[(0,t.jsxs)(k.wd,{children:[(0,t.jsx)(k.r7,{children:"Are you sure?"}),(0,t.jsxs)(k.$v,{children:['This will permanently delete "',D.getValues("name"),'".']})]}),(0,t.jsxs)(k.ck,{children:[(0,t.jsx)(k.Zr,{children:"Cancel"}),(0,t.jsx)(k.Rx,{onClick:_,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,t.jsx)("div",{className:"flex-grow"}),!q&&(0,t.jsx)(x.$,{type:"button",variant:"outline",onClick:O,children:"Cancel"}),(0,t.jsx)(x.$,{type:"submit",children:l?"Create Item":"Save Changes"})]})]})})})}):(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsx)(S.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,t.jsxs)(S.Wu,{className:"text-center pt-6",children:[(0,t.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an item to view"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}async function q(){return Promise.resolve()}function D(){let[e,s]=(0,a.useState)(null),[l,c]=(0,a.useState)(!1),[d,o]=(0,a.useState)(0),[x,h]=(0,a.useState)(""),[m,u]=(0,a.useState)("all"),[j,p]=(0,a.useState)("all"),[f,g]=(0,a.useState)(""),[v,N]=(0,a.useState)("name"),[y,C]=(0,a.useState)("asc"),[b,F]=(0,a.useState)(!1),S=(0,n.a)(),[z,k]=(0,a.useState)("list");(0,a.useEffect)(()=>{F(!0),q().then(()=>{o(e=>e+1)})},[]);let I={searchTerm:x,tierFilter:m,typeFilter:j,tagFilter:f,sortBy:v,sortOrder:y},A={setSearchTerm:h,setTierFilter:u,setTypeFilter:p,setTagFilter:g,setSortBy:N,setSortOrder:C},E=(e,s)=>{s.shiftKey?(e.typeFilter&&p(e.typeFilter),e.tierFilter&&u(e.tierFilter),e.tagFilter&&g(s=>s?s.split(",").map(e=>e.trim()).includes(e.tagFilter)?s:"".concat(s,", ").concat(e.tagFilter):e.tagFilter)):(p(e.typeFilter||"all"),u(e.tierFilter||"all"),g(e.tagFilter||""))},B=()=>{h(""),u("all"),p("all"),g(""),N("name"),C("asc")},T=()=>o(e=>e+1),V=e=>{s(e),c(!1),S&&k("editor")},$=()=>{s(null),c(!0),S&&k("editor")},R=e=>{T(),s(e),c(!1),S&&k("editor")},L=()=>{T(),s(null),c(!1),S&&k("list")},J=()=>{l&&(c(!1),s(null),S&&k("list"))};return b?S?(0,t.jsx)(r.A,{children:(0,t.jsx)("div",{className:"h-full w-full",children:"list"===z?(0,t.jsx)(w,{onSelectItem:V,onNewItem:$,selectedItemId:e,dataVersion:d,filters:I,setFilters:A,onClearFilters:B}):(0,t.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,t.jsx)("div",{className:"p-4 sm:p-6",children:(0,t.jsx)(Z,{itemId:e,isCreatingNew:l,onSaveSuccess:R,onDeleteSuccess:L,onEditCancel:J,onFilterByClick:E,onBack:()=>{k("list"),s(null),c(!1)}},null!=e?e:l?"new":"placeholder")})})})}):(0,t.jsx)(i.SidebarProvider,{children:(0,t.jsx)(r.A,{children:(0,t.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,t.jsx)(i.Bx,{style:{"--sidebar-width":"380px"},children:(0,t.jsx)(w,{onSelectItem:V,onNewItem:$,selectedItemId:e,dataVersion:d,filters:I,setFilters:A,onClearFilters:B})}),(0,t.jsx)(i.sF,{className:"flex-1 overflow-y-auto",children:(0,t.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,t.jsx)(Z,{itemId:e,isCreatingNew:l,onSaveSuccess:R,onDeleteSuccess:L,onEditCancel:J,onFilterByClick:E},null!=e?e:l?"new":"placeholder")})})]})})}):null}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6444],{31841:(e,a,s)=>{s.d(a,{V:()=>h});var t=s(95155),l=s(12115),i=s(30285),n=s(54165),r=s(62523),c=s(66424),d=s(47262),o=s(85057);function h(e){let{items:a,initialSelectedIds:s=[],onConfirm:h,trigger:m,title:u}=e,[x,p]=(0,l.useState)(!1),[j,v]=(0,l.useState)(""),[f,g]=(0,l.useState)(new Set(s));(0,l.useEffect)(()=>{x&&g(new Set(s))},[x,s]);let N=(0,l.useMemo)(()=>a.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())),[a,j]),w=(e,a)=>{g(s=>{let t=new Set(s);return a?t.add(e):t.delete(e),t})};return(0,t.jsxs)(n.lG,{open:x,onOpenChange:p,children:[(0,t.jsx)(n.zM,{asChild:!0,children:m}),(0,t.jsxs)(n.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(n.c7,{children:(0,t.jsx)(n.L3,{children:u})}),(0,t.jsx)(r.p,{placeholder:"Search...",value:j,onChange:e=>v(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:N.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(d.S,{id:"item-select-".concat(e.id),checked:f.has(e.id),onCheckedChange:a=>w(e.id,!!a)}),(0,t.jsx)(o.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(n.Es,{className:"pt-4",children:[(0,t.jsx)(i.$,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),(0,t.jsx)(i.$,{onClick:()=>{h(Array.from(f)),p(!1)},children:"Confirm"})]})]})]})}},46444:(e,a,s)=>{s.r(a),s.d(a,{default:()=>eN});var t=s(95155),l=s(12115),i=s(46855),n=s(19209),r=s(66695),c=s(18186),d=s(68715),o=s(66049),h=s(57946),m=s(23767),u=s(20427),x=s(43152),p=s(83662),j=s(55166),v=s(82643),f=s(86950),g=s(56013),N=s(18046),w=s(10518),y=s(25318),b=s(18763),C=s(77223),k=s(21887),S=s(10366),A=s(10947),I=s(47326),F=s(17657),E=s(11133),M=s(86318),z=s(50286),q=s(51920),D=s(52354),P=s(47219),$=s(7146),J=s(53648),R=s(60704),L=s(59434);let V=R.bL,B=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(R.B8,{ref:a,className:(0,L.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...l})});B.displayName=R.B8.displayName;let T=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(R.l9,{ref:a,className:(0,L.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...l})});T.displayName=R.l9.displayName;let W=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(R.UC,{ref:a,className:(0,L.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...l})});W.displayName=R.UC.displayName;var H=s(85057),U=s(62523),G=s(30285),Z=s(22346),_=s(46102),O=s(49864),Y=s(74466),K=s(124);let Q=(0,Y.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});l.forwardRef((e,a)=>{let{className:s,variant:l,size:i,...n}=e;return(0,t.jsx)(K.b,{ref:a,className:(0,L.cn)(Q({variant:l,size:i,className:s})),...n})}).displayName=K.b.displayName;let X=(0,Y.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),ee=l.createContext({size:"default",variant:"default"}),ea=l.forwardRef((e,a)=>{let{className:s,variant:l,size:i,children:n,...r}=e;return(0,t.jsx)(O.bL,{ref:a,className:(0,L.cn)(X({variant:l,className:s})),...r,children:(0,t.jsx)(ee.Provider,{value:{variant:l,size:i},children:n})})});ea.displayName=O.bL.displayName;let es=l.forwardRef((e,a)=>{let{className:s,children:i,variant:n,size:r,...c}=e,d=l.useContext(ee);return(0,t.jsx)(O.q7,{ref:a,className:(0,L.cn)(Q({variant:d.variant||n,size:d.size||r}),s),...c,children:i})});es.displayName=O.q7.displayName;var et=s(31841),el=s(26126),ei=s(54165),en=s(59409),er=s(87481),ec=s(90010),ed=s(83013),eo=s(47906),eh=s(8643),em=s(66424),eu=s(54059),ex=s(70154);let ep=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(eu.bL,{className:(0,L.cn)("grid gap-2",s),...l,ref:a})});ep.displayName=eu.bL.displayName;let ej=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(eu.q7,{ref:a,className:(0,L.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:(0,t.jsx)(eu.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(ex.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});ej.displayName=eu.q7.displayName;let ev=[{name:"Home",component:c.A},{name:"Trees",component:d.A},{name:"Mountain",component:o.A},{name:"Castle",component:h.A},{name:"TowerControl",component:m.A},{name:"Tent",component:u.A},{name:"Waves",component:x.A},{name:"MapPin",component:p.A},{name:"Landmark",component:j.A},{name:"Skull",component:v.A},{name:"Building",component:f.A}],ef=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function eg(e){let{maps:a,onMapsUpdate:s}=e,[i,n]=(0,l.useState)(!1),[r,c]=(0,l.useState)(""),[d,o]=(0,l.useState)("radial"),[h,m]=(0,l.useState)(20),[u,x]=(0,l.useState)(30),[p,j]=(0,l.useState)(20),[v,f]=(0,l.useState)(null),[k,S]=(0,l.useState)(""),{toast:A}=(0,er.dj)(),I=async()=>{let e,a;if(!r.trim())return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name."});if("radial"===d){if(!h||h<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid radius."});e=(0,$.Xk)(h),a={name:r.trim(),shape:"radial",radius:h,tiles:e,paths:[]}}else{if(!u||u<=0||!p||p<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide valid width and height."});e=(0,$.z0)(u,p),a={name:r.trim(),shape:"rectangular",width:u,height:p,tiles:e,paths:[]}}try{let e=await (0,J.Ys)(a);A({title:"Map Created",description:"'".concat(r,"' has been added.")}),c(""),m(20),x(30),j(20),s(e),n(!1)}catch(e){A({variant:"destructive",title:"Error",description:"Failed to create map."})}},F=e=>{f(e.id),S(e.name)},E=()=>{f(null),S("")},M=async()=>{if(!v||!k.trim())return;let e=a.find(e=>e.id===v);if(e)try{await (0,J.cA)({...e,name:k.trim()}),A({title:"Map Renamed"}),s(),E()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to rename map."})}},z=async e=>{try{await (0,J.GY)(e),A({title:"Map Deleted"}),s()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(ei.lG,{open:i,onOpenChange:n,children:[(0,t.jsx)(ei.zM,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(g.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(ei.Cf,{children:[(0,t.jsxs)(ei.c7,{children:[(0,t.jsx)(ei.L3,{children:"Manage Maps"}),(0,t.jsx)(ei.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-4 p-3 border rounded-md",children:[(0,t.jsx)(H.J,{children:"New Map"}),(0,t.jsx)(U.p,{placeholder:"New map name...",value:r,onChange:e=>c(e.target.value)}),(0,t.jsxs)(ep,{value:d,onValueChange:e=>o(e),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"radial",id:"radial"}),(0,t.jsx)(H.J,{htmlFor:"radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"rectangular",id:"rectangular"}),(0,t.jsx)(H.J,{htmlFor:"rectangular",children:"Rectangular"})]})]}),"radial"===d?(0,t.jsx)(U.p,{placeholder:"Radius",type:"number",value:h,onChange:e=>m(parseInt(e.target.value,10)||0)}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(U.p,{placeholder:"Width",type:"number",value:u,onChange:e=>x(parseInt(e.target.value,10)||0)}),(0,t.jsx)(U.p,{placeholder:"Height",type:"number",value:p,onChange:e=>j(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(G.$,{onClick:I,className:"w-full",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"})," Add Map"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:v===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.p,{value:k,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key&&M()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(G.$,{size:"icon",className:"h-7 w-7",onClick:M,"aria-label":"Save",children:(0,t.jsx)(w.A,{className:"h-4 w-4"})}),(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:E,"aria-label":"Cancel",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>F(e),"aria-label":"Edit",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})}),(0,t.jsxs)(ec.Lt,{children:[(0,t.jsx)(ec.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(C.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(ec.EO,{children:[(0,t.jsxs)(ec.wd,{children:[(0,t.jsx)(ec.r7,{children:"Are you sure?"}),(0,t.jsxs)(ec.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(ec.ck,{children:[(0,t.jsx)(ec.Zr,{children:"Cancel"}),(0,t.jsx)(ec.Rx,{onClick:()=>z(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function eN(){let[e,a]=(0,l.useState)([]),[s,c]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[h,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(null),[j,v]=(0,l.useState)("settings"),[g,N]=(0,l.useState)("brush"),[w,b]=(0,l.useState)("#8A2BE2"),[C,D]=(0,l.useState)(null),[P,R]=(0,l.useState)(null),[O,Y]=(0,l.useState)("#E0D6F0"),[K,Q]=(0,l.useState)(!0),[X,ee]=(0,l.useState)("#E0D6F0"),[ei,ec]=(0,l.useState)([]),[em,eu]=(0,l.useState)([]),[ex,eN]=(0,l.useState)([]),[ey,eb]=(0,l.useState)([]),[eC,ek]=(0,l.useState)(!1),[eS,eA]=(0,l.useState)(!1),[eI,eF]=(0,l.useState)(!1),[eE,eM]=(0,l.useState)(!1),{toast:ez}=(0,er.dj)(),eq=(0,eo.a)(),[eD,eP]=(0,l.useState)(!0);(0,l.useEffect)(()=>{eP(!eq)},[eq]),(0,l.useEffect)(()=>{let e=e=>{"Control"===e.key&&ek(!0),"Alt"===e.key&&(e.preventDefault(),eA(!0)),"Shift"===e.key&&eF(!0)},a=e=>{"Control"===e.key&&ek(!1),"Alt"===e.key&&eA(!1),"Shift"===e.key&&eF(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]);let e$=(0,l.useCallback)(async e=>{let t=(await (0,J.xW)()).sort((e,a)=>e.name.localeCompare(a.name));if(a(t),e)return void c(e);s&&!t.some(e=>e.id===s)?c(t.length>0?t[0].id:null):!s&&t.length>0?c(t[0].id):0===t.length&&(c(null),o(null))},[s]);(0,l.useEffect)(()=>{e$(),(0,J.J0)().then(ec),(0,J.vq)().then(eu),(0,J.bj)().then(eN),(0,J.HV)().then(eb)},[]),(0,l.useEffect)(()=>{s?((0,J.zU)(s).then(e=>{e&&o(e)}),x(null),R(null)):o(null)},[s]),(0,l.useEffect)(()=>{d?m({name:d.name,shape:d.shape||"radial",radius:d.radius||20,width:d.width||30,height:d.height||20}):m(null)},[d]);let eJ=e=>{let a=parseInt((e=e.replace("#","")).substring(0,2),16),s=parseInt(e.substring(2,4),16);return(.2126*a+.7152*s+.0722*parseInt(e.substring(4,6),16))/255};(0,l.useEffect)(()=>{K?ee(eJ(w)>.5?"#000000":"#FFFFFF"):ee(O)},[K,w,O]);let eR=(0,l.useCallback)(e=>{o(e),(0,J.cA)(e).catch(()=>{ez({variant:"destructive",title:"Auto-save failed."})})},[ez]),eL=(0,l.useCallback)(e=>{d&&eR({...d,tiles:e})},[d,eR]),eV=(0,l.useCallback)(async(e,a)=>{if(!d)return;let s=d.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);if(!s)return;let t=new Set(s.data.cityIds||[]),l=new Set(a),i=a.filter(e=>!t.has(e)),n=Array.from(t).filter(e=>!l.has(e)),r=[],c=new Map;for(let e of n){let a=ey.find(a=>a.id===e);a&&r.push((0,J.b4)({...a,location:void 0}))}for(let a of i){let s=ey.find(e=>e.id===a);if(s){if(s.location&&s.location.mapId===d.id){let e="".concat(s.location.hex.q,",").concat(s.location.hex.r);if(!c.has(e)){let a=d.tiles.find(e=>e.hex.q===s.location.hex.q&&e.hex.r===s.location.hex.r);c.set(e,{q:s.location.hex.q,r:s.location.hex.r,cityIds:(null==a?void 0:a.data.cityIds)||[]})}let t=c.get(e);t.cityIds=t.cityIds.filter(e=>e!==a)}r.push((0,J.b4)({...s,location:{mapId:d.id,hex:e}}))}}let o="".concat(e.q,",").concat(e.r);c.has(o)||c.set(o,{q:e.q,r:e.r,cityIds:s.data.cityIds||[]}),c.get(o).cityIds=a;let h=d.tiles.map(e=>{let a="".concat(e.hex.q,",").concat(e.hex.r);return c.has(a)?{...e,data:{...e.data,cityIds:c.get(a).cityIds}}:e});await Promise.all(r),eR({...d,tiles:h}),(0,J.HV)().then(eb)},[d,ey,eR,ez]),eB=(e,a)=>{if(d){let s=d.tiles.map(s=>s.hex.q===e.q&&s.hex.r===e.r?{...s,data:{...s.data,...a}}:s);eR({...d,tiles:s})}},eT=(0,l.useCallback)(e=>{d&&eR({...d,paths:e})},[d,eR]),eW=(0,l.useCallback)(e=>{d&&P&&eT((d.paths||[]).map(a=>a.id===P?{...a,points:[...a.points,e]}:a))},[d,P,eT]),eH=async()=>{let e,s;if(d&&h){if(!h.name.trim())return void ez({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if("radial"===h.shape){if(isNaN(h.radius)||h.radius<=0||h.radius>100)return void ez({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});e=(0,$.YS)(d.tiles,h.radius),s={...d,name:h.name,shape:"radial",radius:h.radius,width:void 0,height:void 0,tiles:e}}else{if(isNaN(h.width)||h.width<=0||h.width>200||isNaN(h.height)||h.height<=0||h.height>200)return void ez({variant:"destructive",title:"Validation Error",description:"Width and Height must be between 1 and 200."});e=(0,$.z0)(h.width,h.height,d.tiles),s={...d,name:h.name,shape:"rectangular",width:h.width,height:h.height,radius:void 0,tiles:e}}try{await (0,J.cA)(s),o(s),a(e=>e.map(e=>e.id===s.id?{...e,name:s.name}:e)),ez({title:"Map settings saved!"})}catch(e){ez({variant:"destructive",title:"Save failed"})}}},eU="erase"===g,eG=(0,l.useMemo)(()=>null==d?void 0:d.tiles.find(e=>e.hex.q===(null==u?void 0:u.q)&&e.hex.r===(null==u?void 0:u.r)),[d,u]),eZ=(0,l.useMemo)(()=>new Map(ei.map(e=>[e.id,e])),[ei]),e_=(0,l.useMemo)(()=>new Map(em.map(e=>[e.id,e])),[em]),eO=(0,l.useMemo)(()=>new Map(ey.map(e=>[e.id,e])),[ey]),eY=(0,l.useMemo)(()=>eG&&d?ex.filter(e=>e.location&&e.location.mapId===d.id&&e.location.hex.q===eG.hex.q&&e.location.hex.r===eG.hex.r&&e.location.hex.s===eG.hex.s):[],[eG,d,ex]);return(0,t.jsx)(i.A,{children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[d?(0,t.jsx)(n.A,{mapData:d,hexSize:25,className:(0,L.cn)("w-full h-full",(eE||eS&&"paint"===j&&"brush"===g)&&"cursor-crosshair"),style:{touchAction:"none"},onGridUpdate:eL,onHexClick:x,onAddPointToPath:eW,activeTool:j,paintMode:g,paintColor:w,paintIcon:C,paintIconColor:X,selectedHex:u,isCtrlPressed:eC,isAltPressed:eS,isShiftPressed:eI,isEyedropperActive:eE,onEyedropperClick:e=>{if(!d)return;let a=d.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);a&&(b(a.data.color||"#8A2BE2"),D(a.data.icon||null),a.data.iconColor&&(Y(a.data.iconColor),Q(!1))),eM(!1),ez({title:"Tile properties copied to brush."})},pathDrawingId:P}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(eh.Nt,{open:!eq||eD,onOpenChange:eq?eP:void 0,className:(0,L.cn)("fixed z-10 w-80 shadow-lg top-20 left-4"),children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(r.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),eq&&(0,t.jsx)(eh.R6,{asChild:!0,children:(0,t.jsxs)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(k.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(eh.Ke,{children:(0,t.jsx)(r.Wu,{children:(0,t.jsxs)(V,{value:j,onValueChange:e=>v(e),className:"w-full",children:[(0,t.jsxs)(B,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(T,{value:"settings",children:"Settings"}),(0,t.jsx)(T,{value:"paint",children:"Paint"}),(0,t.jsx)(T,{value:"path",children:"Path"}),(0,t.jsx)(T,{value:"data",children:"Data"})]}),(0,t.jsxs)(W,{value:"settings",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(en.l6,{value:s||"",onValueChange:c,children:[(0,t.jsx)(en.bq,{className:"flex-1",children:(0,t.jsx)(en.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(en.gC,{children:e.map(e=>(0,t.jsx)(en.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(eg,{maps:e,onMapsUpdate:e=>{e$(e)}})]})]}),(0,t.jsx)(Z.w,{}),d&&h?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(U.p,{id:"map-name",value:h.name,onChange:e=>m(a=>a?{...a,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{children:"Shape"}),(0,t.jsxs)(ep,{value:h.shape,onValueChange:e=>m(a=>a?{...a,shape:e}:null),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"radial",id:"edit-radial"}),(0,t.jsx)(H.J,{htmlFor:"edit-radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"rectangular",id:"edit-rectangular"}),(0,t.jsx)(H.J,{htmlFor:"edit-rectangular",children:"Rectangular"})]})]})]}),"radial"===h.shape?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(U.p,{id:"map-radius",type:"number",value:h.radius,onChange:e=>m(a=>a?{...a,radius:parseInt(e.target.value)||0}:null),min:"1",max:"100"})]}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"map-width",children:"Width"}),(0,t.jsx)(U.p,{id:"map-width",type:"number",value:h.width,onChange:e=>m(a=>a?{...a,width:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"map-height",children:"Height"}),(0,t.jsx)(U.p,{id:"map-height",type:"number",value:h.height,onChange:e=>m(a=>a?{...a,height:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]})]}),(0,t.jsx)(G.$,{onClick:eH,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]}),(0,t.jsx)(W,{value:"paint",className:"mt-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{children:"Paint Mode"}),(0,t.jsxs)(ea,{type:"single",value:eI&&"brush"===g?"erase":eC&&"brush"===g?"bucket":g,onValueChange:e=>{e&&N(e)},className:"w-full",children:[(0,t.jsxs)(es,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(es,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(es,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(I.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("fieldset",{disabled:eU||eE,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(U.p,{id:"color-picker",type:"color",value:w,onChange:e=>b(e.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(H.J,{children:"Terrain Colors"}),(0,t.jsx)(_.Bc,{children:(0,t.jsxs)(_.m_,{children:[(0,t.jsx)(_.k$,{asChild:!0,children:(0,t.jsx)(G.$,{variant:eE?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>eM(e=>!e),children:(0,t.jsx)(F.A,{className:"h-4 w-4"})})}),(0,t.jsx)(_.ZI,{children:(0,t.jsx)("p",{children:"Pick Tile Properties (or hold Alt)"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ef.map(e=>{let{name:a,color:s}=e;return(0,t.jsxs)(G.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>b(s),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:s}}),(0,t.jsx)("span",{className:"ml-2",children:a})]},a)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(H.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!K&&(0,t.jsx)(_.Bc,{children:(0,t.jsxs)(_.m_,{children:[(0,t.jsx)(_.k$,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Q(!0),children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})}),(0,t.jsx)(_.ZI,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(U.p,{id:"icon-color-picker",type:"color",value:O,onChange:e=>{Y(e.target.value),Q(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:ev.map(e=>{let{name:a,component:s}=e;return(0,t.jsx)(G.$,{variant:"outline",size:"icon",onClick:()=>D(e=>e===a?null:a),className:(0,L.cn)(C===a&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(s,{className:"h-5 w-5"})},a)})}),C&&(0,t.jsxs)(G.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>D(null),children:[(0,t.jsx)(y.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}),(0,t.jsx)(W,{value:"path",className:"mt-4",children:(0,t.jsx)(ew,{activeMap:d,onPathUpdate:eT,pathDrawingId:P,setPathDrawingId:R})}),(0,t.jsx)(W,{value:"data",className:"mt-4",children:u&&eG?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",u.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",u.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",u.s]})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(H.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),"Cities"]}),(0,t.jsx)(et.V,{title:"Link Cities",items:ey,initialSelectedIds:eG.data.cityIds||[],onConfirm:e=>eV(u,e),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eG.data.cityIds||[]).map(e=>{var a;return(0,t.jsx)(el.E,{variant:"secondary",children:null==(a=eO.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(H.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(et.V,{title:"Link Dungeons",items:ei,initialSelectedIds:eG.data.dungeonIds||[],onConfirm:e=>eB(u,{dungeonIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eG.data.dungeonIds||[]).map(e=>{var a;return(0,t.jsx)(el.E,{variant:"secondary",children:null==(a=eZ.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(H.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(et.V,{title:"Link Factions",items:em,initialSelectedIds:eG.data.factionIds||[],onConfirm:e=>eB(u,{factionIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eG.data.factionIds||[]).map(e=>{var a;return(0,t.jsx)(el.E,{variant:"secondary",children:null==(a=e_.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(H.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(q.A,{className:"h-4 w-4"}),"Events"]}),eY.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:eY.map(e=>(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,ed.GP)(new Date(e.startDate),"P")," - ",(0,ed.GP)(new Date(e.endDate),"P")]})]},e.id))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."})})]})})})]})})]})})}function ew(e){let{activeMap:a,onPathUpdate:s,pathDrawingId:l,setPathDrawingId:i}=e,n=(e,t)=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,...t}:a))},r=e=>{l===e&&i(null),s(((null==a?void 0:a.paths)||[]).filter(a=>a.id!==e))},c=e=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,points:a.points.slice(0,-1)}:a))};return a?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(G.$,{onClick:()=>{let e={id:crypto.randomUUID(),name:"Path ".concat(((null==a?void 0:a.paths)||[]).length+1),color:"#FFD700",strokeWidth:3,points:[]};s([e,...(null==a?void 0:a.paths)||[]]),i(e.id)},className:"w-full",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Add New Path"]}),(0,t.jsx)(Z.w,{}),(0,t.jsx)(em.F,{className:"h-96",children:(0,t.jsx)("div",{className:"space-y-3 pr-2",children:(a.paths||[]).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-md bg-muted/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(U.p,{value:e.name,onChange:a=>n(e.id,{name:a.target.value}),className:"h-8 flex-1"}),(0,t.jsxs)(ec.Lt,{children:[(0,t.jsx)(ec.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:(0,t.jsx)(C.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(ec.EO,{children:[(0,t.jsxs)(ec.wd,{children:[(0,t.jsx)(ec.r7,{children:"Delete Path?"}),(0,t.jsxs)(ec.$v,{children:['Are you sure you want to delete "',e.name,'"? This cannot be undone.']})]}),(0,t.jsxs)(ec.ck,{children:[(0,t.jsx)(ec.Zr,{children:"Cancel"}),(0,t.jsx)(ec.Rx,{onClick:()=>r(e.id),className:"bg-destructive",children:"Delete"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H.J,{children:"Color:"}),(0,t.jsx)(U.p,{type:"color",value:e.color,onChange:a=>n(e.id,{color:a.target.value}),className:"h-8 w-16 p-1"}),(0,t.jsx)(H.J,{children:"Width:"}),(0,t.jsx)(U.p,{type:"number",value:e.strokeWidth,min:"1",max:"20",onChange:a=>n(e.id,{strokeWidth:parseInt(a.target.value,10)||1}),className:"h-8 flex-1"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(G.$,{variant:l===e.id?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>i(a=>a===e.id?null:e.id),children:[l===e.id?(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2"}),l===e.id?"Drawing...":"Draw Path"]}),(0,t.jsx)(G.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>c(e.id),disabled:0===e.points.length,"aria-label":"Remove last point",children:(0,t.jsx)(P.A,{className:"h-4 w-4"})})]})]},e.id))})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to manage paths."})}}}]);
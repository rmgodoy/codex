"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7662],{57662:(e,s,l)=>{l.r(s),l.d(s,{default:()=>W});var a=l(95155),r=l(12115),t=l(88972),i=l(20031),n=l(47906),c=l(92745),d=l(23062),o=l(62523),m=l(30285),h=l(66424),x=l(22346),u=l(87481),p=l(34301),j=l(75074),g=l(20203),f=l(73926),v=l(85057),y=l(59409),w=l(90648);function N(e){let{onSelectItem:s,onNewItem:l,selectedItemId:t,dataVersion:i,filters:n,setFilters:N,onClearFilters:b}=e,[C,T]=(0,r.useState)([]),[z,I]=(0,r.useState)(!0),{toast:D}=(0,u.dj)();(0,r.useEffect)(()=>{(async()=>{I(!0);try{T(await (0,c.i7)())}catch(e){D({variant:"destructive",title:"Error",description:"Could not fetch items from database."})}finally{I(!1)}})()},[i,D]);let S=(0,r.useMemo)(()=>{let e=C.filter(e=>{let s=e.name.toLowerCase().includes(n.searchTerm.toLowerCase()),l="all"===n.typeFilter||e.type===n.typeFilter,a="all"===n.qualityFilter||e.quality===n.qualityFilter,r="all"===n.magicTierFilter||e.magicTier===n.magicTierFilter,t=!0,i=n.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return i.length>0&&(t=!!e.tags&&i.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&l&&a&&r&&t}),s={crude:0,normal:1,fine:2,magical:3},l=e.sort((e,l)=>{if("quality"===n.sortBy){let a=(s[e.quality]||0)-(s[l.quality]||0);if(0!==a)return a}if("price"===n.sortBy){let s=(e.price||0)-(l.price||0);if(0!==s)return s}if("type"===n.sortBy){let s=e.type.localeCompare(l.type);if(0!==s)return s}return e.name.localeCompare(l.name)});return"desc"===n.sortOrder&&l.reverse(),l},[C,n]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(m.$,{onClick:l,className:"w-full",children:[(0,a.jsx)(p.A,{})," New Item"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(o.p,{placeholder:"Search items...",value:n.searchTerm,onChange:e=>N.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(v.J,{children:"Filter"}),(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:b,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsxs)(y.l6,{value:n.typeFilter,onValueChange:N.setTypeFilter,children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by type"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Types"}),d.w$.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsxs)(y.l6,{value:n.qualityFilter,onValueChange:N.setQualityFilter,children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by quality"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Qualities"}),d.qY.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsxs)(y.l6,{value:n.magicTierFilter,onValueChange:e=>N.setMagicTierFilter(e),children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by Tier"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Tiers"}),d.gV.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsx)(w.F,{value:n.tagFilter?n.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>N.setTagFilter(e.join(",")),placeholder:"Tags (e.g. consumable)",tagSource:"item"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(y.l6,{value:n.sortBy,onValueChange:e=>N.setSortBy(e),children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"name",children:"Name"}),(0,a.jsx)(y.eb,{value:"type",children:"Type"}),(0,a.jsx)(y.eb,{value:"price",children:"Price"}),(0,a.jsx)(y.eb,{value:"quality",children:"Quality"})]})]}),(0,a.jsxs)(m.$,{variant:"ghost",size:"icon",onClick:()=>N.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===n.sortOrder?(0,a.jsx)(g.A,{className:"h-4 w-4"}):(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(x.w,{}),(0,a.jsx)(h.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:z?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading items..."}):S.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:S.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(t===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name,(0,a.jsxs)("span",{className:"text-xs opacity-70 capitalize",children:[" (",e.type,"normal"!==e.magicTier?", ".concat(e.magicTier):"",")"]})]})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No items found."})})})]})}var b=l(62177),C=l(90221),T=l(55594),z=l(66695),I=l(88539),D=l(90010),S=l(17759),A=l(12543),R=l(15599),q=l(18763),E=l(77223),F=l(25318),B=l(14337),V=l(53054),M=l(68856),k=l(26126),J=l(54165);let $=T.z.object({name:T.z.string().min(1,"Item name is required"),type:T.z.enum(d.w$),price:T.z.coerce.number().min(0,"Price must be a non-negative number"),quality:T.z.enum(d.qY),description:T.z.string().min(1,"Description is required"),magicTier:T.z.enum(d.gV),enchantment:T.z.string().optional(),assignedDeedId:T.z.string().optional(),magicalTrait:T.z.string().optional(),tags:T.z.array(T.z.string()).optional(),damageDie:T.z.enum(d.zE).optional(),weaponType:T.z.enum(d.Rb).optional(),range:T.z.coerce.number().optional(),property:T.z.enum(d.Vz).optional(),weaponEffect:T.z.string().optional(),placement:T.z.enum(d.Vx).optional(),weight:T.z.enum(d._d).optional(),AR:T.z.string().optional(),armorDie:T.z.enum(d.gG).optional()}).superRefine((e,s)=>{var l,a,r;"weapon"===e.type&&(e.damageDie||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Damage Die is required for weapons.",path:["damageDie"]}),e.weaponType||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Weapon Type is required for weapons.",path:["weaponType"]}),("missile"===e.weaponType||"spell"===e.weaponType)&&(void 0===e.range||e.range<1)&&s.addIssue({code:T.z.ZodIssueCode.custom,message:"Range is required for this weapon type.",path:["range"]}),e.property||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Property is required for weapons.",path:["property"]})),("armor"===e.type||"shield"===e.type)&&(e.placement||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Placement is required.",path:["placement"]}),(null==(r=e.AR)?void 0:r.trim())||s.addIssue({code:T.z.ZodIssueCode.custom,message:"AR is required.",path:["AR"]}),e.armorDie||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Armor Die is required.",path:["armorDie"]})),"armor"===e.type&&"shield"===e.placement&&s.addIssue({code:T.z.ZodIssueCode.custom,message:"Shield placement is for shields only.",path:["placement"]}),"shield"===e.type&&"shield"!==e.placement&&s.addIssue({code:T.z.ZodIssueCode.custom,message:"Shields must have shield placement.",path:["placement"]}),"magical"!==e.magicTier&&"artifact"!==e.magicTier||(null==(l=e.enchantment)?void 0:l.trim())||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Enchantment is required for magical items and artifacts.",path:["enchantment"]}),"artifact"!==e.magicTier||(null==(a=e.magicalTrait)?void 0:a.trim())||s.addIssue({code:T.z.ZodIssueCode.custom,message:"Magical Trait is required for artifacts.",path:["magicalTrait"]})}),Z=e=>{let{onSelectDeed:s,allDeeds:l,children:t}=e,[i,n]=(0,r.useState)(!1),[c,d]=(0,r.useState)(""),[m,x]=(0,r.useState)("all"),[u,p]=(0,r.useState)(""),j=(0,r.useMemo)(()=>l.filter(e=>{let s=e.name.toLowerCase().includes(c.toLowerCase()),l="all"===m||e.tier===m,a=u.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean),r=0===a.length||e.tags&&a.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)));return s&&l&&r}),[l,c,m,u]),g=e=>{s(e),n(!1)};return(0,a.jsxs)(J.lG,{open:i,onOpenChange:e=>{e||(d(""),x("all"),p("")),n(e)},children:[(0,a.jsx)(J.zM,{asChild:!0,children:t}),(0,a.jsxs)(J.Cf,{className:"sm:max-w-2xl h-[70vh] flex flex-col",children:[(0,a.jsx)(J.c7,{children:(0,a.jsx)(J.L3,{children:"Select a Deed"})}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4 flex-wrap",children:[(0,a.jsx)(o.p,{placeholder:"Search deeds...",value:c,onChange:e=>d(e.target.value),className:"flex-1 min-w-[150px]"}),(0,a.jsxs)(y.l6,{value:m,onValueChange:x,children:[(0,a.jsx)(y.bq,{className:"w-full sm:w-[120px]",children:(0,a.jsx)(y.yv,{placeholder:"Filter tier"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Tiers"}),(0,a.jsx)(y.eb,{value:"light",children:"Light"}),(0,a.jsx)(y.eb,{value:"heavy",children:"Heavy"}),(0,a.jsx)(y.eb,{value:"mighty",children:"Mighty"})]})]}),(0,a.jsx)("div",{className:"flex-1 min-w-[150px]",children:(0,a.jsx)(w.F,{value:u?u.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>p(e.join(",")),placeholder:"Filter by tags...",tagSource:"deed"})})]}),(0,a.jsx)(h.F,{className:"flex-1 border rounded-md p-4",children:(0,a.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,a.jsx)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent cursor-pointer",onClick:()=>g(e),children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-semibold",children:[e.name," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.tier,")"]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.effects.hit})]})},e.id))})})]})]})},P={name:"",type:"weapon",price:0,quality:"normal",magicTier:"normal",description:"",tags:[],property:"one-handed",weaponType:"melee",damageDie:"d4",AR:"0",armorDie:"d4",weight:"None",placement:"head"};function L(e){let{itemId:s,isCreatingNew:l,template:t,onSaveSuccess:i,onDeleteSuccess:h,onUseAsTemplate:p,onEditCancel:j,onBack:g}=e,{toast:f}=(0,u.dj)(),[N,T]=(0,r.useState)(l),[J,L]=(0,r.useState)(!l&&!!s),[W,O]=(0,r.useState)(null),_=(0,n.a)(),[G,Q]=(0,r.useState)([]),[Y,H]=(0,r.useState)({}),[U,K]=(0,r.useState)({}),[X,ee]=(0,r.useState)({}),es=(0,r.useMemo)(()=>l&&t?{...P,...t}:P,[l,t]),el=(0,b.mN)({resolver:(0,C.u)($),defaultValues:es}),{watch:ea,setValue:er,getValues:et}=el,ei=ea("type"),en=ea("weaponType"),ec=ea("magicTier"),ed=(0,r.useRef)(ei),eo=ea("assignedDeedId"),[em,eh]=(0,r.useState)(null);(0,r.useEffect)(()=>{(0,c.xy)().then(Q)},[]),(0,r.useEffect)(()=>{eo&&G.length>0?eh(G.find(e=>e.id===eo)||null):eh(null)},[eo,G]),(0,r.useEffect)(()=>{N&&("magical"===ec||"artifact"===ec)&&er("quality","fine")},[ec,N,er]),(0,r.useEffect)(()=>{let e=ed.current;if(e===ei||!N)return;let s=et();"weapon"===e?H({damageDie:s.damageDie,weaponType:s.weaponType,range:s.range,property:s.property,weaponEffect:s.weaponEffect}):"armor"===e?K({placement:s.placement,weight:s.weight,AR:s.AR,armorDie:s.armorDie}):"shield"===e&&ee({placement:s.placement,weight:s.weight,AR:s.AR,armorDie:s.armorDie}),["damageDie","weaponType","range","property","weaponEffect","placement","weight","AR","armorDie"].forEach(e=>er(e,void 0)),"weapon"===ei?Object.entries(Y).forEach(e=>{let[s,l]=e;return er(s,l)}):"armor"===ei?Object.entries(U).forEach(e=>{let[s,l]=e;return er(s,l)}):"shield"===ei&&(Object.entries(X).forEach(e=>{let[s,l]=e;return er(s,l)}),er("placement","shield",{shouldValidate:!0}),er("weight","None",{shouldValidate:!0})),ed.current=ei},[ei,et,er,N,Y,U,X]),(0,r.useEffect)(()=>{(async()=>{if(l){el.reset(es),t?(O(t||null),H(t),K(t),ee(t)):(H({property:"one-handed",weaponType:"melee",damageDie:"d4"}),K({placement:"head",weight:"None",AR:"0",armorDie:"d4"}),ee({placement:"shield",weight:"None",AR:"0",armorDie:"d4"})),ed.current=(null==t?void 0:t.type)||"weapon",T(!0),L(!1);return}if(!s){T(!1),L(!1),O(null);return}L(!0),T(!1);try{let e=await (0,c.u_)(s);e?(el.reset(e),O(e),H(e),"armor"===e.type?(K(e),ee({})):"shield"===e.type?(ee(e),K({})):(K({}),ee({})),ed.current=e.type):O(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load item data."})}finally{L(!1)}})()},[s,l,el,f,es,t]);let ex=()=>{l?j():W&&(el.reset(W),H(W),"armor"===W.type?(K(W),ee({})):"shield"===W.type?(ee(W),K({})):(K({}),ee({})),ed.current=W.type,T(!1))},eu=async e=>{try{let a,r={name:e.name,type:e.type,price:e.price,quality:e.quality,description:e.description,magicTier:e.magicTier,tags:e.tags||[]};switch(e.type){case"weapon":r.damageDie=e.damageDie,r.weaponType=e.weaponType,r.range=e.range,r.property=e.property,r.weaponEffect=e.weaponEffect;break;case"armor":case"shield":r.placement=e.placement,r.weight=e.weight,r.AR=e.AR,r.armorDie=e.armorDie}("magical"===e.magicTier||"artifact"===e.magicTier)&&(r.enchantment=e.enchantment),"artifact"===e.magicTier&&(r.assignedDeedId=e.assignedDeedId,r.magicalTrait=e.magicalTrait);let t=e.tags||[];if(t.length>0&&await (0,c.JE)(t,"item"),l)a=await (0,c.B5)(r),f({title:"Item Created!",description:"".concat(e.name," has been added.")});else{if(!s)return;a=s,await (0,c.fk)({...r,id:s}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")})}i(a),T(!1)}catch(e){f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},ep=async()=>{if(s)try{await (0,c.LD)(s),f({title:"Item Deleted",description:"The item has been removed."}),h()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the item."})}};if(J)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(z.Zp,{children:[(0,a.jsx)(z.aR,{children:(0,a.jsx)(M.E,{className:"h-8 w-48"})}),(0,a.jsx)(z.Wu,{children:(0,a.jsx)(M.E,{className:"h-40 w-full"})})]})});if(!s&&!l)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(z.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsx)(z.Wu,{className:"text-center pt-6",children:(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an item to view or create a new one."})})})});let ej=e=>{er("assignedDeedId",e.id,{shouldValidate:!0})};return!N&&W?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(z.Zp,{children:[(0,a.jsx)(z.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[_&&g&&(0,a.jsx)(m.$,{variant:"ghost",size:"icon",onClick:g,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(z.ZB,{className:"text-3xl font-bold",children:W.name}),(0,a.jsxs)(z.BT,{className:"capitalize flex flex-wrap gap-x-4",children:[(0,a.jsxs)("span",{children:[W.magicTier," ",W.type]}),(0,a.jsxs)("span",{children:["Quality: ",W.quality]}),(0,a.jsxs)("span",{children:["Price: ",W.price,"gp"]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>{W&&p(W)},children:[(0,a.jsx)(R.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Template"})]}),(0,a.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>T(!0),children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})]})}),(0,a.jsx)(z.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(()=>{let e;if(!W)return null;switch(W.type){case"weapon":let s=("missile"===W.weaponType||"spell"===W.weaponType)&&W.range?"".concat(W.weaponType," (").concat(W.range,")"):W.weaponType;e=(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-primary-foreground",children:"Weapon Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Damage:"})," ",W.damageDie]}),(0,a.jsxs)("div",{className:"capitalize",children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Type:"})," ",s]}),(0,a.jsxs)("div",{className:"capitalize",children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Property:"})," ",W.property]})]}),W.weaponEffect&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Effect:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:W.weaponEffect})]})]});break;case"armor":case"shield":e=(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-primary-foreground",children:"Armor/Shield Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Placement:"})," ",W.placement]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Weight:"})," ",W.weight]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"AR:"})," ",W.AR]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Armor Die:"})," ",W.armorDie]})]})]});break;default:e=null}let l=W.assignedDeedId?G.find(e=>e.id===W.assignedDeedId):null;return(0,a.jsxs)(a.Fragment,{children:[W.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-primary-foreground",children:"Description"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:W.description})]}),e&&(0,a.jsx)(x.w,{}),e,("magical"===W.magicTier||"artifact"===W.magicTier)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-primary-foreground",children:"magical"===W.magicTier?"Magical Properties":"Artifact Properties"}),W.enchantment&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Enchantment:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:W.enchantment})]}),"artifact"===W.magicTier&&W.magicalTrait&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Magical Trait:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:W.magicalTrait})]}),l&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Granted Deed:"}),(0,a.jsx)("p",{className:"text-accent",children:l.name})]})]})]})]})})(),W.tags&&W.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:W.tags.map(e=>(0,a.jsx)(k.E,{variant:"secondary",children:e},e))})})]})}),(0,a.jsx)(z.wL,{children:(0,a.jsxs)(D.Lt,{children:[(0,a.jsx)(D.tv,{asChild:!0,children:(0,a.jsx)(m.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(D.EO,{children:[(0,a.jsxs)(D.wd,{children:[(0,a.jsx)(D.r7,{children:"Are you sure?"}),(0,a.jsxs)(D.$v,{children:['This will permanently delete "',W.name,'".']})]}),(0,a.jsxs)(D.ck,{children:[(0,a.jsx)(D.Zr,{children:"Cancel"}),(0,a.jsx)(D.Rx,{onClick:ep,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(z.Zp,{children:(0,a.jsx)(S.lV,{...el,children:(0,a.jsxs)("form",{onSubmit:el.handleSubmit(eu),className:"space-y-6",children:[(0,a.jsx)(z.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[_&&g&&(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsx)(z.ZB,{children:l?"Create New Item":"Editing: ".concat(el.getValues("name")||"...")})]}),!_&&(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:ex,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(F.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(z.Wu,{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Base Properties"}),(0,a.jsx)(S.zB,{name:"name",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Item Name"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(o.p,{...s})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"description",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Description"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(I.T,{...l,value:null!=(s=l.value)?s:"",rows:4})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(S.zB,{name:"type",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Type"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.w$.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"magicTier",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Tier"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.gV.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"quality",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Quality"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,disabled:"normal"!==ec,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.qY.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"price",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Price (gp)"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(o.p,{type:"number",...l,value:null!=(s=l.value)?s:""})}),(0,a.jsx)(S.C5,{})]})}})]}),(()=>{switch(ei){case"weapon":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Weapon Properties"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[(0,a.jsx)(S.zB,{name:"damageDie",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Damage Die"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.zE.map(e=>(0,a.jsx)(y.eb,{value:e,children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"weaponType",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Weapon Type"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.Rb.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),("missile"===en||"spell"===en)&&(0,a.jsx)(S.zB,{name:"range",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Range"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(o.p,{type:"number",...l,value:null!=(s=l.value)?s:"",placeholder:"e.g., 30"})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"property",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Property"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.Vz.map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}})]}),(0,a.jsx)(S.zB,{name:"weaponEffect",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Weapon Effect"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(I.T,{...l,value:null!=(s=l.value)?s:"",rows:3})})]})}})]});case"armor":case"shield":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Armor/Shield Properties"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(S.zB,{name:"placement",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Placement"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,disabled:"shield"===ei,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:("shield"===ei?["shield"]:d.H1).map(e=>(0,a.jsx)(y.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"weight",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Weight"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,disabled:"shield"===ei,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d._d.map(e=>(0,a.jsx)(y.eb,{value:e,children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"AR",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"AR"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(o.p,{...l,value:null!=(s=l.value)?s:"",placeholder:"e.g., +1"})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{name:"armorDie",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Armor Die"}),(0,a.jsxs)(y.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(S.MJ,{children:(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{})})}),(0,a.jsx)(y.gC,{children:d.gG.map(e=>(0,a.jsx)(y.eb,{value:e,children:e},e))})]}),(0,a.jsx)(S.C5,{})]})}})]})]});default:return null}})(),("magical"===ec||"artifact"===ec)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Magical Properties"}),(0,a.jsx)(S.zB,{name:"enchantment",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Enchantment"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(I.T,{...l,value:null!=(s=l.value)?s:"",rows:4})}),(0,a.jsx)(S.C5,{})]})}})]}),"artifact"===ec&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.zB,{name:"magicalTrait",control:el.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"Magical Trait"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(I.T,{...l,value:null!=(s=l.value)?s:"",rows:2})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{children:"Granted Deed"}),em?(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3",children:[(0,a.jsxs)("p",{className:"font-semibold",children:[em.name," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",em.tier,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z,{onSelectDeed:ej,allDeeds:G,children:(0,a.jsx)(m.$,{type:"button",variant:"outline",size:"sm",children:"Change"})}),(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>{er("assignedDeedId",void 0,{shouldValidate:!0})},children:(0,a.jsx)(F.A,{className:"h-4 w-4"})})]})]}):(0,a.jsx)(Z,{onSelectDeed:ej,allDeeds:G,children:(0,a.jsxs)(m.$,{type:"button",variant:"outline",size:"sm",className:"w-full",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 mr-2"}),"Select a Deed"]})}),(0,a.jsx)(S.zB,{name:"assignedDeedId",control:el.control,render:()=>(0,a.jsx)(S.C5,{})})]})]}),(0,a.jsx)(x.w,{}),(0,a.jsx)(S.zB,{name:"tags",control:el.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsxs)(S.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(w.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"item"})}),(0,a.jsx)(S.C5,{})]})}})]}),(0,a.jsxs)(z.wL,{className:"flex items-center gap-2",children:[!l&&(0,a.jsxs)(D.Lt,{children:[(0,a.jsx)(D.tv,{asChild:!0,children:(0,a.jsx)(m.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(D.EO,{children:[(0,a.jsxs)(D.wd,{children:[(0,a.jsx)(D.r7,{children:"Are you sure?"}),(0,a.jsxs)(D.$v,{children:['This will permanently delete "',el.getValues("name"),'".']})]}),(0,a.jsxs)(D.ck,{children:[(0,a.jsx)(D.Zr,{children:"Cancel"}),(0,a.jsx)(D.Rx,{onClick:ep,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!_&&(0,a.jsx)(m.$,{type:"button",variant:"outline",onClick:ex,children:"Cancel"}),(0,a.jsx)(m.$,{type:"submit",children:l?"Create Item":"Save Changes"})]})]})})})})}function W(){let[e,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(null),[m,h]=(0,r.useState)(0),[x,u]=(0,r.useState)(""),[p,j]=(0,r.useState)("all"),[g,f]=(0,r.useState)("all"),[v,y]=(0,r.useState)("all"),[w,b]=(0,r.useState)(""),[C,T]=(0,r.useState)("name"),[z,I]=(0,r.useState)("asc"),[D,S]=(0,r.useState)(!1),A=(0,n.a)(),[R,q]=(0,r.useState)("list");(0,r.useEffect)(()=>{S(!0)},[]);let E={searchTerm:x,typeFilter:p,qualityFilter:g,magicTierFilter:v,tagFilter:w,sortBy:C,sortOrder:z},F={setSearchTerm:u,setTypeFilter:j,setQualityFilter:f,setMagicTierFilter:y,setTagFilter:b,setSortBy:T,setSortOrder:I},B=()=>{u(""),j("all"),f("all"),y("all"),b(""),T("name"),I("asc")},V=()=>h(e=>e+1),M=e=>{s(e),c(!1),o(null),A&&q("editor")},k=()=>{s(null),c(!0),o(null),A&&q("editor")},J=e=>{let l={...e},a=(e.name||"item").replace(/^(Copy of\s*)+/,"");l.name="Copy of ".concat(a),delete l.id,s(null),c(!0),o(l),A&&q("editor")},$=e=>{V(),s(e),c(!1),o(null),A&&q("editor")},Z=()=>{V(),s(null),c(!1),o(null),A&&q("list")},P=()=>{l&&(c(!1),s(null),A&&q("list"))};return D?A?(0,a.jsx)(t.A,{children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===R?(0,a.jsx)(N,{onSelectItem:M,onNewItem:k,selectedItemId:e,dataVersion:m,filters:E,setFilters:F,onClearFilters:B}):(0,a.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsx)(L,{itemId:e,isCreatingNew:l,template:d,onSaveSuccess:$,onDeleteSuccess:Z,onUseAsTemplate:J,onEditCancel:P,onBack:()=>{q("list"),s(null),c(!1),o(null)}},null!=e?e:l?"new":"placeholder")})})})}):(0,a.jsx)(i.SidebarProvider,{children:(0,a.jsx)(t.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(i.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(N,{onSelectItem:M,onNewItem:k,selectedItemId:e,dataVersion:m,filters:E,setFilters:F,onClearFilters:B})}),(0,a.jsx)(i.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(L,{itemId:e,isCreatingNew:l,template:d,onSaveSuccess:$,onDeleteSuccess:Z,onUseAsTemplate:J,onEditCancel:P},null!=e?e:l?"new":"placeholder")})})]})})}):null}}}]);
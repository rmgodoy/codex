"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4867],{64867:(e,s,t)=>{t.r(s),t.d(s,{default:()=>W});var l=t(95155),a=t(12115),r=t(99982),n=t(20031),i=t(47906),c=t(92745),d=t(62523),o=t(30285),x=t(66424),u=t(22346),h=t(87481),m=t(34301),j=t(75074),p=t(20203),g=t(73926),f=t(85057),v=t(59409),N=t(90648);function b(e){let{onSelectTable:s,onNewTable:t,selectedTableId:r,dataVersion:n,filters:i,setFilters:b,onClearFilters:w}=e,[T,y]=(0,a.useState)([]),[C,R]=(0,a.useState)(!0),{toast:S}=(0,h.dj)();(0,a.useEffect)(()=>{(async()=>{R(!0);try{y(await (0,c.MY)())}catch(e){console.error("Error fetching encounter tables:",e),S({variant:"destructive",title:"Error",description:"Could not fetch encounter tables from database."})}finally{R(!1)}})()},[n,S]);let k=(0,a.useMemo)(()=>{let e=T.filter(e=>{let s=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),t=!0,l=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);l.length>0&&(t=!!e.tags&&l.every(s=>e.tags.some(e=>e.toLowerCase().includes(s))));let a=!0;return i.minTR&&!isNaN(parseInt(i.minTR))&&(a=a&&e.totalTR>=parseInt(i.minTR,10)),i.maxTR&&!isNaN(parseInt(i.maxTR))&&(a=a&&e.totalTR<=parseInt(i.maxTR,10)),s&&t&&a}).sort((e,s)=>{if("TR"===i.sortBy){var t,l;let a=(null!=(t=e.totalTR)?t:0)-(null!=(l=s.totalTR)?l:0);if(0!==a)return a}return e.name.localeCompare(s.name)});return"desc"===i.sortOrder&&e.reverse(),e},[T,i]);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)(o.$,{onClick:t,className:"w-full",children:[(0,l.jsx)(m.A,{})," New Encounter Table"]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(d.p,{placeholder:"Search tables...",value:i.searchTerm,onChange:e=>b.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(f.J,{children:"Filter"}),(0,l.jsx)(o.$,{variant:"ghost",size:"sm",onClick:w,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,l.jsx)(N.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>b.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"encounterTable"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(d.p,{placeholder:"Min TR",type:"number",value:i.minTR,onChange:e=>b.setMinTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,l.jsx)(d.p,{placeholder:"Max TR",type:"number",value:i.maxTR,onChange:e=>b.setMaxTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(f.J,{children:"Sort by"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(v.l6,{value:i.sortBy,onValueChange:e=>b.setSortBy(e),children:[(0,l.jsx)(v.bq,{children:(0,l.jsx)(v.yv,{placeholder:"Sort by"})}),(0,l.jsxs)(v.gC,{children:[(0,l.jsx)(v.eb,{value:"name",children:"Name"}),(0,l.jsx)(v.eb,{value:"TR",children:"TR"})]})]}),(0,l.jsxs)(o.$,{variant:"ghost",size:"icon",onClick:()=>b.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,l.jsx)(p.A,{className:"h-4 w-4"}):(0,l.jsx)(g.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,l.jsx)(u.w,{}),(0,l.jsx)(x.F,{className:"flex-1",children:(0,l.jsx)("div",{className:"p-4",children:C?(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading tables..."}):k.length>0?(0,l.jsx)("ul",{className:"space-y-1",children:k.map(e=>(0,l.jsx)("li",{children:(0,l.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(r===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,l.jsxs)("span",{className:"text-xs opacity-70",children:["(TR ",e.totalTR,")"]})]})},e.id))}):(0,l.jsx)("p",{className:"text-muted-foreground text-center",children:"No tables found."})})})]})}var w=t(62177),T=t(90221),y=t(55594),C=t(66695),R=t(88539),S=t(90010),k=t(17759),z=t(18046),F=t(12543),I=t(18763),E=t(77223),A=t(25318),M=t(53054),B=t(68856),L=t(54165),$=t(26126);let J=e=>{if(!e)return 1;let s=e.toLowerCase().trim(),t=s.match(/(\d*)d(\d+)/);if(t){let e=t[1]?parseInt(t[1],10):1,s=parseInt(t[2],10);if(!isNaN(e)&&!isNaN(s)&&s>0)return e*Math.floor(s/2)}let l=parseInt(s,10);return isNaN(l)?1:l},O=y.z.object({id:y.z.string(),creatureId:y.z.string().min(1,"Creature is required"),quantity:y.z.string().min(1,"Quantity is required (e.g., '3' or 'd6')"),weight:y.z.coerce.number().min(1,"Weight must be at least 1")}),V=y.z.object({name:y.z.string().min(1,"Table name is required"),description:y.z.string().optional(),location:y.z.string().optional(),tags:y.z.array(y.z.string()).optional(),totalTR:y.z.coerce.number().optional(),entries:y.z.array(O).min(1,"At least one entry is required")}),q=e=>{let{onAddCreature:s,existingCreatureIds:t}=e,[r,n]=(0,a.useState)(!1),[i,u]=(0,a.useState)([]),[h,m]=(0,a.useState)("");(0,a.useEffect)(()=>{r&&(0,c.OG)().then(u)},[r]);let j=(0,a.useMemo)(()=>i.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())&&!t.has(e.id)),[i,h,t]),p=e=>{s(e),n(!1),m("")};return(0,l.jsxs)(L.lG,{open:r,onOpenChange:n,children:[(0,l.jsx)(L.zM,{asChild:!0,children:(0,l.jsxs)(o.$,{type:"button",size:"sm",variant:"outline",children:[(0,l.jsx)(z.A,{className:"h-4 w-4 mr-2"})," Add Creature"]})}),(0,l.jsxs)(L.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,l.jsx)(L.c7,{children:(0,l.jsx)(L.L3,{children:"Select a Creature"})}),(0,l.jsx)(d.p,{placeholder:"Search creatures...",value:h,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,l.jsx)(x.F,{className:"flex-1 border rounded-md p-2",children:(0,l.jsx)("div",{className:"space-y-1",children:j.map(e=>(0,l.jsx)(o.$,{variant:"ghost",className:"w-full justify-start h-auto py-2",onClick:()=>p(e),children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:e.name}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground text-left",children:["Lvl ",e.level," ",e.role," (TR ",e.TR,")"]})]})},e.id))})})]})]})},D={name:"",description:"",location:"",tags:[],totalTR:0,entries:[]};function Z(e){let{tableId:s,isCreatingNew:t,onSaveSuccess:r,onDeleteSuccess:n,onEditCancel:x,onBack:m,dataVersion:j,onFilterByClick:p}=e,{toast:g}=(0,h.dj)(),[v,b]=(0,a.useState)(t),[y,z]=(0,a.useState)(!t&&!!s),[L,O]=(0,a.useState)(null),[Z,W]=(0,a.useState)([]),U=(0,a.useMemo)(()=>new Map(Z.map(e=>[e.id,e])),[Z]),_=(0,i.a)(),G=(0,w.mN)({resolver:(0,T.u)(V),defaultValues:D}),{control:Q,watch:K,setValue:P}=G,{fields:Y,append:H,remove:X}=(0,w.jz)({control:Q,name:"entries"}),ee=JSON.stringify(K("entries"));(0,a.useEffect)(()=>{(0,c.OG)().then(W)},[]),(0,a.useEffect)(()=>{let e=JSON.parse(ee);if(!e||0===e.length||0===U.size){0!==G.getValues("totalTR")&&P("totalTR",0);return}let s=e.reduce((e,s)=>e+(Number(s.weight)||0),0);if(0===s){0!==G.getValues("totalTR")&&P("totalTR",0);return}let t=Math.floor(e.reduce((e,s)=>{let t=U.get(s.creatureId),l=J(s.quantity||"1"),a=Number(s.weight)||0;return e+((null==t?void 0:t.TR)||0)*l*a},0)/s);G.getValues("totalTR")!==t&&P("totalTR",t,{shouldValidate:!1})},[ee,U,G,P]),(0,a.useEffect)(()=>{(async()=>{if(t){G.reset(D),O(null),b(!0),z(!1);return}if(!s){b(!1),z(!1),O(null);return}z(!0),b(!1);try{let e=await (0,c.Uh)(s);e?(G.reset(e),O(e)):O(null)}catch(e){g({variant:"destructive",title:"Error",description:"Could not load table data."})}finally{z(!1)}})()},[s,t,G,g,j]);let es=()=>{t?x():L&&(G.reset(L),b(!1))},et=async e=>{try{let l,a={...e,totalTR:e.totalTR||0,tags:e.tags||[]},n=e.tags||[];if(n.length>0&&await (0,c.JE)(n,"encounterTable"),t)l=await (0,c.vg)(a),g({title:"Table Created!",description:"".concat(e.name," has been saved.")});else{if(!s)return;l=s,await (0,c.R1)({...a,id:s}),g({title:"Save Successful",description:"".concat(e.name," has been updated.")})}r(l),b(!1)}catch(e){g({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},el=async()=>{if(s)try{await (0,c.p6)(s),g({title:"Table Deleted",description:"The encounter table has been removed."}),n()}catch(e){g({variant:"destructive",title:"Deletion Failed",description:"Could not delete the table."})}},ea=(0,a.useMemo)(()=>new Set(Y.map(e=>e.creatureId)),[Y]);if(y)return(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(C.Zp,{children:[(0,l.jsx)(C.aR,{children:(0,l.jsx)(B.E,{className:"h-8 w-48"})}),(0,l.jsx)(C.Wu,{children:(0,l.jsx)(B.E,{className:"h-40 w-full"})})]})});if(!s&&!t)return(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(C.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,l.jsxs)(C.Wu,{className:"text-center pt-6",children:[(0,l.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a table to view"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})});if(!v&&L){let e=L.entries.reduce((e,s)=>e+(Number(s.weight)||0),0);return(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsxs)(C.Zp,{children:[(0,l.jsx)(C.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[_&&m&&(0,l.jsx)(o.$,{variant:"ghost",size:"icon",onClick:m,className:"shrink-0 -ml-2 -mt-1",children:(0,l.jsx)(F.A,{className:"h-5 w-5"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(C.ZB,{className:"text-3xl font-bold",children:L.name}),(0,l.jsxs)(C.BT,{className:"flex flex-col sm:flex-row sm:gap-4",children:[(0,l.jsxs)("button",{onClick:e=>p({minTR:L.totalTR,maxTR:L.totalTR},e),className:"hover:underline p-0 bg-transparent text-inherit text-sm",children:["TR ",L.totalTR]}),L.location&&(0,l.jsxs)("span",{children:["Location: ",L.location]})]})]})]}),(0,l.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>b(!0),children:[(0,l.jsx)(I.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,l.jsx)(C.Wu,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[L.description&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,l.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:L.description})]}),(0,l.jsx)(u.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Table Entries"}),(0,l.jsx)("div",{className:"space-y-3",children:L.entries.map(s=>{let t=U.get(s.creatureId),a=e>0?(s.weight/e*100).toFixed(1):"0.0";return(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4 p-2 bg-card-foreground/5 rounded-md",children:[(0,l.jsx)("p",{className:"font-semibold",children:(null==t?void 0:t.name)||"Unknown"}),(0,l.jsxs)("p",{className:"text-center",children:["x ",s.quantity]}),(0,l.jsxs)("p",{className:"text-center",children:["Weight: ",s.weight]}),(0,l.jsxs)("p",{className:"text-center text-muted-foreground",children:[a,"%"]})]},s.id)})})]}),L.tags&&L.tags.length>0&&(0,l.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:L.tags.map(e=>(0,l.jsx)("button",{onClick:s=>p({tagFilter:e},s),className:"bg-transparent border-none p-0 m-0",children:(0,l.jsx)($.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,l.jsx)(C.wL,{children:(0,l.jsxs)(S.Lt,{children:[(0,l.jsx)(S.tv,{asChild:!0,children:(0,l.jsx)(o.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(E.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(S.EO,{children:[(0,l.jsxs)(S.wd,{children:[(0,l.jsx)(S.r7,{children:"Are you sure?"}),(0,l.jsxs)(S.$v,{children:['This will permanently delete "',L.name,'". This action cannot be undone.']})]}),(0,l.jsxs)(S.ck,{children:[(0,l.jsx)(S.Zr,{children:"Cancel"}),(0,l.jsx)(S.Rx,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})}let er=JSON.parse(ee),en=er.reduce((e,s)=>e+(Number(s.weight)||0),0);return(0,l.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,l.jsx)(C.Zp,{children:(0,l.jsx)(k.lV,{...G,children:(0,l.jsxs)("form",{onSubmit:G.handleSubmit(et),className:"space-y-6",children:[(0,l.jsx)(C.aR,{children:(0,l.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[_&&m&&(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:x,className:"shrink-0 -ml-2",children:(0,l.jsx)(F.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{children:(0,l.jsx)(C.ZB,{children:t?_?"New Table":"Create New Encounter Table":"Editing: ".concat(G.getValues("name")||"...")})})]}),!_&&(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:es,className:"text-muted-foreground hover:text-foreground",children:(0,l.jsx)(A.A,{className:"h-5 w-5"})})]})}),(0,l.jsxs)(C.Wu,{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsx)(k.zB,{name:"name",control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Table Name"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(d.p,{...s})}),(0,l.jsx)(k.C5,{})]})}}),(0,l.jsx)(k.zB,{name:"location",control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Location"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(d.p,{...s})}),(0,l.jsx)(k.C5,{})]})}}),(0,l.jsx)(k.zB,{name:"totalTR",control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Average TR"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(d.p,{type:"number",...s,readOnly:!0,className:"bg-muted"})})]})}})]}),(0,l.jsx)(k.zB,{name:"description",control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Description"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(R.T,{...s,rows:2})})]})}}),(0,l.jsx)(k.zB,{name:"tags",control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsxs)(k.lR,{className:"flex items-center gap-2",children:[(0,l.jsx)(M.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(N.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"encounterTable"})}),(0,l.jsx)(k.C5,{})]})}}),(0,l.jsx)(u.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Table Entries"}),(0,l.jsx)(q,{onAddCreature:e=>{H({id:crypto.randomUUID(),creatureId:e.id,quantity:"d6",weight:10})},existingCreatureIds:ea})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[Y.map((e,s)=>{var t;let a=U.get(e.creatureId),r=Number(null==(t=er[s])?void 0:t.weight)||0,n=en>0?(r/en*100).toFixed(1):"0.0";return(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 items-end gap-3 p-3 border rounded-lg bg-card-foreground/5",children:[(0,l.jsxs)("div",{className:"col-span-2 md:col-span-1",children:[(0,l.jsx)(f.J,{children:"Creature"}),(0,l.jsx)("p",{className:"font-semibold truncate",title:null==a?void 0:a.name,children:(null==a?void 0:a.name)||"Unknown"}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Lvl ",null==a?void 0:a.level," (TR ",null==a?void 0:a.TR,")"]})]}),(0,l.jsx)(k.zB,{name:"entries.".concat(s,".quantity"),control:G.control,render:e=>{let{field:s}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Quantity"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(d.p,{placeholder:"e.g., 3 or d8",...s})})]})}}),(0,l.jsx)(k.zB,{name:"entries.".concat(s,".weight"),control:G.control,render:e=>{var s;let{field:t}=e;return(0,l.jsxs)(k.eI,{children:[(0,l.jsx)(k.lR,{children:"Weight"}),(0,l.jsx)(k.MJ,{children:(0,l.jsx)(d.p,{type:"number",min:"1",...t,value:null!=(s=t.value)?s:""})})]})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)(f.J,{children:"Chance"}),(0,l.jsxs)("p",{className:"font-semibold text-muted-foreground h-10 flex items-center",children:[n,"%"]})]}),(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>X(s),className:"text-muted-foreground hover:text-destructive place-self-end md:place-self-auto",children:(0,l.jsx)(E.A,{className:"h-4 w-4"})})]},e.id)}),0===Y.length&&(0,l.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No creatures added to this table."})]})]})]}),(0,l.jsxs)(C.wL,{className:"flex items-center gap-2",children:[!t&&(0,l.jsxs)(S.Lt,{children:[(0,l.jsx)(S.tv,{asChild:!0,children:(0,l.jsx)(o.$,{type:"button",variant:"destructive",size:"sm",children:(0,l.jsx)(E.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(S.EO,{children:[(0,l.jsxs)(S.wd,{children:[(0,l.jsx)(S.r7,{children:"Are you sure?"}),(0,l.jsxs)(S.$v,{children:['This will permanently delete "',G.getValues("name"),'".']})]}),(0,l.jsxs)(S.ck,{children:[(0,l.jsx)(S.Zr,{children:"Cancel"}),(0,l.jsx)(S.Rx,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,l.jsx)("div",{className:"flex-grow"}),!_&&(0,l.jsx)(o.$,{type:"button",variant:"outline",onClick:es,children:"Cancel"}),(0,l.jsx)(o.$,{type:"submit",children:t?"Create Table":"Save Changes"})]})]})})})})}function W(){let[e,s]=(0,a.useState)(null),[t,c]=(0,a.useState)(!1),[d,o]=(0,a.useState)(0),[x,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(""),[j,p]=(0,a.useState)(""),[g,f]=(0,a.useState)(""),[v,N]=(0,a.useState)("name"),[w,T]=(0,a.useState)("asc"),[y,C]=(0,a.useState)(!1),R=(0,i.a)(),[S,k]=(0,a.useState)("list");(0,a.useEffect)(()=>{C(!0)},[]);let z={searchTerm:x,tagFilter:h,minTR:j,maxTR:g,sortBy:v,sortOrder:w},F={setSearchTerm:u,setTagFilter:m,setMinTR:p,setMaxTR:f,setSortBy:N,setSortOrder:T},I=(e,s)=>{s.shiftKey?(void 0!==e.minTR&&p(String(e.minTR)),void 0!==e.maxTR&&f(String(e.maxTR)),e.tagFilter&&m(s=>s?s.split(",").map(e=>e.trim()).includes(e.tagFilter)?s:"".concat(s,", ").concat(e.tagFilter):e.tagFilter)):(p(void 0!==e.minTR?String(e.minTR):""),f(void 0!==e.maxTR?String(e.maxTR):""),m(e.tagFilter||""))},E=()=>{u(""),m(""),p(""),f(""),N("name"),T("asc")},A=()=>o(e=>e+1),M=e=>{s(e),c(!1),R&&k("editor")},B=()=>{s(null),c(!0),R&&k("editor")},L=e=>{A(),s(e),c(!1),R&&k("editor")},$=()=>{A(),s(null),c(!1),R&&k("list")},J=()=>{t&&(c(!1),s(null),R&&k("list"))};return y?R?(0,l.jsx)(r.A,{showSidebarTrigger:!1,children:(0,l.jsx)("div",{className:"h-full w-full",children:"list"===S?(0,l.jsx)(b,{onSelectTable:M,onNewTable:B,selectedTableId:e,dataVersion:d,filters:z,setFilters:F,onClearFilters:E}):(0,l.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,l.jsx)("div",{className:"p-4 sm:p-6",children:(0,l.jsx)(Z,{tableId:e,isCreatingNew:t,onSaveSuccess:L,onDeleteSuccess:$,onEditCancel:J,onBack:()=>{k("list"),s(null),c(!1)},dataVersion:d,onFilterByClick:I},null!=e?e:t?"new":"placeholder")})})})}):(0,l.jsx)(n.SidebarProvider,{children:(0,l.jsx)(r.A,{children:(0,l.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,l.jsx)(n.Bx,{style:{"--sidebar-width":"380px"},children:(0,l.jsx)(b,{onSelectTable:M,onNewTable:B,selectedTableId:e,dataVersion:d,filters:z,setFilters:F,onClearFilters:E})}),(0,l.jsx)(n.sF,{className:"flex-1 overflow-y-auto",children:(0,l.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,l.jsx)(Z,{tableId:e,isCreatingNew:t,onSaveSuccess:L,onDeleteSuccess:$,onEditCancel:J,dataVersion:d,onFilterByClick:I},null!=e?e:t?"new":"placeholder")})})]})})}):null}}}]);
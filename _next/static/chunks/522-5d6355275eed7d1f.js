"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{70522:(e,s,l)=>{l.r(s),l.d(s,{default:()=>X});var a=l(95155),t=l(12115),n=l(37661),r=l(62523),i=l(30285),c=l(66424),d=l(22346),o=l(87481),h=l(34301),x=l(75074),m=l(21887),j=l(20203),p=l(73926),u=l(85057),f=l(59409),g=l(90648),N=l(14636),v=l(47262);function w(e){let{onSelectNpc:s,onNewNpc:l,selectedNpcId:w,dataVersion:y,filters:C,setFilters:b,onClearFilters:S}=e,[k,z]=(0,t.useState)([]),[I,F]=(0,t.useState)([]),[A,M]=(0,t.useState)(!0),{toast:E}=(0,o.dj)();(0,t.useEffect)(()=>{(async()=>{M(!0);try{let[e,s]=await Promise.all([(0,n.Qg)(),(0,n.vq)()]);z(e),F(s)}catch(e){E({variant:"destructive",title:"Error",description:"Could not fetch NPC or faction data from database."})}finally{M(!1)}})()},[y,E]);let B=(0,t.useMemo)(()=>{let e=k.filter(e=>{let s=e.name.toLowerCase().includes(C.searchTerm.toLowerCase()),l=!0,a=C.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);a.length>0&&(l=!!e.tags&&a.every(s=>e.tags.some(e=>e.toLowerCase().includes(s))));let t=!0;return C.factionFilter.length>0&&(t=C.factionFilter.every(s=>{var l;return null==(l=e.factionIds)?void 0:l.includes(s)})),s&&l&&t}).sort((e,s)=>{if("race"===C.sortBy){let l=(e.race||"").localeCompare(s.race||"");if(0!==l)return l}return e.name.localeCompare(s.name)});return"desc"===C.sortOrder&&e.reverse(),e},[k,C]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(i.$,{onClick:l,className:"w-full",children:[(0,a.jsx)(h.A,{})," New NPC"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(r.p,{placeholder:"Search NPCs...",value:C.searchTerm,onChange:e=>b.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(u.J,{children:"Filter"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:S,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsxs)(N.AM,{children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"outline",className:"w-full justify-between",children:[C.factionFilter.length>0?"".concat(C.factionFilter.length," faction(s) selected"):"Filter by Faction",(0,a.jsx)(m.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsx)(c.F,{className:"h-48",children:I.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 hover:bg-accent",children:[(0,a.jsx)(v.S,{id:"filter-faction-".concat(e.id),checked:C.factionFilter.includes(e.id),onCheckedChange:s=>{let l=s?[...C.factionFilter,e.id]:C.factionFilter.filter(s=>s!==e.id);b.setFactionFilter(l)}}),(0,a.jsx)(u.J,{htmlFor:"filter-faction-".concat(e.id),className:"font-normal flex-1",children:e.name})]},e.id))})})]}),(0,a.jsx)(g.F,{value:C.tagFilter?C.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>b.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"npc"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(u.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(f.l6,{value:C.sortBy,onValueChange:e=>b.setSortBy(e),children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"name",children:"Name"}),(0,a.jsx)(f.eb,{value:"race",children:"Race"})]})]}),(0,a.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>b.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===C.sortOrder?(0,a.jsx)(j.A,{className:"h-4 w-4"}):(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(d.w,{}),(0,a.jsx)(c.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:A?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading NPCs..."}):B.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:B.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(w===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No NPCs found."})})})]})}var y=l(62177),C=l(90221),b=l(55594),S=l(66695),k=l(88539),z=l(90010),I=l(17759),F=l(18046),A=l(12543),M=l(15599),E=l(18763),B=l(77223),$=l(25318),P=l(50286);let R=(0,l(40157).A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var T=l(53054),L=l(68856),J=l(26126),V=l(47906),O=l(54165),Z=l(59434);let q=b.z.object({id:b.z.string(),targetNpcId:b.z.string().min(1,"Target NPC is required"),type:b.z.string().min(1,"Relationship type is required")}),D=b.z.object({name:b.z.string().min(1,"Name is required"),race:b.z.string().optional(),age:b.z.string().optional(),role:b.z.string().optional(),personality:b.z.string().optional(),motivation:b.z.string().optional(),backstory:b.z.string().optional(),appearance:b.z.string().optional(),factionIds:b.z.array(b.z.string()).optional(),beliefIds:b.z.array(b.z.string()).optional(),tags:b.z.array(b.z.string()).optional(),relationships:b.z.array(q).optional()}),U=e=>{let{onConfirm:s,allFactions:l,initialSelectedIds:n,children:d}=e,[o,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[j,p]=(0,t.useState)(new Set(n));(0,t.useEffect)(()=>{o&&p(new Set(n))},[o,n]);let u=(0,t.useMemo)(()=>l.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),[l,x]),f=e=>{p(s=>{let l=new Set(s);return l.has(e)?l.delete(e):l.add(e),l})};return(0,a.jsxs)(O.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(O.zM,{asChild:!0,children:d}),(0,a.jsxs)(O.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,a.jsx)(O.c7,{children:(0,a.jsx)(O.L3,{children:"Select Factions"})}),(0,a.jsx)(r.p,{placeholder:"Search factions...",value:x,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,a.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:u.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,a.jsx)(v.S,{id:"faction-dialog-".concat(e.id),checked:j.has(e.id),onCheckedChange:()=>f(e.id)}),(0,a.jsx)("label",{htmlFor:"faction-dialog-".concat(e.id),className:"font-normal flex-1 cursor-pointer",children:e.name})]},e.id))}),(0,a.jsxs)(O.Es,{className:"pt-4",children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{s(Array.from(j)),h(!1)},children:"Confirm"})]})]})]})},W=e=>{let{onConfirm:s,allEntities:l,initialSelectedIds:n,children:d}=e,[o,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[j,p]=(0,t.useState)(new Set(n));(0,t.useEffect)(()=>{o&&p(new Set(n))},[o,n]);let u=(0,t.useMemo)(()=>l.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),[l,x]),f=e=>{p(s=>{let l=new Set(s);return l.has(e)?l.delete(e):l.add(e),l})};return(0,a.jsxs)(O.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(O.zM,{asChild:!0,children:d}),(0,a.jsxs)(O.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,a.jsx)(O.c7,{children:(0,a.jsx)(O.L3,{children:"Select Beliefs"})}),(0,a.jsx)(r.p,{placeholder:"Search entities...",value:x,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,a.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:u.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,a.jsx)(v.S,{id:"belief-dialog-".concat(e.id),checked:j.has(e.id),onCheckedChange:()=>f(e.id)}),(0,a.jsx)("label",{htmlFor:"belief-dialog-".concat(e.id),className:"font-normal flex-1 cursor-pointer",children:e.name})]},e.id))}),(0,a.jsxs)(O.Es,{className:"pt-4",children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{s(Array.from(j)),h(!1)},children:"Confirm"})]})]})]})},_=e=>{var s;let{currentNpcId:l,allNpcs:n,onAdd:d}=e,[o,h]=(0,t.useState)(!1),[x,j]=(0,t.useState)(""),[p,f]=(0,t.useState)(""),[g,v]=(0,t.useState)(!1),w=(0,t.useMemo)(()=>n.filter(e=>e.id!==l),[n,l]);return(0,a.jsxs)(O.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(O.zM,{asChild:!0,children:(0,a.jsxs)(i.$,{type:"button",size:"sm",variant:"outline",children:[(0,a.jsx)(F.A,{className:"h-4 w-4 mr-2"})," Add Relationship"]})}),(0,a.jsxs)(O.Cf,{children:[(0,a.jsx)(O.c7,{children:(0,a.jsx)(O.L3,{children:"Add New Relationship"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"target-npc",children:"Target NPC"}),(0,a.jsxs)(N.AM,{open:g,onOpenChange:v,children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{id:"target-npc",variant:"outline",role:"combobox",className:"w-full justify-between",children:[x?null==(s=w.find(e=>e.id===x))?void 0:s.name:"Select an NPC...",(0,a.jsx)(m.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[var(--radix-popover-trigger-width)] p-0",children:(0,a.jsx)(c.F,{className:"h-48",children:w.map(e=>(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>{j(e.id),v(!1)},className:(0,Z.cn)("w-full justify-start",x===e.id&&"bg-accent"),children:e.name},e.id))})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"relationship-type",children:"Relationship Type"}),(0,a.jsx)(r.p,{id:"relationship-type",value:p,onChange:e=>f(e.target.value),placeholder:"e.g., friends with, hates, sibling of..."})]})]}),(0,a.jsxs)(O.Es,{children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{x&&p&&(d({id:crypto.randomUUID(),targetNpcId:x,type:p}),h(!1),j(""),f(""))},disabled:!x||!p,children:"Add"})]})]})]})},G={name:"",race:"",age:"",role:"",personality:"",motivation:"",backstory:"",appearance:"",factionIds:[],beliefIds:[],tags:[],relationships:[]};function Q(e){let{npcId:s,isCreatingNew:l,template:c,onSaveSuccess:h,onDeleteSuccess:x,onUseAsTemplate:m,onEditCancel:j,onBack:p,dataVersion:u}=e,{toast:f}=(0,o.dj)(),[N,v]=(0,t.useState)(l),[w,b]=(0,t.useState)(!l&&!!s),[F,O]=(0,t.useState)(null),[Z,q]=(0,t.useState)([]),[Q,H]=(0,t.useState)([]),[K,X]=(0,t.useState)([]),Y=(0,V.a)(),ee=(0,t.useMemo)(()=>new Map(Q.map(e=>[e.id,e.name])),[Q]),es=(0,t.useMemo)(()=>new Map(K.map(e=>[e.id,e.name])),[K]),el=(0,t.useMemo)(()=>new Map(Z.map(e=>[e.id,e.name])),[Z]),ea=(0,y.mN)({resolver:(0,C.u)(D),defaultValues:c?{...G,...c}:G}),{fields:et,append:en,remove:er}=(0,y.jz)({control:ea.control,name:"relationships"});(0,t.useEffect)(()=>{Promise.all([(0,n.Qg)(),(0,n.vq)(),(0,n.Wt)()]).then(e=>{let[s,l,a]=e;q(s),H(l),X(a)})},[u]),(0,t.useEffect)(()=>{(async()=>{if(l){ea.reset(c?{...G,...c}:G),O(c),v(!0),b(!1);return}if(!s){v(!1),b(!1),O(null);return}b(!0),v(!1);try{let e=await (0,n.ES)(s);e?(ea.reset({...G,...e}),O(e)):O(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load NPC data."})}finally{b(!1)}})()},[s,l,c,ea,f,u]);let ei=()=>{l?j():F&&(ea.reset({...G,...F}),v(!1))},ec=async e=>{try{let a={...e,tags:e.tags||[],factionIds:e.factionIds||[],beliefIds:e.beliefIds||[],relationships:e.relationships||[]},t=e.tags||[];if(t.length>0&&await (0,n.JE)(t,"npc"),l){let s=await (0,n.NV)(a);f({title:"NPC Created!",description:"".concat(e.name," has been added.")}),h(s)}else s&&(await (0,n.T2)({...a,id:s}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")}),h(s));v(!1)}catch(e){f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},ed=async()=>{if(s)try{await (0,n.Pb)(s),f({title:"NPC Deleted",description:"The NPC has been removed."}),x()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the NPC."})}};return w?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(S.Zp,{children:[(0,a.jsx)(S.aR,{children:(0,a.jsx)(L.E,{className:"h-8 w-48"})}),(0,a.jsx)(S.Wu,{children:(0,a.jsx)(L.E,{className:"h-40 w-full"})})]})}):s||l?!N&&F?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(S.Zp,{children:[(0,a.jsx)(S.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[Y&&p&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:p,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.ZB,{className:"text-3xl font-bold",children:F.name}),(0,a.jsxs)(S.BT,{className:"flex flex-wrap gap-x-4",children:[F.race&&(0,a.jsx)("span",{children:F.race}),F.age&&(0,a.jsx)("span",{children:F.age}),F.role&&(0,a.jsx)("span",{children:F.role})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{F&&m(F)},children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Template"})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>v(!0),children:[(0,a.jsx)(E.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]})]})]})}),(0,a.jsx)(S.Wu,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(F.factionIds&&F.factionIds.length>0||F.beliefIds&&F.beliefIds.length>0)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-4",children:[F.factionIds&&F.factionIds.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Factions"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:F.factionIds.map(e=>(0,a.jsx)(J.E,{variant:"secondary",children:ee.get(e)||"Unknown"},e))})]}),F.beliefIds&&F.beliefIds.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Beliefs"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:F.beliefIds.map(e=>(0,a.jsx)(J.E,{variant:"secondary",children:es.get(e)||"Unknown"},e))})]})]})}),(0,a.jsx)(d.w,{})]}),F.relationships&&F.relationships.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Relationships"}),(0,a.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:F.relationships.map(e=>(0,a.jsxs)("li",{className:"text-sm",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type})," ",(0,a.jsx)("span",{className:"font-semibold text-accent",children:el.get(e.targetNpcId)||"Unknown NPC"})]},e.id))})]}),(0,a.jsx)(d.w,{})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Appearance"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:F.appearance||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Personality"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:F.personality||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Motivation"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:F.motivation||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Backstory"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:F.backstory||"Not specified."})]}),F.tags&&F.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:F.tags.map(e=>(0,a.jsx)(J.E,{variant:"secondary",children:e},e))})})]})}),(0,a.jsx)(S.wL,{children:(0,a.jsxs)(z.Lt,{children:[(0,a.jsx)(z.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(z.EO,{children:[(0,a.jsxs)(z.wd,{children:[(0,a.jsx)(z.r7,{children:"Are you sure?"}),(0,a.jsxs)(z.$v,{children:['This will permanently delete "',F.name,'". This action cannot be undone.']})]}),(0,a.jsxs)(z.ck,{children:[(0,a.jsx)(z.Zr,{children:"Cancel"}),(0,a.jsx)(z.Rx,{onClick:ed,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(S.Zp,{children:(0,a.jsx)(I.lV,{...ea,children:(0,a.jsxs)("form",{onSubmit:ea.handleSubmit(ec),className:"space-y-6",children:[(0,a.jsx)(S.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[Y&&p&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:ei,className:"shrink-0 -ml-2",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{children:(0,a.jsx)(S.ZB,{children:l?Y?"New NPC":"Create New NPC":"Editing: ".concat(ea.getValues("name")||"...")})})]}),!Y&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:ei,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)($.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(S.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsx)(I.zB,{name:"name",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Name"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(r.p,{...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{name:"race",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Race"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(r.p,{...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{name:"age",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Age"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(r.p,{...s})}),(0,a.jsx)(I.C5,{})]})}})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(I.zB,{name:"role",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Role"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(r.p,{...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{control:ea.control,name:"factionIds",render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Factions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(U,{onConfirm:l.onChange,allFactions:Q,initialSelectedIds:l.value||[],children:(0,a.jsxs)(i.$,{type:"button",variant:"outline",className:"w-full justify-between",children:[(0,a.jsx)("span",{children:(null==(s=l.value)?void 0:s.length)?"".concat(l.value.length," selected"):"Select Factions..."}),(0,a.jsx)(P.A,{className:"h-4 w-4 opacity-50"})]})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:(l.value||[]).map(e=>{let s=ee.get(e);return s?(0,a.jsx)(J.E,{variant:"secondary",children:s},e):null})})]}),(0,a.jsx)(I.C5,{})]})}})]}),(0,a.jsx)(I.zB,{control:ea.control,name:"beliefIds",render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Beliefs"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(W,{onConfirm:l.onChange,allEntities:K,initialSelectedIds:l.value||[],children:(0,a.jsxs)(i.$,{type:"button",variant:"outline",className:"w-full justify-between",children:[(0,a.jsx)("span",{children:(null==(s=l.value)?void 0:s.length)?"".concat(l.value.length," selected"):"Select Beliefs..."}),(0,a.jsx)(R,{className:"h-4 w-4 opacity-50"})]})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:(l.value||[]).map(e=>{let s=es.get(e);return s?(0,a.jsx)(J.E,{variant:"secondary",children:s},e):null})})]}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{name:"appearance",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Appearance"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(k.T,{...s,rows:2})})]})}}),(0,a.jsx)(I.zB,{name:"personality",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Personality"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(k.T,{...s,rows:3})})]})}}),(0,a.jsx)(I.zB,{name:"motivation",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Motivation"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(k.T,{...s,rows:3})})]})}}),(0,a.jsx)(I.zB,{name:"backstory",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Backstory"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(k.T,{...s,rows:5})})]})}}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Relationships"}),(0,a.jsx)(_,{currentNpcId:s,allNpcs:Z,onAdd:en})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[et.map((e,s)=>{let l=el.get(e.targetNpcId);return(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card-foreground/5",children:[(0,a.jsxs)("p",{className:"flex-1",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type})," ",(0,a.jsx)("span",{className:"font-semibold text-accent",children:l||"..."})]}),(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>er(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]},e.id)}),0===et.length&&(0,a.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No relationships defined."})]})]}),(0,a.jsx)(d.w,{}),(0,a.jsx)(I.zB,{name:"tags",control:ea.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsxs)(I.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(g.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"npc"})}),(0,a.jsx)(I.C5,{})]})}})]}),(0,a.jsxs)(S.wL,{className:"flex items-center gap-2",children:[!l&&(0,a.jsxs)(z.Lt,{children:[(0,a.jsx)(z.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(z.EO,{children:[(0,a.jsxs)(z.wd,{children:[(0,a.jsx)(z.r7,{children:"Are you sure?"}),(0,a.jsxs)(z.$v,{children:['This will permanently delete "',ea.getValues("name"),'".']})]}),(0,a.jsxs)(z.ck,{children:[(0,a.jsx)(z.Zr,{children:"Cancel"}),(0,a.jsx)(z.Rx,{onClick:ed,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!Y&&(0,a.jsx)(i.$,{type:"button",variant:"outline",onClick:ei,children:"Cancel"}),(0,a.jsx)(i.$,{type:"submit",children:l?"Create NPC":"Save Changes"})]})]})})})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(S.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsxs)(S.Wu,{className:"text-center pt-6",children:[(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an NPC to view"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}var H=l(99982),K=l(20031);function X(){let[e,s]=(0,t.useState)(null),[l,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(null),[c,d]=(0,t.useState)(0),[o,h]=(0,t.useState)(""),[x,m]=(0,t.useState)(""),[j,p]=(0,t.useState)([]),[u,f]=(0,t.useState)([]),[g,N]=(0,t.useState)("name"),[v,y]=(0,t.useState)("asc"),[C,b]=(0,t.useState)(!1),S=(0,V.a)(),[k,z]=(0,t.useState)("list");(0,t.useEffect)(()=>{b(!0)},[]);let I={searchTerm:o,tagFilter:x,factionFilter:j,beliefFilter:u,sortBy:g,sortOrder:v},F={setSearchTerm:h,setTagFilter:m,setFactionFilter:p,setBeliefFilter:f,setSortBy:N,setSortOrder:y},A=()=>{h(""),m(""),p([]),f([]),N("name"),y("asc")},M=()=>d(e=>e+1),E=e=>{s(e),n(!1),i(null),S&&z("editor")},B=()=>{s(null),n(!0),i(null),S&&z("editor")},$=e=>{let l={...e},a=(e.name||"NPC").replace(/^(Copy of\s*)+/,"");l.name="Copy of ".concat(a),delete l.id,s(null),n(!0),i(l),S&&z("editor")},P=e=>{M(),s(e),n(!1),i(null),S&&z("editor")},R=()=>{M(),s(null),n(!1),i(null),S&&z("list")},T=()=>{l&&(n(!1),s(null),S&&z("list"))};return C?S?(0,a.jsx)(H.A,{showSidebarTrigger:!1,children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===k?(0,a.jsx)(w,{onSelectNpc:E,onNewNpc:B,selectedNpcId:e,dataVersion:c,filters:I,setFilters:F,onClearFilters:A}):(0,a.jsx)("div",{className:"h-full w-full overflow-y-auto p-4 sm:p-6",children:(0,a.jsx)(Q,{npcId:e,isCreatingNew:l,template:r,onSaveSuccess:P,onDeleteSuccess:R,onUseAsTemplate:$,onEditCancel:T,onBack:()=>{z("list"),s(null),n(!1),i(null)},dataVersion:c},null!=e?e:l?"new":"placeholder")})})}):(0,a.jsx)(K.SidebarProvider,{children:(0,a.jsx)(H.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(K.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(w,{onSelectNpc:E,onNewNpc:B,selectedNpcId:e,dataVersion:c,filters:I,setFilters:F,onClearFilters:A})}),(0,a.jsx)(K.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(Q,{npcId:e,isCreatingNew:l,template:r,onSaveSuccess:P,onDeleteSuccess:R,onUseAsTemplate:$,onEditCancel:T,dataVersion:c},null!=e?e:l?"new":"placeholder")})})]})})}):null}}}]);
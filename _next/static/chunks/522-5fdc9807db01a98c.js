"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{70522:(e,s,l)=>{l.r(s),l.d(s,{default:()=>es});var a=l(95155),t=l(12115),n=l(34239),r=l(62523),i=l(30285),c=l(66424),d=l(22346),o=l(87481),h=l(34301),x=l(75074),m=l(9572),j=l(21887),u=l(20203),p=l(73926),f=l(85057),g=l(59409),v=l(90648),N=l(14636),w=l(47262),C=l(8643);function y(e){let{onSelectNpc:s,onNewNpc:l,selectedNpcId:y,dataVersion:b,filters:S,setFilters:k,onClearFilters:I}=e,[F,z]=(0,t.useState)([]),[A,M]=(0,t.useState)([]),[E,$]=(0,t.useState)([]),[R,B]=(0,t.useState)(!0),{toast:P}=(0,o.dj)();(0,t.useEffect)(()=>{(async()=>{B(!0);try{let[e,s,l]=await Promise.all([(0,n.Qg)(),(0,n.vq)(),(0,n.E1)()]);z(e),M(s),$(l)}catch(e){P({variant:"destructive",title:"Error",description:"Could not fetch NPC, faction, or race data from database."})}finally{B(!1)}})()},[b,P]);let T=(0,t.useMemo)(()=>new Map(E.map(e=>[e.id,e.name])),[E]),L=(0,t.useMemo)(()=>{let e=F.filter(e=>{let s=e.name.toLowerCase().includes(S.searchTerm.toLowerCase()),l=!0,a=S.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);a.length>0&&(l=!!e.tags&&a.every(s=>e.tags.some(e=>e.toLowerCase().includes(s))));let t=!0;S.factionFilter.length>0&&(t=S.factionFilter.every(s=>{var l;return null==(l=e.factionIds)?void 0:l.includes(s)}));let n=!0;return S.raceFilter.length>0&&(n=!!e.raceId&&S.raceFilter.includes(e.raceId)),s&&l&&t&&n}).sort((e,s)=>{if("race"===S.sortBy){let l=e.raceId&&T.get(e.raceId)||"",a=s.raceId&&T.get(s.raceId)||"",t=l.localeCompare(a);if(0!==t)return t}return e.name.localeCompare(s.name)});return"desc"===S.sortOrder&&e.reverse(),e},[F,S,T]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(i.$,{onClick:l,className:"w-full",children:[(0,a.jsx)(h.A,{})," New NPC"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(r.p,{placeholder:"Search NPCs...",value:S.searchTerm,onChange:e=>k.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(C.Nt,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(C.R6,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"ghost",className:"-ml-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Filters"]})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:I,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsxs)(C.Ke,{className:"space-y-2 pt-2",children:[(0,a.jsxs)(N.AM,{children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"outline",className:"w-full justify-between",children:[S.factionFilter.length>0?"".concat(S.factionFilter.length," faction(s) selected"):"Filter by Faction",(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsx)(c.F,{className:"h-48",children:A.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 hover:bg-accent",children:[(0,a.jsx)(w.S,{id:"filter-faction-".concat(e.id),checked:S.factionFilter.includes(e.id),onCheckedChange:s=>{let l=s?[...S.factionFilter,e.id]:S.factionFilter.filter(s=>s!==e.id);k.setFactionFilter(l)}}),(0,a.jsx)(f.J,{htmlFor:"filter-faction-".concat(e.id),className:"font-normal flex-1",children:e.name})]},e.id))})})]}),(0,a.jsxs)(N.AM,{children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"outline",className:"w-full justify-between",children:[S.raceFilter.length>0?"".concat(S.raceFilter.length," race(s) selected"):"Filter by Race",(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsx)(c.F,{className:"h-48",children:E.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 hover:bg-accent",children:[(0,a.jsx)(w.S,{id:"filter-race-".concat(e.id),checked:S.raceFilter.includes(e.id),onCheckedChange:s=>{let l=s?[...S.raceFilter,e.id]:S.raceFilter.filter(s=>s!==e.id);k.setRaceFilter(l)}}),(0,a.jsx)(f.J,{htmlFor:"filter-race-".concat(e.id),className:"font-normal flex-1",children:e.name})]},e.id))})})]}),(0,a.jsx)(v.F,{value:S.tagFilter?S.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>k.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"npc"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(g.l6,{value:S.sortBy,onValueChange:e=>k.setSortBy(e),children:[(0,a.jsx)(g.bq,{children:(0,a.jsx)(g.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(g.gC,{children:[(0,a.jsx)(g.eb,{value:"name",children:"Name"}),(0,a.jsx)(g.eb,{value:"race",children:"Race"})]})]}),(0,a.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>k.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===S.sortOrder?(0,a.jsx)(u.A,{className:"h-4 w-4"}):(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(d.w,{}),(0,a.jsx)(c.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:R?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading NPCs..."}):L.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:L.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(y===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No NPCs found."})})})]})}var b=l(62177),S=l(90221),k=l(55594),I=l(66695),F=l(88539),z=l(90010),A=l(17759),M=l(18046),E=l(12543),$=l(15599),R=l(18763),B=l(77223),P=l(25318),T=l(50286);let L=(0,l(40157).A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var J=l(53054),V=l(68856),O=l(26126),q=l(47906),U=l(54165),W=l(59434),Z=l(38914);let D=k.z.object({id:k.z.string(),targetNpcId:k.z.string().min(1,"Target NPC is required"),type:k.z.string().min(1,"Relationship type is required")}),_=k.z.object({name:k.z.string().min(1,"Name is required"),raceId:k.z.string().optional(),age:k.z.string().optional(),role:k.z.string().optional(),personality:k.z.string().optional(),motivation:k.z.string().optional(),backstory:k.z.string().optional(),appearance:k.z.string().optional(),factionIds:k.z.array(k.z.string()).optional(),beliefIds:k.z.array(k.z.string()).optional(),tags:k.z.array(k.z.string()).optional(),relationships:k.z.array(D).optional()}),G=e=>{let{onConfirm:s,allFactions:l,initialSelectedIds:n,children:d}=e,[o,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[j,u]=(0,t.useState)(new Set(n));(0,t.useEffect)(()=>{o&&u(new Set(n))},[o,n]);let p=(0,t.useMemo)(()=>l.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),[l,x]),f=e=>{u(s=>{let l=new Set(s);return l.has(e)?l.delete(e):l.add(e),l})};return(0,a.jsxs)(U.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(U.zM,{asChild:!0,children:d}),(0,a.jsxs)(U.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,a.jsx)(U.c7,{children:(0,a.jsx)(U.L3,{children:"Select Factions"})}),(0,a.jsx)(r.p,{placeholder:"Search factions...",value:x,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,a.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:p.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,a.jsx)(w.S,{id:"faction-dialog-".concat(e.id),checked:j.has(e.id),onCheckedChange:()=>f(e.id)}),(0,a.jsx)("label",{htmlFor:"faction-dialog-".concat(e.id),className:"font-normal flex-1 cursor-pointer",children:e.name})]},e.id))}),(0,a.jsxs)(U.Es,{className:"pt-4",children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{s(Array.from(j)),h(!1)},children:"Confirm"})]})]})]})},Q=e=>{let{onConfirm:s,allEntities:l,initialSelectedIds:n,children:d}=e,[o,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[j,u]=(0,t.useState)(new Set(n));(0,t.useEffect)(()=>{o&&u(new Set(n))},[o,n]);let p=(0,t.useMemo)(()=>l.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),[l,x]),f=e=>{u(s=>{let l=new Set(s);return l.has(e)?l.delete(e):l.add(e),l})};return(0,a.jsxs)(U.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(U.zM,{asChild:!0,children:d}),(0,a.jsxs)(U.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,a.jsx)(U.c7,{children:(0,a.jsx)(U.L3,{children:"Select Beliefs"})}),(0,a.jsx)(r.p,{placeholder:"Search entities...",value:x,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,a.jsx)(c.F,{className:"flex-1 border rounded-md p-2",children:p.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,a.jsx)(w.S,{id:"belief-dialog-".concat(e.id),checked:j.has(e.id),onCheckedChange:()=>f(e.id)}),(0,a.jsx)("label",{htmlFor:"belief-dialog-".concat(e.id),className:"font-normal flex-1 cursor-pointer",children:e.name})]},e.id))}),(0,a.jsxs)(U.Es,{className:"pt-4",children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{s(Array.from(j)),h(!1)},children:"Confirm"})]})]})]})},H=e=>{var s;let{currentNpcId:l,allNpcs:n,onAdd:d}=e,[o,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[u,p]=(0,t.useState)(""),[g,v]=(0,t.useState)(!1),w=(0,t.useMemo)(()=>n.filter(e=>e.id!==l),[n,l]);return(0,a.jsxs)(U.lG,{open:o,onOpenChange:h,children:[(0,a.jsx)(U.zM,{asChild:!0,children:(0,a.jsxs)(i.$,{type:"button",size:"sm",variant:"outline",children:[(0,a.jsx)(M.A,{className:"h-4 w-4 mr-2"})," Add Relationship"]})}),(0,a.jsxs)(U.Cf,{children:[(0,a.jsx)(U.c7,{children:(0,a.jsx)(U.L3,{children:"Add New Relationship"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"target-npc",children:"Target NPC"}),(0,a.jsxs)(N.AM,{open:g,onOpenChange:v,children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{id:"target-npc",variant:"outline",role:"combobox",className:"w-full justify-between",children:[x?null==(s=w.find(e=>e.id===x))?void 0:s.name:"Select an NPC...",(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[var(--radix-popover-trigger-width)] p-0",children:(0,a.jsx)(c.F,{className:"h-48",children:w.map(e=>(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>{m(e.id),v(!1)},className:(0,W.cn)("w-full justify-start",x===e.id&&"bg-accent"),children:e.name},e.id))})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"relationship-type",children:"Relationship Type"}),(0,a.jsx)(r.p,{id:"relationship-type",value:u,onChange:e=>p(e.target.value),placeholder:"e.g., friends with, hates, sibling of..."})]})]}),(0,a.jsxs)(U.Es,{children:[(0,a.jsx)(i.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{x&&u&&(d({id:crypto.randomUUID(),targetNpcId:x,type:u}),h(!1),m(""),p(""))},disabled:!x||!u,children:"Add"})]})]})]})},K={name:"",raceId:void 0,age:"",role:"",personality:"",motivation:"",backstory:"",appearance:"",factionIds:[],beliefIds:[],tags:[],relationships:[]};function X(e){let{npcId:s,isCreatingNew:l,template:c,onSaveSuccess:h,onDeleteSuccess:x,onUseAsTemplate:m,onEditCancel:j,onBack:u,dataVersion:p}=e,{toast:f}=(0,o.dj)(),[N,w]=(0,t.useState)(l),[C,y]=(0,t.useState)(!l&&!!s),[k,M]=(0,t.useState)(null),[U,W]=(0,t.useState)([]),[D,X]=(0,t.useState)([]),[Y,ee]=(0,t.useState)([]),[es,el]=(0,t.useState)([]),ea=(0,q.a)(),{worldSlug:et}=(0,Z.q)(),en=(0,t.useMemo)(()=>new Map(D.map(e=>[e.id,e.name])),[D]),er=(0,t.useMemo)(()=>new Map(Y.map(e=>[e.id,e.name])),[Y]),ei=(0,t.useMemo)(()=>new Map(U.map(e=>[e.id,e.name])),[U]),ec=(0,t.useMemo)(()=>new Map(es.map(e=>[e.id,e.name])),[es]),ed=(0,b.mN)({resolver:(0,S.u)(_),defaultValues:c?{...K,...c}:K}),{fields:eo,append:eh,remove:ex}=(0,b.jz)({control:ed.control,name:"relationships"});(0,t.useEffect)(()=>{Promise.all([(0,n.Qg)(),(0,n.vq)(),(0,n.Wt)(),(0,n.E1)()]).then(e=>{let[s,l,a,t]=e;W(s),X(l),ee(a),el(t)})},[p]),(0,t.useEffect)(()=>{(async()=>{if(l){ed.reset(c?{...K,...c}:K),M(c),w(!0),y(!1);return}if(!s){w(!1),y(!1),M(null);return}y(!0),w(!1);try{let e=await (0,n.ES)(s);e?(ed.reset({...K,...e}),M(e)):M(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load NPC data."})}finally{y(!1)}})()},[s,l,c,ed,f,p]);let em=()=>{l?j():k&&(ed.reset({...K,...k}),w(!1))},ej=async e=>{try{let a={...e,raceId:"none"===e.raceId?void 0:e.raceId,tags:e.tags||[],factionIds:e.factionIds||[],beliefIds:e.beliefIds||[],relationships:e.relationships||[]},t=e.tags||[];if(t.length>0&&await (0,n.JE)(t,"npc"),l){let s=await (0,n.NV)(a);f({title:"NPC Created!",description:"".concat(e.name," has been added.")}),h(s)}else s&&(await (0,n.T2)({...a,id:s}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")}),h(s));w(!1)}catch(e){console.error("Save failed:",e),f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},eu=async()=>{if(s)try{await (0,n.Pb)(s),f({title:"NPC Deleted",description:"The NPC has been removed."}),x()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the NPC."})}};if(C)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(I.Zp,{children:[(0,a.jsx)(I.aR,{children:(0,a.jsx)(V.E,{className:"h-8 w-48"})}),(0,a.jsx)(I.Wu,{children:(0,a.jsx)(V.E,{className:"h-40 w-full"})})]})});if(!s&&!l)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(I.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsxs)(I.Wu,{className:"text-center pt-6",children:[(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an NPC to view"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})});if(!N&&k){let e=k.raceId?ec.get(k.raceId):null;return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(I.Zp,{children:[(0,a.jsx)(I.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ea&&u&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(E.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(I.ZB,{className:"text-3xl font-bold",children:k.name}),(0,a.jsxs)(I.BT,{className:"flex flex-wrap gap-x-4",children:[e&&(0,a.jsx)("span",{children:(0,a.jsx)("a",{href:"#/".concat(et,"/races/").concat(k.raceId),className:"hover:underline",children:e})}),k.age&&(0,a.jsx)("span",{children:k.age}),k.role&&(0,a.jsx)("span",{children:k.role})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{k&&m(k)},children:[(0,a.jsx)($.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Template"})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,a.jsx)(R.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]})]})]})}),(0,a.jsx)(I.Wu,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(k.factionIds&&k.factionIds.length>0||k.beliefIds&&k.beliefIds.length>0)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-x-8 gap-y-4",children:[k.factionIds&&k.factionIds.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Factions"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.factionIds.map(e=>(0,a.jsx)(O.E,{variant:"secondary",children:en.get(e)||"Unknown"},e))})]}),k.beliefIds&&k.beliefIds.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Beliefs"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.beliefIds.map(e=>(0,a.jsx)(O.E,{variant:"secondary",children:er.get(e)||"Unknown"},e))})]})]})}),(0,a.jsx)(d.w,{})]}),k.relationships&&k.relationships.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Relationships"}),(0,a.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:k.relationships.map(e=>(0,a.jsxs)("li",{className:"text-sm",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type})," ",(0,a.jsx)("span",{className:"font-semibold text-accent",children:ei.get(e.targetNpcId)||"Unknown NPC"})]},e.id))})]}),(0,a.jsx)(d.w,{})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Appearance"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:k.appearance||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Personality"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:k.personality||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Motivation"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:k.motivation||"Not specified."})]}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Backstory"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:k.backstory||"Not specified."})]}),k.tags&&k.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.tags.map(e=>(0,a.jsx)(O.E,{variant:"secondary",children:e},e))})})]})}),(0,a.jsx)(I.wL,{children:(0,a.jsxs)(z.Lt,{children:[(0,a.jsx)(z.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(z.EO,{children:[(0,a.jsxs)(z.wd,{children:[(0,a.jsx)(z.r7,{children:"Are you sure?"}),(0,a.jsxs)(z.$v,{children:['This will permanently delete "',k.name,'". This action cannot be undone.']})]}),(0,a.jsxs)(z.ck,{children:[(0,a.jsx)(z.Zr,{children:"Cancel"}),(0,a.jsx)(z.Rx,{onClick:eu,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})}return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(I.Zp,{children:(0,a.jsx)(A.lV,{...ed,children:(0,a.jsxs)("form",{onSubmit:ed.handleSubmit(ej,e=>{let s=Object.entries(e).map(e=>{let[s,l]=e;return"".concat(s.charAt(0).toUpperCase()+s.slice(1),": ").concat(l.message)}).join("\n");f({variant:"destructive",title:"Validation Error",description:(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:s})})}),className:"space-y-6",children:[(0,a.jsx)(I.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ea&&u&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:em,className:"shrink-0 -ml-2",children:(0,a.jsx)(E.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{children:(0,a.jsx)(I.ZB,{children:l?ea?"New NPC":"Create New NPC":"Editing: ".concat(ed.getValues("name")||"...")})})]}),!ea&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:em,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(P.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(I.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsx)(A.zB,{name:"name",control:ed.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Name"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(r.p,{...s})}),(0,a.jsx)(A.C5,{})]})}}),(0,a.jsx)(A.zB,{name:"raceId",control:ed.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Race"}),(0,a.jsxs)(g.l6,{onValueChange:s.onChange,value:s.value||"none",children:[(0,a.jsx)(A.MJ,{children:(0,a.jsx)(g.bq,{children:(0,a.jsx)(g.yv,{placeholder:"Select a race..."})})}),(0,a.jsxs)(g.gC,{children:[(0,a.jsx)(g.eb,{value:"none",children:"None"}),es.map(e=>(0,a.jsx)(g.eb,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsx)(A.C5,{})]})}}),(0,a.jsx)(A.zB,{name:"age",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Age"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(r.p,{...l,value:null!=(s=l.value)?s:""})}),(0,a.jsx)(A.C5,{})]})}})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(A.zB,{name:"role",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Role"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(r.p,{...l,value:null!=(s=l.value)?s:""})}),(0,a.jsx)(A.C5,{})]})}}),(0,a.jsx)(A.zB,{control:ed.control,name:"factionIds",render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Factions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(G,{onConfirm:l.onChange,allFactions:D,initialSelectedIds:l.value||[],children:(0,a.jsxs)(i.$,{type:"button",variant:"outline",className:"w-full justify-between",children:[(0,a.jsx)("span",{children:(null==(s=l.value)?void 0:s.length)?"".concat(l.value.length," selected"):"Select Factions..."}),(0,a.jsx)(T.A,{className:"h-4 w-4 opacity-50"})]})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:(l.value||[]).map(e=>{let s=en.get(e);return s?(0,a.jsx)(O.E,{variant:"secondary",children:s},e):null})})]}),(0,a.jsx)(A.C5,{})]})}})]}),(0,a.jsx)(A.zB,{control:ed.control,name:"beliefIds",render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Beliefs"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(Q,{onConfirm:l.onChange,allEntities:Y,initialSelectedIds:l.value||[],children:(0,a.jsxs)(i.$,{type:"button",variant:"outline",className:"w-full justify-between",children:[(0,a.jsx)("span",{children:(null==(s=l.value)?void 0:s.length)?"".concat(l.value.length," selected"):"Select Beliefs..."}),(0,a.jsx)(L,{className:"h-4 w-4 opacity-50"})]})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:(l.value||[]).map(e=>{let s=er.get(e);return s?(0,a.jsx)(O.E,{variant:"secondary",children:s},e):null})})]}),(0,a.jsx)(A.C5,{})]})}}),(0,a.jsx)(A.zB,{name:"appearance",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Appearance"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(F.T,{...l,rows:2,value:null!=(s=l.value)?s:""})})]})}}),(0,a.jsx)(A.zB,{name:"personality",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Personality"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(F.T,{...l,rows:3,value:null!=(s=l.value)?s:""})})]})}}),(0,a.jsx)(A.zB,{name:"motivation",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Motivation"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(F.T,{...l,rows:3,value:null!=(s=l.value)?s:""})})]})}}),(0,a.jsx)(A.zB,{name:"backstory",control:ed.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsx)(A.lR,{children:"Backstory"}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(F.T,{...l,rows:5,value:null!=(s=l.value)?s:""})})]})}}),(0,a.jsx)(d.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Relationships"}),(0,a.jsx)(H,{currentNpcId:s,allNpcs:U,onAdd:eh})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[eo.map((e,s)=>{let l=ei.get(e.targetNpcId);return(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card-foreground/5",children:[(0,a.jsxs)("p",{className:"flex-1",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type})," ",(0,a.jsx)("span",{className:"font-semibold text-accent",children:l||"..."})]}),(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ex(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]},e.id)}),0===eo.length&&(0,a.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No relationships defined."})]})]}),(0,a.jsx)(d.w,{}),(0,a.jsx)(A.zB,{name:"tags",control:ed.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(A.eI,{children:[(0,a.jsxs)(A.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(A.MJ,{children:(0,a.jsx)(v.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"npc"})}),(0,a.jsx)(A.C5,{})]})}})]}),(0,a.jsxs)(I.wL,{className:"flex items-center gap-2",children:[!l&&(0,a.jsxs)(z.Lt,{children:[(0,a.jsx)(z.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(z.EO,{children:[(0,a.jsxs)(z.wd,{children:[(0,a.jsx)(z.r7,{children:"Are you sure?"}),(0,a.jsxs)(z.$v,{children:['This will permanently delete "',ed.getValues("name"),'".']})]}),(0,a.jsxs)(z.ck,{children:[(0,a.jsx)(z.Zr,{children:"Cancel"}),(0,a.jsx)(z.Rx,{onClick:eu,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!ea&&(0,a.jsx)(i.$,{type:"button",variant:"outline",onClick:em,children:"Cancel"}),(0,a.jsx)(i.$,{type:"submit",children:l?"Create NPC":"Save Changes"})]})]})})})})}var Y=l(6195),ee=l(20031);function es(e){let{selectedId:s}=e,[l,n]=(0,t.useState)(s||null),[r,i]=(0,t.useState)(!1),[c,d]=(0,t.useState)(null),[o,h]=(0,t.useState)(0),[x,m]=(0,t.useState)(""),[j,u]=(0,t.useState)(""),[p,f]=(0,t.useState)([]),[g,v]=(0,t.useState)([]),[N,w]=(0,t.useState)([]),[C,b]=(0,t.useState)("name"),[S,k]=(0,t.useState)("asc"),[I,F]=(0,t.useState)(!1),z=(0,q.a)(),[A,M]=(0,t.useState)("list");(0,t.useEffect)(()=>{F(!0),s&&(n(s),z&&M("editor"))},[s,z]);let E={searchTerm:x,tagFilter:j,factionFilter:p,beliefFilter:g,raceFilter:N,sortBy:C,sortOrder:S},$={setSearchTerm:m,setTagFilter:u,setFactionFilter:f,setBeliefFilter:v,setRaceFilter:w,setSortBy:b,setSortOrder:k},R=()=>{m(""),u(""),f([]),v([]),w([]),b("name"),k("asc")},B=()=>h(e=>e+1),P=e=>{n(e),i(!1),d(null),z&&M("editor")},T=()=>{n(null),i(!0),d(null),z&&M("editor")},L=e=>{let s={...e},l=(e.name||"NPC").replace(/^(Copy of\s*)+/,"");s.name="Copy of ".concat(l),delete s.id,n(null),i(!0),d(s),z&&M("editor")},J=e=>{B(),n(e),i(!1),d(null),z&&M("editor")},V=()=>{B(),n(null),i(!1),d(null),z&&M("list")},O=()=>{r&&(i(!1),n(null),z&&M("list"))};return I?z?(0,a.jsx)(Y.A,{showSidebarTrigger:!1,children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===A?(0,a.jsx)(y,{onSelectNpc:P,onNewNpc:T,selectedNpcId:l,dataVersion:o,filters:E,setFilters:$,onClearFilters:R}):(0,a.jsx)("div",{className:"h-full w-full overflow-y-auto p-4 sm:p-6",children:(0,a.jsx)(X,{npcId:l,isCreatingNew:r,template:c,onSaveSuccess:J,onDeleteSuccess:V,onUseAsTemplate:L,onEditCancel:O,onBack:()=>{M("list"),n(null),i(!1),d(null)},dataVersion:o},null!=l?l:r?"new":"placeholder")})})}):(0,a.jsx)(ee.SidebarProvider,{children:(0,a.jsx)(Y.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(ee.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(y,{onSelectNpc:P,onNewNpc:T,selectedNpcId:l,dataVersion:o,filters:E,setFilters:$,onClearFilters:R})}),(0,a.jsx)(ee.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(X,{npcId:l,isCreatingNew:r,template:c,onSaveSuccess:J,onDeleteSuccess:V,onUseAsTemplate:L,onEditCancel:O,dataVersion:o},null!=l?l:r?"new":"placeholder")})})]})})}):null}}}]);
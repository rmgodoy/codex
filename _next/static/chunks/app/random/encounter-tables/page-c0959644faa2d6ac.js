(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[648],{3585:(e,t,s)=>{"use strict";s.d(t,{MY:()=>r,R1:()=>i,Uh:()=>l,p6:()=>c,vg:()=>n});var a=s(82489);let r=async()=>{let e=(await (0,a.Lf)()).transaction(a.yX,"readonly").objectStore(a.yX).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,a.Lf)()).transaction(a.yX,"readonly").objectStore(a.yX).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{let t=(await (0,a.Lf)()).transaction(a.yX,"readwrite").objectStore(a.yX),s=(0,a.$C)(),r={...e,id:s},l=t.add(r);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},i=async e=>{let t=(await (0,a.Lf)()).transaction(a.yX,"readwrite").objectStore(a.yX).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},c=async e=>{let t=(await (0,a.Lf)()).transaction(a.yX,"readwrite").objectStore(a.yX).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},6535:(e,t,s)=>{"use strict";s.d(t,{C8:()=>n,OG:()=>r,PW:()=>o,RW:()=>i,ZK:()=>c,s2:()=>l});var a=s(82489);let r=async()=>{let e=(await (0,a.Lf)()).transaction(a.RN,"readonly").objectStore(a.RN).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,a.Lf)()).transaction(a.RN,"readonly").objectStore(a.RN).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{if(!e||0===e.length)return[];let t=(await (0,a.Lf)()).transaction(a.RN,"readonly").objectStore(a.RN),s=[],r=e.map(e=>new Promise((a,r)=>{let l=t.get(e);l.onsuccess=()=>{l.result&&s.push(l.result),a()},l.onerror=()=>r(l.error)}));return await Promise.all(r),s},i=async e=>{let t=(await (0,a.Lf)()).transaction(a.RN,"readwrite").objectStore(a.RN),s=(0,a.$C)(),r={...e,id:s},l=t.add(r);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},c=async e=>{let t=(await (0,a.Lf)()).transaction(a.RN,"readwrite").objectStore(a.RN).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},o=async e=>{let t=(await (0,a.Lf)()).transaction(a.RN,"readwrite").objectStore(a.RN).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},12543:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},18046:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},20203:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},34301:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},53054:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},54165:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>x,Es:()=>h,L3:()=>j,c7:()=>m,lG:()=>c,rr:()=>p,zM:()=>o});var a=s(95155),r=s(12115),l=s(45821),n=s(25318),i=s(59434);let c=l.bL,o=l.l9,d=l.ZL;l.bm;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});u.displayName=l.hJ.displayName;let x=r.forwardRef((e,t)=>{let{className:s,children:r,...c}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...c,children:[r,(0,a.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=l.UC.displayName;let m=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};m.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let j=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});j.displayName=l.hE.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=l.VY.displayName},64867:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U});var a=s(95155),r=s(12115),l=s(62709),n=s(20031),i=s(47906),c=s(3585),o=s(62523),d=s(30285),u=s(66424),x=s(22346),m=s(87481),h=s(34301),j=s(75074),p=s(20203),f=s(73926),g=s(85057),N=s(59409),v=s(90648);function w(e){let{onSelectTable:t,onNewTable:s,selectedTableId:l,dataVersion:n,filters:i,setFilters:w,onClearFilters:b}=e,[y,T]=(0,r.useState)([]),[R,C]=(0,r.useState)(!0),{toast:S}=(0,m.dj)();(0,r.useEffect)(()=>{(async()=>{C(!0);try{T(await (0,c.MY)())}catch(e){console.error("Error fetching encounter tables:",e),S({variant:"destructive",title:"Error",description:"Could not fetch encounter tables from database."})}finally{C(!1)}})()},[n,S]);let k=(0,r.useMemo)(()=>{let e=y.filter(e=>{let t=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),s=!0,a=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);a.length>0&&(s=!!e.tags&&a.every(t=>e.tags.some(e=>e.toLowerCase().includes(t))));let r=!0;return i.minTR&&!isNaN(parseInt(i.minTR))&&(r=r&&e.totalTR>=parseInt(i.minTR,10)),i.maxTR&&!isNaN(parseInt(i.maxTR))&&(r=r&&e.totalTR<=parseInt(i.maxTR,10)),t&&s&&r}).sort((e,t)=>{if("TR"===i.sortBy){var s,a;let r=(null!=(s=e.totalTR)?s:0)-(null!=(a=t.totalTR)?a:0);if(0!==r)return r}return e.name.localeCompare(t.name)});return"desc"===i.sortOrder&&e.reverse(),e},[y,i]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(d.$,{onClick:s,className:"w-full",children:[(0,a.jsx)(h.A,{})," New Encounter Table"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(o.p,{placeholder:"Search tables...",value:i.searchTerm,onChange:e=>w.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(g.J,{children:"Filter"}),(0,a.jsx)(d.$,{variant:"ghost",size:"sm",onClick:b,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsx)(v.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>w.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"encounterTable"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.p,{placeholder:"Min TR",type:"number",value:i.minTR,onChange:e=>w.setMinTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,a.jsx)(o.p,{placeholder:"Max TR",type:"number",value:i.maxTR,onChange:e=>w.setMaxTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(N.l6,{value:i.sortBy,onValueChange:e=>w.setSortBy(e),children:[(0,a.jsx)(N.bq,{children:(0,a.jsx)(N.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(N.gC,{children:[(0,a.jsx)(N.eb,{value:"name",children:"Name"}),(0,a.jsx)(N.eb,{value:"TR",children:"TR"})]})]}),(0,a.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>w.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,a.jsx)(p.A,{className:"h-4 w-4"}):(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(x.w,{}),(0,a.jsx)(u.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:R?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading tables..."}):k.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:k.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>t(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(l===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,a.jsxs)("span",{className:"text-xs opacity-70",children:["(TR ",e.totalTR,")"]})]})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No tables found."})})})]})}var b=s(62177),y=s(90221),T=s(55594),R=s(6535),C=s(44218),S=s(66695),k=s(88539),A=s(90010),z=s(17759),L=s(18046),E=s(12543),M=s(18763),F=s(77223),I=s(25318),B=s(53054),$=s(68856),J=s(54165),P=s(26126);let q=e=>{if(!e)return 1;let t=e.toLowerCase().trim(),s=t.match(/(\d*)d(\d+)/);if(s){let e=s[1]?parseInt(s[1],10):1,t=parseInt(s[2],10);if(!isNaN(e)&&!isNaN(t)&&t>0)return e*Math.floor(t/2)}let a=parseInt(t,10);return isNaN(a)?1:a},O=T.z.object({id:T.z.string(),creatureId:T.z.string().min(1,"Creature is required"),quantity:T.z.string().min(1,"Quantity is required (e.g., '3' or 'd6')"),weight:T.z.coerce.number().min(1,"Weight must be at least 1")}),V=T.z.object({name:T.z.string().min(1,"Table name is required"),description:T.z.string().optional(),location:T.z.string().optional(),tags:T.z.array(T.z.string()).optional(),totalTR:T.z.coerce.number().optional(),entries:T.z.array(O).min(1,"At least one entry is required")}),D=e=>{let{onAddCreature:t,existingCreatureIds:s}=e,[l,n]=(0,r.useState)(!1),[i,c]=(0,r.useState)([]),[x,m]=(0,r.useState)("");(0,r.useEffect)(()=>{l&&(0,R.OG)().then(c)},[l]);let h=(0,r.useMemo)(()=>i.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())&&!s.has(e.id)),[i,x,s]),j=e=>{t(e),n(!1),m("")};return(0,a.jsxs)(J.lG,{open:l,onOpenChange:n,children:[(0,a.jsx)(J.zM,{asChild:!0,children:(0,a.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 mr-2"})," Add Creature"]})}),(0,a.jsxs)(J.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,a.jsx)(J.c7,{children:(0,a.jsx)(J.L3,{children:"Select a Creature"})}),(0,a.jsx)(o.p,{placeholder:"Search creatures...",value:x,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,a.jsx)(u.F,{className:"flex-1 border rounded-md p-2",children:(0,a.jsx)("div",{className:"space-y-1",children:h.map(e=>(0,a.jsx)(d.$,{variant:"ghost",className:"w-full justify-start h-auto py-2",onClick:()=>j(e),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-left",children:["Lvl ",e.level," ",e.role," (TR ",e.TR,")"]})]})},e.id))})})]})]})},X={name:"",description:"",location:"",tags:[],totalTR:0,entries:[]};function Z(e){let{tableId:t,isCreatingNew:s,onSaveSuccess:l,onDeleteSuccess:n,onEditCancel:u,onBack:h,dataVersion:j,onFilterByClick:p}=e,{toast:f}=(0,m.dj)(),[N,w]=(0,r.useState)(s),[T,L]=(0,r.useState)(!s&&!!t),[J,O]=(0,r.useState)(null),[Z,U]=(0,r.useState)([]),W=(0,r.useMemo)(()=>new Map(Z.map(e=>[e.id,e])),[Z]),G=(0,i.a)(),_=(0,b.mN)({resolver:(0,y.u)(V),defaultValues:X}),{control:Y,watch:H,setValue:K}=_,{fields:Q,append:ee,remove:et}=(0,b.jz)({control:Y,name:"entries"}),es=JSON.stringify(H("entries"));(0,r.useEffect)(()=>{(0,R.OG)().then(U)},[]),(0,r.useEffect)(()=>{let e=JSON.parse(es);if(!e||0===e.length||0===W.size){0!==_.getValues("totalTR")&&K("totalTR",0);return}let t=e.reduce((e,t)=>e+(Number(t.weight)||0),0);if(0===t){0!==_.getValues("totalTR")&&K("totalTR",0);return}let s=Math.floor(e.reduce((e,t)=>{let s=W.get(t.creatureId),a=q(t.quantity||"1"),r=Number(t.weight)||0;return e+((null==s?void 0:s.TR)||0)*a*r},0)/t);_.getValues("totalTR")!==s&&K("totalTR",s,{shouldValidate:!1})},[es,W,_,K]),(0,r.useEffect)(()=>{(async()=>{if(s){_.reset(X),O(null),w(!0),L(!1);return}if(!t){w(!1),L(!1),O(null);return}L(!0),w(!1);try{let e=await (0,c.Uh)(t);e?(_.reset(e),O(e)):O(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load table data."})}finally{L(!1)}})()},[t,s,_,f,j]);let ea=()=>{s?u():J&&(_.reset(J),w(!1))},er=async e=>{try{let a,r={...e,totalTR:e.totalTR||0,tags:e.tags||[]},n=e.tags||[];if(n.length>0&&await (0,C.JE)(n,"encounterTable"),s)a=await (0,c.vg)(r),f({title:"Table Created!",description:"".concat(e.name," has been saved.")});else{if(!t)return;a=t,await (0,c.R1)({...r,id:t}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")})}l(a),w(!1)}catch(e){f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},el=async()=>{if(t)try{await (0,c.p6)(t),f({title:"Table Deleted",description:"The encounter table has been removed."}),n()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the table."})}},en=(0,r.useMemo)(()=>new Set(Q.map(e=>e.creatureId)),[Q]);if(T)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(S.Zp,{children:[(0,a.jsx)(S.aR,{children:(0,a.jsx)($.E,{className:"h-8 w-48"})}),(0,a.jsx)(S.Wu,{children:(0,a.jsx)($.E,{className:"h-40 w-full"})})]})});if(!t&&!s)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(S.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsxs)(S.Wu,{className:"text-center pt-6",children:[(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a table to view"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})});if(!N&&J){let e=J.entries.reduce((e,t)=>e+(Number(t.weight)||0),0);return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(S.Zp,{children:[(0,a.jsx)(S.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[G&&h&&(0,a.jsx)(d.$,{variant:"ghost",size:"icon",onClick:h,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(E.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.ZB,{className:"text-3xl font-bold",children:J.name}),(0,a.jsxs)(S.BT,{className:"flex flex-col sm:flex-row sm:gap-4",children:[(0,a.jsxs)("button",{onClick:e=>p({minTR:J.totalTR,maxTR:J.totalTR},e),className:"hover:underline p-0 bg-transparent text-inherit text-sm",children:["TR ",J.totalTR]}),J.location&&(0,a.jsxs)("span",{children:["Location: ",J.location]})]})]})]}),(0,a.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,a.jsx)(S.Wu,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[J.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:J.description})]}),(0,a.jsx)(x.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Table Entries"}),(0,a.jsx)("div",{className:"space-y-3",children:J.entries.map(t=>{let s=W.get(t.creatureId),r=e>0?(t.weight/e*100).toFixed(1):"0.0";return(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4 p-2 bg-card-foreground/5 rounded-md",children:[(0,a.jsx)("p",{className:"font-semibold",children:(null==s?void 0:s.name)||"Unknown"}),(0,a.jsxs)("p",{className:"text-center",children:["x ",t.quantity]}),(0,a.jsxs)("p",{className:"text-center",children:["Weight: ",t.weight]}),(0,a.jsxs)("p",{className:"text-center text-muted-foreground",children:[r,"%"]})]},t.id)})})]}),J.tags&&J.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:J.tags.map(e=>(0,a.jsx)("button",{onClick:t=>p({tagFilter:e},t),className:"bg-transparent border-none p-0 m-0",children:(0,a.jsx)(P.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,a.jsx)(S.wL,{children:(0,a.jsxs)(A.Lt,{children:[(0,a.jsx)(A.tv,{asChild:!0,children:(0,a.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(F.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(A.EO,{children:[(0,a.jsxs)(A.wd,{children:[(0,a.jsx)(A.r7,{children:"Are you sure?"}),(0,a.jsxs)(A.$v,{children:['This will permanently delete "',J.name,'". This action cannot be undone.']})]}),(0,a.jsxs)(A.ck,{children:[(0,a.jsx)(A.Zr,{children:"Cancel"}),(0,a.jsx)(A.Rx,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})}let ei=JSON.parse(es),ec=ei.reduce((e,t)=>e+(Number(t.weight)||0),0);return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(S.Zp,{children:(0,a.jsx)(z.lV,{..._,children:(0,a.jsxs)("form",{onSubmit:_.handleSubmit(er),className:"space-y-6",children:[(0,a.jsx)(S.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[G&&h&&(0,a.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2",children:(0,a.jsx)(E.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{children:(0,a.jsx)(S.ZB,{children:s?G?"New Table":"Create New Encounter Table":"Editing: ".concat(_.getValues("name")||"...")})})]}),!G&&(0,a.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:ea,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(I.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(S.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(z.zB,{name:"name",control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Table Name"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(o.p,{...t})}),(0,a.jsx)(z.C5,{})]})}}),(0,a.jsx)(z.zB,{name:"location",control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Location"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(o.p,{...t})}),(0,a.jsx)(z.C5,{})]})}}),(0,a.jsx)(z.zB,{name:"totalTR",control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Average TR"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(o.p,{type:"number",...t,readOnly:!0,className:"bg-muted"})})]})}})]}),(0,a.jsx)(z.zB,{name:"description",control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Description"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(k.T,{...t,rows:2})})]})}}),(0,a.jsx)(z.zB,{name:"tags",control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsxs)(z.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(v.F,{value:t.value||[],onChange:t.onChange,placeholder:"Add tags...",tagSource:"encounterTable"})}),(0,a.jsx)(z.C5,{})]})}}),(0,a.jsx)(x.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Table Entries"}),(0,a.jsx)(D,{onAddCreature:e=>{ee({id:crypto.randomUUID(),creatureId:e.id,quantity:"d6",weight:10})},existingCreatureIds:en})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[Q.map((e,t)=>{var s;let r=W.get(e.creatureId),l=Number(null==(s=ei[t])?void 0:s.weight)||0,n=ec>0?(l/ec*100).toFixed(1):"0.0";return(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 items-end gap-3 p-3 border rounded-lg bg-card-foreground/5",children:[(0,a.jsxs)("div",{className:"col-span-2 md:col-span-1",children:[(0,a.jsx)(g.J,{children:"Creature"}),(0,a.jsx)("p",{className:"font-semibold truncate",title:null==r?void 0:r.name,children:(null==r?void 0:r.name)||"Unknown"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Lvl ",null==r?void 0:r.level," (TR ",null==r?void 0:r.TR,")"]})]}),(0,a.jsx)(z.zB,{name:"entries.".concat(t,".quantity"),control:_.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Quantity"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(o.p,{placeholder:"e.g., 3 or d8",...t})})]})}}),(0,a.jsx)(z.zB,{name:"entries.".concat(t,".weight"),control:_.control,render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"Weight"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(o.p,{type:"number",min:"1",...s,value:null!=(t=s.value)?t:""})})]})}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{children:"Chance"}),(0,a.jsxs)("p",{className:"font-semibold text-muted-foreground h-10 flex items-center",children:[n,"%"]})]}),(0,a.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>et(t),className:"text-muted-foreground hover:text-destructive place-self-end md:place-self-auto",children:(0,a.jsx)(F.A,{className:"h-4 w-4"})})]},e.id)}),0===Q.length&&(0,a.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No creatures added to this table."})]})]})]}),(0,a.jsxs)(S.wL,{className:"flex items-center gap-2",children:[!s&&(0,a.jsxs)(A.Lt,{children:[(0,a.jsx)(A.tv,{asChild:!0,children:(0,a.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(F.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(A.EO,{children:[(0,a.jsxs)(A.wd,{children:[(0,a.jsx)(A.r7,{children:"Are you sure?"}),(0,a.jsxs)(A.$v,{children:['This will permanently delete "',_.getValues("name"),'".']})]}),(0,a.jsxs)(A.ck,{children:[(0,a.jsx)(A.Zr,{children:"Cancel"}),(0,a.jsx)(A.Rx,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!G&&(0,a.jsx)(d.$,{type:"button",variant:"outline",onClick:ea,children:"Cancel"}),(0,a.jsx)(d.$,{type:"submit",children:s?"Create Table":"Save Changes"})]})]})})})})}function U(){let[e,t]=(0,r.useState)(null),[s,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(0),[u,x]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[j,p]=(0,r.useState)(""),[f,g]=(0,r.useState)(""),[N,v]=(0,r.useState)("name"),[b,y]=(0,r.useState)("asc"),[T,R]=(0,r.useState)(!1),C=(0,i.a)(),[S,k]=(0,r.useState)("list");(0,r.useEffect)(()=>{R(!0)},[]);let A={searchTerm:u,tagFilter:m,minTR:j,maxTR:f,sortBy:N,sortOrder:b},z={setSearchTerm:x,setTagFilter:h,setMinTR:p,setMaxTR:g,setSortBy:v,setSortOrder:y},L=(e,t)=>{t.shiftKey?(void 0!==e.minTR&&p(String(e.minTR)),void 0!==e.maxTR&&g(String(e.maxTR)),e.tagFilter&&h(t=>t?t.split(",").map(e=>e.trim()).includes(e.tagFilter)?t:"".concat(t,", ").concat(e.tagFilter):e.tagFilter)):(p(void 0!==e.minTR?String(e.minTR):""),g(void 0!==e.maxTR?String(e.maxTR):""),h(e.tagFilter||""))},E=()=>{x(""),h(""),p(""),g(""),v("name"),y("asc")},M=()=>d(e=>e+1),F=e=>{t(e),c(!1),C&&k("editor")},I=()=>{t(null),c(!0),C&&k("editor")},B=e=>{M(),t(e),c(!1),C&&k("editor")},$=()=>{M(),t(null),c(!1),C&&k("list")},J=()=>{s&&(c(!1),t(null),C&&k("list"))};return T?C?(0,a.jsx)(l.A,{showSidebarTrigger:!1,children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===S?(0,a.jsx)(w,{onSelectTable:F,onNewTable:I,selectedTableId:e,dataVersion:o,filters:A,setFilters:z,onClearFilters:E}):(0,a.jsx)("div",{className:"p-4 sm:p-6 h-full w-full overflow-y-auto",children:(0,a.jsx)(Z,{tableId:e,isCreatingNew:s,onSaveSuccess:B,onDeleteSuccess:$,onEditCancel:J,onBack:()=>{k("list"),t(null),c(!1)},dataVersion:o,onFilterByClick:L},null!=e?e:s?"new":"placeholder")})})}):(0,a.jsx)(n.GB,{children:(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(n.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(w,{onSelectTable:F,onNewTable:I,selectedTableId:e,dataVersion:o,filters:A,setFilters:z,onClearFilters:E})}),(0,a.jsx)(n.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(Z,{tableId:e,isCreatingNew:s,onSaveSuccess:B,onDeleteSuccess:$,onEditCancel:J,dataVersion:o,onFilterByClick:L},null!=e?e:s?"new":"placeholder")})})]})})}):null}},68856:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var a=s(95155),r=s(59434);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",t),...s})}},73926:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},75074:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},79646:(e,t,s)=>{Promise.resolve().then(s.bind(s,64867))}},e=>{var t=t=>e(e.s=t);e.O(0,[222,676,670,49,347,516,441,684,358],()=>t(79646)),_N_E=e.O()}]);
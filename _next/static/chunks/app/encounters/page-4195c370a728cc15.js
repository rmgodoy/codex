(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{4580:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>H});var n=t(5155),a=t(2115),l=t(2709),r=t(31),i=t(7189),c=t(3585),o=t(2523),d=t(285),m=t(6424),u=t(2346),x=t(7481),h=t(4301),j=t(5074),p=t(203),f=t(3926),g=t(5057),v=t(9409),N=t(648);function b(e){let{onSelectEncounter:s,onNewEncounter:t,selectedEncounterId:l,dataVersion:r,filters:b,setFilters:w,onClearFilters:y}=e,[T,C]=(0,a.useState)([]),[R,S]=(0,a.useState)([]),[E,k]=(0,a.useState)(!0),{toast:I}=(0,x.dj)();(0,a.useEffect)(()=>{(async()=>{k(!0);try{let[e,s]=await Promise.all([(0,i.eS)(),(0,c.MY)()]);C(e),S(s)}catch(e){console.error("Error fetching encounters:",e),I({variant:"destructive",title:"Error",description:"Could not fetch encounters from database."})}finally{k(!1)}})()},[r,I]);let z=(0,a.useMemo)(()=>{let e=T.map(e=>{if(e.encounterTableId){let s=R.find(s=>s.id===e.encounterTableId);return{...e,totalTR:(null==s?void 0:s.totalTR)||e.totalTR||0}}return{...e,totalTR:e.totalTR||0}}).filter(e=>{let s=e.name.toLowerCase().includes(b.searchTerm.toLowerCase()),t=!0,n=b.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);n.length>0&&(t=!!e.tags&&n.every(s=>e.tags.some(e=>e.toLowerCase().includes(s))));let a=!0;return b.minTR&&!isNaN(parseInt(b.minTR))&&(a=a&&e.totalTR>=parseInt(b.minTR,10)),b.maxTR&&!isNaN(parseInt(b.maxTR))&&(a=a&&e.totalTR<=parseInt(b.maxTR,10)),s&&t&&a}).sort((e,s)=>{if("TR"===b.sortBy){var t,n;let a=(null!=(t=e.totalTR)?t:0)-(null!=(n=s.totalTR)?n:0);if(0!==a)return a}return e.name.localeCompare(s.name)});return"desc"===b.sortOrder&&e.reverse(),e},[T,R,b]);return(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsxs)("div",{className:"p-4 space-y-4",children:[(0,n.jsxs)(d.$,{onClick:t,className:"w-full",children:[(0,n.jsx)(h.A,{})," New Encounter"]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,n.jsx)(o.p,{placeholder:"Search encounters...",value:b.searchTerm,onChange:e=>w.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(g.J,{children:"Filter"}),(0,n.jsx)(d.$,{variant:"ghost",size:"sm",onClick:y,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,n.jsx)(N.F,{value:b.tagFilter?b.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>w.setTagFilter(e.join(",")),placeholder:"Tags (e.g. boss-fight)",tagSource:"encounter"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(o.p,{placeholder:"Min TR",type:"number",value:b.minTR,onChange:e=>w.setMinTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,n.jsx)(o.p,{placeholder:"Max TR",type:"number",value:b.maxTR,onChange:e=>w.setMaxTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(g.J,{children:"Sort by"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(v.l6,{value:b.sortBy,onValueChange:e=>w.setSortBy(e),children:[(0,n.jsx)(v.bq,{children:(0,n.jsx)(v.yv,{placeholder:"Sort by"})}),(0,n.jsxs)(v.gC,{children:[(0,n.jsx)(v.eb,{value:"name",children:"Name"}),(0,n.jsx)(v.eb,{value:"TR",children:"TR"})]})]}),(0,n.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>w.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===b.sortOrder?(0,n.jsx)(p.A,{className:"h-4 w-4"}):(0,n.jsx)(f.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,n.jsx)(u.w,{}),(0,n.jsx)(m.F,{className:"flex-1",children:(0,n.jsx)("div",{className:"p-4",children:E?(0,n.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading encounters..."}):z.length>0?(0,n.jsx)("ul",{className:"space-y-1",children:z.map(e=>(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(l===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,n.jsxs)("span",{className:"text-xs opacity-70",children:["(TR ",e.totalTR,")"]})]})},e.id))}):(0,n.jsx)("p",{className:"text-muted-foreground text-center",children:"No encounters found."})})})]})}var w=t(2177),y=t(221),T=t(5594),C=t(6535),R=t(4218),S=t(6695),E=t(8539),k=t(10),I=t(7759),z=t(3503),M=t(2543),A=t(1816),F=t(8763),B=t(1721),$=t(7223),G=t(5318),L=t(3054),J=t(3896),O=t(8856),V=t(4165),q=t(6126),D=t(7906);let P=T.z.object({id:T.z.string(),name:T.z.string().min(1,"Player name is required")}),Z=T.z.object({monsterId:T.z.string(),quantity:T.z.coerce.number().min(1,"Quantity must be at least 1")}),_=T.z.object({name:T.z.string().min(1,"Encounter name is required"),sceneDescription:T.z.string().optional(),gmNotes:T.z.string().optional(),players:T.z.array(P),monsterGroups:T.z.array(Z),tags:T.z.array(T.z.string()).optional(),totalTR:T.z.coerce.number().optional(),encounterTableId:T.z.string().optional()}),U=e=>{let{onAddCreatures:s}=e,[t,l]=(0,a.useState)(!1),[r,i]=(0,a.useState)([]),[c,u]=(0,a.useState)(new Map),[x,h]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&(0,C.OG)().then(i)},[t]);let j=(0,a.useMemo)(()=>r.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),[r,x]),p=(e,s)=>{s>=1?u(t=>{let n=new Map(t);return n.set(e,s),n}):u(s=>{let t=new Map(s);return t.delete(e),t})},f=async()=>{let e=Array.from(c.entries()).map(e=>{let[s,t]=e,n=r.find(e=>e.id===s);return{id:s,name:n.name,quantity:t}});e.length>0&&s(e),l(!1),u(new Map),h("")};return(0,n.jsxs)(V.lG,{open:t,onOpenChange:l,children:[(0,n.jsx)(V.zM,{asChild:!0,children:(0,n.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,n.jsx)(z.A,{className:"h-4 w-4 mr-2"})," Add Monster"]})}),(0,n.jsxs)(V.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,n.jsx)(V.c7,{children:(0,n.jsx)(V.L3,{children:"Select Monsters from Bestiary"})}),(0,n.jsx)(o.p,{placeholder:"Search monsters...",value:x,onChange:e=>h(e.target.value),className:"mb-4 shrink-0"}),(0,n.jsx)(m.F,{className:"flex-1 border rounded-md p-2",children:(0,n.jsx)("div",{className:"space-y-1",children:j.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md",children:[(0,n.jsx)(o.p,{type:"number",min:"0",value:c.get(e.id)||0,onChange:s=>p(e.id,parseInt(s.target.value)||0),className:"w-20 h-8"}),(0,n.jsx)("label",{htmlFor:"creature-".concat(e.id),className:"flex-1",children:(0,n.jsxs)("p",{className:"font-semibold",children:[e.name," ",(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(Lvl ",e.level,")"]})]})})]},e.id))})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 pt-4 shrink-0",children:[(0,n.jsx)(d.$,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),(0,n.jsx)(d.$,{onClick:f,disabled:0===c.size,children:"Add Selected"})]})]})]})},W={name:"",sceneDescription:"",gmNotes:"",players:[],monsterGroups:[],tags:[],totalTR:0,encounterTableId:"none"};function Y(e){let{encounterId:s,isCreatingNew:t,onEncounterSaveSuccess:l,onEncounterDeleteSuccess:r,onEditCancel:m,onRunEncounter:h,onFilterByClick:j,onBack:p,dataVersion:f}=e,{toast:b}=(0,x.dj)(),[T,V]=(0,a.useState)(t),[P,Z]=(0,a.useState)(!t&&!!s),[Y,Q]=(0,a.useState)(null),H=(0,D.a)(),[K,X]=(0,a.useState)({monsters:new Map}),[ee,es]=(0,a.useState)([]),[et,en]=(0,a.useState)([]),ea=(0,w.mN)({resolver:(0,y.u)(_),defaultValues:W}),{fields:el,append:er,remove:ei}=(0,w.jz)({control:ea.control,name:"players"}),{fields:ec,append:eo,remove:ed,update:em,replace:eu}=(0,w.jz)({control:ea.control,name:"monsterGroups"}),ex=(0,a.useMemo)(()=>new Map(ee.map(e=>[e.id,e.TR])),[ee]),eh=ea.watch("encounterTableId"),ej=JSON.stringify(ea.watch("monsterGroups"));(0,a.useEffect)(()=>{if(eh&&"none"!==eh){let e=et.find(e=>e.id===eh);e&&e.totalTR!==ea.getValues("totalTR")&&ea.setValue("totalTR",e.totalTR),ea.getValues("monsterGroups").length>0&&eu([])}else{let e=JSON.parse(ej).reduce((e,s)=>e+(ex.get(s.monsterId)||0)*s.quantity,0);e!==ea.getValues("totalTR")&&ea.setValue("totalTR",e)}},[ej,eh,et,ex,ea,eu]);let ep=(0,a.useCallback)(async()=>{if(t){ea.reset(W),Q(null),V(!0),Z(!1),en(await (0,c.MY)());return}if(!s){V(!1),Z(!1),Q(null);return}Z(!0),V(!1);try{let[e,t,n]=await Promise.all([(0,i.eq)(s),(0,c.MY)(),(0,C.OG)()]);if(en(t),es(n),e){let s,a=e.totalTR||0;e.encounterTableId&&(s=t.find(s=>s.id===e.encounterTableId))&&(a=s.totalTR);let l={...e,totalTR:a};Q(l);let r={...e,tags:e.tags||[],encounterTableId:e.encounterTableId||"none",totalTR:a};ea.reset(r);let i=(e.monsterGroups||[]).map(e=>e.monsterId),c=n.filter(e=>i.includes(e.id)),o=new Map(c.map(e=>[e.id,e]));X({monsters:o,table:s})}else Q(null)}catch(e){b({variant:"destructive",title:"Error",description:"Could not load encounter data."})}finally{Z(!1)}},[s,t,ea,b]);(0,a.useEffect)(()=>(ep(),window.addEventListener("focus",ep),()=>window.removeEventListener("focus",ep)),[ep,f]);let ef=(0,a.useMemo)(()=>new Map(ee.map(e=>[e.id,e])),[ee]),eg=()=>{if(t)m();else if(Y){let e={...Y,tags:Y.tags||[],encounterTableId:Y.encounterTableId||"none"};ea.reset(e),V(!1)}},ev=async e=>{try{let n,a="none"===e.encounterTableId?void 0:e.encounterTableId,r={...e,tags:e.tags||[],totalTR:e.totalTR,encounterTableId:a,monsterGroups:a?[]:e.monsterGroups},c=e.tags||[];if(c.length>0&&await (0,R.JE)(c,"encounter"),t)n=await (0,i.Fs)(r),b({title:"Encounter Created!",description:"".concat(e.name," has been saved.")});else{if(!s)return;n=s,await (0,i.H$)({...r,id:s}),b({title:"Save Successful",description:"".concat(e.name," has been updated.")})}l(n),V(!1)}catch(e){b({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},eN=async()=>{if(s)try{await (0,i.ZJ)(s),b({title:"Encounter Deleted",description:"The encounter has been removed."}),r()}catch(e){b({variant:"destructive",title:"Deletion Failed",description:"Could not delete the encounter."})}};if(P)return(0,n.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,n.jsxs)(S.Zp,{children:[(0,n.jsx)(S.aR,{children:(0,n.jsx)(O.E,{className:"h-8 w-48"})}),(0,n.jsx)(S.Wu,{children:(0,n.jsx)(O.E,{className:"h-40 w-full"})})]})});if(!s&&!t)return(0,n.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,n.jsx)(S.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,n.jsxs)(S.Wu,{className:"text-center pt-6",children:[(0,n.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an encounter to view"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})});if(!T&&Y){var eb;return(0,n.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,n.jsxs)(S.Zp,{children:[(0,n.jsx)(S.aR,{children:(0,n.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[H&&p&&(0,n.jsx)(d.$,{variant:"ghost",size:"icon",onClick:p,className:"shrink-0 -ml-2 -mt-1",children:(0,n.jsx)(M.A,{className:"h-5 w-5"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(S.ZB,{className:"text-3xl font-bold",children:Y.name}),(0,n.jsx)(S.BT,{children:(0,n.jsxs)("button",{onClick:e=>j({minTR:Y.totalTR||0,maxTR:Y.totalTR||0},e),className:"hover:underline p-0 bg-transparent text-inherit text-sm",children:[(0,n.jsx)("span",{className:"hidden sm:inline",children:"Total Threat Rating (TR): "}),(0,n.jsx)("span",{className:"inline sm:hidden",children:"TR: "}),Y.totalTR||0]})})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,n.jsxs)(d.$,{variant:"default",size:"sm",onClick:()=>h(Y.id),children:[(0,n.jsx)(A.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Run Encounter"}),(0,n.jsx)("span",{className:"inline sm:hidden",children:"Run"})]}),(0,n.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>V(!0),children:[(0,n.jsx)(F.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]})]})]})}),(0,n.jsx)(S.Wu,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Scene"}),(0,n.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Y.sceneDescription||"No scene description."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"GM Notes"}),(0,n.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Y.gmNotes||"No GM notes."})]}),(0,n.jsx)(u.w,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Combatants"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("h4",{className:"font-semibold text-muted-foreground",children:["Players (",(Y.players||[]).length,")"]}),(0,n.jsx)("ul",{className:"space-y-2 pl-4",children:(Y.players||[]).map(e=>(0,n.jsxs)("li",{className:"flex items-center gap-4 p-2 bg-card-foreground/5 rounded-md",children:[(0,n.jsx)(B.A,{className:"h-5 w-5 text-accent"}),(0,n.jsx)("span",{className:"font-semibold flex-1",children:e.name})]},e.id))}),(0,n.jsx)("h4",{className:"font-semibold text-muted-foreground",children:"Monsters"}),Y.encounterTableId?(0,n.jsxs)("div",{className:"p-2 bg-card-foreground/5 rounded-md",children:[(0,n.jsxs)("p",{className:"font-semibold",children:["From Encounter Table: ",(0,n.jsx)("span",{className:"text-accent",children:(null==(eb=K.table)?void 0:eb.name)||"..."})]}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Monsters will be rolled at the start of combat."})]}):(0,n.jsx)("ul",{className:"space-y-2 pl-4",children:(Y.monsterGroups||[]).map(e=>{let s=K.monsters.get(e.monsterId);return(0,n.jsxs)("li",{className:"flex items-center gap-4 p-2 bg-card-foreground/5 rounded-md",children:[(0,n.jsx)(z.A,{className:"h-5 w-5 text-accent"}),(0,n.jsx)("span",{className:"font-semibold flex-1",children:(null==s?void 0:s.name)||"Unknown Monster"}),(0,n.jsxs)("span",{className:"text-sm text-muted-foreground",children:["x ",e.quantity]}),s&&(0,n.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Lvl ",s.level," ",s.role]})]},e.monsterId)})})]})]}),Y.tags&&Y.tags.length>0&&(0,n.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:Y.tags.map(e=>(0,n.jsx)("button",{onClick:s=>j({tagFilter:e},s),className:"bg-transparent border-none p-0 m-0",children:(0,n.jsx)(q.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,n.jsx)(S.wL,{children:(0,n.jsxs)(k.Lt,{children:[(0,n.jsx)(k.tv,{asChild:!0,children:(0,n.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,n.jsx)($.A,{className:"h-4 w-4"})})}),(0,n.jsxs)(k.EO,{children:[(0,n.jsxs)(k.wd,{children:[(0,n.jsx)(k.r7,{children:"Are you sure?"}),(0,n.jsxs)(k.$v,{children:['This will permanently delete "',Y.name,'". This action cannot be undone.']})]}),(0,n.jsxs)(k.ck,{children:[(0,n.jsx)(k.Zr,{children:"Cancel"}),(0,n.jsx)(k.Rx,{onClick:eN,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})}return(0,n.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,n.jsx)(S.Zp,{children:(0,n.jsx)(I.lV,{...ea,children:(0,n.jsxs)("form",{onSubmit:ea.handleSubmit(ev),className:"space-y-6",children:[(0,n.jsx)(S.aR,{children:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[H&&p&&(0,n.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:m,className:"shrink-0 -ml-2",children:(0,n.jsx)(M.A,{className:"h-5 w-5"})}),(0,n.jsx)("div",{children:(0,n.jsx)(S.ZB,{children:t?H?"New Encounter":"Create a New Encounter":"Editing: ".concat(ea.getValues("name")||"...")})})]}),!H&&(0,n.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:eg,className:"text-muted-foreground hover:text-foreground",children:(0,n.jsx)(G.A,{className:"h-5 w-5"})})]})}),(0,n.jsxs)(S.Wu,{className:"space-y-6",children:[(0,n.jsx)(I.zB,{name:"name",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{children:[(0,n.jsx)(I.lR,{children:"Encounter Name"}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(o.p,{...s})}),(0,n.jsx)(I.C5,{})]})}}),(0,n.jsx)(I.zB,{name:"tags",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{children:[(0,n.jsxs)(I.lR,{className:"flex items-center gap-2",children:[(0,n.jsx)(L.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(N.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"encounter"})}),(0,n.jsx)(I.C5,{})]})}}),(0,n.jsx)(I.zB,{name:"sceneDescription",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{children:[(0,n.jsx)(I.lR,{children:"Scene Description"}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(E.T,{...s,rows:4})})]})}}),(0,n.jsx)(I.zB,{name:"gmNotes",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{children:[(0,n.jsx)(I.lR,{children:"GM Notes (Private)"}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(E.T,{...s,rows:4})})]})}}),(0,n.jsx)(u.w,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-4",children:"Combatants"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-muted-foreground",children:"Players"}),(0,n.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{er({id:crypto.randomUUID(),name:"Player ".concat(el.length+1)})},children:[(0,n.jsx)(J.A,{className:"h-4 w-4 mr-2"})," Add Player"]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[el.map((e,s)=>(0,n.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card-foreground/5",children:[(0,n.jsx)(I.zB,{name:"players.".concat(s,".name"),control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{className:"flex-1",children:[(0,n.jsx)(I.MJ,{children:(0,n.jsx)(o.p,{...s})}),(0,n.jsx)(I.C5,{})]})}}),(0,n.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ei(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,n.jsx)($.A,{className:"h-4 w-4"})})]},e.id)),0===el.length&&(0,n.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No players added."})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-muted-foreground",children:"Monsters"}),(0,n.jsx)(I.zB,{name:"totalTR",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{className:"flex items-center gap-2",children:[(0,n.jsx)(I.lR,{children:"Total TR:"}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(o.p,{type:"number",...s,readOnly:!0,className:"w-20 bg-muted border-none"})})]})}})]}),(0,n.jsx)(I.zB,{name:"encounterTableId",control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{children:[(0,n.jsx)(I.lR,{children:"Encounter Table (Optional)"}),(0,n.jsxs)(v.l6,{onValueChange:e=>s.onChange(e),value:s.value||"none",children:[(0,n.jsx)(I.MJ,{children:(0,n.jsx)(v.bq,{children:(0,n.jsx)(v.yv,{placeholder:"Select a table to roll from"})})}),(0,n.jsxs)(v.gC,{children:[(0,n.jsx)(v.eb,{value:"none",children:"None (Manual Selection)"}),et.map(e=>(0,n.jsx)(v.eb,{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)(I.C5,{})]})}}),(!eh||"none"===eh)&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("div",{className:"flex justify-end items-center mb-2",children:(0,n.jsx)(U,{onAddCreatures:e=>{e.forEach(e=>{let{id:s,quantity:t}=e,n=ec.findIndex(e=>e.monsterId===s);if(n>-1){let e=ec[n];em(n,{...e,quantity:e.quantity+t})}else eo({monsterId:s,quantity:t})})}})}),(0,n.jsxs)("div",{className:"space-y-2",children:[ec.map((e,s)=>{let t=ef.get(e.monsterId);return(0,n.jsxs)("div",{className:"flex items-center gap-3 p-2 border rounded-lg bg-card-foreground/5",children:[(0,n.jsx)("p",{className:"flex-1 font-semibold",children:(null==t?void 0:t.name)||"Unknown Monster"}),(0,n.jsx)(I.zB,{name:"monsterGroups.".concat(s,".quantity"),control:ea.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(I.eI,{className:"flex items-center gap-2",children:[(0,n.jsx)(g.J,{children:"Qty"}),(0,n.jsx)(I.MJ,{children:(0,n.jsx)(o.p,{type:"number",min:"1",...s,className:"w-20 h-8"})})]})}}),(0,n.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ed(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,n.jsx)($.A,{className:"h-4 w-4"})})]},e.id)}),0===ec.length&&(0,n.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No monsters added."})]})]})]})]})]}),(0,n.jsxs)(S.wL,{className:"flex items-center gap-2",children:[!t&&(0,n.jsxs)(k.Lt,{children:[(0,n.jsx)(k.tv,{asChild:!0,children:(0,n.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,n.jsx)($.A,{className:"h-4 w-4"})})}),(0,n.jsxs)(k.EO,{children:[(0,n.jsxs)(k.wd,{children:[(0,n.jsx)(k.r7,{children:"Are you sure?"}),(0,n.jsxs)(k.$v,{children:['This will permanently delete "',ea.getValues("name"),'".']})]}),(0,n.jsxs)(k.ck,{children:[(0,n.jsx)(k.Zr,{children:"Cancel"}),(0,n.jsx)(k.Rx,{onClick:eN,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,n.jsx)("div",{className:"flex-grow"}),!H&&(0,n.jsx)(d.$,{type:"button",variant:"outline",onClick:eg,children:"Cancel"}),(0,n.jsx)(d.$,{type:"submit",children:t?"Create Encounter":"Save Changes"})]})]})})})})}var Q=t(1933);function H(){let[e,s]=(0,a.useState)("preparation"),[t,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[m,u]=(0,a.useState)(!1),[h,j]=(0,a.useState)(0),[p,f]=(0,a.useState)(""),[g,v]=(0,a.useState)(""),[N,w]=(0,a.useState)(""),[y,T]=(0,a.useState)(""),[C,R]=(0,a.useState)("name"),[S,E]=(0,a.useState)("asc"),[k,I]=(0,a.useState)(!1),z=(0,D.a)(),[M,A]=(0,a.useState)("list");(0,a.useEffect)(()=>{I(!0)},[]);let F={searchTerm:p,tagFilter:g,minTR:N,maxTR:y,sortBy:C,sortOrder:S},B={setSearchTerm:f,setTagFilter:v,setMinTR:w,setMaxTR:T,setSortBy:R,setSortOrder:E},$=(e,s)=>{s.shiftKey?(void 0!==e.minTR&&w(String(e.minTR)),void 0!==e.maxTR&&T(String(e.maxTR)),e.tagFilter&&v(s=>s?s.split(",").map(e=>e.trim()).includes(e.tagFilter)?s:"".concat(s,", ").concat(e.tagFilter):e.tagFilter)):(w(void 0!==e.minTR?String(e.minTR):""),T(void 0!==e.maxTR?String(e.maxTR):""),v(e.tagFilter||""))},G=()=>{f(""),v(""),w(""),T(""),R("name"),E("asc")},L=()=>j(e=>e+1),J=e=>{c(e),u(!1),z&&A("editor")},O=()=>{c(null),u(!0),z&&A("editor")},V=e=>{L(),c(e),u(!1),z&&A("editor")},q=()=>{L(),c(null),u(!1),z&&A("list")},P=()=>{m&&(u(!1),c(null),z&&A("list"))},{toast:Z}=(0,x.dj)(),_=async e=>{try{let t=await (0,i.eq)(e);t?(d(t),s("live")):Z({variant:"destructive",title:"Error",description:"Could not find encounter to run."})}catch(e){Z({variant:"destructive",title:"Error",description:"Failed to load encounter data."})}};return"live"===e&&o?(0,n.jsx)(Q.A,{encounter:o,onEndEncounter:()=>{d(null),s("preparation")}}):k?z?(0,n.jsx)(l.A,{showSidebarTrigger:!1,children:(0,n.jsx)("div",{className:"h-full w-full",children:"list"===M?(0,n.jsx)(b,{onSelectEncounter:J,onNewEncounter:O,selectedEncounterId:t,dataVersion:h,filters:F,setFilters:B,onClearFilters:G}):(0,n.jsx)("div",{className:"p-4 sm:p-6 h-full w-full overflow-y-auto",children:(0,n.jsx)(Y,{encounterId:t,isCreatingNew:m,onEncounterSaveSuccess:V,onEncounterDeleteSuccess:q,onEditCancel:P,onRunEncounter:_,onFilterByClick:$,onBack:()=>{A("list"),c(null),u(!1)},dataVersion:h},null!=t?t:m?"new":"placeholder")})})}):(0,n.jsx)(r.GB,{children:(0,n.jsx)(l.A,{children:(0,n.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,n.jsx)(r.Bx,{style:{"--sidebar-width":"380px"},children:(0,n.jsx)(b,{onSelectEncounter:J,onNewEncounter:O,selectedEncounterId:t,dataVersion:h,filters:F,setFilters:B,onClearFilters:G})}),(0,n.jsx)(r.sF,{className:"flex-1 overflow-y-auto",children:(0,n.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,n.jsx)(Y,{encounterId:t,isCreatingNew:m,onEncounterSaveSuccess:V,onEncounterDeleteSuccess:q,onEditCancel:P,onRunEncounter:_,onFilterByClick:$,dataVersion:h},null!=t?t:m?"new":"placeholder")})})]})})}):null}},6612:(e,s,t)=>{Promise.resolve().then(t.bind(t,4580))}},e=>{var s=s=>e(e.s=s);e.O(0,[222,120,427,909,347,239,1,441,684,358],()=>s(6612)),_N_E=e.O()}]);
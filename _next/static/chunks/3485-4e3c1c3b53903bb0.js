"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3485],{33485:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ei});var n=a(95155),l=a(12115),s=a(52873),r=a(7860),i=a(76959),d=a(1077),c=a(99982),o=a(66695),h=a(30285),x=a(87481),m=a(62177),u=a(90221),j=a(55594),f=a(53648),p=a(54165),v=a(17759),y=a(62523),g=a(88539),N=a(14636),b=a(90648),C=a(59434),w=a(51920),D=a(25318),S=a(50286),I=a(91721),k=a(83662),A=a(965),E=a(73158),T=a(58049);function z(e){let{className:t,classNames:a,showOutsideDays:l=!0,...s}=e;return(0,n.jsx)(T.hv,{showOutsideDays:l,className:(0,C.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,C.cn)((0,h.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,C.cn)((0,h.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,n.jsx)(A.A,{className:(0,C.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,n.jsx)(E.A,{className:(0,C.cn)("h-4 w-4",t),...a})}},...s})}z.displayName="Calendar";var M=a(66424);function U(e){let{items:t,onSelectItem:a,trigger:s,title:r}=e,[i,d]=(0,l.useState)(!1),[c,o]=(0,l.useState)(""),x=(0,l.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),[t,c]),m=e=>{a(e),d(!1),o("")};return(0,n.jsxs)(p.lG,{open:i,onOpenChange:d,children:[(0,n.jsx)(p.zM,{asChild:!0,children:s}),(0,n.jsxs)(p.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,n.jsx)(p.c7,{children:(0,n.jsx)(p.L3,{children:r})}),(0,n.jsx)(y.p,{placeholder:"Search...",value:c,onChange:e=>o(e.target.value),className:"mb-4 shrink-0"}),(0,n.jsx)(M.F,{className:"flex-1 border rounded-md p-2",children:x.map(e=>(0,n.jsx)(h.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>m(e),children:e.name},e.id))})]})]})}var $=a(69253),F=a(77266);function _(e){let{calendarModel:t,initialDate:a,onDateSelect:s,children:r}=e,[i,d]=(0,l.useState)(!1);return(0,n.jsxs)(p.lG,{open:i,onOpenChange:d,children:[(0,n.jsx)(p.zM,{asChild:!0,children:r}),(0,n.jsxs)(p.Cf,{className:"max-w-3xl h-[80vh] p-4 flex flex-col",children:[(0,n.jsx)(p.c7,{children:(0,n.jsx)(p.L3,{children:"Select a Date"})}),(0,n.jsx)(F.r,{calendar:t,onDateSelect:e=>{s(e),d(!1)},disableEditing:!0,initialDate:a?new Date(Date.UTC(a.year,a.monthIndex,a.day)):void 0,selectedDate:a})]})]})}var O=a(82940),R=a.n(O);let L=()=>{let e=new Date(Date.UTC(1,0,1));return e.setUTCFullYear(1),e},P=e=>({year:e.getUTCFullYear(),monthIndex:e.getUTCMonth(),day:e.getUTCDate()}),B=e=>{let t=R()().utc().endOf("day").toDate();return t.setUTCFullYear(e.year,e.monthIndex,e.day),t},Y=j.z.object({year:j.z.number(),monthIndex:j.z.number(),day:j.z.number()}),G=j.z.object({title:j.z.string().min(1,"Title is required."),description:j.z.string().optional(),tags:j.z.array(j.z.string()).optional(),startDate:Y,endDate:Y.optional(),location:j.z.object({mapId:j.z.string(),hex:j.z.object({q:j.z.number(),r:j.z.number(),s:j.z.number()})}).optional()}).superRefine((e,t)=>{e.endDate&&B(e.startDate)>B(e.endDate)&&t.addIssue({path:["endDate"],message:"End date cannot be before start date."})});function Z(e){let{isOpen:t,onOpenChange:a,onSaveSuccess:s,event:r,calendar:i,calendarModel:d,initialDate:c}=e,{toast:o}=(0,x.dj)(),[j,A]=(0,l.useState)([]),[E,T]=(0,l.useState)([]),[F,O]=(0,l.useState)([]),[R,Y]=(0,l.useState)([]),[Z,q]=(0,l.useState)(null),[W,J]=(0,l.useState)(null);(0,l.useEffect)(()=>{Promise.all([(0,f.OG)(),(0,f.vq)(),(0,f.xW)(),(0,f.Qg)()]).then(e=>{let[t,a,n,l]=e;A(t),T(a),Y(n),O(l)})},[]);let V=(0,m.mN)({resolver:(0,u.u)(G)}),{watch:H,setValue:Q}=V,K=H("startDate");(0,l.useEffect)(()=>{if(t)if(r)if(V.reset({title:r.title,description:r.description,tags:r.tags||[],startDate:r.startDate,endDate:r.endDate,location:r.location}),q(r.party||null),r.location&&R.length>0){var e;let t=(null==(e=R.find(e=>e.id===r.location.mapId))?void 0:e.name)||"Unknown Map";J({...r.location,mapName:t})}else J(null);else V.reset({title:"",description:"",tags:[],startDate:c,endDate:void 0,location:void 0}),q(null),J(null)},[r,t,V,c,R]);let X=async e=>{let t;if(Z&&(t={type:Z.type,id:Z.id,name:Z.name}),!i)return void o({variant:"destructive",title:"Error",description:"No calendar selected to add the event to."});let a={title:e.title,calendarId:i.id,description:e.description||"",startDate:e.startDate,endDate:e.endDate||e.startDate,tags:e.tags||[],party:t,location:W?{mapId:W.mapId,hex:W.hex}:void 0};try{e.tags&&await (0,f.JE)(e.tags,"calendar"),r?(await (0,f._1)({...a,id:r.id}),o({title:"Event Updated"})):(await (0,f.UU)(a),o({title:"Event Created"})),s()}catch(e){o({variant:"destructive",title:"Save Failed",description:"Could not save event."})}};return(0,n.jsx)(p.lG,{open:t,onOpenChange:a,children:(0,n.jsxs)(p.Cf,{className:"max-h-[90vh] flex flex-col p-0",children:[(0,n.jsxs)(p.c7,{className:"p-6 pb-4",children:[(0,n.jsx)(p.L3,{children:r?"Edit Event":"Add New Event"}),(0,n.jsx)(p.rr,{children:r?"Editing event.":"Create a new event."})]}),(0,n.jsx)(M.F,{className:"flex-1 px-6",children:(0,n.jsx)(v.lV,{...V,children:(0,n.jsxs)("form",{id:"event-form",onSubmit:V.handleSubmit(X),className:"space-y-4 pb-4",children:[(0,n.jsx)(v.zB,{name:"title",control:V.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(v.eI,{children:[(0,n.jsx)(v.lR,{children:"Title"}),(0,n.jsx)(v.MJ,{children:(0,n.jsx)(y.p,{...t})}),(0,n.jsx)(v.C5,{})]})}}),(0,n.jsx)(v.zB,{name:"description",control:V.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(v.eI,{children:[(0,n.jsx)(v.lR,{children:"Description"}),(0,n.jsx)(v.MJ,{children:(0,n.jsx)(g.T,{...t})})]})}}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(v.zB,{name:"startDate",control:V.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(v.eI,{className:"flex flex-col",children:[(0,n.jsx)(v.lR,{children:"Start Date"}),d?(0,n.jsx)(_,{calendarModel:d,onDateSelect:e=>t.onChange(e),initialDate:t.value,children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full pl-3 text-left font-normal",children:[(0,n.jsx)("span",{children:t.value&&d.months[t.value.monthIndex]?"".concat(d.months[t.value.monthIndex].name," ").concat(t.value.day,", ").concat(t.value.year):"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})}):(0,n.jsxs)(N.AM,{children:[(0,n.jsx)(N.Wv,{asChild:!0,children:(0,n.jsx)(v.MJ,{children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:(0,C.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?B(t.value).toUTCString().slice(5,16):(0,n.jsx)("span",{children:"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,n.jsx)(N.hl,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(z,{mode:"single",selected:B(t.value),onSelect:e=>e&&t.onChange(P(e)),defaultMonth:B(t.value),disabled:e=>e<L(),initialFocus:!0})})]}),(0,n.jsx)(v.C5,{})]})}}),(0,n.jsx)(v.zB,{name:"endDate",control:V.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(v.eI,{className:"flex flex-col",children:[(0,n.jsx)(v.lR,{children:"End Date (Optional)"}),d?(0,n.jsx)(_,{calendarModel:d,onDateSelect:e=>t.onChange(e),initialDate:t.value,children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full pl-3 text-left font-normal",children:[(0,n.jsx)("span",{children:t.value&&d.months[t.value.monthIndex]?"".concat(d.months[t.value.monthIndex].name," ").concat(t.value.day,", ").concat(t.value.year):"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})}):(0,n.jsxs)(N.AM,{children:[(0,n.jsx)(N.Wv,{asChild:!0,children:(0,n.jsx)(v.MJ,{children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:(0,C.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?B(t.value).toUTCString().slice(5,16):(0,n.jsx)("span",{children:"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,n.jsx)(N.hl,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(z,{mode:"single",selected:t.value?B(t.value):void 0,onSelect:e=>e&&t.onChange(P(e)),defaultMonth:B(t.value||K),disabled:e=>e<(B(K)||L()),initialFocus:!0})})]}),(0,n.jsx)(v.C5,{})]})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(v.lR,{children:"Responsible Party (Optional)"}),Z?(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,n.jsxs)("p",{className:"font-semibold",children:[Z.name," ",(0,n.jsxs)("span",{className:"text-sm text-muted-foreground capitalize",children:["(",Z.type,")"]})]}),(0,n.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>q(null),children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]}):(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[(0,n.jsx)(U,{items:E,onSelectItem:e=>q({...e,type:"faction"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Faction"]}),title:"Select a Faction"}),(0,n.jsx)(U,{items:j,onSelectItem:e=>q({...e,type:"creature"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Creature"]}),title:"Select a Creature"}),(0,n.jsx)(U,{items:F,onSelectItem:e=>q({...e,type:"npc"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"NPC"]}),title:"Select an NPC"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(v.lR,{children:"Location (Optional)"}),W?(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,n.jsxs)("p",{className:"font-semibold text-sm",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Map:"})," ",W.mapName,(0,n.jsx)("span",{className:"text-muted-foreground ml-2",children:"Tile:"})," ","Q:",W.hex.q,", R:",W.hex.r]}),(0,n.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>J(null),children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]}):(0,n.jsx)($.G,{onLocationSelect:e=>{var t;let{mapId:a,hex:n}=e,l=(null==(t=R.find(e=>e.id===a))?void 0:t.name)||"Unknown Map";J({mapId:a,mapName:l,hex:n})},children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full mt-2",children:[(0,n.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Select Location on Map"]})})]}),(0,n.jsx)(v.zB,{name:"tags",control:V.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(v.eI,{children:[(0,n.jsx)(v.lR,{children:"Tags"}),(0,n.jsx)(v.MJ,{children:(0,n.jsx)(b.F,{value:t.value||[],onChange:t.onChange,tagSource:"calendar",placeholder:"Add tags..."})})]})}})]})})}),(0,n.jsxs)(p.Es,{className:"p-6 pt-4 border-t",children:[(0,n.jsx)(h.$,{type:"button",variant:"ghost",onClick:()=>a(!1),children:"Cancel"}),(0,n.jsx)(h.$,{type:"submit",form:"event-form",children:"Save Event"})]})]})})}var q=a(90010),W=a(26126),J=a(56013),V=a(18046),H=a(10518),Q=a(18763),K=a(77223),X=a(2868),ee=a(59409),et=a(20031),ea=a(22346);let en=new Date(Date.UTC(1,0,1));en.setUTCFullYear(1);let el=e=>{"string"==typeof e&&(e=es(R()(e).utc().endOf("day").toDate()));let t=R()().utc().endOf("day").toDate();return t.setUTCFullYear(e.year,e.monthIndex,e.day),t},es=e=>({year:e.getUTCFullYear(),monthIndex:e.getUTCMonth(),day:e.getUTCDate()});function er(e){let{calendars:t,customCalendars:a,onCalendarsUpdate:s}=e,[r,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(""),[o,m]=(0,l.useState)("traditional"),[u,j]=(0,l.useState)(null),[v,g]=(0,l.useState)(""),{toast:N}=(0,x.dj)(),b=async()=>{if(d.trim())try{let e={name:d.trim(),modelId:"traditional"===o?void 0:o},t=await (0,f.ep)(e);N({title:"Calendar Created",description:'"'.concat(d,'" has been added.')}),c(""),m("traditional"),s(t),i(!1)}catch(e){N({variant:"destructive",title:"Error",description:"Failed to create calendar."})}},C=e=>{j(e.id),g(e.name)},w=()=>{j(null),g("")},S=async()=>{if(!u||!v.trim())return;let e=t.find(e=>e.id===u);if(e)try{await (0,f.md)({...e,name:v.trim()}),N({title:"Calendar Renamed"}),s(),w()}catch(e){N({variant:"destructive",title:"Error",description:"Failed to rename calendar."})}},I=async e=>{try{await (0,f.A$)(e),N({title:"Calendar Deleted"}),s()}catch(e){N({variant:"destructive",title:"Error",description:"Failed to delete calendar and its events."})}};return(0,n.jsxs)(p.lG,{open:r,onOpenChange:i,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",children:(0,n.jsx)(J.A,{className:"h-5 w-5"})})}),(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Manage Calendars"}),(0,n.jsx)(p.rr,{children:"Add, rename, or delete your calendars."})]}),(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2 p-3 border rounded-md",children:[(0,n.jsx)(y.p,{placeholder:"New calendar name...",value:d,onChange:e=>c(e.target.value)}),(0,n.jsxs)(ee.l6,{value:o,onValueChange:m,children:[(0,n.jsx)(ee.bq,{children:(0,n.jsx)(ee.yv,{placeholder:"Select a model"})}),(0,n.jsxs)(ee.gC,{children:[(0,n.jsx)(ee.eb,{value:"traditional",children:"Traditional Calendar"}),a.map(e=>(0,n.jsx)(ee.eb,{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(h.$,{onClick:b,disabled:!d.trim(),children:[(0,n.jsx)(V.A,{className:"h-4 w-4"})," Add"]})]}),(0,n.jsx)(ea.w,{}),(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(e=>(0,n.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:u===e.id?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.p,{value:v,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&S()},className:"h-8",autoFocus:!0}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(h.$,{size:"icon",className:"h-7 w-7",onClick:S,"aria-label":"Save",children:(0,n.jsx)(H.A,{className:"h-4 w-4"})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:w,"aria-label":"Cancel",children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,n.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>C(e),"aria-label":"Edit",children:(0,n.jsx)(Q.A,{className:"h-4 w-4"})}),(0,n.jsxs)(q.Lt,{children:[(0,n.jsx)(q.tv,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,n.jsx)(K.A,{className:"h-4 w-4 text-destructive"})})}),(0,n.jsxs)(q.EO,{children:[(0,n.jsxs)(q.wd,{children:[(0,n.jsx)(q.r7,{children:"Are you sure?"}),(0,n.jsxs)(q.$v,{children:['This will permanently delete the "',e.name,'" calendar and all of its events.']})]}),(0,n.jsxs)(q.ck,{children:[(0,n.jsx)(q.Zr,{children:"Cancel"}),(0,n.jsx)(q.Rx,{onClick:()=>I(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function ei(){let[e,t]=(0,l.useState)([]),[a,m]=(0,l.useState)([]),[u,j]=(0,l.useState)([]),[p,v]=(0,l.useState)(null),[y,g]=(0,l.useState)(null),[N,b]=(0,l.useState)(void 0),[C,w]=(0,l.useState)(!1),[D,S]=(0,l.useState)(null),{toast:I}=(0,x.dj)(),A=(0,l.useMemo)(()=>a.find(e=>e.id===p),[a,p]),E=(0,l.useMemo)(()=>A&&A.modelId&&u.find(e=>e.id===A.modelId)||null,[A,u]),T=!!E,z=e=>(null==e?void 0:e.minDate)?es(new Date(e.minDate)):{year:1,monthIndex:0,day:1},U=async e=>{try{let[a,n]=await Promise.all([(0,f.FO)(),(0,f.Ul)()]);j(n);let l=e;if(!l||!a.some(e=>e.id===l)){var t;l=(null==(t=a[0])?void 0:t.id)||null}if(m(a),p===l&&a.length>0)return;v(l)}catch(e){I({variant:"destructive",title:"Error",description:"Failed to load calendar data."})}};(0,l.useEffect)(()=>{U(p)},[]),(0,l.useEffect)(()=>{(async()=>{let e;if(!p)return t([]);let n=await (0,X.bj)(p);t(n);let l=u.find(e=>{var t;return e.id===(null==(t=a.find(e=>e.id===p))?void 0:t.modelId)})||null;y||g(n.length>0?[...n].sort((e,t)=>el(e.startDate).getTime()-el(t.startDate).getTime())[0].startDate:z(l))})()},[p]),(0,l.useEffect)(()=>{!T&&y&&b(el(y))},[y,T]);let $=async e=>{p&&t(await (0,X.bj)(p)),await U(e||null)},_=e=>{S(e),w(!0)},O=async e=>{try{await (0,X.At)(e),I({title:"Event Deleted"}),p&&(0,X.bj)(p).then(t)}catch(e){I({variant:"destructive",title:"Error",description:"Failed to delete event."})}},L=e=>{let t;return String("string"==typeof e?R()(e).utc().endOf("day").toDate().getUTCDate():e.day).padStart(2,"0")},P=e=>{let t;return String("string"==typeof e?R()(e).utc().endOf("day").toDate().getUTCMonth()+1:e.monthIndex+1).padStart(2,"0")},B=e=>{let t;return String("string"==typeof e?R()(e).utc().endOf("day").toDate().getUTCFullYear():e.year).padStart(4,"0")},Y=(0,l.useMemo)(()=>{if(!y)return[];let t=el(y);return e.filter(e=>{let a=el(e.startDate),n=el(e.endDate);return(0,s.v)(t,{start:a,end:n})}).sort((e,t)=>e.startDate.day-t.startDate.day)},[e,y]),G=(0,l.useMemo)(()=>e.flatMap(e=>{let t=el(e.startDate),a=el(e.endDate);return(0,r.k)({start:t,end:a}).map(es)}),[e]),J=(0,l.useMemo)(()=>{if(!y)return"...";if(T&&E){let{year:e,monthIndex:t,day:a}=y,n=E.months[t];return n?"".concat(n.name," ").concat(a,", ").concat(e):"Invalid Date"}return el(y).toUTCString().slice(5,16)},[y,E,T]),V=(0,l.useMemo)(()=>y||z(E),[y,E]),H=(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(ee.l6,{value:p||"",onValueChange:e=>{v(e),g(null)},disabled:0===a.length,children:[(0,n.jsx)(ee.bq,{className:"flex-1",children:(0,n.jsx)(ee.yv,{placeholder:"Select a calendar"})}),(0,n.jsx)(ee.gC,{children:a.map(e=>(0,n.jsx)(ee.eb,{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)(er,{calendars:a,customCalendars:u,onCalendarsUpdate:$})]});return 0===a.length?(0,n.jsx)(c.A,{children:(0,n.jsx)("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center bg-background/50",children:(0,n.jsxs)(o.Zp,{className:"max-w-md",children:[(0,n.jsxs)(o.aR,{children:[(0,n.jsx)(o.ZB,{children:"Welcome to the Calendar"}),(0,n.jsx)(o.BT,{children:"Create your first calendar to start tracking important dates and events in your world."})]}),(0,n.jsx)(o.Wu,{children:H})]})})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(et.SidebarProvider,{children:[(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,n.jsx)(et.Bx,{style:{"--sidebar-width":"380px"},children:(0,n.jsxs)("div",{className:"p-4 space-y-4 h-full flex flex-col",children:[H,(0,n.jsx)(h.$,{onClick:()=>{S(null),w(!0)},children:"Add Event"}),(0,n.jsx)(ea.w,{}),(0,n.jsxs)(o.Zp,{className:"flex-1 flex flex-col min-h-0",children:[(0,n.jsx)(o.aR,{children:(0,n.jsxs)(o.ZB,{children:["Events for ",J]})}),(0,n.jsx)(o.Wu,{className:"flex-1 min-h-0",children:(0,n.jsx)(M.F,{className:"h-full",children:Y.length>0?(0,n.jsx)("div",{className:"space-y-4 pr-4",children:Y.map(e=>(0,n.jsxs)(o.Zp,{className:"bg-card-foreground/5",children:[(0,n.jsx)(o.aR,{className:"pb-2",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsx)("div",{children:(0,n.jsx)(o.ZB,{className:"text-lg",children:e.title})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>_(e),children:(0,n.jsx)(Q.A,{className:"h-4 w-4"})}),(0,n.jsxs)(q.Lt,{children:[(0,n.jsx)(q.tv,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",children:(0,n.jsx)(K.A,{className:"h-4 w-4 text-destructive"})})}),(0,n.jsxs)(q.EO,{children:[(0,n.jsxs)(q.wd,{children:[(0,n.jsx)(q.r7,{children:"Are you sure?"}),(0,n.jsxs)(q.$v,{children:['This will permanently delete "',e.title,'".']})]}),(0,n.jsxs)(q.ck,{children:[(0,n.jsx)(q.Zr,{children:"Cancel"}),(0,n.jsx)(q.Rx,{onClick:()=>O(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})}),(0,n.jsxs)(o.Wu,{children:[(0,n.jsxs)(o.BT,{className:"text-xs",children:["From: ",L(e.startDate),"/",P(e.startDate),"/",B(e.startDate)," To:"," ",L(e.endDate),"/",P(e.endDate),"/",B(e.endDate)]}),e.description&&(0,n.jsx)("p",{className:"text-sm mt-2",children:e.description}),e.party&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Party:"," ",(0,n.jsxs)("span",{className:"font-semibold text-accent",children:[e.party.name," (",e.party.type,")"]})]}),e.location&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[(0,n.jsx)(k.A,{className:"h-3 w-3"})," Location set"]}),e.tags&&e.tags.length>0&&(0,n.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map(e=>(0,n.jsx)(W.E,{variant:"secondary",children:e},e))})]})]},e.id))}):(0,n.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No events for this day."})})})]})]})}),(0,n.jsx)(et.sF,{className:"flex-1 flex flex-col overflow-hidden bg-background/50 p-4",children:T&&E?(0,n.jsx)(F.r,{calendar:E,disableEditing:!0,initialDate:y,selectedDate:y,onDateSelect:g,events:e}):(0,n.jsx)(d.Ay,{onChange:e=>{e instanceof Date&&g(es(e))},value:y?el(y):void 0,activeStartDate:N,onActiveStartDateChange:e=>{let{activeStartDate:t}=e;return t&&b(t)},minDate:en,maxDate:new Date(Date.UTC(9999,11,31)),tileContent:e=>{let{date:t,view:a}=e;return"month"===a&&G.some(e=>(0,i.r)(el(e),t))?(0,n.jsx)("div",{className:"event-dot"}):null},className:"w-full h-full",weekStartsOn:1,next2Label:null,prev2Label:null})})]})}),(0,n.jsx)(Z,{isOpen:C,onOpenChange:w,onSaveSuccess:()=>{p&&(0,X.bj)(p).then(t),w(!1),S(null)},event:D,calendar:A,calendarModel:E,initialDate:V})]})})}},69253:(e,t,a)=>{a.d(t,{G:()=>o});var n=a(95155),l=a(12115),s=a(54165),r=a(30285),i=a(59409),d=a(53648),c=a(19209);function o(e){let{children:t,onLocationSelect:a}=e,[o,h]=(0,l.useState)(!1),[x,m]=(0,l.useState)([]),[u,j]=(0,l.useState)(null),[f,p]=(0,l.useState)(null),[v,y]=(0,l.useState)(null);return(0,l.useEffect)(()=>{o&&(0,d.xW)().then(e=>{m(e),e.length>0&&j(e[0].id)})},[o]),(0,l.useEffect)(()=>{u?(0,d.zU)(u).then(e=>{p(e||null),y(null)}):p(null)},[u]),(0,n.jsxs)(s.lG,{open:o,onOpenChange:h,children:[(0,n.jsx)(s.zM,{asChild:!0,children:t}),(0,n.jsxs)(s.Cf,{className:"sm:max-w-4xl h-[90vh] sm:h-[80vh] flex flex-col",children:[(0,n.jsx)(s.c7,{children:(0,n.jsx)(s.L3,{children:"Select a Location"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4 p-4 border-b",children:[(0,n.jsxs)(i.l6,{value:u||"",onValueChange:j,children:[(0,n.jsx)(i.bq,{className:"w-[250px]",children:(0,n.jsx)(i.yv,{placeholder:"Select a map..."})}),(0,n.jsx)(i.gC,{children:x.map(e=>(0,n.jsx)(i.eb,{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)("div",{className:"flex-1 text-right text-sm text-muted-foreground",children:v?"Selected: Q:".concat(v.q,", R:").concat(v.r):"Click a tile to select it"})]}),(0,n.jsx)("div",{className:"flex-1 relative bg-background/50",children:f?(0,n.jsx)(c.A,{mapData:f,hexSize:20,className:"w-full h-full",onHexClick:y,selectedHex:v,onGridUpdate:()=>{},onAddPointToPath:()=>{},activeTool:"data",paintMode:"brush",paintColor:"",paintIcon:null,paintIconColor:"",isCtrlPressed:!1,isAltPressed:!1,isShiftPressed:!1,isEyedropperActive:!1,onEyedropperClick:()=>{},pathDrawingId:null}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,n.jsx)("p",{children:"Select a map to view it."})})}),(0,n.jsxs)(s.Es,{children:[(0,n.jsx)(r.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,n.jsx)(r.$,{onClick:()=>{u&&v&&(a({mapId:u,hex:v}),h(!1))},disabled:!v,children:"Confirm Location"})]})]})]})}},77266:(e,t,a)=>{a.d(t,{r:()=>p});var n=a(95155),l=a(12115),s=a(30285),r=a(18763),i=a(965),d=a(73158),c=a(66695),o=a(59434),h=a(62523),x=a(82940),m=a.n(x);let u=e=>({year:e.getUTCFullYear(),monthIndex:e.getUTCMonth(),day:e.getUTCDate()}),j=(e,t)=>!!e&&!!t&&e.year===t.year&&e.monthIndex===t.monthIndex&&e.day===t.day,f=e=>"".concat(e.year,"-").concat(e.monthIndex,"-").concat(e.day);function p(e){let{calendar:t,disableEditing:a=!1,initialDate:x,selectedDate:p,events:v=[],onEdit:y,onDateSelect:g}=e,[N,b]=(0,l.useState)((()=>{if("string"==typeof x&&(x=u(m()(x).utc().endOf("day").toDate())),x&&"year"in x&&void 0!==x.year){let e=x.monthIndex;return e>=t.months.length&&(e=0),{year:x.year,monthIndex:e,day:x.day}}if(t.minDate){let e=new Date(0);return e.setUTCFullYear(parseInt(t.minDate.substring(0,4)),parseInt(t.minDate.substring(5,7))-1,parseInt(t.minDate.substring(8,10))),e.setUTCHours(0,0,0,0),u(e)}return{year:1,monthIndex:0,day:1}})()),[C,w]=(0,l.useState)("day"),[D,S]=(0,l.useState)(0),[I,k]=(0,l.useState)(!1),[A,E]=(0,l.useState)("");(0,l.useEffect)(()=>{N&&(S(10*Math.floor((N.year-1)/10)+1),E(N.year.toString()))},[N]),(0,l.useEffect)(()=>{p&&b({year:p.year,monthIndex:p.monthIndex,day:p.day})},[p]);let T=(0,l.useMemo)(()=>t&&N?t.months[N.monthIndex]:null,[t,N]),z=(0,l.useMemo)(()=>{let e=new Set;return v.forEach(a=>{let n=a.startDate,l=a.endDate,s=t.months.length,r=n.year,i=n.monthIndex,d=n.day;for(;;){var c;let a=f({year:r,monthIndex:i,day:d});if(e.add(a),r===l.year&&i===l.monthIndex&&d===l.day)break;++d>((null==(c=t.months[i])?void 0:c.days)||30)&&(d=1,++i>=s&&(i=0,r++))}}),e},[v,t.months]),M=e=>{b(t=>t?{...t,monthIndex:e,day:1}:{year:new Date().getFullYear(),monthIndex:e,day:1}),w("day")},U=e=>{b(t=>t?{...t,year:e}:{year:e,monthIndex:0,day:1}),w("month")},$=e=>{if(!N)return;let t={year:N.year,monthIndex:N.monthIndex,day:e};g&&g(t)};return(0,n.jsxs)(c.Zp,{className:"h-full flex flex-col p-4",children:[!a&&(0,n.jsx)("div",{className:"flex justify-end mb-2",children:(0,n.jsxs)(s.$,{variant:"outline",size:"sm",onClick:y,children:[(0,n.jsx)(r.A,{className:"h-4 w-4 mr-2"}),"Edit"]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)(s.$,{variant:"ghost",size:"icon",onClick:()=>{"day"===C?b(e=>{if(!e)return null;let a=e.monthIndex-1,n=e.year;return a<0&&(a=t.months.length-1,n-=1),{...e,year:n,monthIndex:a}}):"month"===C?b(e=>e?{...e,year:e.year-1}:null):S(e=>e-10)},children:(0,n.jsx)(i.A,{className:"h-5 w-5"})}),I?(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=parseInt(A,10);isNaN(t)||(b(e=>e?{...e,year:t}:{year:t,monthIndex:0,day:1}),w("month"),k(!1))},className:"flex-1 px-4",children:(0,n.jsx)(h.p,{type:"number",value:A,onChange:e=>E(e.target.value),onBlur:()=>k(!1),className:"text-center text-xl font-bold h-10",autoFocus:!0})}):(0,n.jsx)(s.$,{variant:"ghost",className:"text-xl font-bold",onClick:()=>{N&&("day"===C?w("month"):"month"===C?(S(10*Math.floor((N.year-1)/10)+1),w("year")):"year"===C&&(E(N.year.toString()),k(!0)))},children:T&&N?"day"===C?"".concat(T.name,", ").concat(N.year):"month"===C?"".concat(N.year):"".concat(D," - ").concat(D+9):"..."}),(0,n.jsx)(s.$,{variant:"ghost",size:"icon",onClick:()=>{"day"===C?b(e=>{if(!e)return null;let a=e.monthIndex+1,n=e.year;return a>=t.months.length&&(a=0,n+=1),{...e,year:n,monthIndex:a}}):"month"===C?b(e=>e?{...e,year:e.year+1}:null):S(e=>e+10)},children:(0,n.jsx)(d.A,{className:"h-5 w-5"})})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:["day"===C&&(()=>{if(!T||!N)return null;let e=t.weekdays.length,a=T.days,l={year:N.year,monthIndex:N.monthIndex,day:1},s=t.minDate?parseInt(t.minDate.substring(0,4)):1,r=0;for(let e=s;e<l.year;e++)r+=t.months.reduce((e,t)=>e+t.days,0);for(let e=0;e<l.monthIndex;e++)r+=t.months[e].days;let i=r%e,d=Array(i+a).fill(null);for(let e=0;e<a;e++)d[e+i]=e+1;return(0,n.jsxs)("div",{className:"grid flex-1 grid-cols-1",style:{gridTemplateRows:"auto 1fr"},children:[(0,n.jsx)("div",{style:{"--cols":e},className:"grid grid-cols-[repeat(var(--cols),_minmax(0,_1fr))] shrink-0",children:t.weekdays.map(e=>(0,n.jsx)("div",{className:"text-center font-semibold text-muted-foreground p-2 text-sm",children:e},e))}),(0,n.jsx)("div",{style:{"--cols":e},className:"grid grid-cols-[repeat(var(--cols),_minmax(0,_1fr))] grid-rows-auto flex-1 gap-2",children:d.map((e,t)=>{if(!e)return(0,n.jsx)("div",{},t);let a={year:N.year,monthIndex:N.monthIndex,day:e},l=j(p,a),s=f(a),r=z.has(s);return(0,n.jsxs)("button",{className:(0,o.cn)("flex items-start justify-start p-2 rounded-lg transition-colors relative","hover:bg-muted",l&&"bg-primary text-primary-foreground hover:bg-primary/90"),onClick:()=>$(e),disabled:!g,children:[(0,n.jsx)("span",{className:"text-sm",children:e}),r&&(0,n.jsx)("div",{className:(0,o.cn)("absolute bottom-2 left-1/2 -translate-x-1/2 w-1.5 h-1.5 rounded-full",l?"bg-primary-foreground":"bg-accent")})]},t)})})]})})(),"month"===C&&(0,n.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4 p-4 flex-1",children:t.months.map((e,t)=>(0,n.jsx)(s.$,{variant:"outline",className:"h-24 text-lg",onClick:()=>M(t),children:e.name},e.name))}),"year"===C&&(()=>{let e=Array.from({length:10},(e,t)=>D+t);return(0,n.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-4 p-4 flex-1",children:e.map(e=>(0,n.jsx)(s.$,{variant:"outline",className:"h-24 text-lg",onClick:()=>U(e),children:e},e))})})()]})]})}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7265],{97265:(e,s,a)=>{a.r(s),a.d(s,{default:()=>ej});var t=a(95155),l=a(12115),n=a(88972),i=a(19209),r=a(66695),c=a(18186),d=a(68715),o=a(66049),m=a(57946),h=a(23767),u=a(20427),x=a(43152),p=a(83662),j=a(55166),v=a(82643),f=a(56013),g=a(18046),N=a(10518),w=a(25318),b=a(18763),y=a(77223),C=a(21887),k=a(10366),S=a(10947),A=a(47326),E=a(17657),F=a(11133),M=a(86318),z=a(50286),D=a(51920),I=a(52354),$=a(47219),P=a(7146),R=a(92745),L=a(60704),J=a(59434);let T=L.bL,B=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(L.B8,{ref:s,className:(0,J.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...l})});B.displayName=L.B8.displayName;let q=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(L.l9,{ref:s,className:(0,J.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...l})});q.displayName=L.l9.displayName;let U=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(L.UC,{ref:s,className:(0,J.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...l})});U.displayName=L.UC.displayName;var W=a(85057),G=a(62523),V=a(30285),Z=a(22346),_=a(46102),O=a(49864),H=a(74466),Y=a(124);let K=(0,H.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});l.forwardRef((e,s)=>{let{className:a,variant:l,size:n,...i}=e;return(0,t.jsx)(Y.b,{ref:s,className:(0,J.cn)(K({variant:l,size:n,className:a})),...i})}).displayName=Y.b.displayName;let Q=(0,H.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),X=l.createContext({size:"default",variant:"default"}),ee=l.forwardRef((e,s)=>{let{className:a,variant:l,size:n,children:i,...r}=e;return(0,t.jsx)(O.bL,{ref:s,className:(0,J.cn)(Q({variant:l,className:a})),...r,children:(0,t.jsx)(X.Provider,{value:{variant:l,size:n},children:i})})});ee.displayName=O.bL.displayName;let es=l.forwardRef((e,s)=>{let{className:a,children:n,variant:i,size:r,...c}=e,d=l.useContext(X);return(0,t.jsx)(O.q7,{ref:s,className:(0,J.cn)(K({variant:d.variant||i,size:d.size||r}),a),...c,children:n})});es.displayName=O.q7.displayName;var ea=a(54165),et=a(66424),el=a(47262);function en(e){let{items:s,initialSelectedIds:a=[],onConfirm:n,trigger:i,title:r}=e,[c,d]=(0,l.useState)(!1),[o,m]=(0,l.useState)(""),[h,u]=(0,l.useState)(new Set(a));(0,l.useEffect)(()=>{c&&u(new Set(a))},[c,a]);let x=(0,l.useMemo)(()=>s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())),[s,o]),p=(e,s)=>{u(a=>{let t=new Set(a);return s?t.add(e):t.delete(e),t})};return(0,t.jsxs)(ea.lG,{open:c,onOpenChange:d,children:[(0,t.jsx)(ea.zM,{asChild:!0,children:i}),(0,t.jsxs)(ea.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(ea.c7,{children:(0,t.jsx)(ea.L3,{children:r})}),(0,t.jsx)(G.p,{placeholder:"Search...",value:o,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(et.F,{className:"flex-1 border rounded-md p-2",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(el.S,{id:"item-select-".concat(e.id),checked:h.has(e.id),onCheckedChange:s=>p(e.id,!!s)}),(0,t.jsx)(W.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(ea.Es,{className:"pt-4",children:[(0,t.jsx)(V.$,{variant:"ghost",onClick:()=>d(!1),children:"Cancel"}),(0,t.jsx)(V.$,{onClick:()=>{n(Array.from(h)),d(!1)},children:"Confirm"})]})]})]})}var ei=a(26126),er=a(59409),ec=a(87481),ed=a(90010),eo=a(83013),em=a(47906),eh=a(8643);let eu=[{name:"Home",component:c.A},{name:"Trees",component:d.A},{name:"Mountain",component:o.A},{name:"Castle",component:m.A},{name:"TowerControl",component:h.A},{name:"Tent",component:u.A},{name:"Waves",component:x.A},{name:"MapPin",component:p.A},{name:"Landmark",component:j.A},{name:"Skull",component:v.A}],ex=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function ep(e){let{maps:s,onMapsUpdate:a}=e,[n,i]=(0,l.useState)(!1),[r,c]=(0,l.useState)(""),[d,o]=(0,l.useState)(20),[m,h]=(0,l.useState)(null),[u,x]=(0,l.useState)(""),{toast:p}=(0,ec.dj)(),j=async()=>{if(!r.trim()||!d||d<=0)return void p({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name and radius."});try{let e=(0,P.Xk)(d),s={name:r.trim(),radius:d,tiles:e,paths:[]},t=await (0,R.Ys)(s);p({title:"Map Created",description:"'".concat(r,"' has been added.")}),c(""),o(20),a(t),i(!1)}catch(e){p({variant:"destructive",title:"Error",description:"Failed to create map."})}},v=e=>{h(e.id),x(e.name)},C=()=>{h(null),x("")},k=async()=>{if(!m||!u.trim())return;let e=s.find(e=>e.id===m);if(e)try{await (0,R.cA)({...e,name:u.trim()}),p({title:"Map Renamed"}),a(),C()}catch(e){p({variant:"destructive",title:"Error",description:"Failed to rename map."})}},S=async e=>{try{await (0,R.GY)(e),p({title:"Map Deleted"}),a()}catch(e){p({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(ea.lG,{open:n,onOpenChange:i,children:[(0,t.jsx)(ea.zM,{asChild:!0,children:(0,t.jsx)(V.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(f.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(ea.Cf,{children:[(0,t.jsxs)(ea.c7,{children:[(0,t.jsx)(ea.L3,{children:"Manage Maps"}),(0,t.jsx)(ea.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"flex items-end gap-2 p-3 border rounded-md",children:[(0,t.jsxs)("div",{className:"grid gap-2 flex-1",children:[(0,t.jsx)(W.J,{children:"New Map"}),(0,t.jsx)(G.p,{placeholder:"New map name...",value:r,onChange:e=>c(e.target.value)}),(0,t.jsx)(G.p,{placeholder:"Radius",type:"number",value:d,onChange:e=>o(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(V.$,{onClick:j,disabled:!r.trim()||!d||d<=0,children:[(0,t.jsx)(g.A,{className:"h-4 w-4"})," Add"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:m===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G.p,{value:u,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&k()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(V.$,{size:"icon",className:"h-7 w-7",onClick:k,"aria-label":"Save",children:(0,t.jsx)(N.A,{className:"h-4 w-4"})}),(0,t.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:C,"aria-label":"Cancel",children:(0,t.jsx)(w.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>v(e),"aria-label":"Edit",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})}),(0,t.jsxs)(ed.Lt,{children:[(0,t.jsx)(ed.tv,{asChild:!0,children:(0,t.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(y.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(ed.EO,{children:[(0,t.jsxs)(ed.wd,{children:[(0,t.jsx)(ed.r7,{children:"Are you sure?"}),(0,t.jsxs)(ed.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(ed.ck,{children:[(0,t.jsx)(ed.Zr,{children:"Cancel"}),(0,t.jsx)(ed.Rx,{onClick:()=>S(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function ej(){let[e,s]=(0,l.useState)([]),[a,c]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[u,x]=(0,l.useState)(null),[j,v]=(0,l.useState)("settings"),[f,g]=(0,l.useState)("brush"),[N,b]=(0,l.useState)("#8A2BE2"),[y,I]=(0,l.useState)(null),[$,L]=(0,l.useState)(null),[O,H]=(0,l.useState)("#E0D6F0"),[Y,K]=(0,l.useState)(!0),[Q,X]=(0,l.useState)("#E0D6F0"),[ea,et]=(0,l.useState)([]),[el,ed]=(0,l.useState)([]),[ej,ef]=(0,l.useState)([]),[eg,eN]=(0,l.useState)(!1),[ew,eb]=(0,l.useState)(!1),[ey,eC]=(0,l.useState)(!1),[ek,eS]=(0,l.useState)(!1),{toast:eA}=(0,ec.dj)(),eE=(0,em.a)(),[eF,eM]=(0,l.useState)(!0);(0,l.useEffect)(()=>{eM(!eE)},[eE]),(0,l.useEffect)(()=>{let e=e=>{"Control"===e.key&&eN(!0),"Alt"===e.key&&(e.preventDefault(),eb(!0)),"Shift"===e.key&&eC(!0)},s=e=>{"Control"===e.key&&eN(!1),"Alt"===e.key&&eb(!1),"Shift"===e.key&&eC(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[]);let ez=(0,l.useCallback)(async e=>{let t=(await (0,R.xW)()).sort((e,s)=>e.name.localeCompare(s.name));if(s(t),e)return void c(e);a&&!t.some(e=>e.id===a)?c(t.length>0?t[0].id:null):!a&&t.length>0?c(t[0].id):0===t.length&&(c(null),o(null))},[a]);(0,l.useEffect)(()=>{ez(),(0,R.J0)().then(et),(0,R.vq)().then(ed),(0,R.bj)().then(ef)},[]),(0,l.useEffect)(()=>{a?((0,R.zU)(a).then(e=>{e&&o(e)}),x(null),L(null)):o(null)},[a]),(0,l.useEffect)(()=>{d?h({name:d.name,radius:String(d.radius)}):h(null)},[d]);let eD=e=>{let s=parseInt((e=e.replace("#","")).substring(0,2),16),a=parseInt(e.substring(2,4),16);return(.2126*s+.7152*a+.0722*parseInt(e.substring(4,6),16))/255};(0,l.useEffect)(()=>{Y?X(eD(N)>.5?"#000000":"#FFFFFF"):X(O)},[Y,N,O]);let eI=(0,l.useCallback)(e=>{o(e),(0,R.cA)(e).catch(()=>{eA({variant:"destructive",title:"Auto-save failed."})})},[eA]),e$=(0,l.useCallback)(e=>{d&&eI({...d,tiles:e})},[d,eI]),eP=(e,s)=>{if(d){let a=d.tiles.map(a=>a.hex.q===e.q&&a.hex.r===e.r?{...a,data:{...a.data,...s}}:a);eI({...d,tiles:a})}},eR=(0,l.useCallback)(e=>{d&&eI({...d,paths:e})},[d,eI]),eL=(0,l.useCallback)(e=>{d&&$&&eR((d.paths||[]).map(s=>s.id===$?{...s,points:[...s.points,e]}:s))},[d,$,eR]),eJ=async()=>{if(!d||!m)return;let e=Number(m.radius);if(!m.name.trim())return void eA({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if(isNaN(e)||e<=0||e>100)return void eA({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});let a=(0,P.YS)(d.tiles,e),t={...d,name:m.name,radius:e,tiles:a};try{await (0,R.cA)(t),o(t),s(e=>e.map(e=>e.id===t.id?{...e,name:t.name}:e)),eA({title:"Map settings saved!"})}catch(e){eA({variant:"destructive",title:"Save failed"})}},eT="erase"===f,eB=(0,l.useMemo)(()=>null==d?void 0:d.tiles.find(e=>e.hex.q===(null==u?void 0:u.q)&&e.hex.r===(null==u?void 0:u.r)),[d,u]),eq=(0,l.useMemo)(()=>new Map(ea.map(e=>[e.id,e])),[ea]),eU=(0,l.useMemo)(()=>new Map(el.map(e=>[e.id,e])),[el]),eW=(0,l.useMemo)(()=>eB&&d?ej.filter(e=>e.location&&e.location.mapId===d.id&&e.location.hex.q===eB.hex.q&&e.location.hex.r===eB.hex.r&&e.location.hex.s===eB.hex.s):[],[eB,d,ej]);return(0,t.jsx)(n.A,{children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[d?(0,t.jsx)(i.A,{mapData:d,hexSize:25,className:(0,J.cn)("w-full h-full",(ek||ew&&"paint"===j&&"brush"===f)&&"cursor-crosshair"),style:{touchAction:"none"},onGridUpdate:e$,onHexClick:x,onAddPointToPath:eL,activeTool:j,paintMode:f,paintColor:N,paintIcon:y,paintIconColor:Q,selectedHex:u,isCtrlPressed:eg,isAltPressed:ew,isShiftPressed:ey,isEyedropperActive:ek,onEyedropperClick:e=>{if(!d)return;let s=d.tiles.find(s=>s.hex.q===e.q&&s.hex.r===e.r);s&&(b(s.data.color||"#8A2BE2"),I(s.data.icon||null),s.data.iconColor&&(H(s.data.iconColor),K(!1))),eS(!1),eA({title:"Tile properties copied to brush."})},pathDrawingId:$}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(eh.Nt,{open:!eE||eF,onOpenChange:eE?eM:void 0,className:(0,J.cn)("fixed z-10 w-80 shadow-lg top-20 left-4"),children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(r.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),eE&&(0,t.jsx)(eh.R6,{asChild:!0,children:(0,t.jsxs)(V.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(C.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(eh.Ke,{children:(0,t.jsx)(r.Wu,{children:(0,t.jsxs)(T,{value:j,onValueChange:e=>v(e),className:"w-full",children:[(0,t.jsxs)(B,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(q,{value:"settings",children:"Settings"}),(0,t.jsx)(q,{value:"paint",children:"Paint"}),(0,t.jsx)(q,{value:"path",children:"Path"}),(0,t.jsx)(q,{value:"data",children:"Data"})]}),(0,t.jsxs)(U,{value:"settings",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(er.l6,{value:a||"",onValueChange:c,children:[(0,t.jsx)(er.bq,{className:"flex-1",children:(0,t.jsx)(er.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(er.gC,{children:e.map(e=>(0,t.jsx)(er.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(ep,{maps:e,onMapsUpdate:e=>{ez(e)}})]})]}),(0,t.jsx)(Z.w,{}),d&&m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(G.p,{id:"map-name",value:m.name,onChange:e=>h(s=>s?{...s,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(G.p,{id:"map-radius",type:"number",value:m.radius,onChange:e=>h(s=>s?{...s,radius:e.target.value}:null),min:"1",max:"100"})]}),(0,t.jsx)(V.$,{onClick:eJ,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]}),(0,t.jsx)(U,{value:"paint",className:"mt-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.J,{children:"Paint Mode"}),(0,t.jsxs)(ee,{type:"single",value:ey&&"brush"===f?"erase":eg&&"brush"===f?"bucket":f,onValueChange:e=>{e&&g(e)},className:"w-full",children:[(0,t.jsxs)(es,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(es,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(es,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("fieldset",{disabled:eT||ek,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(G.p,{id:"color-picker",type:"color",value:N,onChange:e=>b(e.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(W.J,{children:"Terrain Colors"}),(0,t.jsx)(_.Bc,{children:(0,t.jsxs)(_.m_,{children:[(0,t.jsx)(_.k$,{asChild:!0,children:(0,t.jsx)(V.$,{variant:ek?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>eS(e=>!e),children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})}),(0,t.jsx)(_.ZI,{children:(0,t.jsx)("p",{children:"Pick Tile Properties (or hold Alt)"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ex.map(e=>{let{name:s,color:a}=e;return(0,t.jsxs)(V.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>b(a),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:a}}),(0,t.jsx)("span",{className:"ml-2",children:s})]},s)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(W.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!Y&&(0,t.jsx)(_.Bc,{children:(0,t.jsxs)(_.m_,{children:[(0,t.jsx)(_.k$,{asChild:!0,children:(0,t.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>K(!0),children:(0,t.jsx)(F.A,{className:"h-4 w-4"})})}),(0,t.jsx)(_.ZI,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(G.p,{id:"icon-color-picker",type:"color",value:O,onChange:e=>{H(e.target.value),K(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:eu.map(e=>{let{name:s,component:a}=e;return(0,t.jsx)(V.$,{variant:"outline",size:"icon",onClick:()=>I(e=>e===s?null:s),className:(0,J.cn)(y===s&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(a,{className:"h-5 w-5"})},s)})}),y&&(0,t.jsxs)(V.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>I(null),children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}),(0,t.jsx)(U,{value:"path",className:"mt-4",children:(0,t.jsx)(ev,{activeMap:d,onPathUpdate:eR,pathDrawingId:$,setPathDrawingId:L})}),(0,t.jsx)(U,{value:"data",className:"mt-4",children:u&&eB?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",u.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",u.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",u.s]})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(W.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(en,{title:"Link Dungeons",items:ea,initialSelectedIds:eB.data.dungeonIds||[],onConfirm:e=>eP(u,{dungeonIds:e}),trigger:(0,t.jsx)(V.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eB.data.dungeonIds||[]).map(e=>{var s;return(0,t.jsx)(ei.E,{variant:"secondary",children:null==(s=eq.get(e))?void 0:s.name},e)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(W.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(en,{title:"Link Factions",items:el,initialSelectedIds:eB.data.factionIds||[],onConfirm:e=>eP(u,{factionIds:e}),trigger:(0,t.jsx)(V.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eB.data.factionIds||[]).map(e=>{var s;return(0,t.jsx)(ei.E,{variant:"secondary",children:null==(s=eU.get(e))?void 0:s.name},e)})})]}),(0,t.jsx)(Z.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(W.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(D.A,{className:"h-4 w-4"}),"Events"]}),eW.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:eW.map(e=>(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,eo.GP)(new Date(e.startDate),"P")," - ",(0,eo.GP)(new Date(e.endDate),"P")]})]},e.id))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."})})]})})})]})})]})})}function ev(e){let{activeMap:s,onPathUpdate:a,pathDrawingId:l,setPathDrawingId:n}=e,i=(e,t)=>{a(((null==s?void 0:s.paths)||[]).map(s=>s.id===e?{...s,...t}:s))},r=e=>{l===e&&n(null),a(((null==s?void 0:s.paths)||[]).filter(s=>s.id!==e))},c=e=>{a(((null==s?void 0:s.paths)||[]).map(s=>s.id===e?{...s,points:s.points.slice(0,-1)}:s))};return s?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(V.$,{onClick:()=>{let e={id:crypto.randomUUID(),name:"Path ".concat(((null==s?void 0:s.paths)||[]).length+1),color:"#FFD700",strokeWidth:3,points:[]};a([e,...(null==s?void 0:s.paths)||[]]),n(e.id)},className:"w-full",children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Add New Path"]}),(0,t.jsx)(Z.w,{}),(0,t.jsx)(et.F,{className:"h-96",children:(0,t.jsx)("div",{className:"space-y-3 pr-2",children:(s.paths||[]).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-md bg-muted/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(G.p,{value:e.name,onChange:s=>i(e.id,{name:s.target.value}),className:"h-8 flex-1"}),(0,t.jsxs)(ed.Lt,{children:[(0,t.jsx)(ed.tv,{asChild:!0,children:(0,t.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(ed.EO,{children:[(0,t.jsxs)(ed.wd,{children:[(0,t.jsx)(ed.r7,{children:"Delete Path?"}),(0,t.jsxs)(ed.$v,{children:['Are you sure you want to delete "',e.name,'"? This cannot be undone.']})]}),(0,t.jsxs)(ed.ck,{children:[(0,t.jsx)(ed.Zr,{children:"Cancel"}),(0,t.jsx)(ed.Rx,{onClick:()=>r(e.id),className:"bg-destructive",children:"Delete"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.J,{children:"Color:"}),(0,t.jsx)(G.p,{type:"color",value:e.color,onChange:s=>i(e.id,{color:s.target.value}),className:"h-8 w-16 p-1"}),(0,t.jsx)(W.J,{children:"Width:"}),(0,t.jsx)(G.p,{type:"number",value:e.strokeWidth,min:"1",max:"20",onChange:s=>i(e.id,{strokeWidth:parseInt(s.target.value,10)||1}),className:"h-8 flex-1"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(V.$,{variant:l===e.id?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>n(s=>s===e.id?null:e.id),children:[l===e.id?(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(I.A,{className:"h-4 w-4 mr-2"}),l===e.id?"Drawing...":"Draw Path"]}),(0,t.jsx)(V.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>c(e.id),disabled:0===e.points.length,"aria-label":"Remove last point",children:(0,t.jsx)($.A,{className:"h-4 w-4"})})]})]},e.id))})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to manage paths."})}}}]);
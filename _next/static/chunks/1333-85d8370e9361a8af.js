"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1333],{31333:(e,a,s)=>{s.r(a),s.d(a,{default:()=>eC});var t=s(95155),i=s(12115),l=s(46855),n=s(19209),r=s(66695),d=s(18186),c=s(68715),o=s(66049),h=s(57946),m=s(23767),u=s(20427),x=s(43152),p=s(83662),j=s(55166),f=s(82643),v=s(86950),g=s(56013),N=s(18046),w=s(10518),b=s(25318),y=s(18763),C=s(77223),k=s(21887),S=s(10366),A=s(10947),I=s(47326),F=s(17657),E=s(11133),z=s(86318),M=s(50286),q=s(51920),D=s(52354),P=s(47219),R=s(7146),$=s(53648),J=s(60704),L=s(59434);let V=J.bL,T=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(J.B8,{ref:a,className:(0,L.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i})});T.displayName=J.B8.displayName;let B=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(J.l9,{ref:a,className:(0,L.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i})});B.displayName=J.l9.displayName;let W=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(J.UC,{ref:a,className:(0,L.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i})});W.displayName=J.UC.displayName;var U=s(85057),H=s(62523),G=s(30285),O=s(22346),Z=s(78082);let _=Z.Kq,K=Z.bL,Y=Z.l9,Q=i.forwardRef((e,a)=>{let{className:s,sideOffset:i=4,...l}=e;return(0,t.jsx)(Z.UC,{ref:a,sideOffset:i,className:(0,L.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});Q.displayName=Z.UC.displayName;var X=s(49864),ee=s(74466),ea=s(124);let es=(0,ee.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});i.forwardRef((e,a)=>{let{className:s,variant:i,size:l,...n}=e;return(0,t.jsx)(ea.b,{ref:a,className:(0,L.cn)(es({variant:i,size:l,className:s})),...n})}).displayName=ea.b.displayName;let et=(0,ee.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),ei=i.createContext({size:"default",variant:"default"}),el=i.forwardRef((e,a)=>{let{className:s,variant:i,size:l,children:n,...r}=e;return(0,t.jsx)(X.bL,{ref:a,className:(0,L.cn)(et({variant:i,className:s})),...r,children:(0,t.jsx)(ei.Provider,{value:{variant:i,size:l},children:n})})});el.displayName=X.bL.displayName;let en=i.forwardRef((e,a)=>{let{className:s,children:l,variant:n,size:r,...d}=e,c=i.useContext(ei);return(0,t.jsx)(X.q7,{ref:a,className:(0,L.cn)(es({variant:c.variant||n,size:c.size||r}),s),...d,children:l})});en.displayName=X.q7.displayName;var er=s(31841),ed=s(26126),ec=s(54165),eo=s(59409),eh=s(87481),em=s(90010),eu=s(83013),ex=s(47906),ep=s(8643),ej=s(66424),ef=s(54059),ev=s(70154);let eg=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(ef.bL,{className:(0,L.cn)("grid gap-2",s),...i,ref:a})});eg.displayName=ef.bL.displayName;let eN=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(ef.q7,{ref:a,className:(0,L.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...i,children:(0,t.jsx)(ef.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(ev.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});eN.displayName=ef.q7.displayName;let ew=[{name:"Home",component:d.A},{name:"Trees",component:c.A},{name:"Mountain",component:o.A},{name:"Castle",component:h.A},{name:"TowerControl",component:m.A},{name:"Tent",component:u.A},{name:"Waves",component:x.A},{name:"MapPin",component:p.A},{name:"Landmark",component:j.A},{name:"Skull",component:f.A},{name:"Building",component:v.A}],eb=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function ey(e){let{maps:a,onMapsUpdate:s}=e,[l,n]=(0,i.useState)(!1),[r,d]=(0,i.useState)(""),[c,o]=(0,i.useState)("radial"),[h,m]=(0,i.useState)(20),[u,x]=(0,i.useState)(30),[p,j]=(0,i.useState)(20),[f,v]=(0,i.useState)(null),[k,S]=(0,i.useState)(""),{toast:A}=(0,eh.dj)(),I=async()=>{let e,a;if(!r.trim())return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name."});if("radial"===c){if(!h||h<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid radius."});e=(0,R.Xk)(h),a={name:r.trim(),shape:"radial",radius:h,tiles:e,paths:[]}}else{if(!u||u<=0||!p||p<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide valid width and height."});e=(0,R.z0)(u,p),a={name:r.trim(),shape:"rectangular",width:u,height:p,tiles:e,paths:[]}}try{let e=await (0,$.Ys)(a);A({title:"Map Created",description:"'".concat(r,"' has been added.")}),d(""),m(20),x(30),j(20),s(e),n(!1)}catch(e){A({variant:"destructive",title:"Error",description:"Failed to create map."})}},F=e=>{v(e.id),S(e.name)},E=()=>{v(null),S("")},z=async()=>{if(!f||!k.trim())return;let e=a.find(e=>e.id===f);if(e)try{await (0,$.cA)({...e,name:k.trim()}),A({title:"Map Renamed"}),s(),E()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to rename map."})}},M=async e=>{try{await (0,$.GY)(e),A({title:"Map Deleted"}),s()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(ec.lG,{open:l,onOpenChange:n,children:[(0,t.jsx)(ec.zM,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(g.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(ec.Cf,{children:[(0,t.jsxs)(ec.c7,{children:[(0,t.jsx)(ec.L3,{children:"Manage Maps"}),(0,t.jsx)(ec.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-4 p-3 border rounded-md",children:[(0,t.jsx)(U.J,{children:"New Map"}),(0,t.jsx)(H.p,{placeholder:"New map name...",value:r,onChange:e=>d(e.target.value)}),(0,t.jsxs)(eg,{value:c,onValueChange:e=>o(e),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eN,{value:"radial",id:"radial"}),(0,t.jsx)(U.J,{htmlFor:"radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eN,{value:"rectangular",id:"rectangular"}),(0,t.jsx)(U.J,{htmlFor:"rectangular",children:"Rectangular"})]})]}),"radial"===c?(0,t.jsx)(H.p,{placeholder:"Radius",type:"number",value:h,onChange:e=>m(parseInt(e.target.value,10)||0)}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(H.p,{placeholder:"Width",type:"number",value:u,onChange:e=>x(parseInt(e.target.value,10)||0)}),(0,t.jsx)(H.p,{placeholder:"Height",type:"number",value:p,onChange:e=>j(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(G.$,{onClick:I,className:"w-full",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"})," Add Map"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:f===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.p,{value:k,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key&&z()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(G.$,{size:"icon",className:"h-7 w-7",onClick:z,"aria-label":"Save",children:(0,t.jsx)(w.A,{className:"h-4 w-4"})}),(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:E,"aria-label":"Cancel",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>F(e),"aria-label":"Edit",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})}),(0,t.jsxs)(em.Lt,{children:[(0,t.jsx)(em.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(C.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(em.EO,{children:[(0,t.jsxs)(em.wd,{children:[(0,t.jsx)(em.r7,{children:"Are you sure?"}),(0,t.jsxs)(em.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(em.ck,{children:[(0,t.jsx)(em.Zr,{children:"Cancel"}),(0,t.jsx)(em.Rx,{onClick:()=>M(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function eC(){let[e,a]=(0,i.useState)([]),[s,d]=(0,i.useState)(null),[c,o]=(0,i.useState)(null),[h,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),[j,f]=(0,i.useState)("settings"),[g,N]=(0,i.useState)("brush"),[w,y]=(0,i.useState)("#8A2BE2"),[C,D]=(0,i.useState)(null),[P,J]=(0,i.useState)(null),[Z,X]=(0,i.useState)("#E0D6F0"),[ee,ea]=(0,i.useState)(!0),[es,et]=(0,i.useState)("#E0D6F0"),[ei,ec]=(0,i.useState)([]),[em,ej]=(0,i.useState)([]),[ef,ev]=(0,i.useState)([]),[eC,eS]=(0,i.useState)([]),[eA,eI]=(0,i.useState)(!1),[eF,eE]=(0,i.useState)(!1),[ez,eM]=(0,i.useState)(!1),[eq,eD]=(0,i.useState)(!1),{toast:eP}=(0,eh.dj)(),eR=(0,ex.a)(),[e$,eJ]=(0,i.useState)(!0);(0,i.useEffect)(()=>{eJ(!eR)},[eR]),(0,i.useEffect)(()=>{let e=e=>{"Control"===e.key&&eI(!0),"Alt"===e.key&&(e.preventDefault(),eE(!0)),"Shift"===e.key&&eM(!0)},a=e=>{"Control"===e.key&&eI(!1),"Alt"===e.key&&eE(!1),"Shift"===e.key&&eM(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]);let eL=(0,i.useCallback)(async e=>{let t=(await (0,$.xW)()).sort((e,a)=>e.name.localeCompare(a.name));if(a(t),e)return void d(e);s&&!t.some(e=>e.id===s)?d(t.length>0?t[0].id:null):!s&&t.length>0?d(t[0].id):0===t.length&&(d(null),o(null))},[s]);(0,i.useEffect)(()=>{eL(),(0,$.J0)().then(ec),(0,$.vq)().then(ej),(0,$.bj)().then(ev),(0,$.HV)().then(eS)},[]),(0,i.useEffect)(()=>{s?((0,$.zU)(s).then(e=>{e&&o(e)}),x(null),J(null)):o(null)},[s]),(0,i.useEffect)(()=>{c?m({name:c.name,shape:c.shape||"radial",radius:c.radius||20,width:c.width||30,height:c.height||20}):m(null)},[c]);let eV=e=>{let a=parseInt((e=e.replace("#","")).substring(0,2),16),s=parseInt(e.substring(2,4),16);return(.2126*a+.7152*s+.0722*parseInt(e.substring(4,6),16))/255};(0,i.useEffect)(()=>{ee?et(eV(w)>.5?"#000000":"#FFFFFF"):et(Z)},[ee,w,Z]);let eT=(0,i.useCallback)(e=>{o(e),(0,$.cA)(e).catch(()=>{eP({variant:"destructive",title:"Auto-save failed."})})},[eP]),eB=(0,i.useCallback)(e=>{c&&eT({...c,tiles:e})},[c,eT]),eW=(0,i.useCallback)(async(e,a)=>{if(!c)return;let s=c.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);if(!s)return;let t=new Set(s.data.cityIds||[]),i=new Set(a),l=a.filter(e=>!t.has(e)),n=Array.from(t).filter(e=>!i.has(e)),r=[],d=new Map;for(let e of n){let a=eC.find(a=>a.id===e);a&&r.push((0,$.b4)({...a,location:void 0}))}for(let a of l){let s=eC.find(e=>e.id===a);if(s){if(s.location&&s.location.mapId===c.id){let e="".concat(s.location.hex.q,",").concat(s.location.hex.r);if(!d.has(e)){let a=c.tiles.find(e=>e.hex.q===s.location.hex.q&&e.hex.r===s.location.hex.r);d.set(e,{q:s.location.hex.q,r:s.location.hex.r,cityIds:(null==a?void 0:a.data.cityIds)||[]})}let t=d.get(e);t.cityIds=t.cityIds.filter(e=>e!==a)}r.push((0,$.b4)({...s,location:{mapId:c.id,hex:e}}))}}let o="".concat(e.q,",").concat(e.r);d.has(o)||d.set(o,{q:e.q,r:e.r,cityIds:s.data.cityIds||[]}),d.get(o).cityIds=a;let h=c.tiles.map(e=>{let a="".concat(e.hex.q,",").concat(e.hex.r);return d.has(a)?{...e,data:{...e.data,cityIds:d.get(a).cityIds}}:e});await Promise.all(r),eT({...c,tiles:h}),(0,$.HV)().then(eS)},[c,eC,eT,eP]),eU=(e,a)=>{if(c){let s=c.tiles.map(s=>s.hex.q===e.q&&s.hex.r===e.r?{...s,data:{...s.data,...a}}:s);eT({...c,tiles:s})}},eH=(0,i.useCallback)(e=>{c&&eT({...c,paths:e})},[c,eT]),eG=(0,i.useCallback)(e=>{c&&P&&eH((c.paths||[]).map(a=>a.id===P?{...a,points:[...a.points,e]}:a))},[c,P,eH]),eO=async()=>{let e,s;if(c&&h){if(!h.name.trim())return void eP({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if("radial"===h.shape){if(isNaN(h.radius)||h.radius<=0||h.radius>100)return void eP({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});e=(0,R.YS)(c.tiles,h.radius),s={...c,name:h.name,shape:"radial",radius:h.radius,width:void 0,height:void 0,tiles:e}}else{if(isNaN(h.width)||h.width<=0||h.width>200||isNaN(h.height)||h.height<=0||h.height>200)return void eP({variant:"destructive",title:"Validation Error",description:"Width and Height must be between 1 and 200."});e=(0,R.z0)(h.width,h.height,c.tiles),s={...c,name:h.name,shape:"rectangular",width:h.width,height:h.height,radius:void 0,tiles:e}}try{await (0,$.cA)(s),o(s),a(e=>e.map(e=>e.id===s.id?{...e,name:s.name}:e)),eP({title:"Map settings saved!"})}catch(e){eP({variant:"destructive",title:"Save failed"})}}},eZ="erase"===g,e_=(0,i.useMemo)(()=>null==c?void 0:c.tiles.find(e=>e.hex.q===(null==u?void 0:u.q)&&e.hex.r===(null==u?void 0:u.r)),[c,u]),eK=(0,i.useMemo)(()=>new Map(ei.map(e=>[e.id,e])),[ei]),eY=(0,i.useMemo)(()=>new Map(em.map(e=>[e.id,e])),[em]),eQ=(0,i.useMemo)(()=>new Map(eC.map(e=>[e.id,e])),[eC]),eX=(0,i.useMemo)(()=>e_&&c?ef.filter(e=>e.location&&e.location.mapId===c.id&&e.location.hex.q===e_.hex.q&&e.location.hex.r===e_.hex.r&&e.location.hex.s===e_.hex.s):[],[e_,c,ef]);return(0,t.jsx)(l.A,{children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[c?(0,t.jsx)(n.A,{mapData:c,hexSize:25,className:(0,L.cn)("w-full h-full",(eq||eF&&"paint"===j&&"brush"===g)&&"cursor-crosshair"),style:{touchAction:"none"},onGridUpdate:eB,onHexClick:x,onAddPointToPath:eG,activeTool:j,paintMode:g,paintColor:w,paintIcon:C,paintIconColor:es,selectedHex:u,isCtrlPressed:eA,isAltPressed:eF,isShiftPressed:ez,isEyedropperActive:eq,onEyedropperClick:e=>{if(!c)return;let a=c.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);a&&(y(a.data.color||"#8A2BE2"),D(a.data.icon||null),a.data.iconColor&&(X(a.data.iconColor),ea(!1))),eD(!1),eP({title:"Tile properties copied to brush."})},pathDrawingId:P}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(ep.Nt,{open:!eR||e$,onOpenChange:eR?eJ:void 0,className:(0,L.cn)("fixed z-10 w-80 shadow-lg top-20 left-4"),children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(r.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),eR&&(0,t.jsx)(ep.R6,{asChild:!0,children:(0,t.jsxs)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(k.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(ep.Ke,{children:(0,t.jsx)(r.Wu,{children:(0,t.jsxs)(V,{value:j,onValueChange:e=>f(e),className:"w-full",children:[(0,t.jsxs)(T,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(B,{value:"settings",children:"Settings"}),(0,t.jsx)(B,{value:"paint",children:"Paint"}),(0,t.jsx)(B,{value:"path",children:"Path"}),(0,t.jsx)(B,{value:"data",children:"Data"})]}),(0,t.jsxs)(W,{value:"settings",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(eo.l6,{value:s||"",onValueChange:d,children:[(0,t.jsx)(eo.bq,{className:"flex-1",children:(0,t.jsx)(eo.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(eo.gC,{children:e.map(e=>(0,t.jsx)(eo.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(ey,{maps:e,onMapsUpdate:e=>{eL(e)}})]})]}),(0,t.jsx)(O.w,{}),c&&h?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(H.p,{id:"map-name",value:h.name,onChange:e=>m(a=>a?{...a,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{children:"Shape"}),(0,t.jsxs)(eg,{value:h.shape,onValueChange:e=>m(a=>a?{...a,shape:e}:null),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eN,{value:"radial",id:"edit-radial"}),(0,t.jsx)(U.J,{htmlFor:"edit-radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eN,{value:"rectangular",id:"edit-rectangular"}),(0,t.jsx)(U.J,{htmlFor:"edit-rectangular",children:"Rectangular"})]})]})]}),"radial"===h.shape?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(H.p,{id:"map-radius",type:"number",value:h.radius,onChange:e=>m(a=>a?{...a,radius:parseInt(e.target.value)||0}:null),min:"1",max:"100"})]}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{htmlFor:"map-width",children:"Width"}),(0,t.jsx)(H.p,{id:"map-width",type:"number",value:h.width,onChange:e=>m(a=>a?{...a,width:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{htmlFor:"map-height",children:"Height"}),(0,t.jsx)(H.p,{id:"map-height",type:"number",value:h.height,onChange:e=>m(a=>a?{...a,height:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]})]}),(0,t.jsx)(G.$,{onClick:eO,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]}),(0,t.jsx)(W,{value:"paint",className:"mt-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{children:"Paint Mode"}),(0,t.jsxs)(el,{type:"single",value:ez&&"brush"===g?"erase":eA&&"brush"===g?"bucket":g,onValueChange:e=>{e&&N(e)},className:"w-full",children:[(0,t.jsxs)(en,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(en,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(en,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(I.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("fieldset",{disabled:eZ||eq,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(U.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(H.p,{id:"color-picker",type:"color",value:w,onChange:e=>y(e.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(U.J,{children:"Terrain Colors"}),(0,t.jsx)(_,{children:(0,t.jsxs)(K,{children:[(0,t.jsx)(Y,{asChild:!0,children:(0,t.jsx)(G.$,{variant:eq?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>eD(e=>!e),children:(0,t.jsx)(F.A,{className:"h-4 w-4"})})}),(0,t.jsx)(Q,{children:(0,t.jsx)("p",{children:"Pick Tile Properties (or hold Alt)"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:eb.map(e=>{let{name:a,color:s}=e;return(0,t.jsxs)(G.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>y(s),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:s}}),(0,t.jsx)("span",{className:"ml-2",children:a})]},a)})})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(U.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!ee&&(0,t.jsx)(_,{children:(0,t.jsxs)(K,{children:[(0,t.jsx)(Y,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ea(!0),children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})}),(0,t.jsx)(Q,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(H.p,{id:"icon-color-picker",type:"color",value:Z,onChange:e=>{X(e.target.value),ea(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:ew.map(e=>{let{name:a,component:s}=e;return(0,t.jsx)(G.$,{variant:"outline",size:"icon",onClick:()=>D(e=>e===a?null:a),className:(0,L.cn)(C===a&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(s,{className:"h-5 w-5"})},a)})}),C&&(0,t.jsxs)(G.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>D(null),children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}),(0,t.jsx)(W,{value:"path",className:"mt-4",children:(0,t.jsx)(ek,{activeMap:c,onPathUpdate:eH,pathDrawingId:P,setPathDrawingId:J})}),(0,t.jsx)(W,{value:"data",className:"mt-4",children:u&&e_?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",u.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",u.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",u.s]})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(U.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),"Cities"]}),(0,t.jsx)(er.V,{title:"Link Cities",items:eC,initialSelectedIds:e_.data.cityIds||[],onConfirm:e=>eW(u,e),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(z.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(e_.data.cityIds||[]).map(e=>{var a;return(0,t.jsx)(ed.E,{variant:"secondary",children:null==(a=eQ.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(U.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(er.V,{title:"Link Dungeons",items:ei,initialSelectedIds:e_.data.dungeonIds||[],onConfirm:e=>eU(u,{dungeonIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(z.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(e_.data.dungeonIds||[]).map(e=>{var a;return(0,t.jsx)(ed.E,{variant:"secondary",children:null==(a=eK.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(U.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(M.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(er.V,{title:"Link Factions",items:em,initialSelectedIds:e_.data.factionIds||[],onConfirm:e=>eU(u,{factionIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(z.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(e_.data.factionIds||[]).map(e=>{var a;return(0,t.jsx)(ed.E,{variant:"secondary",children:null==(a=eY.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(O.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(U.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(q.A,{className:"h-4 w-4"}),"Events"]}),eX.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:eX.map(e=>(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,eu.GP)(new Date(e.startDate),"P")," - ",(0,eu.GP)(new Date(e.endDate),"P")]})]},e.id))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."})})]})})})]})})]})})}function ek(e){let{activeMap:a,onPathUpdate:s,pathDrawingId:i,setPathDrawingId:l}=e,n=(e,t)=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,...t}:a))},r=e=>{i===e&&l(null),s(((null==a?void 0:a.paths)||[]).filter(a=>a.id!==e))},d=e=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,points:a.points.slice(0,-1)}:a))};return a?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(G.$,{onClick:()=>{let e={id:crypto.randomUUID(),name:"Path ".concat(((null==a?void 0:a.paths)||[]).length+1),color:"#FFD700",strokeWidth:3,points:[]};s([e,...(null==a?void 0:a.paths)||[]]),l(e.id)},className:"w-full",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Add New Path"]}),(0,t.jsx)(O.w,{}),(0,t.jsx)(ej.F,{className:"h-96",children:(0,t.jsx)("div",{className:"space-y-3 pr-2",children:(a.paths||[]).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-md bg-muted/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(H.p,{value:e.name,onChange:a=>n(e.id,{name:a.target.value}),className:"h-8 flex-1"}),(0,t.jsxs)(em.Lt,{children:[(0,t.jsx)(em.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:(0,t.jsx)(C.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(em.EO,{children:[(0,t.jsxs)(em.wd,{children:[(0,t.jsx)(em.r7,{children:"Delete Path?"}),(0,t.jsxs)(em.$v,{children:['Are you sure you want to delete "',e.name,'"? This cannot be undone.']})]}),(0,t.jsxs)(em.ck,{children:[(0,t.jsx)(em.Zr,{children:"Cancel"}),(0,t.jsx)(em.Rx,{onClick:()=>r(e.id),className:"bg-destructive",children:"Delete"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(U.J,{children:"Color:"}),(0,t.jsx)(H.p,{type:"color",value:e.color,onChange:a=>n(e.id,{color:a.target.value}),className:"h-8 w-16 p-1"}),(0,t.jsx)(U.J,{children:"Width:"}),(0,t.jsx)(H.p,{type:"number",value:e.strokeWidth,min:"1",max:"20",onChange:a=>n(e.id,{strokeWidth:parseInt(a.target.value,10)||1}),className:"h-8 flex-1"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(G.$,{variant:i===e.id?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>l(a=>a===e.id?null:e.id),children:[i===e.id?(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2"}),i===e.id?"Drawing...":"Draw Path"]}),(0,t.jsx)(G.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>d(e.id),disabled:0===e.points.length,"aria-label":"Remove last point",children:(0,t.jsx)(P.A,{className:"h-4 w-4"})})]})]},e.id))})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to manage paths."})}},31841:(e,a,s)=>{s.d(a,{V:()=>h});var t=s(95155),i=s(12115),l=s(30285),n=s(54165),r=s(62523),d=s(66424),c=s(47262),o=s(85057);function h(e){let{items:a,initialSelectedIds:s=[],onConfirm:h,trigger:m,title:u}=e,[x,p]=(0,i.useState)(!1),[j,f]=(0,i.useState)(""),[v,g]=(0,i.useState)(new Set(s));(0,i.useEffect)(()=>{x&&g(new Set(s))},[x,s]);let N=(0,i.useMemo)(()=>a.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())),[a,j]),w=(e,a)=>{g(s=>{let t=new Set(s);return a?t.add(e):t.delete(e),t})};return(0,t.jsxs)(n.lG,{open:x,onOpenChange:p,children:[(0,t.jsx)(n.zM,{asChild:!0,children:m}),(0,t.jsxs)(n.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(n.c7,{children:(0,t.jsx)(n.L3,{children:u})}),(0,t.jsx)(r.p,{placeholder:"Search...",value:j,onChange:e=>f(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(d.F,{className:"flex-1 border rounded-md p-2",children:N.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(c.S,{id:"item-select-".concat(e.id),checked:v.has(e.id),onCheckedChange:a=>w(e.id,!!a)}),(0,t.jsx)(o.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(n.Es,{className:"pt-4",children:[(0,t.jsx)(l.$,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),(0,t.jsx)(l.$,{onClick:()=>{h(Array.from(v)),p(!1)},children:"Confirm"})]})]})]})}}}]);
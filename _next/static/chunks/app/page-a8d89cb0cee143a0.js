(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{49180:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ei});var i=t(95155),a=t(12115),l=t(38914),r=t(88972),n=t(30285),o=t(66695),c=t(22945),d=t(82643),u=t(40157);let p=(0,u.A)("BookCopy",[["path",{d:"M2 16V4a2 2 0 0 1 2-2h11",key:"spzkk5"}],["path",{d:"M22 18H11a2 2 0 1 0 0 4h10.5a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5H11a2 2 0 0 0-2 2v12",key:"1wz07i"}],["path",{d:"M5 14H4a2 2 0 1 0 0 4h1",key:"16gqf9"}]]);var h=t(21816),m=t(18051),g=t(91721),f=t(50286),x=t(45731),b=t(32137),j=t(98917),k=t(30990);let v=(0,u.A)("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);var y=t(51920),w=t(82489),L=t(88539),N=t(87481),C=t(62523);let S=()=>new Promise((e,s)=>{let t=indexedDB.open("TresspasserWorldsMetadata",1);t.onupgradeneeded=()=>{let e=t.result;e.objectStoreNames.contains(w.sb)||e.createObjectStore(w.sb,{keyPath:"slug"})},t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)});function A(){let{worldSlug:e,worldName:s,refreshWorldName:t}=(0,l.q)(),[u,A]=(0,a.useState)(null),[F,T]=(0,a.useState)(""),[E,P]=(0,a.useState)(""),[B,M]=(0,a.useState)(!1),{toast:D}=(0,N.dj)();(0,a.useEffect)(()=>{(async()=>{if(e)try{let t=(await S()).transaction(w.sb,"readonly").objectStore(w.sb).get(e);t.onsuccess=()=>{if(t.result)A(t.result),T(t.result.name),P(t.result.description);else{let t={slug:e,name:s,description:"A new world of adventure awaits..."};A(t),T(t.name),P(t.description)}},t.onerror=()=>{console.error("Error fetching world metadata:",t.error)}}catch(e){console.error("DB error:",e)}})()},[e,s]);let R=async()=>{if(e)try{let s=(await S()).transaction(w.sb,"readwrite"),i=s.objectStore(w.sb),a={slug:e,name:F,description:E};i.put(a),await new Promise((e,t)=>{s.oncomplete=()=>e(),s.onerror=()=>t(s.error)}),A(a),M(!1),t(),D({title:"World Updated",description:"Your world details have been saved."})}catch(e){D({variant:"destructive",title:"Error",description:"Failed to save world details."})}},W=[{title:"Alchemy",description:"Manage potions, powders, oils, and bombs.",icon:c.A,href:"/#/".concat(e,"/alchemy")},{title:"Bestiary",description:"Create, edit, and manage all the creatures for your game.",icon:d.A,href:"/#/".concat(e,"/bestiary")},{title:"Deeds Library",description:"A library of actions that creatures can perform.",icon:p,href:"/#/".concat(e,"/deeds")},{title:"Encounters",description:"Design and run combat encounters.",icon:h.A,href:"/#/".concat(e,"/encounters")},{title:"Items",description:"Catalog weapons, armor, and other equipment.",icon:m.A,href:"/#/".concat(e,"/items")},{title:"NPCs",description:"Create detailed Non-Player Characters.",icon:g.A,href:"/#/".concat(e,"/npcs")},{title:"Factions",description:"Manage the various factions in your world.",icon:f.A,href:"/#/".concat(e,"/factions")},{title:"Pantheon",description:"Manage the godlike entities of your world.",icon:x.A,href:"/#/".concat(e,"/pantheon")},{title:"Rooms",description:"Build a library of reusable rooms for dungeons.",icon:b.A,href:"/#/".concat(e,"/rooms")},{title:"Treasures",description:"Create a library of treasure items.",icon:j.A,href:"/#/".concat(e,"/random/treasures")},{title:"Encounter Tables",description:"Create weighted tables to randomly generate encounters.",icon:k.A,href:"/#/".concat(e,"/random/encounter-tables")},{title:"Commoners",description:"Instantly generate four random commoner PCs.",icon:k.A,href:"/#/".concat(e,"/random/commoners")},{title:"Dungeons",description:"Assemble your pre-defined rooms into complex dungeons.",icon:k.A,href:"/#/".concat(e,"/dungeons")},{title:"World Map",description:"A powerful hex-grid map creator.",icon:v,href:"/#/".concat(e,"/maps")},{title:"Calendar",description:"A fully-featured in-game calendar.",icon:y.A,href:"/#/".concat(e,"/calendar")}].sort((e,s)=>e.title.localeCompare(s.title));return(0,i.jsx)(r.A,{showSidebarTrigger:!1,children:(0,i.jsx)("div",{className:"h-full overflow-y-auto bg-background/50",children:(0,i.jsxs)("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"text-center",children:B?(0,i.jsxs)("div",{className:"max-w-xl mx-auto space-y-4",children:[(0,i.jsx)(C.p,{value:F,onChange:e=>T(e.target.value),className:"text-4xl font-extrabold tracking-tight text-primary-foreground sm:text-5xl md:text-6xl text-center h-auto bg-transparent border-primary"}),(0,i.jsx)(L.T,{value:E,onChange:e=>P(e.target.value),className:"mt-3 text-lg text-muted-foreground sm:text-xl md:mt-5 bg-transparent",rows:3}),(0,i.jsxs)("div",{className:"flex justify-center gap-2 mt-4",children:[(0,i.jsx)(n.$,{onClick:R,children:"Save"}),(0,i.jsx)(n.$,{variant:"ghost",onClick:()=>M(!1),children:"Cancel"})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{className:"text-4xl font-extrabold tracking-tight text-primary-foreground sm:text-5xl md:text-6xl",children:(null==u?void 0:u.name)||s||"Loading..."}),(0,i.jsx)("p",{className:"mt-3 max-w-md mx-auto text-lg text-muted-foreground sm:text-xl md:mt-5 md:max-w-3xl",children:(null==u?void 0:u.description)||"..."}),(0,i.jsx)("div",{className:"mt-5",children:(0,i.jsx)(n.$,{variant:"outline",onClick:()=>M(!0),children:"Edit World Details"})})]})}),(0,i.jsx)("div",{className:"mt-20",children:(0,i.jsx)("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-3",children:W.map(e=>(0,i.jsxs)(o.Zp,{className:"flex flex-col",children:[(0,i.jsx)(o.aR,{className:"flex-shrink-0",children:(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(e.icon,{className:"h-8 w-8 text-accent"}),(0,i.jsx)(o.ZB,{children:e.title})]})}),(0,i.jsx)(o.Wu,{className:"flex-grow",children:(0,i.jsx)("p",{className:"text-muted-foreground",children:e.description})}),(0,i.jsx)(o.Wu,{children:(0,i.jsx)("a",{href:e.href,children:(0,i.jsxs)(n.$,{variant:"outline",className:"w-full",children:["Go to ",e.title]})})})]},e.title))})})]})})})}var F=t(19094),T=t(46818),E=t(81625),P=t(57662),B=t(70522),M=t(71608),D=t(42667),R=t(46395),W=t(99012),z=t(4580),$=t(50371),q=t(97265),V=t(99395),I=t(64867),G=t(64911);let O={"":A,bestiary:F.default,deeds:T.default,alchemy:E.default,items:P.default,npcs:B.default,factions:M.default,pantheon:D.default,rooms:R.default,dungeons:W.default,encounters:z.default,calendar:$.default,maps:q.default,"random/commoners":V.default,"random/encounter-tables":I.default,"random/treasures":G.default};function J(){let{worldSlug:e}=(0,l.q)(),[s,t]=(0,a.useState)(null);return((0,a.useEffect)(()=>{let s=()=>{let s=window.location.hash.slice(1).split("/").filter(Boolean),i=s[0],a=s.slice(1).join("/")||"";if(i===e){let e=O[a]||A;t(()=>e)}};return s(),window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s)},[e]),e&&s)?(0,i.jsx)(s,{}):null}var H=t(54165),Z=t(85057),K=t(92745),U=t(50172),_=t(18763),Q=t(68718),Y=t(77223),X=t(90010),ee=t(22346);let es=[{title:"Bestiary",description:"Create, edit, and manage creatures with detailed stats, roles, templates, abilities, and deeds.",icon:d.A},{title:"Deeds Library",description:"A library of reusable actions for creatures, from simple attacks to complex magical spells.",icon:p},{title:"Items & Alchemy",description:"Catalog weapons, armor, potions, and alchemical items with unique properties.",icon:c.A},{title:"NPCs & Factions",description:"Create detailed characters and manage the various factions, goals, and relationships in your world.",icon:f.A},{title:"Encounters",description:"Design combat encounters, add monsters from your bestiary, and run them with a live initiative tracker.",icon:h.A},{title:"Maps & Dungeons",description:"Build your world on a hex grid and assemble complex, interconnected dungeons from a library of rooms.",icon:v},{title:"Calendar & Events",description:"Track in-game events on multiple calendars, and link them to factions, creatures, or map locations.",icon:y.A},{title:"Random Generators",description:"Instantly generate random treasures, commoner PCs for a quick start, or roll on encounter tables.",icon:k.A},{title:"Pantheon",description:"Define the gods and powerful entities of your world, complete with their domains, symbols, and artifacts.",icon:x.A}];function et(){let[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(""),[h,m]=(0,a.useState)(null),{toast:g}=(0,N.dj)(),f=async()=>{l(!0);try{let e=await (0,K.Uj)();s(e)}catch(e){console.error("Failed to list worlds",e),g({variant:"destructive",title:"Error",description:"Could not load worlds list."})}finally{l(!1)}};(0,a.useEffect)(()=>{f()},[]);let x=()=>{if(!u.trim())return void g({variant:"destructive",title:"Invalid Name",description:"World name cannot be empty."});let s=u.trim().toLowerCase().replace(/\s+/g,"-");if(e.some(e=>e.slug===s))return void g({variant:"destructive",title:"Name Exists",description:"A world with this name already exists."});window.location.hash="#/".concat(s)},b=async s=>{let t=e.find(e=>e.slug===s);t&&(await (0,K.uT)(s),g({title:"World Deleted",description:'"'.concat(t.name,'" has been permanently deleted.')}),f())},j=async()=>{if(!h||!h.newName.trim())return void g({variant:"destructive",title:"Invalid Name",description:"New world name cannot be empty."});let{oldName:s,newName:t,slug:i}=h,a=t.trim().toLowerCase().replace(/\s+/g,"-");if(e.some(e=>e.slug===a&&e.slug!==i))return void g({variant:"destructive",title:"Name Exists",description:"A world with this name already exists."});try{await (0,K.XN)(i,t),g({title:"World Renamed",description:'"'.concat(s,'" is now "').concat(t,'".')}),m(null),f()}catch(e){g({variant:"destructive",title:"Error",description:"Could not rename world."})}},k=async s=>{let t=e.find(e=>e.slug===s);if(t)try{let e=await (0,K.P7)(s),i="data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(e,null,2))),a=document.createElement("a");a.href=i,a.download="tresspasser_world_".concat(t.name,".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),g({title:"Export Successful",description:'"'.concat(t.name,'" data has been downloaded.')})}catch(e){console.error("Export failed:",e),g({variant:"destructive",title:"Export Failed",description:"Could not export the data."})}},v=e=>{if(e.length<=50)return e;let s=e.substring(0,50),t=s.lastIndexOf(" ");return t>0?s.substring(0,t)+"...":s+"..."};return(0,i.jsxs)(r.A,{showSidebarTrigger:!1,children:[(0,i.jsx)("div",{className:"h-full overflow-y-auto bg-background/50",children:(0,i.jsxs)("div",{className:"container mx-auto px-4 py-12 sm:px-6 lg:px-8",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-4xl font-extrabold tracking-tight text-primary-foreground sm:text-5xl md:text-6xl",children:"Codex"}),(0,i.jsx)("p",{className:"mt-3 max-w-md mx-auto text-lg text-muted-foreground sm:text-xl md:mt-5 md:max-w-3xl",children:"A comprehensive application for managing and organizing your TTRPG worlds. Create creatures, design encounters, build dungeons, and bring your stories to life."}),(0,i.jsx)("div",{className:"mt-5 max-w-md mx-auto sm:flex sm:justify-center md:mt-8",children:(0,i.jsxs)(H.lG,{open:c,onOpenChange:d,children:[(0,i.jsx)(H.zM,{asChild:!0,children:(0,i.jsx)(n.$,{size:"lg",disabled:t,children:t?(0,i.jsx)(U.A,{className:"mr-2 h-5 w-5 animate-spin"}):e.length>0?"New World":"Get Started"})}),(0,i.jsxs)(H.Cf,{children:[(0,i.jsxs)(H.c7,{children:[(0,i.jsx)(H.L3,{children:"Create a New World"}),(0,i.jsx)(H.rr,{children:"Give your new world a name to begin your journey."})]}),(0,i.jsxs)("div",{className:"py-4",children:[(0,i.jsx)(Z.J,{htmlFor:"world-name",children:"World Name"}),(0,i.jsx)(C.p,{id:"world-name",value:u,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key&&x()},placeholder:"e.g., Aethelgard"})]}),(0,i.jsx)(H.Es,{children:(0,i.jsx)(n.$,{onClick:x,children:"Create World"})})]})]})})]}),(0,i.jsx)("div",{className:"mt-20",children:t||0===e.length?(0,i.jsx)("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-3",children:es.map(e=>(0,i.jsxs)(o.Zp,{children:[(0,i.jsxs)(o.aR,{className:"flex flex-row items-center gap-4",children:[(0,i.jsx)(e.icon,{className:"h-8 w-8 text-accent shrink-0"}),(0,i.jsx)(o.ZB,{children:e.title})]}),(0,i.jsx)(o.Wu,{children:(0,i.jsx)("p",{className:"text-muted-foreground",children:e.description})})]},e.title))}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-center mb-8",children:"Your Worlds"}),(0,i.jsx)("div",{className:"max-w-3xl mx-auto space-y-4",children:e.map(e=>(0,i.jsxs)("div",{className:"border rounded-lg p-4 flex items-center justify-between gap-4 bg-card",children:[(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("h3",{className:"font-bold text-lg text-primary-foreground truncate",children:e.name}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground hidden md:block",children:v(e.description)})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[(0,i.jsx)(n.$,{asChild:!0,size:"sm",children:(0,i.jsx)("a",{href:"#/".concat(e.slug),children:"Enter World"})}),(0,i.jsx)(ee.w,{orientation:"vertical",className:"h-6 hidden sm:block"}),(0,i.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>m({oldName:e.name,newName:e.name,slug:e.slug}),children:(0,i.jsx)(_.A,{})}),(0,i.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>k(e.slug),children:(0,i.jsx)(Q.A,{})}),(0,i.jsxs)(X.Lt,{children:[(0,i.jsx)(X.tv,{asChild:!0,children:(0,i.jsx)(n.$,{variant:"ghost",size:"icon",className:"text-destructive",children:(0,i.jsx)(Y.A,{})})}),(0,i.jsxs)(X.EO,{children:[(0,i.jsxs)(X.wd,{children:[(0,i.jsxs)(X.r7,{children:['Delete "',e.name,'"?']}),(0,i.jsx)(X.$v,{children:"This action cannot be undone. All data for this world will be permanently deleted."})]}),(0,i.jsxs)(X.ck,{children:[(0,i.jsx)(X.Zr,{children:"Cancel"}),(0,i.jsx)(X.Rx,{onClick:()=>b(e.slug),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]},e.slug))})]})})]})}),h&&(0,i.jsx)(H.lG,{open:!!h,onOpenChange:()=>m(null),children:(0,i.jsxs)(H.Cf,{children:[(0,i.jsx)(H.c7,{children:(0,i.jsxs)(H.L3,{children:['Rename "',h.oldName,'"']})}),(0,i.jsxs)("div",{className:"py-4",children:[(0,i.jsx)(Z.J,{htmlFor:"world-name-edit",children:"New World Name"}),(0,i.jsx)(C.p,{id:"world-name-edit",value:h.newName,onChange:e=>m({...h,newName:e.target.value}),onKeyDown:e=>{"Enter"===e.key&&j()}})]}),(0,i.jsx)(H.Es,{children:(0,i.jsx)(n.$,{onClick:j,children:"Save"})})]})})]})}function ei(){let[e,s]=(0,a.useState)("");return((0,a.useEffect)(()=>{let e=()=>{s(window.location.hash)};return e(),window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[]),e&&e.startsWith("#/")&&e.length>2)?(0,i.jsx)(J,{}):(0,i.jsx)(et,{})}},50717:(e,s,t)=>{Promise.resolve().then(t.bind(t,49180))},71608:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>$});var i=t(95155),a=t(12115),l=t(92745),r=t(62523),n=t(30285),o=t(66424),c=t(22346),d=t(87481),u=t(34301),p=t(75074),h=t(20203),m=t(73926),g=t(85057),f=t(59409),x=t(90648);function b(e){let{onSelectFaction:s,onNewFaction:t,selectedFactionId:b,dataVersion:j,filters:k,setFilters:v,onClearFilters:y}=e,[w,L]=(0,a.useState)([]),[N,C]=(0,a.useState)(!0),{toast:S}=(0,d.dj)();(0,a.useEffect)(()=>{(async()=>{C(!0);try{L(await (0,l.vq)())}catch(e){S({variant:"destructive",title:"Error",description:"Could not fetch factions from database."})}finally{C(!1)}})()},[j,S]);let A=(0,a.useMemo)(()=>{let e=w.filter(e=>{let s=e.name.toLowerCase().includes(k.searchTerm.toLowerCase()),t=!0,i=k.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return i.length>0&&(t=!!e.tags&&i.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>e.name.localeCompare(s.name));return"desc"===k.sortOrder&&e.reverse(),e},[w,k]);return(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsxs)("div",{className:"p-4 space-y-4",children:[(0,i.jsxs)(n.$,{onClick:t,className:"w-full",children:[(0,i.jsx)(u.A,{})," New Faction"]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(p.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,i.jsx)(r.p,{placeholder:"Search factions...",value:k.searchTerm,onChange:e=>v.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(g.J,{children:"Filter"}),(0,i.jsx)(n.$,{variant:"ghost",size:"sm",onClick:y,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,i.jsx)(x.F,{value:k.tagFilter?k.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>v.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"faction"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(g.J,{children:"Sort by"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)(f.l6,{value:k.sortBy,onValueChange:e=>v.setSortBy(e),children:[(0,i.jsx)(f.bq,{children:(0,i.jsx)(f.yv,{placeholder:"Sort by"})}),(0,i.jsx)(f.gC,{children:(0,i.jsx)(f.eb,{value:"name",children:"Name"})})]}),(0,i.jsxs)(n.$,{variant:"ghost",size:"icon",onClick:()=>v.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===k.sortOrder?(0,i.jsx)(h.A,{className:"h-4 w-4"}):(0,i.jsx)(m.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,i.jsx)(c.w,{}),(0,i.jsx)(o.F,{className:"flex-1",children:(0,i.jsx)("div",{className:"p-4",children:N?(0,i.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading factions..."}):A.length>0?(0,i.jsx)("ul",{className:"space-y-1",children:A.map(e=>(0,i.jsx)("li",{children:(0,i.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(b===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,i.jsx)("p",{className:"text-muted-foreground text-center",children:"No factions found."})})})]})}var j=t(62177),k=t(90221),v=t(55594),y=t(66695),w=t(88539),L=t(90010),N=t(17759),C=t(12543),S=t(18763),A=t(77223),F=t(25318),T=t(53054),E=t(68856),P=t(26126),B=t(47906);let M=v.z.object({name:v.z.string().min(1,"Faction name is required"),description:v.z.string().optional(),goals:v.z.string().optional(),tags:v.z.array(v.z.string()).optional()}),D={name:"",description:"",goals:"",tags:[]};function R(e){let{factionId:s,isCreatingNew:t,onSaveSuccess:o,onDeleteSuccess:u,onEditCancel:p,onBack:h}=e,{toast:m}=(0,d.dj)(),[g,f]=(0,a.useState)(t),[b,v]=(0,a.useState)(!t&&!!s),[R,W]=(0,a.useState)(null),z=(0,B.a)(),$=(0,j.mN)({resolver:(0,k.u)(M),defaultValues:D});(0,a.useEffect)(()=>{(async()=>{if(t){$.reset(D),W(null),f(!0),v(!1);return}if(!s){f(!1),v(!1),W(null);return}v(!0),f(!1);try{let e=await (0,l.vR)(s);e?($.reset(e),W(e)):W(null)}catch(e){m({variant:"destructive",title:"Error",description:"Could not load faction data."})}finally{v(!1)}})()},[s,t,$,m]);let q=()=>{t?p():R&&($.reset(R),f(!1))},V=async e=>{try{let i={...e,tags:e.tags||[]},a=e.tags||[];if(a.length>0&&await (0,l.JE)(a,"faction"),t){let s=await (0,l.sB)(i);m({title:"Faction Created!",description:"".concat(e.name," has been added.")}),o(s)}else s&&(await (0,l.mu)({...i,id:s}),m({title:"Save Successful",description:"".concat(e.name," has been updated.")}),o(s));f(!1)}catch(e){m({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},I=async()=>{if(s)try{await (0,l.Bx)(s),m({title:"Faction Deleted",description:"The faction has been removed."}),u()}catch(e){m({variant:"destructive",title:"Deletion Failed",description:"Could not delete the faction."})}};return b?(0,i.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,i.jsxs)(y.Zp,{children:[(0,i.jsx)(y.aR,{children:(0,i.jsx)(E.E,{className:"h-8 w-48"})}),(0,i.jsx)(y.Wu,{children:(0,i.jsx)(E.E,{className:"h-40 w-full"})})]})}):s||t?!g&&R?(0,i.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,i.jsxs)(y.Zp,{children:[(0,i.jsx)(y.aR,{children:(0,i.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[z&&h&&(0,i.jsx)(n.$,{variant:"ghost",size:"icon",onClick:h,className:"shrink-0 -ml-2 -mt-1",children:(0,i.jsx)(C.A,{className:"h-5 w-5"})}),(0,i.jsx)("div",{children:(0,i.jsx)(y.ZB,{className:"text-3xl font-bold",children:R.name})})]}),(0,i.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>f(!0),children:[(0,i.jsx)(S.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,i.jsx)(y.Wu,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,i.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:R.description||"No description provided."})]}),(0,i.jsx)(c.w,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Goals"}),(0,i.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:R.goals||"No goals provided."})]}),R.tags&&R.tags.length>0&&(0,i.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:R.tags.map(e=>(0,i.jsx)(P.E,{variant:"secondary",children:e},e))})})]})}),(0,i.jsx)(y.wL,{children:(0,i.jsxs)(L.Lt,{children:[(0,i.jsx)(L.tv,{asChild:!0,children:(0,i.jsx)(n.$,{type:"button",variant:"destructive",size:"sm",children:(0,i.jsx)(A.A,{className:"h-4 w-4"})})}),(0,i.jsxs)(L.EO,{children:[(0,i.jsxs)(L.wd,{children:[(0,i.jsx)(L.r7,{children:"Are you sure?"}),(0,i.jsxs)(L.$v,{children:['This will permanently delete "',R.name,'". This action cannot be undone.']})]}),(0,i.jsxs)(L.ck,{children:[(0,i.jsx)(L.Zr,{children:"Cancel"}),(0,i.jsx)(L.Rx,{onClick:I,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,i.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,i.jsx)(y.Zp,{children:(0,i.jsx)(N.lV,{...$,children:(0,i.jsxs)("form",{onSubmit:$.handleSubmit(V),className:"space-y-6",children:[(0,i.jsx)(y.aR,{children:(0,i.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[z&&h&&(0,i.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",onClick:p,className:"shrink-0 -ml-2",children:(0,i.jsx)(C.A,{className:"h-5 w-5"})}),(0,i.jsx)("div",{children:(0,i.jsx)(y.ZB,{children:t?z?"New Faction":"Create New Faction":"Editing: ".concat($.getValues("name")||"...")})})]}),!z&&(0,i.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",onClick:q,className:"text-muted-foreground hover:text-foreground",children:(0,i.jsx)(F.A,{className:"h-5 w-5"})})]})}),(0,i.jsxs)(y.Wu,{className:"space-y-6",children:[(0,i.jsx)(N.zB,{name:"name",control:$.control,render:e=>{let{field:s}=e;return(0,i.jsxs)(N.eI,{children:[(0,i.jsx)(N.lR,{children:"Name"}),(0,i.jsx)(N.MJ,{children:(0,i.jsx)(r.p,{...s})}),(0,i.jsx)(N.C5,{})]})}}),(0,i.jsx)(N.zB,{name:"description",control:$.control,render:e=>{let{field:s}=e;return(0,i.jsxs)(N.eI,{children:[(0,i.jsx)(N.lR,{children:"Description"}),(0,i.jsx)(N.MJ,{children:(0,i.jsx)(w.T,{...s,rows:4})})]})}}),(0,i.jsx)(N.zB,{name:"goals",control:$.control,render:e=>{let{field:s}=e;return(0,i.jsxs)(N.eI,{children:[(0,i.jsx)(N.lR,{children:"Goals"}),(0,i.jsx)(N.MJ,{children:(0,i.jsx)(w.T,{...s,rows:4})})]})}}),(0,i.jsx)(N.zB,{name:"tags",control:$.control,render:e=>{let{field:s}=e;return(0,i.jsxs)(N.eI,{children:[(0,i.jsxs)(N.lR,{className:"flex items-center gap-2",children:[(0,i.jsx)(T.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,i.jsx)(N.MJ,{children:(0,i.jsx)(x.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"faction"})}),(0,i.jsx)(N.C5,{})]})}})]}),(0,i.jsxs)(y.wL,{className:"flex items-center gap-2",children:[!t&&(0,i.jsxs)(L.Lt,{children:[(0,i.jsx)(L.tv,{asChild:!0,children:(0,i.jsx)(n.$,{type:"button",variant:"destructive",size:"sm",children:(0,i.jsx)(A.A,{className:"h-4 w-4"})})}),(0,i.jsxs)(L.EO,{children:[(0,i.jsxs)(L.wd,{children:[(0,i.jsx)(L.r7,{children:"Are you sure?"}),(0,i.jsxs)(L.$v,{children:['This will permanently delete "',$.getValues("name"),'".']})]}),(0,i.jsxs)(L.ck,{children:[(0,i.jsx)(L.Zr,{children:"Cancel"}),(0,i.jsx)(L.Rx,{onClick:I,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,i.jsx)("div",{className:"flex-grow"}),!z&&(0,i.jsx)(n.$,{type:"button",variant:"outline",onClick:q,children:"Cancel"}),(0,i.jsx)(n.$,{type:"submit",children:t?"Create Faction":"Save Changes"})]})]})})})}):(0,i.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,i.jsx)(y.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,i.jsxs)(y.Wu,{className:"text-center pt-6",children:[(0,i.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a faction to view"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}var W=t(88972),z=t(20031);function $(){let[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)(!1),[r,n]=(0,a.useState)(0),[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[p,h]=(0,a.useState)("name"),[m,g]=(0,a.useState)("asc"),[f,x]=(0,a.useState)(!1),j=(0,B.a)(),[k,v]=(0,a.useState)("list");(0,a.useEffect)(()=>{x(!0)},[]);let y={searchTerm:o,tagFilter:d,sortBy:p,sortOrder:m},w={setSearchTerm:c,setTagFilter:u,setSortBy:h,setSortOrder:g},L=()=>{c(""),u(""),h("name"),g("asc")},N=()=>n(e=>e+1),C=e=>{s(e),l(!1),j&&v("editor")},S=()=>{s(null),l(!0),j&&v("editor")},A=e=>{N(),s(e),l(!1),j&&v("editor")},F=()=>{N(),s(null),l(!1),j&&v("list")},T=()=>{t&&(l(!1),s(null),j&&v("list"))};return f?j?(0,i.jsx)(W.A,{showSidebarTrigger:!1,children:(0,i.jsx)("div",{className:"h-full w-full",children:"list"===k?(0,i.jsx)(b,{onSelectFaction:C,onNewFaction:S,selectedFactionId:e,dataVersion:r,filters:y,setFilters:w,onClearFilters:L}):(0,i.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,i.jsx)("div",{className:"p-4 sm:p-6",children:(0,i.jsx)(R,{factionId:e,isCreatingNew:t,onSaveSuccess:A,onDeleteSuccess:F,onEditCancel:T,onBack:()=>{v("list"),s(null),l(!1)}},null!=e?e:t?"new":"placeholder")})})})}):(0,i.jsx)(z.SidebarProvider,{children:(0,i.jsx)(W.A,{children:(0,i.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,i.jsx)(z.Bx,{style:{"--sidebar-width":"380px"},children:(0,i.jsx)(b,{onSelectFaction:C,onNewFaction:S,selectedFactionId:e,dataVersion:r,filters:y,setFilters:w,onClearFilters:L})}),(0,i.jsx)(z.sF,{className:"flex-1 overflow-y-auto",children:(0,i.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,i.jsx)(R,{factionId:e,isCreatingNew:t,onSaveSuccess:A,onDeleteSuccess:F,onEditCancel:T},null!=e?e:t?"new":"placeholder")})})]})})}):null}},99395:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>D});var i=t(95155),a=t(12115),l=t(88972),r=t(30285),n=t(30990);let o=e=>Math.floor(Math.random()*e)+1,c=[{range:[1,1],type:"Wicked",rolls:["vice","vice"]},{range:[2,3],type:"Unhinged",rolls:["vice","oddity"]},{range:[4,7],type:"Balanced",rolls:["virtue","vice"]},{range:[8,9],type:"Eccentric",rolls:["virtue","oddity"]},{range:[10,10],type:"Virtuous",rolls:["virtue","virtue"]}],d=[{virtue:"Calm",vice:"Wrathful"},{virtue:"Daring",vice:"Cowardly"},{virtue:"Thoughtful",vice:"Impulsive"},{virtue:"Dutiful",vice:"Unruly"},{virtue:"Generous",vice:"Greedy"},{virtue:"Honest",vice:"Deceitful"},{virtue:"Supportive",vice:"Envious"},{virtue:"Humble",vice:"Arrogant"},{virtue:"Kind",vice:"Cruel"},{virtue:"Trusting",vice:"Paranoid"}],u=[["Obsessive","Steadfast","Altruistic","Haunted","Crude","Na\xefve"],["Whimsical","Imperious","Observant","Prideful","Self-Righteous","Vile"],["Anarchic","Eloquent","Jaded","Imaginative","Blunt","Tedious"],["Gentle","Delusional","Capricious","Nonchalant","Valiant","Merciful"],["Destructive","Loyal","Sarcastic","Servile","Ethical","Devout"],["Callous","Tense","Seductive","Fair-Minded","Spirited","Absentminded"],["Slothful","Curious","Clumsy","Heartless","Dramatic","Erudite"],["Stoic","Cheerful","Regal","Ambitious","Reliable","Vengeful"]],p=[{range:[1,3],group:"Outcasts"},{range:[4,6],group:"Laborers"},{range:[7,9],group:"Farmers"},{range:[10,12],group:"Artisans"},{range:[13,15],group:"Merchants"},{range:[16,17],group:"Soldiers"},{range:[18,19],group:"Servants"},{range:[20,20],group:"Nobility"}],h=[{pastLife:"Hermit",attributes:["spirit"],skill:"Nature",possessions:"moonshine"},{pastLife:"Leper",attributes:["spirit"],skill:"Stealth",possessions:"crude cloak (1d6)"},{pastLife:"Urchin",attributes:["agility"],skill:"Stealth",possessions:"stuffed animal"},{pastLife:"Poacher",attributes:["agility"],skill:"Perception",possessions:"bag of hides"},{pastLife:"Beggar",attributes:["spirit"],skill:"Folklore",possessions:"tin cup, 5 cp"},{pastLife:"Charlatan",attributes:["spirit"],skill:"Speech",possessions:"disguise kit"},{pastLife:"Graverobber",attributes:["might"],skill:"Perception",possessions:"rusted shovel"},{pastLife:"Fraud",attributes:["intellect"],skill:"Letters",possessions:"quill, ink, paper"},{pastLife:"Gambler",attributes:["intellect"],skill:"Speech",possessions:"dice"},{pastLife:"Pickpocket",attributes:["agility"],skill:"Stealth",possessions:"keys to unknown door"},{pastLife:"Arsonist",attributes:["intellect"],skill:"Athletics",possessions:"crude sword (1d6)"},{pastLife:"Drunkard",attributes:["might"],skill:"Speech",possessions:"empty tankard"},{pastLife:"Outlaw",attributes:["agility"],skill:"Stealth",possessions:"stolen jewelry"},{pastLife:"Expelled Acolyte",attributes:["intellect"],skill:"Letters",possessions:"holy texts, unread"},{pastLife:"Failed Apprentice",attributes:["intellect"],skill:"Magic",possessions:"stolen spellbook"},{pastLife:"Lockpicker",attributes:["agility"],skill:"Tinkering",possessions:"lockpicks"},{pastLife:"Vigilante",attributes:["agility","spirit"],skill:"Perception",possessions:"cloak (d8)"},{pastLife:"Doomsayer",attributes:["intellect","spirit"],skill:"Magic",possessions:"manifesto"},{pastLife:"Burglar",attributes:["agility","intellect"],skill:"Stealth",possessions:"crowbar"},{pastLife:"Pig Thief",attributes:["might","agility"],skill:"Stealth",possessions:"pig"}],m=[{pastLife:"Gongfarmer",attributes:["might"],skill:"Nature",possessions:"dung shovel"},{pastLife:"Scavenger",attributes:["agility"],skill:"Tinkering",possessions:"crude helm"},{pastLife:"Chimney Sweep",attributes:["agility"],skill:"Athletics",possessions:"bag of limes"},{pastLife:"Lamplighter",attributes:["might"],skill:"Acrobatics",possessions:"rope"},{pastLife:"Carver",attributes:["agility"],skill:"Nature",possessions:"sextant"},{pastLife:"Roofer",attributes:["agility"],skill:"Acrobatics",possessions:"ten-foot ladder (heavy)"},{pastLife:"Ferry Keeper",attributes:["intellect"],skill:"Folklore",possessions:"broken oar"},{pastLife:"Boatwright",attributes:["intellect"],skill:"Tinkering",possessions:"hammer and nails"},{pastLife:"Ragpicker",attributes:["spirit"],skill:"Stealth",possessions:"chipped shovel"},{pastLife:"Stable Hand",attributes:["agility"],skill:"Nature",possessions:"push broom"},{pastLife:"Stonemason",attributes:["might"],skill:"Tinkering",possessions:"hammer and chisel"},{pastLife:"Stable Keeper",attributes:["might"],skill:"Nature",possessions:"sack of horseshoes"},{pastLife:"Polisher",attributes:["agility"],skill:"Perception",possessions:"silver knife (as dagger)"},{pastLife:"Wagoner",attributes:["might"],skill:"Folklore",possessions:"tattered scarf, tricorn hat"},{pastLife:"Thatcher",attributes:["agility"],skill:"Acrobatics",possessions:"bag of thatch"},{pastLife:"Miner",attributes:["might"],skill:"Athletics",possessions:"pickaxe"},{pastLife:"Woodcutter",attributes:["might"],skill:"Nature",possessions:"old axe"},{pastLife:"Tavern Guard",attributes:["might","spirit"],skill:"Folklore",possessions:"cudgel (1d6)"},{pastLife:"Gravedigger",attributes:["might","spirit"],skill:"Athletics",possessions:"tombstone"},{pastLife:"Rat-Catcher",attributes:["agility","intellect"],skill:"Stealth",possessions:"rat-bashing stick"}],g=[{pastLife:"Cabbage Farmer",attributes:["might"],skill:"Athletics",possessions:"bag of cabbages"},{pastLife:"Carrot Farmer",attributes:["might"],skill:"Athletics",possessions:"bag of carrots"},{pastLife:"Onion Farmer",attributes:["might"],skill:"Athletics",possessions:"bag of onions"},{pastLife:"Wheat Farmer",attributes:["agility"],skill:"Athletics",possessions:"scythe (weapon)"},{pastLife:"Herbalist",attributes:["intellect"],skill:"Nature",possessions:"bag of herbs"},{pastLife:"Forager",attributes:["might"],skill:"Nature",possessions:"pouch of berries"},{pastLife:"Miller",attributes:["might"],skill:"Athletics",possessions:"bag of flour"},{pastLife:"Chicken Farmer",attributes:["agility"],skill:"Acrobatics",possessions:"chicken"},{pastLife:"Shepherd",attributes:["might"],skill:"Perception",possessions:"bag of wool"},{pastLife:"Cowherd",attributes:["might"],skill:"Nature",possessions:"cattle prod"},{pastLife:"Swineherd",attributes:["might"],skill:"Nature",possessions:"slop bucket, slop"},{pastLife:"Fowler",attributes:["agility"],skill:"Acrobatics",possessions:"quail eggs"},{pastLife:"Butter Churner",attributes:["agility"],skill:"Athletics",possessions:"butter churn"},{pastLife:"Fisher",attributes:["spirit"],skill:"Nature",possessions:"rod and tackle"},{pastLife:"Horse Trainer",attributes:["might"],skill:"Nature",possessions:"bag of carrots"},{pastLife:"Beekeeper",attributes:["spirit"],skill:"Nature",possessions:"queen in a jar"},{pastLife:"Trapper",attributes:["intellect"],skill:"Tinkering",possessions:"iron bear trap"},{pastLife:"Hound Keeper",attributes:["might","spirit"],skill:"Nature",possessions:"puppy"},{pastLife:"Hunter",attributes:["might","agility"],skill:"Stealth",possessions:"bow (d8)"},{pastLife:"Falconer",attributes:["agility","spirit"],skill:"Nature",possessions:"trained falcon"}],f=[{pastLife:"Carpenter",attributes:["might"],skill:"Crafting",possessions:"woodworking tools"},{pastLife:"Cobbler",attributes:["spirit"],skill:"Tinkering",possessions:"boots (L./+0/d6)"},{pastLife:"Wood-Carver",attributes:["agility"],skill:"Crafting",possessions:"carving of a squirrel"},{pastLife:"Glassblower",attributes:["agility"],skill:"Crafting",possessions:"1d6 glass vials"},{pastLife:"Leather-Worker",attributes:["might"],skill:"Crafting",possessions:"leather gloves (L./+1/d6)"},{pastLife:"Cook",attributes:["spirit"],skill:"Alchemy",possessions:"cookware"},{pastLife:"Weaver",attributes:["agility"],skill:"Crafting",possessions:"quilt"},{pastLife:"Locksmith",attributes:["agility"],skill:"Tinkering",possessions:"simple lock and key"},{pastLife:"Brewer",attributes:["spirit"],skill:"Alchemy",possessions:"small keg of ale"},{pastLife:"Soap-Maker",attributes:["might"],skill:"Alchemy",possessions:"bag of soap bars"},{pastLife:"Tailor",attributes:["agility"],skill:"Crafting",possessions:"well-maintained outfit"},{pastLife:"Tinker",attributes:["intellect"],skill:"Tinkering",possessions:"wind-up toy"},{pastLife:"Candle-Maker",attributes:["spirit"],skill:"Alchemy",possessions:"huge ceremonial candle"},{pastLife:"Fletcher",attributes:["agility"],skill:"Crafting",possessions:"bundle of arrows"},{pastLife:"Baker",attributes:["might"],skill:"Nature",possessions:"loaf of bread"},{pastLife:"Butcher",attributes:["might"],skill:"Nature",possessions:"meat cleaver (1d6)"},{pastLife:"Barber",attributes:["agility"],skill:"Speech",possessions:"shaving razors"},{pastLife:"Inventor",attributes:["intellect","spirit"],skill:"Crafting",possessions:"bundle of notes"},{pastLife:"Jeweler",attributes:["agility","intellect"],skill:"Tinkering",possessions:"tray of semi-precious gems"},{pastLife:"Blacksmith",attributes:["might","spirit"],skill:"Crafting",possessions:"hammer"}],x=[{pastLife:"Fence",attributes:["intellect"],skill:"Magic",possessions:"box of stolen junk"},{pastLife:"Salvage Dealer",attributes:["might"],skill:"Tinkering",possessions:"broken sword hilt"},{pastLife:"Relic Peddler",attributes:["spirit"],skill:"Folklore",possessions:"reliquary, fake relic"},{pastLife:"Wine Merchant",attributes:["intellect"],skill:"Nature",possessions:"bottle of lowland red"},{pastLife:"Street Hawker",attributes:["spirit"],skill:"Speech",possessions:"arrow-shaped sign"},{pastLife:"Bird Seller",attributes:["spirit"],skill:"Perception",possessions:"fine plumes"},{pastLife:"Fishmonger",attributes:["might"],skill:"Athletics",possessions:"rod and tackle"},{pastLife:"Cheesemonger",attributes:["spirit"],skill:"Speech",possessions:"bucket of cheeses"},{pastLife:"Fortune Teller",attributes:["spirit"],skill:"Magic",possessions:"fortune-telling cards"},{pastLife:"Tavern Server",attributes:["might"],skill:"Folklore",possessions:"serving platter"},{pastLife:"Pie Seller",attributes:["spirit"],skill:"Perception",possessions:"basket of meat pies"},{pastLife:"Florist",attributes:["spirit"],skill:"Nature",possessions:"basket of flowers"},{pastLife:"Cartographer",attributes:["intellect"],skill:"Letters",possessions:"scroll case with map"},{pastLife:"Spice Merchant",attributes:["intellect"],skill:"Speech",possessions:"spice box"},{pastLife:"Shopkeeper",attributes:["spirit"],skill:"Speech",possessions:"dusty ledger"},{pastLife:"Bookseller",attributes:["intellect"],skill:"Letters",possessions:"tome on a useful subject"},{pastLife:"Moneylender",attributes:["intellect"],skill:"Letters",possessions:"pouch of silver pieces"},{pastLife:"Apothecary",attributes:["intellect","spirit"],skill:"Nature",possessions:"satchel of herbs"},{pastLife:"Perfumer",attributes:["agility","spirit"],skill:"Perception",possessions:"fine perfume"},{pastLife:"Innkeeper",attributes:["might","intellect"],skill:"Speech",possessions:"bottle of hard liquor"}],b=[{pastLife:"Deserter",attributes:["intellect"],skill:"Stealth",possessions:"rusted helm (d6)"},{pastLife:"Mercenary",attributes:["might"],skill:"Stealth",possessions:"crude sword (d6)"},{pastLife:"Bodyguard",attributes:["might"],skill:"Perception",possessions:"crude crossbow (d6)"},{pastLife:"Town Guard",attributes:["might"],skill:"Perception",possessions:"crude flail (d6)"},{pastLife:"Catchpole",attributes:["intellect"],skill:"Athletics",possessions:"broken catchpole"},{pastLife:"Jailer",attributes:["might"],skill:"Perception",possessions:"set of keys"},{pastLife:"Executioner",attributes:["might"],skill:"Athletics",possessions:"crude greataxe (d8)"},{pastLife:"Sheriff",attributes:["spirit"],skill:"Perception",possessions:"crude crossbow (d8)"},{pastLife:"Scout",attributes:["agility"],skill:"Perception",possessions:"forest-green cloak (L./+0/d6)"},{pastLife:"Messenger",attributes:["agility"],skill:"Letters",possessions:"bag of undelivered letters"},{pastLife:"Foot Soldier",attributes:["might"],skill:"Athletics",possessions:"round shield (d8)"},{pastLife:"Rider",attributes:["agility"],skill:"Nature",possessions:"saddle bag"},{pastLife:"Flag-Bearer",attributes:["spirit"],skill:"Speech",possessions:"tattered banner (as staff)"},{pastLife:"Siege Engineer",attributes:["intellect"],skill:"Tinkering",possessions:"unfinished schematic"},{pastLife:"Sapper",attributes:["agility"],skill:"Perception",possessions:"grenade (deals 3d6 in a blast 3)"},{pastLife:"Archer",attributes:["agility"],skill:"Perception",possessions:"shortbow (d6)"},{pastLife:"Sergeant",attributes:["might"],skill:"Athletics",possessions:"child's drawing"},{pastLife:"Herald",attributes:["might","spirit"],skill:"Speech",possessions:"brass horn"},{pastLife:"Lieutenant",attributes:["might","intellect"],skill:"Letters",possessions:"medal of honor"},{pastLife:"Captain",attributes:["might","spirit"],skill:"Speech",possessions:"battle map"}],j=[{pastLife:"Teacher",attributes:["intellect"],skill:"Letters",possessions:"history book"},{pastLife:"Troubadour",attributes:["spirit"],skill:"Folklore",possessions:"book of sagas"},{pastLife:"Dancer",attributes:["agility"],skill:"Acrobatics",possessions:"dancing shoes"},{pastLife:"Singer",attributes:["spirit"],skill:"Speech",possessions:"whistle"},{pastLife:"Tax Collector",attributes:["intellect"],skill:"Letters",possessions:"empty coffer"},{pastLife:"Physician",attributes:["intellect"],skill:"Alchemy",possessions:"medicine bag"},{pastLife:"Gardener",attributes:["might"],skill:"Nature",possessions:"gardening hoe"},{pastLife:"Chef",attributes:["intellect"],skill:"Alchemy",possessions:"kitchen knife (as dagger)"},{pastLife:"Mortician",attributes:["intellect"],skill:"Letters",possessions:"autopsy kit"},{pastLife:"Pilgrim",attributes:["spirit"],skill:"Folklore",possessions:"holy text"},{pastLife:"Librarian",attributes:["intellect"],skill:"Letters",possessions:"tome on a useless subject"},{pastLife:"Thespian",attributes:["spirit"],skill:"Speech",possessions:"makeup kit"},{pastLife:"Circus Performer",attributes:["agility"],skill:"Acrobatics",possessions:"hoop"},{pastLife:"Pigeon Fancier",attributes:["intellect"],skill:"Nature",possessions:"pigeon in a cage"},{pastLife:"Painter",attributes:["spirit"],skill:"Perception",possessions:"brush and paints"},{pastLife:"Philosopher",attributes:["intellect"],skill:"Letters",possessions:"treatise on ethics"},{pastLife:"Astrologer",attributes:["intellect"],skill:"Magic",possessions:"chart of the cosmos"},{pastLife:"Spy",attributes:["agility","intellect"],skill:"Letters",possessions:"stolen letters"},{pastLife:"Poet",attributes:["intellect","spirit"],skill:"Letters",possessions:"binder of notes"},{pastLife:"Jester",attributes:["agility","spirit"],skill:"Acrobatics",possessions:"jester's cap (as cap)"}],k=[{range:[1,4],title:"Lady / Lord",attributes:["might","agility","spirit"],skill:"Letters"},{range:[5,8],title:"Duchess / Duke",attributes:["might","intellect","spirit"],skill:"Letters"},{range:[9,12],title:"Count / Countess",attributes:["agility","intellect","spirit"],skill:"Letters"},{range:[13,16],title:"Baron / Baroness",attributes:["might","agility","intellect"],skill:"Letters"},{range:[17,18],title:"Princess / Prince",attributes:["might","agility","intellect","spirit"],skill:"Letters, Speech"},{range:[19,20],title:"Queen / King",attributes:["might","agility","intellect","spirit"],skill:"Letters, Speech"}],v=["tattered but fine clothes","a signet ring","a deed to a forgotten land","a single, perfect pearl","a letter of introduction to a powerful figure","a portrait of a lost loved one"],y=()=>{let e=o(8),s=o(6);return u[e-1][s-1]},w=()=>{let e=o(10),s=c.find(s=>e>=s.range[0]&&e<=s.range[1]),t=[],i=[];for(let e of s.rolls)if("virtue"===e){let e=o(10);i.push(e),t.push(d[e-1].virtue)}else if("vice"===e){let e=o(10);i.push(e),t.push(d[e-1].vice)}else t.push(y());let a=new Set(t).size!==t.length,l=2===i.length&&i[0]===i[1];if(a||l){let e=y(),s=y();for(;e===s;)s=y();return"Strange: ".concat(e," & ").concat(s)}return"".concat(s.type,": ").concat(t.join(" & "))},L=()=>{let e,s=o(20),t=p.find(e=>s>=e.range[0]&&s<=e.range[1]);if(!t)return{pastLife:"Unknown",attributeBonuses:[],skill:"To be determined",equipment:[],isNoble:!1,isRoyalty:!1};let i=o(20);if("Nobility"===t.group){let e=k.find(e=>i>=e.range[0]&&i<=e.range[1]);if(e){let s=[v[o(v.length)-1]],t=["Princess / Prince","Queen / King"].includes(e.title);return{pastLife:e.title,attributeBonuses:e.attributes,skill:e.skill,equipment:s,isNoble:!0,isRoyalty:t}}}switch(t.group){case"Outcasts":e=h;break;case"Laborers":e=m;break;case"Farmers":e=g;break;case"Artisans":e=f;break;case"Merchants":e=x;break;case"Soldiers":e=b;break;case"Servants":e=j;break;default:return{pastLife:t.group,attributeBonuses:[],skill:"To be determined",equipment:[],isNoble:!1,isRoyalty:!1}}let a=e[i-1];return{pastLife:a.pastLife,attributeBonuses:a.attributes,skill:a.skill,equipment:[a.possessions],isNoble:!1,isRoyalty:!1}},N=()=>{let e={might:0,agility:0,intellect:0,spirit:0};for(let s=0;s<4;s++){let s=o(4);1===s?e.might++:2===s?e.agility++:3===s?e.intellect++:4===s&&e.spirit++}let{pastLife:s,attributeBonuses:t,skill:i,equipment:a,isNoble:l,isRoyalty:r}=L();for(let s of t)e.hasOwnProperty(s)&&e[s]++;let n=0,c=[...a];c.push("Crude weapon (melee, 2d4, topple)"),l&&(c.push("Normal weapon of any type","Quilted chest armor"),n=1,r&&c.push("Battered crown"));let d=e.might>=e.agility?"Might":"Agility",u={skillBonus:1,skillDie:"d6",hp:5+e.might,speed:5+e.agility,initiative:e.agility+1,accuracy:e.might+1,guard:n+e.agility,resist:e.spirit+1,prevail:e.intellect+1,tenacity:e.might+e.spirit};return{id:crypto.randomUUID(),attributes:e,keyAttribute:d,alignment:w(),pastLife:s,skill:i,equipment:c.join(", "),combatValues:u}},C=()=>Array.from({length:4},N);var S=t(66695),A=t(22346),F=t(85057),T=t(59434);let E=e=>{let{label:s,value:t,isKey:a}=e;return(0,i.jsxs)("div",{className:(0,T.cn)("rounded-md p-3 text-center",a?"bg-primary/20":"bg-muted/50"),children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:s}),(0,i.jsx)("p",{className:(0,T.cn)("text-4xl font-bold",a&&"text-primary"),children:t})]})},P=e=>{let{label:s,value:t}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:s}),(0,i.jsx)("p",{className:"text-lg font-bold",children:t})]})};function B(e){let{commoner:s}=e,[t,a]=s.alignment.split(": ");return(0,i.jsxs)(S.Zp,{children:[(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.ZB,{children:"Commoner"}),(0,i.jsx)(S.BT,{children:s.pastLife})]}),(0,i.jsxs)(S.Wu,{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(F.J,{children:"Attributes"}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-2 mt-1",children:[(0,i.jsx)(E,{label:"Might",value:s.attributes.might,isKey:"Might"===s.keyAttribute}),(0,i.jsx)(E,{label:"Agility",value:s.attributes.agility,isKey:"Agility"===s.keyAttribute}),(0,i.jsx)(E,{label:"Intellect",value:s.attributes.intellect}),(0,i.jsx)(E,{label:"Spirit",value:s.attributes.spirit})]})]}),(0,i.jsx)(A.w,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)(F.J,{children:"Combat Values"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3 mt-2",children:[(0,i.jsx)(P,{label:"HP",value:s.combatValues.hp}),(0,i.jsx)(P,{label:"Speed",value:s.combatValues.speed}),(0,i.jsx)(P,{label:"Initiative",value:s.combatValues.initiative}),(0,i.jsx)(P,{label:"Accuracy",value:s.combatValues.accuracy}),(0,i.jsx)(P,{label:"Guard",value:s.combatValues.guard}),(0,i.jsx)(P,{label:"Resist",value:s.combatValues.resist}),(0,i.jsx)(P,{label:"Prevail",value:s.combatValues.prevail}),(0,i.jsx)(P,{label:"Tenacity",value:s.combatValues.tenacity})]})]}),(0,i.jsx)(A.w,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)(F.J,{children:"Alignment"}),(0,i.jsxs)("p",{className:"text-foreground/90",children:[(0,i.jsxs)("span",{className:"font-bold text-primary-foreground",children:[t,":"]})," ",a]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(F.J,{children:"Skill"}),(0,i.jsxs)("p",{className:"text-muted-foreground",children:[s.skill," (Bonus: +",s.combatValues.skillBonus,", Die: ",s.combatValues.skillDie,")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(F.J,{children:"Equipment"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:s.equipment})]})]})]})}var M=t(20031);function D(){let[e,s]=(0,a.useState)([]);return(0,i.jsx)(M.SidebarProvider,{children:(0,i.jsx)(l.A,{children:(0,i.jsx)("div",{className:"h-full overflow-y-auto p-4 sm:p-6 md:p-8",children:(0,i.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,i.jsx)("div",{className:"flex justify-center mb-8",children:(0,i.jsxs)(r.$,{onClick:()=>{s(C())},size:"lg",children:[(0,i.jsx)(n.A,{className:"mr-2 h-5 w-5"}),"Generate Commoners"]})}),e.length>0?(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.map(e=>(0,i.jsx)(B,{commoner:e},e.id))}):(0,i.jsx)("div",{className:"text-center text-muted-foreground mt-16",children:(0,i.jsx)("p",{children:"Click the button to generate your first set of commoners."})})]})})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[1294,8238,8702,8478,4055,3160,49,750,8082,3451,5720,3554,7294,3347,6874,6004,5520,9516,3336,9209,6762,9094,9012,7662,4580,7265,522,371,6395,6818,2667,4867,4911,1625,8441,1684,7358],()=>s(50717)),_N_E=e.O()}]);
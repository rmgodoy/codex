"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9094],{19094:(e,s,l)=>{l.r(s),l.d(s,{default:()=>ev});var t=l(95155),a=l(12115),r=l(92745),n=l(76762),i=l(62523),c=l(30285),d=l(66424),o=l(22346),x=l(87481),h=l(85057),m=l(59409),u=l(50172),j=l(34301),p=l(68718),g=l(75074),f=l(20203),v=l(73926),b=l(90648),N=l(54165),w=l(47262),y=l(58962);let C=e=>{switch(e){case"light":return"L";case"heavy":return"H";case"mighty":return"M";case"tyrant":return"T";case"special":return"S"}},T=(e,s)=>e?e.replace(/\\dd/g,s).split(/(\bconfer\s+\w+\s+\d+\b)/gi).map((e,s)=>{if(e.match(/\bconfer\s+\w+\s+\d+\b/i)){let l=e.split(" ");return(0,t.jsxs)("span",{children:[l.slice(0,-1).join(" ")," ",(0,t.jsx)("span",{className:"font-bold",children:l[l.length-1]})]},s)}return e}):null,R=e=>{let{template:s}=e;switch(s){case"Underling":return(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-bold",children:"Underling:"})," Any amount of damage from a hit is enough to kill this creature. It is immune to state damage, environmental damage and damage from missed attacks."]});case"Paragon":return(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-bold",children:"Extra Turn:"})," This creature takes an additional turn at the end of the round. Immune to effects that delay its turn (loses an action point on its next turn instead)."]});case"Tyrant":return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-bold",children:"Extra Turn:"})," This creature takes an additional turn at the end of the round. Immune to effects that delay its turn (loses an action point on its next turn instead)."]}),(0,t.jsxs)("p",{className:"mt-1",children:[(0,t.jsx)("span",{className:"font-bold",children:"Unstoppable:"})," Can make a free prevail check against one state at the end of each round."]})]});default:return null}};function S(e){let{creature:s}=e;if(!s)return null;let l={light:0,heavy:1,mighty:2,tyrant:3,special:4},a=[...s.deeds].sort((e,s)=>l[e.tier]-l[s.tier]),r=(e,l)=>{if(!l)return null;let a=T(l,s.attributes.DMG);return(0,t.jsxs)("p",{children:[(0,t.jsxs)("span",{className:"font-bold",children:[e,":"]})," ",a]})};return(0,t.jsxs)("div",{className:"bg-stone-200 text-black font-sans text-xs w-[350px] shadow-lg",style:{fontFamily:"Literata, serif"},children:[(0,t.jsxs)("header",{className:"flex bg-gray-700 text-white font-bold uppercase",children:[(0,t.jsx)("h1",{className:"flex-1 p-1.5 pl-2",children:s.name}),(0,t.jsxs)("div",{className:"border-l-2 border-white p-1.5 px-3",children:["TR ",s.TR]})]}),(0,t.jsxs)("section",{className:"p-2 grid grid-cols-2 gap-x-4 bg-white border-b border-stone-300",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," ",s.role," ","Normal"!==s.template&&s.template," ",s.level]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," HP: ",s.attributes.HP]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Speed: ",s.attributes.Speed]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Initiative: ",s.attributes.Initiative]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Accuracy: ",s.attributes.Accuracy]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Guard: ",s.attributes.Guard]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Resist: ",s.attributes.Resist]}),(0,t.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(y.A,{className:"w-2 h-2 fill-current"})," Roll Bonus: ",s.attributes.rollBonus>0?"+".concat(s.attributes.rollBonus):s.attributes.rollBonus]})]})]}),"Normal"!==s.template&&(0,t.jsx)("section",{className:"p-2 bg-stone-100 border-b border-stone-300 text-stone-800",children:(0,t.jsx)(R,{template:s.template})}),s.abilities&&s.abilities.length>0&&(0,t.jsx)("section",{className:"p-2 bg-white border-b border-stone-300",children:(0,t.jsx)("div",{className:"space-y-1",children:s.abilities.map((e,s)=>(0,t.jsxs)("p",{children:[(0,t.jsxs)("span",{className:"font-bold",children:[e.name,":"]})," ",e.description]},e.id||s))})}),(0,t.jsx)("section",{className:"space-y-1",children:a.map(e=>(0,t.jsxs)("div",{className:"p-2 border-t border-stone-300",children:[(0,t.jsxs)("h2",{className:"font-bold",children:["(",C(e.tier),") ",e.name.toUpperCase()," ",(0,t.jsx)(y.A,{className:"w-2 h-2 inline-block fill-current"})," ",e.deedType.toUpperCase()," ATTACK VS. ",e.versus.toUpperCase()]}),(0,t.jsxs)("div",{className:"pl-3 text-stone-800 space-y-0.5",children:[e.target&&(0,t.jsxs)("p",{children:["Target: ",e.target]}),r("Start",e.effects.start),r("Base",e.effects.base),r("Hit",e.effects.hit),r("Spark",e.effects.spark),r("Shadow",e.effects.shadow),r("After",e.effects.after)]})]},e.id))})]})}var z=l(78064),A=l(59311),k=l.n(A);let F=["Normal","Underling","Paragon","Tyrant"];function M(e){let{onSelectCreature:s,onNewCreature:l,selectedCreatureId:y,dataVersion:C,filters:T,setFilters:R,onClearFilters:A}=e,[M,B]=(0,a.useState)([]),[I,L]=(0,a.useState)(!0),{toast:E}=(0,x.dj)(),[J,D]=(0,a.useState)(!1),[G,P]=(0,a.useState)(new Set),[$,V]=(0,a.useState)(!1),[U,O]=(0,a.useState)(null),[H,q]=(0,a.useState)(""),W=(0,a.useRef)(null),Z={searchTerm:"",roleFilter:"all",templateFilter:"all",minLevel:"",maxLevel:"",minTR:"",maxTR:"",tagFilter:""},[_,K]=(0,a.useState)(Z);(0,a.useEffect)(()=>{(async()=>{L(!0);try{let e=await (0,r.OG)();B(e)}catch(e){console.error("Error fetching creatures:",e),E({variant:"destructive",title:"Error",description:"Could not fetch creatures from database."})}finally{L(!1)}})()},[C,E]);let Q=async()=>{if(0===G.size)return void E({variant:"destructive",title:"No creatures selected",description:"Please select at least one creature to export."});V(!0),E({title:"Starting Export...",description:"Preparing ".concat(G.size," creature(s).")});try{let e=await (0,r.hP)(Array.from(G)),s=new(k()),l=1;for(let t of e){if(O(t),q("Exporting ".concat(l," of ").concat(e.length,": ").concat(t.name)),await new Promise(e=>requestAnimationFrame(()=>setTimeout(e,50))),W.current)try{let e=await z.$E(W.current,{quality:1,pixelRatio:2,backgroundColor:"#e7e5e4"}),l=await (await fetch(e)).blob();s.file("".concat(t.name.replace(/ /g,"_"),".png"),l)}catch(e){console.error("Failed to export ".concat(t.name,":"),e),E({variant:"destructive",title:"Failed to export ".concat(t.name)})}l++}let t=await s.generateAsync({type:"blob"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download="exported_creatures.zip",document.body.appendChild(a),a.click(),document.body.removeChild(a),E({title:"Export finished!",description:"".concat(e.length," creature(s) have been exported.")})}catch(e){console.error("Export failed",e),E({variant:"destructive",title:"Export Failed",description:"An unexpected error occurred."})}finally{V(!1),O(null),q(""),D(!1),P(new Set)}},Y=(e,s)=>e.filter(e=>{let l=e.name.toLowerCase().includes(s.searchTerm.toLowerCase()),t="all"===s.roleFilter||e.role===s.roleFilter,a="all"===s.templateFilter||e.template===s.templateFilter,r=!0;s.minLevel&&!isNaN(parseInt(s.minLevel))&&(r=r&&e.level>=parseInt(s.minLevel,10)),s.maxLevel&&!isNaN(parseInt(s.maxLevel))&&(r=r&&e.level<=parseInt(s.maxLevel,10));let n=!0;s.minTR&&!isNaN(parseInt(s.minTR))&&(n=n&&e.TR>=parseInt(s.minTR,10)),s.maxTR&&!isNaN(parseInt(s.maxTR))&&(n=n&&e.TR<=parseInt(s.maxTR,10));let i=!0;if(s.tagFilter){let l=s.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);l.length>0&&(i=e.tags&&e.tags.length>0&&l.every(s=>e.tags.some(e=>e.toLowerCase().includes(s))))}return l&&t&&a&&r&&n&&i}),X=(0,a.useMemo)(()=>Y(M,_),[M,_]),ee=(0,a.useMemo)(()=>{let e=Y(M,T).sort((e,s)=>{if("TR"===T.sortBy){let l=e.TR-s.TR;if(0!==l)return l}if("level"===T.sortBy){let l=e.level-s.level;if(0!==l)return l}return e.name.localeCompare(s.name)});return"desc"===T.sortOrder&&e.reverse(),e},[M,T]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.lG,{open:$,children:(0,t.jsxs)(N.Cf,{className:"sm:max-w-md",onInteractOutside:e=>e.preventDefault(),children:[(0,t.jsxs)(N.c7,{children:[(0,t.jsx)(N.L3,{children:"Exporting Creatures"}),(0,t.jsx)(N.rr,{children:"Please wait while the creature cards are being generated."})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-4",children:[(0,t.jsx)("div",{className:"min-h-[200px]",children:(0,t.jsx)("div",{ref:W,children:U&&(0,t.jsx)(S,{creature:U})})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(u.A,{className:"animate-spin h-4 w-4"}),(0,t.jsx)("span",{children:H})]})]})]})}),(0,t.jsxs)("div",{className:"border-r border-border bg-card flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(c.$,{onClick:l,className:"w-full",children:[(0,t.jsx)(j.A,{})," New Creature"]}),(0,t.jsxs)(N.lG,{open:J,onOpenChange:D,children:[(0,t.jsx)(N.zM,{asChild:!0,children:(0,t.jsx)(c.$,{variant:"outline",className:"px-3",title:"Export as PNG",children:(0,t.jsx)(p.A,{})})}),(0,t.jsxs)(N.Cf,{className:"sm:max-w-4xl",children:[(0,t.jsxs)(N.c7,{children:[(0,t.jsx)(N.L3,{children:"Export Creatures to PNG"}),(0,t.jsx)(N.rr,{children:"Select the creatures you want to export. They will be downloaded as a single ZIP file."})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"w-64 flex-shrink-0 space-y-4",children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Filters"}),(0,t.jsx)(i.p,{placeholder:"Search...",value:_.searchTerm,onChange:e=>K(s=>({...s,searchTerm:e.target.value}))}),(0,t.jsxs)(m.l6,{value:_.templateFilter,onValueChange:e=>K(s=>({...s,templateFilter:e})),children:[(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"All Templates"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"all",children:"All Templates"}),F.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))]})]}),(0,t.jsxs)(m.l6,{value:_.roleFilter,onValueChange:e=>K(s=>({...s,roleFilter:e})),children:[(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"All Roles"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"all",children:"All Roles"}),n.gg.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.p,{placeholder:"Min Lvl",type:"number",value:_.minLevel,onChange:e=>K(s=>({...s,minLevel:e.target.value}))}),(0,t.jsx)(i.p,{placeholder:"Max Lvl",type:"number",value:_.maxLevel,onChange:e=>K(s=>({...s,maxLevel:e.target.value}))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.p,{placeholder:"Min TR",type:"number",value:_.minTR,onChange:e=>K(s=>({...s,minTR:e.target.value}))}),(0,t.jsx)(i.p,{placeholder:"Max TR",type:"number",value:_.maxTR,onChange:e=>K(s=>({...s,maxTR:e.target.value}))})]}),(0,t.jsx)(b.F,{value:_.tagFilter?_.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>K(s=>({...s,tagFilter:e.join(",")})),placeholder:"Tags...",tagSource:"creature"}),(0,t.jsx)(c.$,{variant:"ghost",className:"w-full",onClick:()=>K(Z),children:"Clear Filters"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)(h.J,{children:[G.size," of ",X.length," selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.$,{variant:"link",className:"p-0 h-auto",onClick:()=>{let e=new Set(X.map(e=>e.id));P(s=>new Set([...Array.from(s),...Array.from(e)]))},children:"Select All Visible"}),(0,t.jsx)(c.$,{variant:"link",className:"p-0 h-auto",onClick:()=>{let e=new Set(X.map(e=>e.id));P(s=>{let l=new Set(s);return e.forEach(e=>l.delete(e)),l})},children:"Deselect All Visible"})]})]}),(0,t.jsx)(d.F,{className:"h-64 border rounded-md",children:(0,t.jsx)("div",{className:"p-4 space-y-2",children:X.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.S,{id:"export-".concat(e.id),checked:G.has(e.id),onCheckedChange:s=>{P(l=>{let t=new Set(l);return s?t.add(e.id):t.delete(e.id),t})}}),(0,t.jsx)(h.J,{htmlFor:"export-".concat(e.id),className:"font-normal",children:e.name})]},e.id))})})]})]}),(0,t.jsxs)(N.Es,{className:"mt-4",children:[(0,t.jsx)(c.$,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,t.jsx)(c.$,{onClick:Q,disabled:$||0===G.size,children:$?"Exporting...":"Export ".concat(G.size," Creature(s)")})]})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(g.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(i.p,{placeholder:"Search creatures...",value:T.searchTerm,onChange:e=>R.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(h.J,{children:"Filter"}),(0,t.jsx)(c.$,{variant:"ghost",size:"sm",onClick:A,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,t.jsxs)(m.l6,{value:T.templateFilter,onValueChange:R.setTemplateFilter,children:[(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Filter by template"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"all",children:"All Templates"}),F.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))]})]}),(0,t.jsxs)(m.l6,{value:T.roleFilter,onValueChange:R.setRoleFilter,children:[(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Filter by role"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"all",children:"All Roles"}),n.gg.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.p,{placeholder:"Min Lvl",type:"number",value:T.minLevel,onChange:e=>R.setMinLevel(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,t.jsx)(i.p,{placeholder:"Max Lvl",type:"number",value:T.maxLevel,onChange:e=>R.setMaxLevel(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.p,{placeholder:"Min TR",type:"number",value:T.minTR,onChange:e=>R.setMinTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,t.jsx)(i.p,{placeholder:"Max TR",type:"number",value:T.maxTR,onChange:e=>R.setMaxTR(e.target.value),className:"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),(0,t.jsx)(b.F,{value:T.tagFilter?T.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>R.setTagFilter(e.join(",")),placeholder:"Tags (e.g. undead, goblin)",tagSource:"creature"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Sort by"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(m.l6,{value:T.sortBy,onValueChange:e=>R.setSortBy(e),children:[(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Sort by"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"name",children:"Name"}),(0,t.jsx)(m.eb,{value:"TR",children:"TR"}),(0,t.jsx)(m.eb,{value:"level",children:"Level"})]})]}),(0,t.jsxs)(c.$,{variant:"ghost",size:"icon",onClick:()=>R.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===T.sortOrder?(0,t.jsx)(f.A,{className:"h-4 w-4"}):(0,t.jsx)(v.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,t.jsx)(o.w,{}),(0,t.jsx)(d.F,{className:"flex-1",children:(0,t.jsx)("div",{className:"p-4",children:I?(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading creatures..."}):ee.length>0?(0,t.jsx)("ul",{className:"space-y-1",children:ee.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(y===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,t.jsxs)("span",{className:"text-xs opacity-70",children:["(Lvl ",e.level," / TR ",e.TR,")"]})]})},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"No creatures found."})})})]})]})}var B=l(62177),I=l(90221),L=l(55594),E=l(23062),J=l(66695),D=l(88539),G=l(90010),P=l(17759),$=l(14337),V=l(12543),U=l(15599),O=l(18763),H=l(68098),q=l(14014),W=l(89829),Z=l(64442),_=l(45731),K=l(69479),Q=l(77119),Y=l(18051),X=l(77223),ee=l(25318),es=l(18046),el=l(21887),et=l(53054),ea=l(68856),er=l(8643),en=l(88911),ei=l(26126),ec=l(47906);let ed=["Normal","Underling","Paragon","Tyrant"],eo=L.z.object({start:L.z.string().optional(),base:L.z.string().optional(),hit:L.z.string().optional(),spark:L.z.string().optional(),shadow:L.z.string().optional(),after:L.z.string().optional()}),ex=L.z.object({id:L.z.string().optional(),name:L.z.string().min(1,"Deed name is required"),tier:L.z.enum(["light","heavy","mighty","tyrant","special"]),actionType:L.z.enum(E.GW),deedType:L.z.enum(E.FC),versus:L.z.enum(E.OJ),target:L.z.string().optional(),effects:eo,tags:L.z.array(L.z.string()).optional()}),eh=L.z.object({id:L.z.string(),name:L.z.string().min(1,"Ability name is required"),description:L.z.string().min(1,"Ability description is required")}),em=L.z.object({name:L.z.string().min(1,"Name is required"),level:L.z.coerce.number().int().min(1).max(10),role:L.z.enum(n.gg),template:L.z.enum(ed),TR:L.z.coerce.number().int().min(0),attributes:L.z.object({HP:L.z.coerce.number().int().min(0),Speed:L.z.coerce.number().int().min(0),Initiative:L.z.coerce.number().int().min(0),Accuracy:L.z.coerce.number().int().min(0),Guard:L.z.coerce.number().int().min(0),Resist:L.z.coerce.number().int().min(0),rollBonus:L.z.coerce.number().int().min(0),DMG:L.z.string()}),deeds:L.z.array(ex),abilities:L.z.array(eh).optional(),description:L.z.string().optional(),tags:L.z.array(L.z.string()).optional()}),eu={name:"",level:1,role:"Archer",template:"Normal",TR:1,attributes:{HP:20,Speed:5,Initiative:14,Accuracy:16,Guard:12,Resist:12,rollBonus:4,DMG:"d6"},deeds:[],abilities:[],description:"",tags:[]},ej=e=>{let{onAddDeeds:s,allDeeds:l,existingDeedIds:r}=e,[n,o]=(0,a.useState)(!1),[x,h]=(0,a.useState)(new Set),[u,j]=(0,a.useState)(""),[p,g]=(0,a.useState)("all"),[f,v]=(0,a.useState)(""),b=(0,a.useMemo)(()=>l.filter(e=>{let s=e.name.toLowerCase().includes(u.toLowerCase()),l="all"===p||e.tier===p,t=f.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean),a=0===t.length||e.tags&&t.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)));return s&&l&&a}),[l,u,p,f]),y=e=>{h(s=>{let l=new Set(s);return l.has(e)?l.delete(e):l.add(e),l})};return(0,t.jsxs)(N.lG,{open:n,onOpenChange:o,children:[(0,t.jsx)(N.zM,{asChild:!0,children:(0,t.jsxs)(c.$,{type:"button",size:"sm",variant:"outline",children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"})," Add From Library"]})}),(0,t.jsxs)(N.Cf,{className:"max-w-2xl h-[70vh] flex flex-col",children:[(0,t.jsxs)(N.c7,{children:[(0,t.jsx)(N.L3,{children:"Select Deeds from Library"}),(0,t.jsx)(N.rr,{children:"Select one or more deeds to add to the creature."})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-4 flex-wrap",children:[(0,t.jsx)(i.p,{placeholder:"Search deeds...",value:u,onChange:e=>j(e.target.value),className:"flex-1 min-w-[150px]"}),(0,t.jsxs)(m.l6,{value:p,onValueChange:g,children:[(0,t.jsx)(m.bq,{className:"w-full sm:w-[120px]",children:(0,t.jsx)(m.yv,{placeholder:"Filter tier"})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"all",children:"All Tiers"}),(0,t.jsx)(m.eb,{value:"light",children:"Light"}),(0,t.jsx)(m.eb,{value:"heavy",children:"Heavy"}),(0,t.jsx)(m.eb,{value:"mighty",children:"Mighty"})]})]}),(0,t.jsx)(i.p,{placeholder:"Filter by tags...",value:f,onChange:e=>v(e.target.value),className:"flex-1 min-w-[150px]"})]}),(0,t.jsx)(d.F,{className:"flex-1 border rounded-md p-4",children:(0,t.jsx)("div",{className:"space-y-2",children:b.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(w.S,{id:"deed-".concat(e.id),onCheckedChange:()=>y(e.id),checked:x.has(e.id),disabled:r.has(e.id)}),(0,t.jsxs)("label",{htmlFor:"deed-".concat(e.id),className:"flex-1",children:[(0,t.jsxs)("p",{className:"font-semibold",children:[e.name," ",(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.tier,")"]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.effects.hit})]})]},e.id))})}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,t.jsx)(c.$,{variant:"ghost",onClick:()=>o(!1),children:"Cancel"}),(0,t.jsx)(c.$,{onClick:()=>{s(l.filter(e=>x.has(e.id))),o(!1),h(new Set),j(""),g("all"),v("")},disabled:0===x.size,children:"Add Selected"})]})]})]})};function ep(e){let{creatureId:s,isCreatingNew:l,template:d,onCreatureSaveSuccess:u,onCreatureDeleteSuccess:j,onUseAsTemplate:p,onEditCancel:g,dataVersion:f,onFilterByClick:v,onBack:N}=e,{toast:w}=(0,x.dj)(),[y,C]=(0,a.useState)(l),[T,R]=(0,a.useState)(!l&&!!s),[S,z]=(0,a.useState)(null),[A,k]=(0,a.useState)([]),F=(0,ec.a)(),M=(0,a.useMemo)(()=>{if(l)if(d){let e={...eu,...d,abilities:(d.abilities||[]).map(e=>({...e,id:e.id||crypto.randomUUID()})),description:d.description||"",tags:d.tags||[],deeds:(d.deeds||[]).map(e=>{var s,l,t,a,r,n;return{...e,effects:{start:(null==(s=e.effects)?void 0:s.start)||"",base:(null==(l=e.effects)?void 0:l.base)||"",hit:(null==(t=e.effects)?void 0:t.hit)||"",spark:(null==(a=e.effects)?void 0:a.spark)||"",shadow:(null==(r=e.effects)?void 0:r.shadow)||"",after:(null==(n=e.effects)?void 0:n.after)||""},tags:e.tags||[]}})};return delete e.id,e}else{let e=(0,n.GQ)(eu.role,eu.level);return{...eu,attributes:e||eu.attributes}}return eu},[l,d]),L=(0,B.mN)({resolver:(0,I.u)(em),defaultValues:M}),{fields:$,append:eo,remove:ex,replace:eh}=(0,B.jz)({control:L.control,name:"deeds"}),{fields:ep,append:eg,remove:ef}=(0,B.jz)({control:L.control,name:"abilities"}),{watch:ev,setValue:eb,getValues:eN}=L,ew=ev("role"),ey=ev("level"),eC=ev("template"),eT=ev();(0,a.useEffect)(()=>{if(y){let e=(0,n.GQ)(ew,ey);if(e){let s=(0,n.TP)(eC,ey),l=e.HP,t=e.DMG;switch(eC){case"Underling":l=1,t=(0,n.ED)(e.DMG),eh(eN("deeds").filter(e=>"light"===e.tier));break;case"Paragon":l=2*e.HP;break;case"Tyrant":l=4*e.HP}eb("attributes",{...e,HP:l,DMG:t}),eb("TR",s)}}},[ew,ey,eC,eb,y,eN,eh]),(0,a.useEffect)(()=>{(0,r.xy)().then(k).catch(e=>console.error("Could not fetch all deeds",e))},[f]),(0,a.useEffect)(()=>{(async()=>{if(l||!s){C(l),R(!1),z(d||null);return}R(!0),C(!1);try{let e=await (0,r.s2)(s);if(e){let s=await (0,r.pT)(e.deeds),l=[];"string"==typeof e.abilities&&e.abilities.length>0?l=e.abilities.split("\n\n").map(e=>{let s=e.match(RegExp("\\*\\*(.*?):\\*\\*\\s*(.*)","s"));return s&&s[1]&&s[2]?{id:crypto.randomUUID(),name:s[1],description:s[2].trim()}:!s&&e.trim()?{id:crypto.randomUUID(),name:"Ability",description:e.trim()}:null}).filter(e=>null!==e):Array.isArray(e.abilities)&&(l=e.abilities.map(e=>({...e,id:e.id||crypto.randomUUID()})));let t={...e,abilities:l,deeds:s};z(t);let a={...eu,...t,description:t.description||"",template:t.template||"Normal",tags:t.tags||[],deeds:s.map(e=>{var s,l,t,a,r,n;return{...e,effects:{start:(null==(s=e.effects)?void 0:s.start)||"",base:(null==(l=e.effects)?void 0:l.base)||"",hit:(null==(t=e.effects)?void 0:t.hit)||"",spark:(null==(a=e.effects)?void 0:a.spark)||"",shadow:(null==(r=e.effects)?void 0:r.shadow)||"",after:(null==(n=e.effects)?void 0:n.after)||""},tags:e.tags||[]}})};L.reset(a)}}catch(e){console.error("Failed to fetch creature data:",e),w({variant:"destructive",title:"Error",description:"Could not load creature data."})}finally{R(!1)}})()},[s,l,L,w,f,d]);let eR=async e=>{try{"Underling"===e.template&&(e.deeds=e.deeds.filter(e=>"light"===e.tier));let t=e.deeds.map(e=>{if(!e.id){let{id:s,...l}=e,t={...l,tags:l.tags||[]};return(0,r.W$)(t)}return Promise.resolve(e.id)}),a=await Promise.all(t),n={...e,tags:e.tags||[],abilities:e.abilities||[],deeds:a},i=e.tags||[];if(i.length>0&&await (0,r.JE)(i,"creature"),l){let s=await (0,r.RW)(n);w({title:"Creature Created!",description:"".concat(e.name," has been added to the bestiary.")}),u(s)}else s&&(await (0,r.ZK)({...n,id:s}),w({title:"Save Successful",description:"".concat(e.name," has been updated.")}),u(s));C(!1)}catch(e){console.error("Failed to save creature:",e),w({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},eS=async()=>{if(s)try{await (0,r.PW)(s),w({title:"Creature Deleted",description:"The creature has been removed from the bestiary."}),j()}catch(e){console.error("Failed to delete creature:",e),w({variant:"destructive",title:"Deletion Failed",description:"Could not delete the creature."})}},ez=()=>{if(l)g();else{if(S){let e={...eu,...S,description:S.description||"",template:S.template||"Normal",tags:S.tags||[],deeds:S.deeds.map(e=>{var s,l,t,a,r,n;return{...e,effects:{start:(null==(s=e.effects)?void 0:s.start)||"",base:(null==(l=e.effects)?void 0:l.base)||"",hit:(null==(t=e.effects)?void 0:t.hit)||"",spark:(null==(a=e.effects)?void 0:a.spark)||"",shadow:(null==(r=e.effects)?void 0:r.shadow)||"",after:(null==(n=e.effects)?void 0:n.after)||""},tags:e.tags||[]}})};L.reset(e)}C(!1)}},eA={light:0,heavy:1,mighty:2,tyrant:3,special:4},ek=(0,a.useMemo)(()=>new Set($.map(e=>e.id).filter(Boolean)),[$]);if(T&&!l)return(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsxs)(J.Zp,{children:[(0,t.jsxs)(J.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ea.E,{className:"h-8 w-48"}),(0,t.jsx)(ea.E,{className:"h-4 w-32"})]}),(0,t.jsx)(ea.E,{className:"h-10 w-24"})]}),(0,t.jsxs)(J.Wu,{children:[(0,t.jsx)(o.w,{className:"my-6"}),(0,t.jsx)(ea.E,{className:"h-6 w-32 mb-4"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"}),(0,t.jsx)(ea.E,{className:"h-12 w-full"})]}),(0,t.jsx)(o.w,{className:"my-6"}),(0,t.jsx)(ea.E,{className:"h-6 w-32 mb-4"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(ea.E,{className:"h-24 w-full"}),(0,t.jsx)(ea.E,{className:"h-24 w-full"})]})]})]})});if(!l&&!s&&!T)return(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsx)(J.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,t.jsxs)(J.Wu,{className:"text-center pt-6",children:[(0,t.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a creature to view"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})});if(!y&&s&&S){let e=[...S.deeds].sort((e,s)=>eA[e.tier]-eA[s.tier]);return(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsxs)(J.Zp,{children:[(0,t.jsx)(J.aR,{children:(0,t.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[F&&N&&(0,t.jsx)(c.$,{variant:"ghost",size:"icon",onClick:N,className:"-ml-4 -mt-1",children:(0,t.jsx)(V.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(J.ZB,{className:"text-3xl font-bold",children:S.name}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-muted-foreground flex flex-col items-start gap-1",children:[(0,t.jsx)("p",{children:(0,t.jsxs)("button",{onClick:e=>v({templateFilter:S.template,roleFilter:S.role,minLevel:S.level,maxLevel:S.level},e),className:"hover:underline p-0 bg-transparent text-inherit",children:["Lvl ",S.level," ",S.template," ",S.role]})}),(0,t.jsx)("p",{children:(0,t.jsxs)("button",{onClick:e=>v({minTR:S.TR,maxTR:S.TR},e),className:"hover:underline p-0 bg-transparent text-inherit",children:["TR ",S.TR]})}),S.tags&&S.tags.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:S.tags.map(e=>(0,t.jsx)("button",{onClick:s=>v({tagFilter:e},s),className:"bg-transparent border-none p-0 m-0",children:(0,t.jsx)(ei.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{S&&p(S)},children:[(0,t.jsx)(U.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Template"})]}),(0,t.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>C(!0),children:[(0,t.jsx)(O.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]})]})]})}),(0,t.jsxs)(J.Wu,{children:[(0,t.jsx)(o.w,{className:"my-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4 text-primary-foreground",children:"Attributes"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-x-6 gap-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"HP"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.HP})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(q.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Speed"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.Speed})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Initiative"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.Initiative})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Z.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Accuracy"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.Accuracy})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(_.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Guard"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.Guard})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(K.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Resist"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.Resist})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"Roll Bonus"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.rollBonus>0?"+".concat(S.attributes.rollBonus):S.attributes.rollBonus})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Y.A,{className:"h-5 w-5 text-accent"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.J,{children:"DMG"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:S.attributes.DMG})]})]})]})]}),S.abilities&&S.abilities.length>0&&(0,t.jsx)(o.w,{className:"my-6"}),S.abilities&&S.abilities.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2 text-primary-foreground",children:"Abilities"}),(0,t.jsx)("div",{className:"space-y-2",children:S.abilities.map(e=>(0,t.jsxs)("p",{className:"text-foreground/90 whitespace-pre-wrap",children:[(0,t.jsxs)("span",{className:"font-bold",children:[e.name,":"]})," ",e.description]},e.id))})]}),(0,t.jsx)(o.w,{className:"my-6"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4 text-primary-foreground",children:"Deeds"}),e.length>0?e.map((e,s)=>(0,t.jsx)(en.P,{deed:e,dmgReplacement:S.attributes.DMG},s)):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No deeds defined."})]}),S.description&&(0,t.jsx)(o.w,{className:"my-6"}),S.description&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2 text-primary-foreground",children:"Description"}),(0,t.jsx)("p",{className:"text-foreground/90 whitespace-pre-wrap",children:S.description})]})]}),(0,t.jsx)(J.wL,{children:(0,t.jsxs)(G.Lt,{children:[(0,t.jsx)(G.tv,{asChild:!0,children:(0,t.jsx)(c.$,{type:"button",variant:"destructive",size:"sm",children:(0,t.jsx)(X.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(G.EO,{children:[(0,t.jsxs)(G.wd,{children:[(0,t.jsx)(G.r7,{children:"Are you sure?"}),(0,t.jsxs)(G.$v,{children:['This will permanently delete "',L.getValues("name"),'". This action cannot be undone.']})]}),(0,t.jsxs)(G.ck,{children:[(0,t.jsx)(G.Zr,{children:"Cancel"}),(0,t.jsx)(G.Rx,{onClick:eS,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})})}return(0,t.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,t.jsx)(J.Zp,{children:(0,t.jsx)(P.lV,{...L,children:(0,t.jsxs)("form",{onSubmit:L.handleSubmit(eR),className:"space-y-6",children:[(0,t.jsx)(J.aR,{children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[F&&N&&(0,t.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:ez,className:"-ml-4",children:(0,t.jsx)(V.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(J.ZB,{children:l?F?"New Creature":"Create a New Creature":"Editing: ".concat((null==S?void 0:S.name)||"...")}),(0,t.jsx)(J.BT,{children:l?"Fill out the details for your new creature.":"Make your changes and click Save."})]})]}),!F&&(0,t.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:ez,className:"text-muted-foreground hover:text-foreground",children:(0,t.jsx)(ee.A,{className:"h-5 w-5"})})]})}),(0,t.jsxs)(J.Wu,{className:"space-y-8 pt-0",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)(P.zB,{name:"name",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{className:"lg:col-span-2",children:[(0,t.jsx)(P.lR,{children:"Name"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{placeholder:"e.g., Gloomfang Serpent",...s})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"level",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Level"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",min:"1",max:"10",...s})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"TR",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"TR"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})}),(0,t.jsx)(P.C5,{})]})}})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsx)(P.zB,{name:"template",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Template"}),(0,t.jsxs)(m.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Select a template"})})}),(0,t.jsx)(m.gC,{children:ed.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))})]}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"role",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Role"}),(0,t.jsxs)(m.l6,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Select a role"})})}),(0,t.jsx)(m.gC,{children:n.gg.map(e=>(0,t.jsx)(m.eb,{value:e,children:e},e))})]}),(0,t.jsx)(P.C5,{})]})}})]}),(0,t.jsx)(o.w,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4 text-primary-foreground",children:"Attributes"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4",children:[(0,t.jsx)(P.zB,{name:"attributes.HP",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(H.A,{className:"h-4 w-4 text-accent"}),"HP"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.Speed",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(q.A,{className:"h-4 w-4 text-accent"}),"Speed"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.Initiative",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(W.A,{className:"h-4 w-4 text-accent"}),"Initiative"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.Accuracy",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4 text-accent"}),"Accuracy"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.Guard",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(_.A,{className:"h-4 w-4 text-accent"}),"Guard"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.Resist",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(K.A,{className:"h-4 w-4 text-accent"}),"Resist"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.rollBonus",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.A,{className:"h-4 w-4 text-accent"}),"Roll Bonus"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{type:"number",...s})})]})}}),(0,t.jsx)(P.zB,{name:"attributes.DMG",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4 text-accent"}),"DMG"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{...s})})]})}})]})]}),(0,t.jsx)(o.w,{}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Abilities"}),(0,t.jsxs)(c.$,{type:"button",size:"sm",variant:"outline",onClick:()=>eg({id:crypto.randomUUID(),name:"",description:""}),children:[(0,t.jsx)(es.A,{className:"h-4 w-4 mr-2"})," Add Ability"]})]}),(0,t.jsx)("div",{className:"space-y-4",children:ep.map((e,s)=>(0,t.jsxs)("div",{className:"border bg-card-foreground/5 rounded-lg p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(P.zB,{name:"abilities.".concat(s,".name"),control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{className:"flex-1",children:[(0,t.jsx)(P.lR,{children:"Ability Name"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{placeholder:"e.g., Ogre's Wrath",...s})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ef(s),className:"text-muted-foreground hover:text-destructive self-end",children:(0,t.jsx)(X.A,{className:"h-4 w-4"})})]}),(0,t.jsx)(P.zB,{name:"abilities.".concat(s,".description"),control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Ability Description"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{rows:3,...s})}),(0,t.jsx)(P.C5,{})]})}})]},e.id))})]}),(0,t.jsx)(o.w,{}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Deeds"}),(0,t.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,t.jsx)(ej,{onAddDeeds:e=>{let s=e.map(e=>({...e,tags:e.tags||[]}));if("Underling"===eN("template")){let e=s.filter(e=>"light"===e.tier);e.length<s.length&&w({variant:"destructive",title:"Warning",description:"Only Light deeds can be added to Underlings."}),eo(e)}else eo(s)},allDeeds:A,existingDeedIds:ek}),(0,t.jsxs)(c.$,{type:"button",size:"sm",variant:"outline",onClick:()=>eo({name:"",tier:"light",actionType:"attack",deedType:"melee",versus:"guard",target:"",effects:{start:"",base:"",hit:"",spark:"",shadow:"",after:""},tags:[]}),children:[(0,t.jsx)(es.A,{className:"h-4 w-4 mr-2"})," Create New"]})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:$.map((e,s)=>{var l,a,r,n;return(0,t.jsxs)(er.Nt,{defaultOpen:!L.getValues("deeds.".concat(s,".name")),className:"border bg-card-foreground/5 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(er.R6,{asChild:!0,children:(0,t.jsxs)("button",{type:"button",className:"flex items-center gap-3 text-left w-full",children:[(0,t.jsx)(el.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-lg font-semibold text-primary-foreground",children:(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.name)||"New Deed"}),(null==(n=eT.deeds)||null==(r=n[s])?void 0:r.id)&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(from library)"})]})}),(0,t.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ex(s),className:"text-muted-foreground hover:text-destructive",children:(0,t.jsx)(X.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)(er.Ke,{className:"mt-6 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".name"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Deed Name"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{placeholder:"e.g., Inferno",...r,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".tier"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Tier"}),(0,t.jsxs)(m.l6,{onValueChange:r.onChange,value:r.value,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)||"Underling"===eC,children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Select tier"})})}),(0,t.jsxs)(m.gC,{children:[(0,t.jsx)(m.eb,{value:"light",children:"Light"}),(0,t.jsx)(m.eb,{value:"heavy",children:"Heavy"}),(0,t.jsx)(m.eb,{value:"mighty",children:"Mighty"}),(0,t.jsx)(m.eb,{value:"tyrant",children:"Tyrant"}),(0,t.jsx)(m.eb,{value:"special",children:"Special"})]})]}),(0,t.jsx)(P.C5,{})]})}})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".deedType"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Deed Type"}),(0,t.jsxs)(m.l6,{onValueChange:r.onChange,value:r.value,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id),children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Type"})})}),(0,t.jsx)(m.gC,{children:E.FC.map(e=>(0,t.jsx)(m.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".actionType"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Action Type"}),(0,t.jsxs)(m.l6,{onValueChange:r.onChange,value:r.value,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id),children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Action"})})}),(0,t.jsx)(m.gC,{children:E.GW.map(e=>(0,t.jsx)(m.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".versus"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Versus"}),(0,t.jsxs)(m.l6,{onValueChange:r.onChange,value:r.value,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id),children:[(0,t.jsx)(P.MJ,{children:(0,t.jsx)(m.bq,{children:(0,t.jsx)(m.yv,{placeholder:"Versus"})})}),(0,t.jsx)(m.gC,{children:E.OJ.map(e=>(0,t.jsx)(m.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,t.jsx)(P.C5,{})]})}})]}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".target"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Target"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(i.p,{placeholder:"e.g., 1 Creature | Blast 4",...r,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-primary-foreground",children:"Effects"}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.start"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["Start ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"Effect when a creature starts its turn in an area...",...r,rows:2,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.base"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["Base ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"Base effect of the deed...",...r,rows:2,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.hit"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["Hit ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"The primary effect on a successful hit...",...r,rows:3,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.spark"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["Spark (Critical Hit) ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"The effect on a critical hit...",...r,rows:2,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.shadow"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["Shadow (Critical Failure) ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"The effect on a critical failure...",...r,rows:3,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})}),(0,t.jsx)(P.C5,{})]})}}),(0,t.jsx)(P.zB,{name:"deeds.".concat(s,".effects.after"),control:L.control,render:e=>{var l,a;let{field:r}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{children:["After ",(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"Effect at the end of a creature's turn...",...r,rows:2,disabled:!!(null==(a=eT.deeds)||null==(l=a[s])?void 0:l.id)})})]})}})]})]})]},e.id)})})]}),(0,t.jsx)(o.w,{}),(0,t.jsx)(P.zB,{name:"description",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsx)(P.lR,{children:"Description"}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(D.T,{placeholder:"A short description of the creature...",rows:5,...s})})]})}}),(0,t.jsx)(P.zB,{name:"tags",control:L.control,render:e=>{let{field:s}=e;return(0,t.jsxs)(P.eI,{children:[(0,t.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(et.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,t.jsx)(P.MJ,{children:(0,t.jsx)(b.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"creature"})}),(0,t.jsx)(P.C5,{})]})}})]}),(0,t.jsxs)(J.wL,{className:"flex items-center gap-2",children:[!l&&(0,t.jsxs)(G.Lt,{children:[(0,t.jsx)(G.tv,{asChild:!0,children:(0,t.jsx)(c.$,{type:"button",variant:"destructive",size:"sm",children:(0,t.jsx)(X.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(G.EO,{children:[(0,t.jsxs)(G.wd,{children:[(0,t.jsx)(G.r7,{children:"Are you sure?"}),(0,t.jsxs)(G.$v,{children:['This will permanently delete "',L.getValues("name"),'". This action cannot be undone.']})]}),(0,t.jsxs)(G.ck,{children:[(0,t.jsx)(G.Zr,{children:"Cancel"}),(0,t.jsx)(G.Rx,{onClick:eS,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,t.jsx)("div",{className:"flex-grow"}),!F&&(0,t.jsx)(c.$,{type:"button",variant:"outline",onClick:ez,children:"Cancel"}),(0,t.jsx)(c.$,{type:"submit",children:l?"Create Creature":"Save Changes"})]})]})})})})}var eg=l(20031),ef=l(88972);function ev(){let[e,s]=(0,a.useState)(null),[l,r]=(0,a.useState)(!1),[n,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(0),[o,x]=(0,a.useState)(""),[h,m]=(0,a.useState)("all"),[u,j]=(0,a.useState)("all"),[p,g]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[b,N]=(0,a.useState)(""),[w,y]=(0,a.useState)(""),[C,T]=(0,a.useState)(""),[R,S]=(0,a.useState)("name"),[z,A]=(0,a.useState)("asc"),[k,F]=(0,a.useState)(!1),B=(0,ec.a)(),[I,L]=(0,a.useState)("list");(0,a.useEffect)(()=>{F(!0)},[]);let E={searchTerm:o,roleFilter:h,templateFilter:u,minLevel:p,maxLevel:f,minTR:b,maxTR:w,tagFilter:C,sortBy:R,sortOrder:z},J={setSearchTerm:x,setRoleFilter:m,setTemplateFilter:j,setMinLevel:g,setMaxLevel:v,setMinTR:N,setMaxTR:y,setTagFilter:T,setSortBy:S,setSortOrder:A},D=(e,s)=>{s.shiftKey?(e.roleFilter&&m(e.roleFilter),e.templateFilter&&j(e.templateFilter),void 0!==e.minLevel&&g(String(e.minLevel)),void 0!==e.maxLevel&&v(String(e.maxLevel)),void 0!==e.minTR&&N(String(e.minTR)),void 0!==e.maxTR&&y(String(e.maxTR)),e.tagFilter&&T(s=>s?s.split(",").map(e=>e.trim()).includes(e.tagFilter)?s:"".concat(s,", ").concat(e.tagFilter):e.tagFilter)):(m(e.roleFilter||"all"),j(e.templateFilter||"all"),g(void 0!==e.minLevel?String(e.minLevel):""),v(void 0!==e.maxLevel?String(e.maxLevel):""),N(void 0!==e.minTR?String(e.minTR):""),y(void 0!==e.maxTR?String(e.maxTR):""),T(e.tagFilter||""))},G=()=>{x(""),m("all"),j("all"),g(""),v(""),N(""),y(""),T(""),S("name"),A("asc")},P=()=>d(e=>e+1),$=e=>{s(e),r(!1),i(null),B&&L("editor")},V=()=>{s(null),r(!0),i(null),B&&L("editor")},U=e=>{let l={...e},t=(e.name||"creature").replace(/^(Copy of\s*)+/,"");l.name="Copy of ".concat(t),delete l.id,s(null),r(!0),i(l),B&&L("editor")},O=e=>{P(),s(e),r(!1),i(null),B&&L("editor")},H=()=>{P(),s(null),r(!1),i(null),B&&L("list")},q=()=>{l&&(r(!1),s(null),B&&L("list"))};return k?B?(0,t.jsx)(ef.A,{children:(0,t.jsx)("div",{className:"h-full w-full",children:"list"===I?(0,t.jsx)(M,{onSelectCreature:$,onNewCreature:V,selectedCreatureId:e,dataVersion:c,filters:E,setFilters:J,onClearFilters:G}):(0,t.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,t.jsx)("div",{className:"p-4 sm:p-6",children:(0,t.jsx)(ep,{creatureId:e,isCreatingNew:l,template:n,onCreatureSaveSuccess:O,onCreatureDeleteSuccess:H,onUseAsTemplate:U,onEditCancel:q,dataVersion:c,onFilterByClick:D,onBack:()=>{L("list"),s(null),r(!1),i(null)}},null!=e?e:l?"new":"placeholder")})})})}):(0,t.jsx)(eg.SidebarProvider,{children:(0,t.jsx)(ef.A,{children:(0,t.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,t.jsx)(eg.Bx,{style:{"--sidebar-width":"380px"},children:(0,t.jsx)(M,{onSelectCreature:$,onNewCreature:V,selectedCreatureId:e,dataVersion:c,filters:E,setFilters:J,onClearFilters:G})}),(0,t.jsx)(eg.sF,{className:"flex-1 overflow-y-auto",children:(0,t.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,t.jsx)(ep,{creatureId:e,isCreatingNew:l,template:n,onCreatureSaveSuccess:O,onCreatureDeleteSuccess:H,onUseAsTemplate:U,onEditCancel:q,dataVersion:c,onFilterByClick:D},null!=e?e:l?"new":"placeholder")})})]})})}):null}},23062:(e,s,l)=>{l.d(s,{FC:()=>a,GW:()=>t,H1:()=>u,OJ:()=>r,Rb:()=>x,Vx:()=>j,Vz:()=>m,Yh:()=>n,_d:()=>p,ag:()=>i,gG:()=>g,gV:()=>o,qY:()=>d,w$:()=>c,zE:()=>h});let t=["attack","support"],a=["melee","missile","innate","unarmed","spell","item","versatile"],r=["guard","resist","10","special"],n=["potion","powder","oil","bomb"],i=["lesser","greater"],c=["weapon","armor","shield","tool"],d=["crude","normal","fine"],o=["normal","magical","artifact"],x=["melee","missile","spell","unarmed"],h=["d4","d6","d8","d10","d12","d20"],m=["one-handed","two-handed","thrown"],u=["head","chest","arms","legs","outer"],j=["head","chest","arms","legs","outer","shield"],p=["None","Light","Heavy"],g=["d4","d6","d8","d10","d12","d20"]}}]);
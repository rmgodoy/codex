(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{8643:(e,t,s)=>{"use strict";s.d(t,{Ke:()=>n,Nt:()=>a,R6:()=>l});var r=s(27242);let a=r.bL,l=r.R6,n=r.Ke},12543:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},15584:(e,t,s)=>{Promise.resolve().then(s.bind(s,46395))},20203:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},21887:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]])},22945:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("FlaskConical",[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]])},34301:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},36697:(e,t,s)=>{"use strict";s.d(t,{HN:()=>c,SP:()=>a,TG:()=>n,_w:()=>l,xX:()=>i});var r=s(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{let t=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK),s=(0,r.$C)(),a={...e,id:s},l=t.add(a);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},i=async e=>{let t=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},c=async e=>{let t=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},46395:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Q});var r=s(95155),a=s(12115),l=s(62709),n=s(20031),i=s(47906),c=s(36697),o=s(62523),d=s(30285),u=s(66424),m=s(22346),x=s(87481),h=s(34301),j=s(75074),p=s(20203),f=s(73926),g=s(85057),w=s(59409),y=s(90648);function v(e){let{onSelectItem:t,onNewItem:s,selectedItemId:l,dataVersion:n,filters:i,setFilters:v,onClearFilters:N}=e,[b,k]=(0,a.useState)([]),[C,S]=(0,a.useState)(!0),{toast:z}=(0,x.dj)();(0,a.useEffect)(()=>{(async()=>{S(!0);try{k(await (0,c.SP)())}catch(e){z({variant:"destructive",title:"Error",description:"Could not fetch rooms from database."})}finally{S(!1)}})()},[n,z]);let A=(0,a.useMemo)(()=>{let e=b.filter(e=>{let t=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),s=!0,r=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return r.length>0&&(s=!!e.tags&&r.every(t=>e.tags.some(e=>e.toLowerCase().includes(t)))),t&&s}).sort((e,t)=>e.name.localeCompare(t.name));return"desc"===i.sortOrder&&e.reverse(),e},[b,i]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)(d.$,{onClick:s,className:"w-full",children:[(0,r.jsx)(h.A,{})," New Room"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(o.p,{placeholder:"Search rooms...",value:i.searchTerm,onChange:e=>v.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(g.J,{children:"Filter"}),(0,r.jsx)(d.$,{variant:"ghost",size:"sm",onClick:N,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,r.jsx)(y.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>v.setTagFilter(e.join(",")),placeholder:"Tags (e.g. dungeon, trap)",tagSource:"room"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(g.J,{children:"Sort by"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(w.l6,{value:i.sortBy,onValueChange:e=>v.setSortBy(e),children:[(0,r.jsx)(w.bq,{children:(0,r.jsx)(w.yv,{placeholder:"Sort by"})}),(0,r.jsx)(w.gC,{children:(0,r.jsx)(w.eb,{value:"name",children:"Name"})})]}),(0,r.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>v.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,r.jsx)(p.A,{className:"h-4 w-4"}):(0,r.jsx)(f.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,r.jsx)(m.w,{}),(0,r.jsx)(u.F,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4",children:C?(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading rooms..."}):A.length>0?(0,r.jsx)("ul",{className:"space-y-1",children:A.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)("button",{onClick:()=>t(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(l===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No rooms found."})})})]})}var N=s(62177),b=s(90221),k=s(55594),C=s(87189),S=s(74691),z=s(98638),A=s(44218),I=s(66695),L=s(88539),P=s(90010),E=s(17759),T=s(12543),F=s(18763),R=s(73503),V=s(98917),M=s(22945),$=s(77223),B=s(25318),D=s(53054),G=s(18046),_=s(21887),K=s(68856),q=s(26126),J=s(54165),O=s(47262),Z=s(8643);let H=k.z.object({id:k.z.string(),title:k.z.string().min(1,"Feature title is required"),description:k.z.string().min(1,"Feature description is required"),encounterIds:k.z.array(k.z.string()),treasureIds:k.z.array(k.z.string()),alchemicalItemIds:k.z.array(k.z.string())}),U=k.z.object({name:k.z.string().min(1,"Room name is required"),description:k.z.string().optional(),size:k.z.string().optional(),tags:k.z.array(k.z.string()).optional(),features:k.z.array(H),totalTreasureValue:k.z.coerce.number()}),W=e=>{let{triggerButton:t,dialogTitle:s,items:l,onSelectItems:n,initialSelectedIds:i=[]}=e,[c,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)(new Set(i)),[j,p]=(0,a.useState)(""),f=(0,a.useMemo)(()=>{let e=l.filter(e=>e.name.toLowerCase().includes(j.toLowerCase()));return e.sort((e,t)=>{let s=x.has(e.id),r=x.has(t.id);return s&&!r?-1:!s&&r?1:e.name.localeCompare(t.name)}),e},[l,j,x]),g=e=>{h(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return(0,r.jsxs)(J.lG,{open:c,onOpenChange:e=>{e&&h(new Set(i)),m(e)},children:[(0,r.jsx)(J.zM,{asChild:!0,children:t}),(0,r.jsxs)(J.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,r.jsx)(J.c7,{children:(0,r.jsx)(J.L3,{children:s})}),(0,r.jsx)(o.p,{placeholder:"Search...",value:j,onChange:e=>p(e.target.value),className:"mb-4 shrink-0"}),(0,r.jsx)(u.F,{className:"flex-1 border rounded-md p-2",children:(0,r.jsx)("div",{className:"space-y-1",children:f.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md",children:[(0,r.jsx)(O.S,{id:"item-".concat(e.id),onCheckedChange:()=>g(e.id),checked:x.has(e.id)}),(0,r.jsxs)("label",{htmlFor:"item-".concat(e.id),className:"flex-1",children:[(0,r.jsx)("p",{className:"font-semibold",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[void 0!==e.value&&"Value: ".concat(e.value),e.type&&"Type: ".concat(e.type)]})]})]},e.id))})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4 shrink-0",children:[(0,r.jsx)(d.$,{variant:"ghost",onClick:()=>m(!1),children:"Cancel"}),(0,r.jsx)(d.$,{onClick:()=>{n(Array.from(x)),m(!1)},children:"Confirm"})]})]})]})},X={name:"",description:"",size:"",tags:[],features:[],totalTreasureValue:0};function Y(e){let{roomId:t,isCreatingNew:s,onSaveSuccess:l,onDeleteSuccess:n,onEditCancel:u,onFilterByClick:h,onBack:j,dataVersion:p}=e,{toast:f}=(0,x.dj)(),[g,w]=(0,a.useState)(s),[v,k]=(0,a.useState)(!s&&!!t),[J,O]=(0,a.useState)(null),[H,Y]=(0,a.useState)([]),[Q,ee]=(0,a.useState)([]),[et,es]=(0,a.useState)([]),er=(0,i.a)(),ea=(0,a.useMemo)(()=>({encounters:new Map(H.map(e=>[e.id,e])),treasures:new Map(Q.map(e=>[e.id,e])),alchemicalItems:new Map(et.map(e=>[e.id,e]))}),[H,Q,et]),el=(0,N.mN)({resolver:(0,b.u)(U),defaultValues:X}),{fields:en,append:ei,remove:ec}=(0,N.jz)({control:el.control,name:"features"}),eo=el.watch("features");(0,a.useEffect)(()=>{if(g){let e=eo.reduce((e,t)=>e+t.treasureIds.reduce((e,t)=>{let s=ea.treasures.get(t);return e+((null==s?void 0:s.value)||0)},0),0);el.getValues("totalTreasureValue")!==e&&el.setValue("totalTreasureValue",e,{shouldValidate:!0})}},[eo,ea.treasures,el,g]),(0,a.useEffect)(()=>{Promise.all([(0,C.eS)(),(0,S.Ap)(),(0,z.vV)()]).then(e=>{let[t,s,r]=e;Y(t),ee(s),es(r)})},[]),(0,a.useEffect)(()=>{(async()=>{if(s){el.reset(X),O(null),w(!0),k(!1);return}if(!t){w(!1),k(!1),O(null);return}k(!0),w(!1);try{let e=await (0,c._w)(t);e?(el.reset(e),O(e)):O(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load room data."})}finally{k(!1)}})()},[t,s,el,f,p]);let ed=()=>{s?u():J&&(el.reset(J),w(!1))},eu=async e=>{try{let r,a={...e,tags:e.tags||[]},n=e.tags||[];if(n.length>0&&await (0,A.JE)(n,"room"),s)r=await (0,c.TG)(a),f({title:"Room Created!",description:"".concat(e.name," has been added.")});else{if(!t)return;r=t,await (0,c.xX)({...a,id:t}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")})}l(r),w(!1)}catch(e){f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},em=async()=>{if(t)try{await (0,c.HN)(t),f({title:"Room Deleted",description:"The room has been removed."}),n()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the room."})}};return v?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(I.Zp,{children:[(0,r.jsx)(I.aR,{children:(0,r.jsx)(K.E,{className:"h-8 w-48"})}),(0,r.jsx)(I.Wu,{children:(0,r.jsx)(K.E,{className:"h-40 w-full"})})]})}):t||s?!g&&J?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(I.Zp,{children:[(0,r.jsx)(I.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[er&&j&&(0,r.jsx)(d.$,{variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2 -mt-1",children:(0,r.jsx)(T.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(I.ZB,{className:"text-3xl font-bold",children:J.name}),(0,r.jsxs)(I.BT,{className:"flex flex-wrap gap-x-4",children:[J.size&&(0,r.jsxs)("span",{children:["Size: ",J.size]}),(0,r.jsxs)("span",{children:["Total Value: ",J.totalTreasureValue]})]})]})]}),(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,r.jsx)(F.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,r.jsx)(I.Wu,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[J.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,r.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:J.description})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Features"}),J.features.length>0?(0,r.jsx)("ul",{className:"space-y-4",children:J.features.map(e=>(0,r.jsxs)("li",{className:"p-3 bg-card-foreground/5 rounded-lg",children:[(0,r.jsx)("p",{className:"font-semibold",children:e.title}),e.encounterIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(R.A,{className:"h-4 w-4"})," Linked Encounters"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.encounterIds.map(e=>{var t;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(t=ea.encounters.get(e))?void 0:t.name)||"..."},e)})})]}),e.treasureIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(V.A,{className:"h-4 w-4"})," Linked Treasures"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.treasureIds.map(e=>{var t;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(t=ea.treasures.get(e))?void 0:t.name)||"..."},e)})})]}),e.alchemicalItemIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(M.A,{className:"h-4 w-4"})," Linked Alchemy"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.alchemicalItemIds.map(e=>{var t;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(t=ea.alchemicalItems.get(e))?void 0:t.name)||"..."},e)})})]})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No features defined for this room."})]}),J.tags&&J.tags.length>0&&(0,r.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:J.tags.map(e=>(0,r.jsx)("button",{onClick:t=>h({tagFilter:e},t),className:"bg-transparent border-none p-0 m-0",children:(0,r.jsx)(q.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,r.jsx)(I.wL,{children:(0,r.jsxs)(P.Lt,{children:[(0,r.jsx)(P.tv,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(P.EO,{children:[(0,r.jsxs)(P.wd,{children:[(0,r.jsx)(P.r7,{children:"Are you sure?"}),(0,r.jsxs)(P.$v,{children:['This will permanently delete "',J.name,'".']})]}),(0,r.jsxs)(P.ck,{children:[(0,r.jsx)(P.Zr,{children:"Cancel"}),(0,r.jsx)(P.Rx,{onClick:em,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(I.Zp,{children:(0,r.jsx)(E.lV,{...el,children:(0,r.jsxs)("form",{onSubmit:el.handleSubmit(eu),className:"space-y-6",children:[(0,r.jsx)(I.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[er&&j&&(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2",children:(0,r.jsx)(T.A,{className:"h-5 w-5"})}),(0,r.jsx)(I.ZB,{children:s?"Create New Room":"Editing: ".concat(el.getValues("name")||"...")})]}),!er&&(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:ed,className:"text-muted-foreground hover:text-foreground",children:(0,r.jsx)(B.A,{className:"h-5 w-5"})})]})}),(0,r.jsxs)(I.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(E.zB,{name:"name",control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Name"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(o.p,{...t})}),(0,r.jsx)(E.C5,{})]})}}),(0,r.jsx)(E.zB,{name:"size",control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Size"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(o.p,{...t,placeholder:"e.g., 30ft x 40ft"})})]})}})]}),(0,r.jsx)(E.zB,{name:"totalTreasureValue",control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Total Treasure Value"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(o.p,{type:"number",...t,readOnly:!0,className:"w-28 bg-muted border-none"})})]})}}),(0,r.jsx)(E.zB,{name:"description",control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Description"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(L.T,{...t,rows:4})})]})}}),(0,r.jsx)(E.zB,{name:"tags",control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsxs)(E.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(D.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(y.F,{value:t.value||[],onChange:t.onChange,placeholder:"Add tags...",tagSource:"room"})}),(0,r.jsx)(E.C5,{})]})}}),(0,r.jsx)(m.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Room Features"}),(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{ei({id:crypto.randomUUID(),title:"",description:"",encounterIds:[],treasureIds:[],alchemicalItemIds:[]})},children:[(0,r.jsx)(G.A,{className:"h-4 w-4 mr-2"})," Add Feature"]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[en.map((e,t)=>(0,r.jsxs)(Z.Nt,{className:"border bg-card-foreground/5 rounded-lg p-3",defaultOpen:!el.watch("features.".concat(t,".title")),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(Z.R6,{asChild:!0,children:(0,r.jsxs)("button",{type:"button",className:"flex items-center gap-3 text-left w-full",children:[(0,r.jsx)(_.A,{className:"h-5 w-5 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-primary-foreground",children:el.watch("features.".concat(t,".title"))||"New Feature"})]})}),(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ec(t),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)(Z.Ke,{className:"mt-4 space-y-4",children:[(0,r.jsx)(E.zB,{name:"features.".concat(t,".title"),control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Title"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(o.p,{...t})}),(0,r.jsx)(E.C5,{})]})}}),(0,r.jsx)(E.zB,{name:"features.".concat(t,".description"),control:el.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(E.eI,{children:[(0,r.jsx)(E.lR,{children:"Description"}),(0,r.jsx)(E.MJ,{children:(0,r.jsx)(L.T,{...t,rows:2})}),(0,r.jsx)(E.C5,{})]})}}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 justify-end",children:[(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(R.A,{className:"h-4 w-4 mr-2"})," Encounters"]}),dialogTitle:"Link Encounters",items:H.map(e=>({id:e.id,name:e.name,value:e.totalTR||0})),onSelectItems:e=>el.setValue("features.".concat(t,".encounterIds"),e),initialSelectedIds:el.getValues("features.".concat(t,".encounterIds"))}),(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(V.A,{className:"h-4 w-4 mr-2"})," Treasures"]}),dialogTitle:"Link Treasures",items:Q,onSelectItems:e=>el.setValue("features.".concat(t,".treasureIds"),e),initialSelectedIds:el.getValues("features.".concat(t,".treasureIds"))}),(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(M.A,{className:"h-4 w-4 mr-2"})," Alchemy"]}),dialogTitle:"Link Alchemical Items",items:et.map(e=>({id:e.id,name:e.name,type:e.type})),onSelectItems:e=>el.setValue("features.".concat(t,".alchemicalItemIds"),e),initialSelectedIds:el.getValues("features.".concat(t,".alchemicalItemIds"))})]})]})]},e.id)),0===en.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No features added to this room."})]})]})]}),(0,r.jsxs)(I.wL,{className:"flex items-center gap-2",children:[!s&&(0,r.jsxs)(P.Lt,{children:[(0,r.jsx)(P.tv,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(P.EO,{children:[(0,r.jsxs)(P.wd,{children:[(0,r.jsx)(P.r7,{children:"Are you sure?"}),(0,r.jsxs)(P.$v,{children:['This will permanently delete "',el.getValues("name"),'".']})]}),(0,r.jsxs)(P.ck,{children:[(0,r.jsx)(P.Zr,{children:"Cancel"}),(0,r.jsx)(P.Rx,{onClick:em,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,r.jsx)("div",{className:"flex-grow"}),!er&&(0,r.jsx)(d.$,{type:"button",variant:"outline",onClick:ed,children:"Cancel"}),(0,r.jsx)(d.$,{type:"submit",children:s?"Create Room":"Save Changes"})]})]})})})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(I.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,r.jsx)(I.Wu,{className:"text-center pt-6",children:(0,r.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a room to view or create a new one."})})})})}function Q(){let[e,t]=(0,a.useState)(null),[s,c]=(0,a.useState)(!1),[o,d]=(0,a.useState)(0),[u,m]=(0,a.useState)(""),[x,h]=(0,a.useState)(""),[j,p]=(0,a.useState)("name"),[f,g]=(0,a.useState)("asc"),[w,y]=(0,a.useState)(!1),N=(0,i.a)(),[b,k]=(0,a.useState)("list");(0,a.useEffect)(()=>{y(!0)},[]);let C={searchTerm:u,tagFilter:x,sortBy:j,sortOrder:f},S={setSearchTerm:m,setTagFilter:h,setSortBy:p,setSortOrder:g},z=(e,t)=>{t.shiftKey?e.tagFilter&&h(t=>t?t.split(",").map(e=>e.trim()).includes(e.tagFilter)?t:"".concat(t,", ").concat(e.tagFilter):e.tagFilter):h(e.tagFilter||"")},A=()=>{m(""),h(""),p("name"),g("asc")},I=()=>d(e=>e+1),L=e=>{t(e),c(!1),N&&k("editor")},P=()=>{t(null),c(!0),N&&k("editor")},E=e=>{I(),t(e),c(!1),N&&k("editor")},T=()=>{I(),t(null),c(!1),N&&k("list")},F=()=>{s&&(c(!1),t(null),N&&k("list"))};return w?N?(0,r.jsx)(l.A,{showSidebarTrigger:!1,children:(0,r.jsx)("div",{className:"h-full w-full",children:"list"===b?(0,r.jsx)(v,{onSelectItem:L,onNewItem:P,selectedItemId:e,dataVersion:o,filters:C,setFilters:S,onClearFilters:A}):(0,r.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,r.jsx)("div",{className:"p-4 sm:p-6",children:(0,r.jsx)(Y,{roomId:e,isCreatingNew:s,onSaveSuccess:E,onDeleteSuccess:T,onEditCancel:F,onFilterByClick:z,onBack:()=>{k("list"),t(null),c(!1)},dataVersion:o},null!=e?e:s?"new":"placeholder")})})})}):(0,r.jsx)(n.GB,{children:(0,r.jsx)(l.A,{children:(0,r.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,r.jsx)(n.Bx,{style:{"--sidebar-width":"380px"},children:(0,r.jsx)(v,{onSelectItem:L,onNewItem:P,selectedItemId:e,dataVersion:o,filters:C,setFilters:S,onClearFilters:A})}),(0,r.jsx)(n.sF,{className:"flex-1 overflow-y-auto",children:(0,r.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,r.jsx)(Y,{roomId:e,isCreatingNew:s,onSaveSuccess:E,onDeleteSuccess:T,onEditCancel:F,onFilterByClick:z,dataVersion:o},null!=e?e:s?"new":"placeholder")})})]})})}):null}},47262:(e,t,s)=>{"use strict";s.d(t,{S:()=>c});var r=s(95155),a=s(12115),l=s(76981),n=s(10518),i=s(59434);let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,r.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})})});c.displayName=l.bL.displayName},53054:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},54165:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>m,Es:()=>h,L3:()=>j,c7:()=>x,lG:()=>c,rr:()=>p,zM:()=>o});var r=s(95155),a=s(12115),l=s(45821),n=s(25318),i=s(59434);let c=l.bL,o=l.l9,d=l.ZL;l.bm;let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});u.displayName=l.hJ.displayName;let m=a.forwardRef((e,t)=>{let{className:s,children:a,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...c,children:[a,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let j=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...a})});j.displayName=l.hE.displayName;let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...a})});p.displayName=l.VY.displayName},68856:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var r=s(95155),a=s(59434);function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",t),...s})}},73503:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]])},73926:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},74691:(e,t,s)=>{"use strict";s.d(t,{Ap:()=>a,Dp:()=>n,Ld:()=>i,qp:()=>l,vm:()=>c});var r=s(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{let t=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG),s=(0,r.$C)(),a={...e,id:s},l=t.add(a);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},i=async e=>{let t=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},c=async e=>{let t=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},75074:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},76981:(e,t,s)=>{"use strict";s.d(t,{C1:()=>C,bL:()=>k});var r=s(12115),a=s(6101),l=s(46081),n=s(85185),i=s(5845),c=s(45503),o=s(11275),d=s(28905),u=s(63540),m=s(95155),x="Checkbox",[h,j]=(0,l.A)(x),[p,f]=h(x),g=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,name:l,checked:c,defaultChecked:o,required:d,disabled:x,value:h="on",onCheckedChange:j,form:f,...g}=e,[w,y]=r.useState(null),k=(0,a.s)(t,e=>y(e)),C=r.useRef(!1),S=!w||f||!!w.closest("form"),[z=!1,A]=(0,i.i)({prop:c,defaultProp:o,onChange:j}),I=r.useRef(z);return r.useEffect(()=>{let e=null==w?void 0:w.form;if(e){let t=()=>A(I.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[w,A]),(0,m.jsxs)(p,{scope:s,state:z,disabled:x,children:[(0,m.jsx)(u.sG.button,{type:"button",role:"checkbox","aria-checked":N(z)?"mixed":z,"aria-required":d,"data-state":b(z),"data-disabled":x?"":void 0,disabled:x,value:h,...g,ref:k,onKeyDown:(0,n.m)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,n.m)(e.onClick,e=>{A(e=>!!N(e)||!e),S&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),S&&(0,m.jsx)(v,{control:w,bubbles:!C.current,name:l,value:h,checked:z,required:d,disabled:x,form:f,style:{transform:"translateX(-100%)"},defaultChecked:!N(o)&&o})]})});g.displayName=x;var w="CheckboxIndicator",y=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,forceMount:r,...a}=e,l=f(w,s);return(0,m.jsx)(d.C,{present:r||N(l.state)||!0===l.state,children:(0,m.jsx)(u.sG.span,{"data-state":b(l.state),"data-disabled":l.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});y.displayName=w;var v=e=>{let{control:t,checked:s,bubbles:a=!0,defaultChecked:l,...n}=e,i=r.useRef(null),d=(0,c.Z)(s),u=(0,o.X)(t);r.useEffect(()=>{let e=i.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(d!==s&&t){let r=new Event("click",{bubbles:a});e.indeterminate=N(s),t.call(e,!N(s)&&s),e.dispatchEvent(r)}},[d,s,a]);let x=r.useRef(!N(s)&&s);return(0,m.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:null!=l?l:x.current,...n,tabIndex:-1,ref:i,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function N(e){return"indeterminate"===e}function b(e){return N(e)?"indeterminate":e?"checked":"unchecked"}var k=g,C=y},87189:(e,t,s)=>{"use strict";s.d(t,{Fs:()=>n,H$:()=>i,ZJ:()=>c,eS:()=>a,eq:()=>l});var r=s(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.l_,"readonly").objectStore(r.l_).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,r.Lf)()).transaction(r.l_,"readonly").objectStore(r.l_).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{let t=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_),s=(0,r.$C)(),a={...e,id:s},l=t.add(a);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},i=async e=>{let t=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},c=async e=>{let t=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},98638:(e,t,s)=>{"use strict";s.d(t,{S9:()=>i,gL:()=>c,rD:()=>l,vV:()=>a,wo:()=>n});var r=s(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).getAll();return new Promise((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)})},l=async e=>{let t=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).get(e);return new Promise((e,s)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>s(t.error)})},n=async e=>{let t=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP),s=(0,r.$C)(),a={...e,id:s},l=t.add(a);return new Promise((e,t)=>{l.onsuccess=()=>e(s),l.onerror=()=>t(l.error)})},i=async e=>{let t=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).put(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})},c=async e=>{let t=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).delete(e);return new Promise((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)})}},98917:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[222,194,160,49,923,347,516,441,684,358],()=>t(15584)),_N_E=e.O()}]);
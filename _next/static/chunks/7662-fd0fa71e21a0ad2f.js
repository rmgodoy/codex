"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7662],{57662:(e,s,l)=>{l.r(s),l.d(s,{default:()=>G});var a=l(95155),r=l(12115),t=l(6195),n=l(20031),i=l(47906),c=l(15019),d=l(23062),o=l(62523),m=l(30285),h=l(66424),x=l(22346),u=l(87481),p=l(34301),j=l(75074),g=l(9572),f=l(20203),v=l(73926),y=l(85057),w=l(59409),N=l(90648),C=l(8643);function b(e){let{onSelectItem:s,onNewItem:l,selectedItemId:t,dataVersion:n,filters:i,setFilters:b,onClearFilters:T}=e,[z,I]=(0,r.useState)([]),[D,S]=(0,r.useState)(!0),{toast:A}=(0,u.dj)();(0,r.useEffect)(()=>{(async()=>{S(!0);try{I(await (0,c.i7)())}catch(e){A({variant:"destructive",title:"Error",description:"Could not fetch items from database."})}finally{S(!1)}})()},[n,A]);let R=(0,r.useMemo)(()=>{let e=z.filter(e=>{let s=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),l="all"===i.typeFilter||e.type===i.typeFilter,a="all"===i.qualityFilter||e.quality===i.qualityFilter,r="all"===i.magicTierFilter||e.magicTier===i.magicTierFilter,t=!0,n=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return n.length>0&&(t=!!e.tags&&n.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&l&&a&&r&&t}),s={crude:0,normal:1,fine:2,magical:3},l=e.sort((e,l)=>{if("quality"===i.sortBy){let a=(s[e.quality]||0)-(s[l.quality]||0);if(0!==a)return a}if("price"===i.sortBy){let s=(e.price||0)-(l.price||0);if(0!==s)return s}if("type"===i.sortBy){let s=e.type.localeCompare(l.type);if(0!==s)return s}return e.name.localeCompare(l.name)});return"desc"===i.sortOrder&&l.reverse(),l},[z,i]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(m.$,{onClick:l,className:"w-full",children:[(0,a.jsx)(p.A,{})," New Item"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(o.p,{placeholder:"Search items...",value:i.searchTerm,onChange:e=>b.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(C.Nt,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(C.R6,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"ghost",className:"-ml-2",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Filters"]})}),(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:T,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsxs)(C.Ke,{className:"space-y-2 pt-2",children:[(0,a.jsxs)(w.l6,{value:i.typeFilter,onValueChange:b.setTypeFilter,children:[(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{placeholder:"Filter by type"})}),(0,a.jsxs)(w.gC,{children:[(0,a.jsx)(w.eb,{value:"all",children:"All Types"}),d.w$.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsxs)(w.l6,{value:i.qualityFilter,onValueChange:b.setQualityFilter,children:[(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{placeholder:"Filter by quality"})}),(0,a.jsxs)(w.gC,{children:[(0,a.jsx)(w.eb,{value:"all",children:"All Qualities"}),d.qY.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsxs)(w.l6,{value:i.magicTierFilter,onValueChange:e=>b.setMagicTierFilter(e),children:[(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{placeholder:"Filter by Tier"})}),(0,a.jsxs)(w.gC,{children:[(0,a.jsx)(w.eb,{value:"all",children:"All Tiers"}),d.gV.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,a.jsx)(N.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>b.setTagFilter(e.join(",")),placeholder:"Tags (e.g. consumable)",tagSource:"item"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(w.l6,{value:i.sortBy,onValueChange:e=>b.setSortBy(e),children:[(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(w.gC,{children:[(0,a.jsx)(w.eb,{value:"name",children:"Name"}),(0,a.jsx)(w.eb,{value:"type",children:"Type"}),(0,a.jsx)(w.eb,{value:"price",children:"Price"}),(0,a.jsx)(w.eb,{value:"quality",children:"Quality"})]})]}),(0,a.jsxs)(m.$,{variant:"ghost",size:"icon",onClick:()=>b.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,a.jsx)(f.A,{className:"h-4 w-4"}):(0,a.jsx)(v.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(x.w,{}),(0,a.jsx)(h.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:D?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading items..."}):R.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:R.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(t===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name,(0,a.jsxs)("span",{className:"text-xs opacity-70 capitalize",children:[" (",e.type,"normal"!==e.magicTier?", ".concat(e.magicTier):"",")"]})]})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No items found."})})})]})}var T=l(62177),z=l(90221),I=l(55594),D=l(66695),S=l(88539),A=l(90010),R=l(17759),q=l(12543),E=l(15599),F=l(18763),B=l(77223),V=l(25318),M=l(14337),k=l(53054),J=l(68856),$=l(26126),Z=l(54165),P=l(38914);let L=I.z.object({name:I.z.string().min(1,"Item name is required"),type:I.z.enum(d.w$),price:I.z.coerce.number().min(0,"Price must be a non-negative number"),quality:I.z.enum(d.qY),description:I.z.string().min(1,"Description is required"),magicTier:I.z.enum(d.gV),enchantment:I.z.string().optional(),assignedDeedId:I.z.string().optional(),magicalTrait:I.z.string().optional(),tags:I.z.array(I.z.string()).optional(),damageDie:I.z.enum(d.zE).optional(),weaponType:I.z.enum(d.Rb).optional(),range:I.z.coerce.number().optional(),property:I.z.enum(d.Vz).optional(),weaponEffect:I.z.string().optional(),placement:I.z.enum(d.Vx).optional(),weight:I.z.enum(d._d).optional(),AR:I.z.string().optional(),armorDie:I.z.enum(d.gG).optional()}).superRefine((e,s)=>{var l,a,r;"weapon"===e.type&&(e.damageDie||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Damage Die is required for weapons.",path:["damageDie"]}),e.weaponType||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Weapon Type is required for weapons.",path:["weaponType"]}),("missile"===e.weaponType||"spell"===e.weaponType)&&(void 0===e.range||e.range<1)&&s.addIssue({code:I.z.ZodIssueCode.custom,message:"Range is required for this weapon type.",path:["range"]}),e.property||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Property is required for weapons.",path:["property"]})),("armor"===e.type||"shield"===e.type)&&(e.placement||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Placement is required.",path:["placement"]}),(null==(r=e.AR)?void 0:r.trim())||s.addIssue({code:I.z.ZodIssueCode.custom,message:"AR is required.",path:["AR"]}),e.armorDie||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Armor Die is required.",path:["armorDie"]})),"armor"===e.type&&"shield"===e.placement&&s.addIssue({code:I.z.ZodIssueCode.custom,message:"Shield placement is for shields only.",path:["placement"]}),"shield"===e.type&&"shield"!==e.placement&&s.addIssue({code:I.z.ZodIssueCode.custom,message:"Shields must have shield placement.",path:["placement"]}),"magical"!==e.magicTier&&"artifact"!==e.magicTier||(null==(l=e.enchantment)?void 0:l.trim())||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Enchantment is required for magical items and artifacts.",path:["enchantment"]}),"artifact"!==e.magicTier||(null==(a=e.magicalTrait)?void 0:a.trim())||s.addIssue({code:I.z.ZodIssueCode.custom,message:"Magical Trait is required for artifacts.",path:["magicalTrait"]})}),W=e=>{let{onSelectDeed:s,allDeeds:l,children:t}=e,[n,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(""),[m,x]=(0,r.useState)("all"),[u,p]=(0,r.useState)(""),j=(0,r.useMemo)(()=>l.filter(e=>{let s=e.name.toLowerCase().includes(c.toLowerCase()),l="all"===m||e.tier===m,a=u.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean),r=0===a.length||e.tags&&a.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)));return s&&l&&r}),[l,c,m,u]),g=e=>{s(e),i(!1)};return(0,a.jsxs)(Z.lG,{open:n,onOpenChange:e=>{e||(d(""),x("all"),p("")),i(e)},children:[(0,a.jsx)(Z.zM,{asChild:!0,children:t}),(0,a.jsxs)(Z.Cf,{className:"sm:max-w-2xl h-[70vh] flex flex-col",children:[(0,a.jsx)(Z.c7,{children:(0,a.jsx)(Z.L3,{children:"Select a Deed"})}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4 flex-wrap",children:[(0,a.jsx)(o.p,{placeholder:"Search deeds...",value:c,onChange:e=>d(e.target.value),className:"flex-1 min-w-[150px]"}),(0,a.jsxs)(w.l6,{value:m,onValueChange:x,children:[(0,a.jsx)(w.bq,{className:"w-full sm:w-[120px]",children:(0,a.jsx)(w.yv,{placeholder:"Filter tier"})}),(0,a.jsxs)(w.gC,{children:[(0,a.jsx)(w.eb,{value:"all",children:"All Tiers"}),(0,a.jsx)(w.eb,{value:"light",children:"Light"}),(0,a.jsx)(w.eb,{value:"heavy",children:"Heavy"}),(0,a.jsx)(w.eb,{value:"mighty",children:"Mighty"})]})]}),(0,a.jsx)("div",{className:"flex-1 min-w-[150px]",children:(0,a.jsx)(N.F,{value:u?u.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>p(e.join(",")),placeholder:"Filter by tags...",tagSource:"deed"})})]}),(0,a.jsx)(h.F,{className:"flex-1 border rounded-md p-4",children:(0,a.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,a.jsx)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent cursor-pointer",onClick:()=>g(e),children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-semibold",children:[e.name," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.tier,")"]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.effects.hit})]})},e.id))})})]})]})},O={name:"",type:"weapon",price:0,quality:"normal",magicTier:"normal",description:"",tags:[],property:"one-handed",weaponType:"melee",damageDie:"d4",AR:"0",armorDie:"d4",weight:"None",placement:"head"};function _(e){let{itemId:s,isCreatingNew:l,template:t,onSaveSuccess:n,onDeleteSuccess:h,onUseAsTemplate:p,onEditCancel:j,onBack:g}=e,{toast:f}=(0,u.dj)(),[v,C]=(0,r.useState)(l),[b,I]=(0,r.useState)(!l&&!!s),[Z,_]=(0,r.useState)(null),G=(0,i.a)(),{worldSlug:Q}=(0,P.q)(),[Y,H]=(0,r.useState)([]),[U,K]=(0,r.useState)({}),[X,ee]=(0,r.useState)({}),[es,el]=(0,r.useState)({}),ea=(0,r.useMemo)(()=>l&&t?{...O,...t}:O,[l,t]),er=(0,T.mN)({resolver:(0,z.u)(L),defaultValues:ea}),{watch:et,setValue:en,getValues:ei}=er,ec=et("type"),ed=et("weaponType"),eo=et("magicTier"),em=(0,r.useRef)(ec),eh=et("assignedDeedId"),[ex,eu]=(0,r.useState)(null);(0,r.useEffect)(()=>{(0,c.xy)().then(H)},[]),(0,r.useEffect)(()=>{eh&&Y.length>0?eu(Y.find(e=>e.id===eh)||null):eu(null)},[eh,Y]),(0,r.useEffect)(()=>{v&&("magical"===eo||"artifact"===eo)&&en("quality","fine")},[eo,v,en]),(0,r.useEffect)(()=>{let e=em.current;if(e===ec||!v)return;let s=ei();"weapon"===e?K({damageDie:s.damageDie,weaponType:s.weaponType,range:s.range,property:s.property,weaponEffect:s.weaponEffect}):"armor"===e?ee({placement:s.placement,weight:s.weight,AR:s.AR,armorDie:s.armorDie}):"shield"===e&&el({placement:s.placement,weight:s.weight,AR:s.AR,armorDie:s.armorDie}),["damageDie","weaponType","range","property","weaponEffect","placement","weight","AR","armorDie"].forEach(e=>en(e,void 0)),"weapon"===ec?Object.entries(U).forEach(e=>{let[s,l]=e;return en(s,l)}):"armor"===ec?Object.entries(X).forEach(e=>{let[s,l]=e;return en(s,l)}):"shield"===ec&&(Object.entries(es).forEach(e=>{let[s,l]=e;return en(s,l)}),en("placement","shield",{shouldValidate:!0}),en("weight","None",{shouldValidate:!0})),em.current=ec},[ec,ei,en,v,U,X,es]),(0,r.useEffect)(()=>{(async()=>{if(l){er.reset(ea),t?(_(t||null),K(t),ee(t),el(t)):(K({property:"one-handed",weaponType:"melee",damageDie:"d4"}),ee({placement:"head",weight:"None",AR:"0",armorDie:"d4"}),el({placement:"shield",weight:"None",AR:"0",armorDie:"d4"})),em.current=(null==t?void 0:t.type)||"weapon",C(!0),I(!1);return}if(!s){C(!1),I(!1),_(null);return}I(!0),C(!1);try{let e=await (0,c.u_)(s);e?(er.reset(e),_(e),K(e),"armor"===e.type?(ee(e),el({})):"shield"===e.type?(el(e),ee({})):(ee({}),el({})),em.current=e.type):_(null)}catch(e){f({variant:"destructive",title:"Error",description:"Could not load item data."})}finally{I(!1)}})()},[s,l,er,f,ea,t]);let ep=()=>{l?j():Z&&(er.reset(Z),K(Z),"armor"===Z.type?(ee(Z),el({})):"shield"===Z.type?(el(Z),ee({})):(ee({}),el({})),em.current=Z.type,C(!1))},ej=async e=>{try{let a,r={name:e.name,type:e.type,price:e.price,quality:e.quality,description:e.description,magicTier:e.magicTier,tags:e.tags||[]};switch(e.type){case"weapon":r.damageDie=e.damageDie,r.weaponType=e.weaponType,r.range=e.range,r.property=e.property,r.weaponEffect=e.weaponEffect;break;case"armor":case"shield":r.placement=e.placement,r.weight=e.weight,r.AR=e.AR,r.armorDie=e.armorDie}("magical"===e.magicTier||"artifact"===e.magicTier)&&(r.enchantment=e.enchantment),"artifact"===e.magicTier&&(r.assignedDeedId=e.assignedDeedId,r.magicalTrait=e.magicalTrait);let t=e.tags||[];if(t.length>0&&await (0,c.JE)(t,"item"),l)a=await (0,c.B5)(r),f({title:"Item Created!",description:"".concat(e.name," has been added.")});else{if(!s)return;a=s,await (0,c.fk)({...r,id:s}),f({title:"Save Successful",description:"".concat(e.name," has been updated.")})}n(a),C(!1)}catch(e){f({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},eg=async()=>{if(s)try{await (0,c.LD)(s),f({title:"Item Deleted",description:"The item has been removed."}),h()}catch(e){f({variant:"destructive",title:"Deletion Failed",description:"Could not delete the item."})}};if(b)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(D.Zp,{children:[(0,a.jsx)(D.aR,{children:(0,a.jsx)(J.E,{className:"h-8 w-48"})}),(0,a.jsx)(D.Wu,{children:(0,a.jsx)(J.E,{className:"h-40 w-full"})})]})});if(!s&&!l)return(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(D.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsx)(D.Wu,{className:"text-center pt-6",children:(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select an item to view or create a new one."})})})});let ef=e=>{en("assignedDeedId",e.id,{shouldValidate:!0})};return!v&&Z?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(D.Zp,{children:[(0,a.jsx)(D.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[G&&g&&(0,a.jsx)(m.$,{variant:"ghost",size:"icon",onClick:g,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(q.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D.ZB,{className:"text-3xl font-bold",children:Z.name}),(0,a.jsxs)(D.BT,{className:"capitalize flex flex-wrap gap-x-4",children:[(0,a.jsxs)("span",{children:[Z.magicTier," ",Z.type]}),(0,a.jsxs)("span",{children:["Quality: ",Z.quality]}),(0,a.jsxs)("span",{children:["Price: ",Z.price,"gp"]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>{Z&&p(Z)},children:[(0,a.jsx)(E.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Template"})]}),(0,a.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>C(!0),children:[(0,a.jsx)(F.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})]})}),(0,a.jsx)(D.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(()=>{let e;if(!Z)return null;switch(Z.type){case"weapon":let s=("missile"===Z.weaponType||"spell"===Z.weaponType)&&Z.range?"".concat(Z.weaponType," (").concat(Z.range,")"):Z.weaponType;e=(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-foreground",children:"Weapon Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Damage:"})," ",Z.damageDie]}),(0,a.jsxs)("div",{className:"capitalize",children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Type:"})," ",s]}),(0,a.jsxs)("div",{className:"capitalize",children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Property:"})," ",Z.property]})]}),Z.weaponEffect&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Effect:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Z.weaponEffect})]})]});break;case"armor":case"shield":e=(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-foreground",children:"Armor/Shield Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Placement:"})," ",Z.placement]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Weight:"})," ",Z.weight]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"AR:"})," ",Z.AR]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-muted-foreground",children:"Armor Die:"})," ",Z.armorDie]})]})]});break;default:e=null}let l=Z.assignedDeedId?Y.find(e=>e.id===Z.assignedDeedId):null;return(0,a.jsxs)(a.Fragment,{children:[Z.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-foreground",children:"Description"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Z.description})]}),e&&(0,a.jsx)(x.w,{}),e,("magical"===Z.magicTier||"artifact"===Z.magicTier)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-foreground",children:"magical"===Z.magicTier?"Magical Properties":"Artifact Properties"}),Z.enchantment&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Enchantment:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Z.enchantment})]}),"artifact"===Z.magicTier&&Z.magicalTrait&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Magical Trait:"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Z.magicalTrait})]}),l&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-muted-foreground",children:"Granted Deed:"}),(0,a.jsx)("a",{href:"#/".concat(Q,"/deeds/").concat(l.id),className:"text-accent hover:underline",children:l.name})]})]})]})]})})(),Z.tags&&Z.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Z.tags.map(e=>(0,a.jsx)($.E,{variant:"secondary",children:e},e))})})]})}),(0,a.jsx)(D.wL,{children:(0,a.jsxs)(A.Lt,{children:[(0,a.jsx)(A.tv,{asChild:!0,children:(0,a.jsx)(m.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(A.EO,{children:[(0,a.jsxs)(A.wd,{children:[(0,a.jsx)(A.r7,{children:"Are you sure?"}),(0,a.jsxs)(A.$v,{children:['This will permanently delete "',Z.name,'".']})]}),(0,a.jsxs)(A.ck,{children:[(0,a.jsx)(A.Zr,{children:"Cancel"}),(0,a.jsx)(A.Rx,{onClick:eg,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(D.Zp,{children:(0,a.jsx)(R.lV,{...er,children:(0,a.jsxs)("form",{onSubmit:er.handleSubmit(ej),className:"space-y-6",children:[(0,a.jsx)(D.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[G&&g&&(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2",children:(0,a.jsx)(q.A,{className:"h-5 w-5"})}),(0,a.jsx)(D.ZB,{children:l?"Create New Item":"Editing: ".concat(er.getValues("name")||"...")})]}),!G&&(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:ep,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(V.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(D.Wu,{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Base Properties"}),(0,a.jsx)(R.zB,{name:"name",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Item Name"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(o.p,{...s})}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"description",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Description"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(S.T,{...l,value:null!=(s=l.value)?s:"",rows:4})}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(R.zB,{name:"type",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Type"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.w$.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"magicTier",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Tier"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.gV.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"quality",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Quality"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,disabled:"normal"!==eo,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.qY.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"price",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Price (gp)"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(o.p,{type:"number",...l,value:null!=(s=l.value)?s:""})}),(0,a.jsx)(R.C5,{})]})}})]}),(()=>{switch(ec){case"weapon":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Weapon Properties"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[(0,a.jsx)(R.zB,{name:"damageDie",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Damage Die"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.zE.map(e=>(0,a.jsx)(w.eb,{value:e,children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"weaponType",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Weapon Type"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.Rb.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),("missile"===ed||"spell"===ed)&&(0,a.jsx)(R.zB,{name:"range",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Range"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(o.p,{type:"number",...l,value:null!=(s=l.value)?s:"",placeholder:"e.g., 30"})}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"property",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Property"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.Vz.map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}})]}),(0,a.jsx)(R.zB,{name:"weaponEffect",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Weapon Effect"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(S.T,{...l,value:null!=(s=l.value)?s:"",rows:3})})]})}})]});case"armor":case"shield":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Armor/Shield Properties"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(R.zB,{name:"placement",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Placement"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,disabled:"shield"===ec,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:("shield"===ec?["shield"]:d.H1).map(e=>(0,a.jsx)(w.eb,{value:e,className:"capitalize",children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"weight",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Weight"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,disabled:"shield"===ec,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d._d.map(e=>(0,a.jsx)(w.eb,{value:e,children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"AR",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"AR"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(o.p,{...l,value:null!=(s=l.value)?s:"",placeholder:"e.g., +1"})}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsx)(R.zB,{name:"armorDie",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Armor Die"}),(0,a.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(R.MJ,{children:(0,a.jsx)(w.bq,{children:(0,a.jsx)(w.yv,{})})}),(0,a.jsx)(w.gC,{children:d.gG.map(e=>(0,a.jsx)(w.eb,{value:e,children:e},e))})]}),(0,a.jsx)(R.C5,{})]})}})]})]});default:return null}})(),("magical"===eo||"artifact"===eo)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.w,{}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Magical Properties"}),(0,a.jsx)(R.zB,{name:"enchantment",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Enchantment"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(S.T,{...l,value:null!=(s=l.value)?s:"",rows:4})}),(0,a.jsx)(R.C5,{})]})}})]}),"artifact"===eo&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.zB,{name:"magicalTrait",control:er.control,render:e=>{var s;let{field:l}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsx)(R.lR,{children:"Magical Trait"}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(S.T,{...l,value:null!=(s=l.value)?s:"",rows:2})}),(0,a.jsx)(R.C5,{})]})}}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.J,{children:"Granted Deed"}),ex?(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3",children:[(0,a.jsxs)("p",{className:"font-semibold",children:[ex.name," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",ex.tier,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(W,{onSelectDeed:ef,allDeeds:Y,children:(0,a.jsx)(m.$,{type:"button",variant:"outline",size:"sm",children:"Change"})}),(0,a.jsx)(m.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>{en("assignedDeedId",void 0,{shouldValidate:!0})},children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})]})]}):(0,a.jsx)(W,{onSelectDeed:ef,allDeeds:Y,children:(0,a.jsxs)(m.$,{type:"button",variant:"outline",size:"sm",className:"w-full",children:[(0,a.jsx)(M.A,{className:"h-4 w-4 mr-2"}),"Select a Deed"]})}),(0,a.jsx)(R.zB,{name:"assignedDeedId",control:er.control,render:()=>(0,a.jsx)(R.C5,{})})]})]}),(0,a.jsx)(x.w,{}),(0,a.jsx)(R.zB,{name:"tags",control:er.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(R.eI,{children:[(0,a.jsxs)(R.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(R.MJ,{children:(0,a.jsx)(N.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"item"})}),(0,a.jsx)(R.C5,{})]})}})]}),(0,a.jsxs)(D.wL,{className:"flex items-center gap-2",children:[!l&&(0,a.jsxs)(A.Lt,{children:[(0,a.jsx)(A.tv,{asChild:!0,children:(0,a.jsx)(m.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(A.EO,{children:[(0,a.jsxs)(A.wd,{children:[(0,a.jsx)(A.r7,{children:"Are you sure?"}),(0,a.jsxs)(A.$v,{children:['This will permanently delete "',er.getValues("name"),'".']})]}),(0,a.jsxs)(A.ck,{children:[(0,a.jsx)(A.Zr,{children:"Cancel"}),(0,a.jsx)(A.Rx,{onClick:eg,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!G&&(0,a.jsx)(m.$,{type:"button",variant:"outline",onClick:ep,children:"Cancel"}),(0,a.jsx)(m.$,{type:"submit",children:l?"Create Item":"Save Changes"})]})]})})})})}function G(e){let{selectedId:s}=e,[l,c]=(0,r.useState)(s||null),[d,o]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null),[x,u]=(0,r.useState)(0),[p,j]=(0,r.useState)(""),[g,f]=(0,r.useState)("all"),[v,y]=(0,r.useState)("all"),[w,N]=(0,r.useState)("all"),[C,T]=(0,r.useState)(""),[z,I]=(0,r.useState)("name"),[D,S]=(0,r.useState)("asc"),[A,R]=(0,r.useState)(!1),q=(0,i.a)(),[E,F]=(0,r.useState)("list");(0,r.useEffect)(()=>{R(!0),s&&(c(s),q&&F("editor"))},[s,q]);let B={searchTerm:p,typeFilter:g,qualityFilter:v,magicTierFilter:w,tagFilter:C,sortBy:z,sortOrder:D},V={setSearchTerm:j,setTypeFilter:f,setQualityFilter:y,setMagicTierFilter:N,setTagFilter:T,setSortBy:I,setSortOrder:S},M=()=>{j(""),f("all"),y("all"),N("all"),T(""),I("name"),S("asc")},k=()=>u(e=>e+1),J=e=>{c(e),o(!1),h(null),q&&F("editor")},$=()=>{c(null),o(!0),h(null),q&&F("editor")},Z=e=>{let s={...e},l=(e.name||"item").replace(/^(Copy of\s*)+/,"");s.name="Copy of ".concat(l),delete s.id,c(null),o(!0),h(s),q&&F("editor")},P=e=>{k(),c(e),o(!1),h(null),q&&F("editor")},L=()=>{k(),c(null),o(!1),h(null),q&&F("list")},W=()=>{d&&(o(!1),c(null),q&&F("list"))};return A?q?(0,a.jsx)(t.A,{children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===E?(0,a.jsx)(b,{onSelectItem:J,onNewItem:$,selectedItemId:l,dataVersion:x,filters:B,setFilters:V,onClearFilters:M}):(0,a.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsx)(_,{itemId:l,isCreatingNew:d,template:m,onSaveSuccess:P,onDeleteSuccess:L,onUseAsTemplate:Z,onEditCancel:W,onBack:()=>{F("list"),c(null),o(!1),h(null)}},null!=l?l:d?"new":"placeholder")})})})}):(0,a.jsx)(n.SidebarProvider,{children:(0,a.jsx)(t.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(n.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(b,{onSelectItem:J,onNewItem:$,selectedItemId:l,dataVersion:x,filters:B,setFilters:V,onClearFilters:M})}),(0,a.jsx)(n.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(_,{itemId:l,isCreatingNew:d,template:m,onSaveSuccess:P,onDeleteSuccess:L,onUseAsTemplate:Z,onEditCancel:W},null!=l?l:d?"new":"placeholder")})})]})})}):null}}}]);
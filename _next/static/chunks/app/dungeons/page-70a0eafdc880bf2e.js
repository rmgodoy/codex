(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8],{288:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eM});var r=t(5155),n=t(2115),a=t(2709),l=t(31),i=t(2489);let o=async()=>{let e=(await (0,i.Lf)()).transaction(i.Qu,"readonly").objectStore(i.Qu).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},c=async e=>{let s=(await (0,i.Lf)()).transaction(i.Qu,"readonly").objectStore(i.Qu).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},d=async e=>{let s=(await (0,i.Lf)()).transaction(i.Qu,"readwrite").objectStore(i.Qu),t=(0,i.$C)(),r={...e,id:t},n=s.add(r);return new Promise((e,s)=>{n.onsuccess=()=>e(t),n.onerror=()=>s(n.error)})},u=async e=>{let s=(await (0,i.Lf)()).transaction(i.Qu,"readwrite").objectStore(i.Qu).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},h=async e=>{let s=(await (0,i.Lf)()).transaction(i.Qu,"readwrite").objectStore(i.Qu).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})};var m=t(2523),x=t(285),j=t(6424),g=t(2346),p=t(7481),f=t(4301),v=t(5074),w=t(203),y=t(3926),N=t(5057),b=t(9409),C=t(648);function S(e){let{onSelectDungeon:s,onNewDungeon:t,selectedDungeonId:a,dataVersion:l,filters:i,setFilters:c,onClearFilters:d}=e,[u,h]=(0,n.useState)([]),[S,k]=(0,n.useState)(!0),{toast:z}=(0,p.dj)();(0,n.useEffect)(()=>{(async()=>{k(!0);try{h(await o())}catch(e){z({variant:"destructive",title:"Error",description:"Could not fetch dungeons from database."})}finally{k(!1)}})()},[l,z]);let R=(0,n.useMemo)(()=>{let e=u.filter(e=>{let s=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),t=!0,r=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return r.length>0&&(t=!!e.tags&&r.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>{if("threatRating"===i.sortBy){var t,r;let n=(null!=(t=e.threatRating)?t:0)-(null!=(r=s.threatRating)?r:0);if(0!==n)return n}return e.name.localeCompare(s.name)});return"desc"===i.sortOrder&&e.reverse(),e},[u,i]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)(x.$,{onClick:t,className:"w-full",children:[(0,r.jsx)(f.A,{})," New Dungeon"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(v.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(m.p,{placeholder:"Search dungeons...",value:i.searchTerm,onChange:e=>c.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(N.J,{children:"Filter"}),(0,r.jsx)(x.$,{variant:"ghost",size:"sm",onClick:d,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,r.jsx)(C.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>c.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"dungeon"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(N.J,{children:"Sort by"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(b.l6,{value:i.sortBy,onValueChange:e=>c.setSortBy(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{placeholder:"Sort by"})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"name",children:"Name"}),(0,r.jsx)(b.eb,{value:"threatRating",children:"Threat Rating"})]})]}),(0,r.jsxs)(x.$,{variant:"ghost",size:"icon",onClick:()=>c.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,r.jsx)(w.A,{className:"h-4 w-4"}):(0,r.jsx)(y.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,r.jsx)(g.w,{}),(0,r.jsx)(j.F,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4",children:S?(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading dungeons..."}):R.length>0?(0,r.jsx)("ul",{className:"space-y-1",children:R.map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(a===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:[e.name," ",(0,r.jsxs)("span",{className:"text-xs opacity-70",children:["(TR ",e.threatRating,")"]})]})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No dungeons found."})})})]})}var k=t(2177),z=t(221),R=t(5594),I=t(6697),A=t(4218);let L={I:{name:"Bleak",targetNumber:10,threatRating:"2d6 x 10",threatRange:"20 to 120"},II:{name:"Sinister",targetNumber:12,threatRating:"2d6 x 20",threatRange:"40 to 240"},III:{name:"Frightening",targetNumber:15,threatRating:"2d6 x 30",threatRange:"60 to 360"},IV:{name:"Harrowing",targetNumber:18,threatRating:"2d6 x 40",threatRange:"80 to 480"},V:{name:"Nightmarish",targetNumber:20,threatRating:"2d6 x 50",threatRange:"100 to 600"}},T={Tiny:{rooms:"2D4 (~5)",treasureRoll:"2D6 X HOSTILITY"},Small:{rooms:"4D4 (~10)",treasureRoll:"4D6 X HOSTILITY"},Medium:{rooms:"6D4 (~15)",treasureRoll:"6D6 X HOSTILITY"},Large:{rooms:"8D4 (~20)",treasureRoll:"8D6 X HOSTILITY"},Huge:{rooms:"10D4 (~25)",treasureRoll:"10D6 X HOSTILITY"}},M=Object.keys(L),P=Object.keys(T);var D=t(6695),E=t(8539),$=t(10),B=t(7759),V=t(8046),F=t(2543),X=t(1816),O=t(8763),G=t(7223),Z=t(5318),H=t(1203),W=t(3054),J=t(2137),K=t(7805),Q=t(8856),_=t(7906),q=t(4165),Y=t(7262),U=t(6126);let ee=R.z.object({instanceId:R.z.string(),roomId:R.z.string(),position:R.z.object({x:R.z.number(),y:R.z.number()})}),es=R.z.object({from:R.z.string().min(1,"A 'from' room must be selected."),to:R.z.string().min(1,"A 'to' room must be selected.")}),et=R.z.object({name:R.z.string().min(1,"Dungeon name is required"),description:R.z.string().optional(),hostility:R.z.enum(M),size:R.z.enum(P),threatRating:R.z.coerce.number(),treasureValue:R.z.coerce.number(),tags:R.z.array(R.z.string()).optional(),rooms:R.z.array(ee),connections:R.z.array(es)}),er=e=>{let{onAddRooms:s,existingRoomIds:t}=e,[a,l]=(0,n.useState)(!1),[i,o]=(0,n.useState)([]),[c,d]=(0,n.useState)(new Set),[u,h]=(0,n.useState)("");(0,n.useEffect)(()=>{a&&(0,I.SP)().then(o)},[a]);let g=(0,n.useMemo)(()=>i.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())&&!t.has(e.id)),[i,u,t]);return(0,r.jsxs)(q.lG,{open:a,onOpenChange:l,children:[(0,r.jsx)(q.zM,{asChild:!0,children:(0,r.jsxs)(x.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"Add Room"]})}),(0,r.jsxs)(q.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,r.jsx)(q.c7,{children:(0,r.jsx)(q.L3,{children:"Select Rooms"})}),(0,r.jsx)(m.p,{placeholder:"Search rooms...",value:u,onChange:e=>h(e.target.value),className:"mb-4 shrink-0"}),(0,r.jsx)(j.F,{className:"flex-1 border rounded-md p-2",children:(0,r.jsx)("div",{className:"space-y-1",children:g.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md",children:[(0,r.jsx)(Y.S,{id:"room-".concat(e.id),onCheckedChange:()=>d(s=>{let t=new Set(s);return t.has(e.id)?t.delete(e.id):t.add(e.id),t}),checked:c.has(e.id)}),(0,r.jsx)("label",{htmlFor:"room-".concat(e.id),className:"flex-1",children:(0,r.jsx)("p",{className:"font-semibold",children:e.name})})]},e.id))})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4 shrink-0",children:[(0,r.jsx)(x.$,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),(0,r.jsx)(x.$,{onClick:()=>{s(i.filter(e=>c.has(e.id))),l(!1),d(new Set)},disabled:0===c.size,children:"Add Selected"})]})]})]})},en={name:"",description:"",hostility:"I",size:"Tiny",threatRating:0,treasureValue:0,tags:[],rooms:[],connections:[]};function ea(e){let{dungeonId:s,isCreatingNew:t,onSaveSuccess:a,onDeleteSuccess:l,onEditCancel:i,onRunDungeon:o,onBack:j,dataVersion:f}=e,{toast:v}=(0,p.dj)(),[w,y]=(0,n.useState)(t),[N,S]=(0,n.useState)(!t&&!!s),[R,q]=(0,n.useState)(null),[Y,ee]=(0,n.useState)([]),es=(0,n.useMemo)(()=>new Map(Y.map(e=>[e.id,e])),[Y]),ea=(0,_.a)(),el=(0,k.mN)({resolver:(0,z.u)(et),defaultValues:en}),{control:ei,watch:eo,setValue:ec,getValues:ed}=el,{fields:eu,append:eh,remove:em}=(0,k.jz)({control:ei,name:"rooms"}),{fields:ex,append:ej,remove:eg}=(0,k.jz)({control:ei,name:"connections"}),ep=eo("rooms");(0,n.useEffect)(()=>{ec("treasureValue",ep.reduce((e,s)=>{let t=es.get(s.roomId);return e+((null==t?void 0:t.totalTreasureValue)||0)},0))},[ep,es,ec]),(0,n.useEffect)(()=>{(0,I.SP)().then(ee)},[]),(0,n.useEffect)(()=>{(async()=>{if(t){el.reset(en),q(null),y(!0),S(!1);return}if(!s){y(!1),S(!1),q(null);return}S(!0),y(!1);try{let e=await c(s);e?(el.reset(e),q(e)):q(null)}catch(e){v({variant:"destructive",title:"Error",description:"Could not load dungeon data."})}finally{S(!1)}})()},[s,t,el,v,f]);let ef=()=>{t?i():R&&(el.reset(R),y(!1))},ev=async e=>{try{var r;let n={...e,tags:e.tags||[]};(null==(r=e.tags)?void 0:r.length)&&await (0,A.JE)(e.tags,"dungeon");let l=s;t?(l=await d(n),v({title:"Dungeon Created!"})):s&&(await u({...n,id:s}),v({title:"Save Successful"})),l&&a(l),y(!1)}catch(e){v({variant:"destructive",title:"Save Failed"})}},ew=async()=>{if(s)try{await h(s),v({title:"Dungeon Deleted"}),l()}catch(e){v({variant:"destructive",title:"Deletion Failed"})}},ey=(0,n.useMemo)(()=>new Set(eu.map(e=>e.roomId)),[eu]),eN=eo("hostility"),eb=eo("size");return N?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(D.Zp,{children:[(0,r.jsx)(D.aR,{children:(0,r.jsx)(Q.E,{className:"h-8 w-48"})}),(0,r.jsx)(D.Wu,{children:(0,r.jsx)(Q.E,{className:"h-40 w-full"})})]})}):s||t?!w&&R?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(D.Zp,{children:[(0,r.jsx)(D.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[ea&&j&&(0,r.jsx)(x.$,{variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2 -mt-1",children:(0,r.jsx)(F.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(D.ZB,{className:"text-3xl font-bold",children:R.name}),(0,r.jsxs)(D.BT,{className:"flex flex-wrap gap-x-4",children:[(0,r.jsxs)("span",{children:["Hostility: ",L[R.hostility].name]}),(0,r.jsxs)("span",{children:["Size: ",R.size]}),(0,r.jsxs)("span",{children:["TR: ",R.threatRating]}),(0,r.jsxs)("span",{children:["Treasure: ",R.treasureValue]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,r.jsxs)(x.$,{variant:"default",size:"sm",onClick:()=>o(R.id),children:[(0,r.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"Run"]}),(0,r.jsxs)(x.$,{variant:"outline",size:"sm",onClick:()=>y(!0),children:[(0,r.jsx)(O.A,{className:"h-4 w-4 mr-2"}),"Edit"]})]})]})}),(0,r.jsxs)(D.Wu,{className:"space-y-6",children:[R.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,r.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:R.description})]}),(0,r.jsx)(g.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:["Rooms (",R.rooms.length,")"]}),(0,r.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:R.rooms.map(e=>{var s;return(0,r.jsx)("li",{className:"text-accent",children:(null==(s=es.get(e.roomId))?void 0:s.name)||"Unknown Room"},e.instanceId)})})]}),R.tags&&R.tags.length>0&&(0,r.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:R.tags.map(e=>(0,r.jsx)(U.E,{variant:"secondary",children:e},e))})})]}),(0,r.jsx)(D.wL,{children:(0,r.jsxs)($.Lt,{children:[(0,r.jsx)($.tv,{asChild:!0,children:(0,r.jsx)(x.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)(G.A,{className:"h-4 w-4"})})}),(0,r.jsxs)($.EO,{children:[(0,r.jsxs)($.wd,{children:[(0,r.jsx)($.r7,{children:"Are you sure?"}),(0,r.jsxs)($.$v,{children:['This will permanently delete "',R.name,'".']})]}),(0,r.jsxs)($.ck,{children:[(0,r.jsx)($.Zr,{children:"Cancel"}),(0,r.jsx)($.Rx,{onClick:ew,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(D.Zp,{children:(0,r.jsx)(B.lV,{...el,children:(0,r.jsxs)("form",{onSubmit:el.handleSubmit(ev),className:"space-y-6",children:[(0,r.jsx)(D.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[ea&&j&&(0,r.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:ef,className:"shrink-0 -ml-2",children:(0,r.jsx)(F.A,{className:"h-5 w-5"})}),(0,r.jsx)(D.ZB,{children:t?"Create New Dungeon":"Editing: ".concat(el.getValues("name")||"...")})]}),!ea&&(0,r.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:ef,className:"text-muted-foreground hover:text-foreground",children:(0,r.jsx)(Z.A,{className:"h-5 w-5"})})]})}),(0,r.jsxs)(D.Wu,{className:"space-y-6",children:[(0,r.jsx)(B.zB,{name:"name",control:ei,render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsx)(B.lR,{children:"Dungeon Name"}),(0,r.jsx)(B.MJ,{children:(0,r.jsx)(m.p,{...s})}),(0,r.jsx)(B.C5,{})]})}}),(0,r.jsx)(B.zB,{name:"description",control:ei,render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsx)(B.lR,{children:"Description"}),(0,r.jsx)(B.MJ,{children:(0,r.jsx)(E.T,{...s,rows:3})})]})}}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(B.zB,{control:ei,name:"hostility",render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsx)(B.lR,{children:"Hostility"}),(0,r.jsxs)(b.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,r.jsx)(B.MJ,{children:(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})})}),(0,r.jsx)(b.gC,{children:M.map(e=>(0,r.jsxs)(b.eb,{value:e,children:[e,": ",L[e].name]},e))})]}),(0,r.jsx)(B.C5,{})]})}}),(0,r.jsx)(B.zB,{control:ei,name:"size",render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsx)(B.lR,{children:"Size"}),(0,r.jsxs)(b.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,r.jsx)(B.MJ,{children:(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})})}),(0,r.jsx)(b.gC,{children:P.map(e=>(0,r.jsx)(b.eb,{value:e,children:e},e))})]}),(0,r.jsx)(B.C5,{})]})}})]}),(0,r.jsxs)(D.Zp,{className:"p-4 bg-muted/50",children:[(0,r.jsx)(D.aR,{className:"p-0 pb-2",children:(0,r.jsxs)(D.ZB,{className:"text-base flex items-center gap-2",children:[(0,r.jsx)(H.A,{className:"h-5 w-5"})," Target Values"]})}),(0,r.jsxs)(D.Wu,{className:"p-0 text-sm text-muted-foreground grid grid-cols-2 md:grid-cols-3 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"Rooms: "}),T[eb].rooms]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"Treasure: "}),T[eb].treasureRoll]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground",children:"TR Range: "}),L[eN].threatRange]})]})]}),(0,r.jsx)(B.zB,{name:"tags",control:ei,render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsxs)(B.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(W.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,r.jsx)(B.MJ,{children:(0,r.jsx)(C.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"dungeon"})}),(0,r.jsx)(B.C5,{})]})}}),(0,r.jsx)(g.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground flex items-center gap-2",children:[(0,r.jsx)(J.A,{className:"h-5 w-5"}),"Rooms"]}),(0,r.jsx)(er,{onAddRooms:e=>{let s=eu.length;e.forEach((e,t)=>{let r=s+t,n=130*Math.floor(r/4),a=r%4*200+(Math.random()-.5)*40,l=n+(Math.random()-.5)*40;eh({instanceId:crypto.randomUUID(),roomId:e.id,position:{x:a,y:l}})})},existingRoomIds:ey})]}),(0,r.jsxs)("div",{className:"space-y-2 pr-2",children:[eu.map((e,s)=>{var t;return(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-card-foreground/5 rounded-md",children:[(0,r.jsx)("p",{className:"flex-1 font-semibold",children:(null==(t=es.get(e.roomId))?void 0:t.name)||"Unknown Room"}),(0,r.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>em(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,r.jsx)(G.A,{className:"h-4 w-4"})})]},e.id)}),0===eu.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No rooms added."})]}),(0,r.jsx)(B.zB,{control:ei,name:"treasureValue",render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{className:"mt-2",children:[(0,r.jsx)(B.lR,{children:"Total Treasure Value"}),(0,r.jsx)(B.MJ,{children:(0,r.jsx)(m.p,{type:"number",...s,readOnly:!0,className:"w-24 bg-muted border-none"})})]})}})]}),(0,r.jsx)(g.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-primary-foreground flex items-center gap-2",children:[(0,r.jsx)(K.A,{className:"h-5 w-5"}),"Connections"]}),(0,r.jsxs)(x.$,{type:"button",size:"sm",variant:"outline",onClick:()=>ej({from:"",to:""}),disabled:eu.length<2,children:[(0,r.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"Add Connection"]})]}),(0,r.jsxs)("div",{className:"space-y-2 pr-2",children:[ex.map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] items-start gap-2 p-2 bg-card-foreground/5 rounded-md",children:[(0,r.jsx)(B.zB,{control:ei,name:"connections.".concat(s,".from"),render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsxs)(b.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,r.jsx)(B.MJ,{children:(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{placeholder:"From Room..."})})}),(0,r.jsx)(b.gC,{children:eu.map(e=>{var s;return(0,r.jsx)(b.eb,{value:e.instanceId,children:(null==(s=es.get(e.roomId))?void 0:s.name)||"..."},e.instanceId)})})]}),(0,r.jsx)(B.C5,{})]})}}),(0,r.jsx)("span",{className:"pt-2",children:"->"}),(0,r.jsx)(B.zB,{control:ei,name:"connections.".concat(s,".to"),render:e=>{let{field:s}=e;return(0,r.jsxs)(B.eI,{children:[(0,r.jsxs)(b.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,r.jsx)(B.MJ,{children:(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{placeholder:"To Room..."})})}),(0,r.jsx)(b.gC,{children:eu.map(e=>{var s;return(0,r.jsx)(b.eb,{value:e.instanceId,children:(null==(s=es.get(e.roomId))?void 0:s.name)||"..."},e.instanceId)})})]}),(0,r.jsx)(B.C5,{})]})}}),(0,r.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>eg(s),className:"text-muted-foreground hover:text-destructive shrink-0 self-center",children:(0,r.jsx)(G.A,{className:"h-4 w-4"})})]},e.id)),0===ex.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-2",children:"No connections added."})]})]})]}),(0,r.jsxs)(D.wL,{className:"flex items-center gap-2",children:[!t&&(0,r.jsxs)($.Lt,{children:[(0,r.jsx)($.tv,{asChild:!0,children:(0,r.jsx)(x.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)(G.A,{className:"h-4 w-4"})})}),(0,r.jsxs)($.EO,{children:[(0,r.jsxs)($.wd,{children:[(0,r.jsx)($.r7,{children:"Are you sure?"}),(0,r.jsxs)($.$v,{children:['This will permanently delete "',ed("name"),'".']})]}),(0,r.jsxs)($.ck,{children:[(0,r.jsx)($.Zr,{children:"Cancel"}),(0,r.jsx)($.Rx,{onClick:ew,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,r.jsx)("div",{className:"flex-grow"}),!ea&&(0,r.jsx)(x.$,{type:"button",variant:"outline",onClick:ef,children:"Cancel"}),(0,r.jsx)(x.$,{type:"submit",children:t?"Create Dungeon":"Save Changes"})]})]})})})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(D.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,r.jsx)(D.Wu,{className:"text-center pt-6",children:(0,r.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a dungeon to view or create one."})})})})}var el=t(4211),ei=t(3306),eo=t(7581),ec=t(7916);t(1687);var ed=t(8251),eu=t.n(ed),eh=t(7189),em=t(4691),ex=t(8638),ej=t(1933),eg=t(8531),ep=t(6438),ef=t(7554),ev=t(3503),ew=t(8917),ey=t(2945);function eN(e,s){var t,r,n,a,l,i;let{width:o,height:c,positionAbsolute:d}=e,u=s.positionAbsolute,h=(null!=o?o:0)/2,m=(null!=c?c:0)/2,x=(null!=(t=null==d?void 0:d.x)?t:0)+h,j=(null!=(r=null==d?void 0:d.y)?r:0)+m,g=(null!=(n=null==u?void 0:u.x)?n:0)+(null!=(a=s.width)?a:0)/2,p=(null!=(l=null==u?void 0:u.y)?l:0)+(null!=(i=s.height)?i:0)/2,f=(g-x)/(2*h)-(p-j)/(2*m),v=(g-x)/(2*h)+(p-j)/(2*m),w=1/(Math.abs(f)+Math.abs(v)),y=w*f,N=w*v;return{x:h*(y+N)+x,y:m*(-y+N)+j}}function eb(e,s){var t,r,n,a;let l={...e.positionAbsolute,...e},i=Math.round(null!=(t=l.x)?t:0),o=Math.round(null!=(r=l.y)?r:0),c=Math.round(s.x),d=Math.round(s.y);return c<=i+1?"left":c>=i+(null!=(n=l.width)?n:0)-1?"right":d<=o+1?"top":d>=o+(null!=(a=l.height)?a:0)-1?"bottom":"top"}let eC=e=>{let{fromNode:s,toX:t,toY:n}=e;if(!s)return null;let{x:a,y:l}=function(e,s){var t,r,n,a,l,i;let{width:o,height:c,positionAbsolute:d}=e,u=s.positionAbsolute,h=(null!=o?o:0)/2,m=(null!=c?c:0)/2,x=(null!=(t=null==d?void 0:d.x)?t:0)+h,j=(null!=(r=null==d?void 0:d.y)?r:0)+m,g=(null!=(n=null==u?void 0:u.x)?n:0)+(null!=(a=s.width)?a:0)/2,p=(null!=(l=null==u?void 0:u.y)?l:0)+(null!=(i=s.height)?i:0)/2,f=(g-x)/(2*h)-(p-j)/(2*m),v=(g-x)/(2*h)+(p-j)/(2*m),w=1/(Math.abs(f)+Math.abs(v)),y=w*f,N=w*v;return{x:h*(y+N)+x,y:m*(-y+N)+j}}(s,{id:"target-node",width:1,height:1,positionAbsolute:{x:t,y:n}}),[i]=(0,el.Fp)({sourceX:a,sourceY:l,sourcePosition:"bottom",targetX:t,targetY:n,targetPosition:"top"});return(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{fill:"none",stroke:"hsl(var(--primary))",strokeWidth:1.5,className:"animated",d:i}),(0,r.jsx)("circle",{cx:t,cy:n,fill:"#fff",r:3,stroke:"hsl(var(--primary))",strokeWidth:1.5})]})},eS={visibility:"hidden"},ek={floating:function(e){let{id:s,source:t,target:a,markerEnd:l,style:i}=e,o=(0,el.Pj)((0,n.useCallback)(e=>e.nodeInternals.get(t),[t])),c=(0,el.Pj)((0,n.useCallback)(e=>e.nodeInternals.get(a),[a]));if(!o||!c)return null;let d=eN(o,c),u=eN(c,o),h=eb(o,d),m=eb(c,u),[x]=(0,el.Fp)({sourceX:d.x,sourceY:d.y,sourcePosition:h,targetX:u.x,targetY:u.y,targetPosition:m});return(0,r.jsx)(el.tE,{id:s,path:x,markerEnd:l,style:i})}},ez={dungeonRoom:function(e){let{data:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(el.h7,{type:"source",position:el.yX.Top,style:eS}),(0,r.jsx)(el.h7,{type:"source",position:el.yX.Right,style:eS}),(0,r.jsx)(el.h7,{type:"source",position:el.yX.Bottom,style:eS}),(0,r.jsx)(el.h7,{type:"source",position:el.yX.Left,style:eS}),(0,r.jsx)(el.h7,{type:"target",position:el.yX.Top,style:eS}),(0,r.jsx)(el.h7,{type:"target",position:el.yX.Right,style:eS}),(0,r.jsx)(el.h7,{type:"target",position:el.yX.Bottom,style:eS}),(0,r.jsx)(el.h7,{type:"target",position:el.yX.Left,style:eS}),(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-center p-2",children:s.label})]})}},eR=new(eu()),eI={"elk.algorithm":"force","elk.force.iterations":"1000","elk.force.alpha":"1","elk.force.gravity":"0.01","elk.spacing.nodeNode":"120"},eA=(e,s)=>{let t={id:"root",layoutOptions:eI,children:e.map(e=>{var s,t;return{id:e.id,width:(null==(s=e.style)?void 0:s.width)||150,height:(null==(t=e.style)?void 0:t.height)||80}}),edges:s.map(e=>({id:e.id,sources:[e.source],targets:[e.target]}))};return eR.layout(t).then(s=>e.map(e=>{var t;let r=null==(t=s.children)?void 0:t.find(s=>s.id===e.id);return(null==r?void 0:r.x)&&(null==r?void 0:r.y)&&(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(e.position={x:r.x,y:r.y}),e})).catch(s=>(console.error("ELK layout error:",s),e))};function eL(e){var s;let{dungeon:t,onEndDungeon:a}=e,[l,i]=(0,n.useState)(!0),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),[w,y]=(0,n.useState)(0),[N,b]=(0,n.useState)([0]),{toast:C}=(0,p.dj)(),[S,k,z]=(0,el.ck)([]),[R,A,L]=(0,el.fM)([]),{fitView:T}=(0,el.VH)(),M=(0,n.useCallback)(()=>{eA(S,R).then(e=>{k(e),window.requestAnimationFrame(()=>{T({duration:800,padding:.1})})})},[S,R,k,T]),P=Math.floor(w/3)+1,E=null!=(s=N[w])?s:0,$=e=>{let s=Math.max(0,Math.min(10,E+e)),t=[...N];t[w]=s,b(t)},B=(0,n.useCallback)((e,s)=>{if(!s){m(null),v(null);return}m(s.id),v(null)},[m,v]);(0,n.useEffect)(()=>{if(h){let e=new Set([h]);t.connections.forEach(s=>{s.from===h&&e.add(s.to),s.to===h&&e.add(s.from)}),setTimeout(()=>{T({nodes:Array.from(e).map(e=>({id:e})),duration:600,padding:.2})},10)}},[h,t.connections,T]),(0,n.useEffect)(()=>{(async()=>{i(!0);let e=await (0,I.SP)(),s=new Map(e.map(e=>[e.id,e])),t=e.flatMap(e=>e.features.flatMap(e=>e.encounterIds)),r=await Promise.all(t.map(e=>(0,eh.eq)(e).catch(()=>null)));e.flatMap(e=>e.features.flatMap(e=>e.treasureIds));let n=await (0,em.Ap)();e.flatMap(e=>e.features.flatMap(e=>e.alchemicalItemIds));let a=await (0,ex.vV)();u({rooms:s,encounters:new Map(r.filter(e=>null!==e).map(e=>[e.id,e])),treasures:new Map(n.map(e=>[e.id,e])),alchemicalItems:new Map(a.map(e=>[e.id,e]))}),i(!1)})()},[t]);let O=(0,n.useMemo)(()=>t&&d?t.rooms.map(e=>{let s=d.rooms.get(e.roomId);return{id:e.instanceId,position:{x:0,y:0},data:{label:(null==s?void 0:s.name)||"Loading..."},style:{background:"hsl(var(--card))",color:"hsl(var(--card-foreground))",border:"2px solid",borderColor:"hsl(var(--border))",width:150,height:80,borderRadius:"var(--radius)",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"},type:"dungeonRoom"}}):[],[t,d]),G=(0,n.useMemo)(()=>t?t.connections.map(e=>({id:"edge-".concat(e.from,"-").concat(e.to),source:e.from,target:e.to,type:"floating",style:{strokeWidth:2,stroke:"hsl(var(--border))"}})):[],[t]);(0,n.useEffect)(()=>{O.length>0&&eA(O,G).then(e=>{k(e),A(G),setTimeout(()=>{T({duration:800,padding:.1})},100)})},[O,G,k,A,T]),(0,n.useEffect)(()=>{k(e=>e.map(e=>{let s=e.id===h;return{...e,style:{...e.style,background:s?"hsl(var(--primary))":"hsl(var(--card))",color:s?"hsl(var(--primary-foreground))":"hsl(var(--card-foreground))",borderColor:s?"hsl(var(--ring))":"hsl(var(--border))"}}})),A(e=>e.map(e=>{let s=h&&(e.source===h||e.target===h);return{...e,animated:s,style:{...e.style,strokeWidth:s?2.5:1.5,stroke:s?"hsl(var(--primary))":"hsl(var(--border))"}}}))},[h,k,A]);let Z=(0,n.useMemo)(()=>{if(!h||!d)return null;let e=t.rooms.find(e=>e.instanceId===h);return e?d.rooms.get(e.roomId):null},[h,t,d]),H=(0,n.useMemo)(()=>f&&d&&d.encounters.get(f)||null,[f,d]),W=async e=>{let s=null==d?void 0:d.encounters.get(e);s?c(s):C({variant:"destructive",title:"Error",description:"Could not find encounter data."})};return o?(0,r.jsx)(ej.A,{encounter:o,onEndEncounter:()=>c(null)}):l?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,r.jsx)(Q.E,{className:"h-48 w-48"})}):(0,r.jsxs)("div",{className:"flex flex-col h-screen w-full bg-background/50",children:[(0,r.jsxs)("header",{className:"py-4 px-6 border-b border-border flex items-center justify-between shrink-0 bg-background/80 backdrop-blur-sm sticky top-0 z-20",children:[(0,r.jsx)("h1",{className:"text-xl md:text-3xl font-bold text-primary-foreground",children:t.name}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Alert"}),(0,r.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>{let e=[...N];e[w]=0,b(e)},title:"Reset Alert",children:(0,r.jsx)(eg.A,{className:"h-3 w-3"})})]}),(0,r.jsxs)("div",{className:"text-lg font-bold flex items-center gap-1",children:[(0,r.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>$(-1),disabled:E<=0,children:(0,r.jsx)(ep.A,{className:"h-4 w-4"})}),E,(0,r.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>$(1),disabled:E>=10,children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Round / Action"}),(0,r.jsxs)("div",{className:"text-lg font-bold",children:[P," / ",w%3+1]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:()=>{y(e=>Math.max(0,e-1))},disabled:0===w,children:"Prev Action"}),(0,r.jsx)(x.$,{variant:"default",size:"sm",onClick:()=>{y(e=>{let s=e+1;return b(e=>{var t;let r=[...e],n=null!=(t=e[e.length-1])?t:0;return s>=r.length&&(r[s]=n),r}),s})},children:"Next Action"})]}),(0,r.jsx)(x.$,{variant:"outline",size:"icon",onClick:M,title:"Re-Layout",children:(0,r.jsx)(ef.A,{className:"h-4 w-4"})}),(0,r.jsx)(x.$,{variant:"destructive",onClick:a,children:"End Dungeon"})]})]}),(0,r.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(Z||H)&&(0,r.jsxs)("div",{className:"w-[380px] border-r border-border bg-card p-4 flex flex-col",children:[H?(0,r.jsxs)(x.$,{variant:"ghost",className:"self-start mb-2 -ml-2",onClick:()=>v(null),children:[(0,r.jsx)(F.A,{className:"h-4 w-4 mr-2"})," Back to Room Details"]}):(0,r.jsxs)(x.$,{variant:"ghost",className:"self-start mb-2 -ml-2",onClick:()=>{m(null),v(null)},children:[(0,r.jsx)(F.A,{className:"h-4 w-4 mr-2"})," Back to Dungeon View"]}),(0,r.jsx)(j.F,{className:"flex-1",children:H?(0,r.jsxs)(D.Zp,{children:[(0,r.jsxs)(D.aR,{children:[(0,r.jsx)(D.ZB,{children:H.name}),(0,r.jsxs)(D.BT,{children:["TR: ",H.totalTR]})]}),(0,r.jsxs)(D.Wu,{children:[(0,r.jsxs)(x.$,{className:"w-full",onClick:()=>W(H.id),children:[(0,r.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"Run Encounter"]}),(0,r.jsx)("p",{className:"mt-4 text-sm whitespace-pre-wrap",children:H.sceneDescription})]})]}):Z?(0,r.jsxs)(D.Zp,{children:[(0,r.jsxs)(D.aR,{children:[(0,r.jsx)(D.ZB,{children:Z.name}),(0,r.jsx)(D.BT,{children:Z.size})]}),(0,r.jsxs)(D.Wu,{className:"space-y-4",children:[(0,r.jsx)("p",{children:Z.description}),(0,r.jsx)(g.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"Features"}),Z.features.map(e=>(0,r.jsxs)("div",{className:"p-2 border-b",children:[(0,r.jsx)("p",{className:"font-bold",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.encounterIds.map(e=>{var s;return(0,r.jsxs)(x.$,{variant:"link",className:"p-0 h-auto text-accent",onClick:()=>v(e),children:[(0,r.jsx)(ev.A,{className:"h-4 w-4 mr-1"}),null==d||null==(s=d.encounters.get(e))?void 0:s.name]},e)}),e.treasureIds.map(e=>{var s;return(0,r.jsxs)("p",{className:"text-sm flex items-center gap-1",children:[(0,r.jsx)(ew.A,{className:"h-4 w-4"}),null==d||null==(s=d.treasures.get(e))?void 0:s.name]},e)}),e.alchemicalItemIds.map(e=>{var s;return(0,r.jsxs)("p",{className:"text-sm flex items-center gap-1",children:[(0,r.jsx)(ey.A,{className:"h-4 w-4"}),null==d||null==(s=d.alchemicalItems.get(e))?void 0:s.name]},e)})]},e.id))]})]})]}):null})]}),(0,r.jsx)("div",{className:"flex-1 relative overflow-hidden bg-gradient-to-br from-background to-muted/20",children:(0,r.jsxs)(el.Gc,{nodes:S,edges:R,onNodesChange:z,onEdgesChange:L,onNodeClick:B,onPaneClick:()=>B(null,null),fitView:!0,nodesDraggable:!0,nodeTypes:ez,edgeTypes:ek,connectionLineComponent:eC,children:[(0,r.jsx)(ei.H,{}),(0,r.jsx)(eo.o,{pannable:!0,zoomable:!0,nodeStrokeWidth:3,nodeColor:e=>{var s;return(null==(s=e.style)?void 0:s.background)||"#fff"}}),(0,r.jsx)(ec.V,{variant:"dots",gap:16,size:1})]})})]})]})}function eT(e){return(0,r.jsx)(el.Ln,{children:(0,r.jsx)(eL,{...e})})}function eM(){let[e,s]=(0,n.useState)("preparation"),[t,i]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(0),[j,g]=(0,n.useState)(""),[f,v]=(0,n.useState)(""),[w,y]=(0,n.useState)("name"),[N,b]=(0,n.useState)("asc"),[C,k]=(0,n.useState)(!1),z=(0,_.a)(),[R,I]=(0,n.useState)("list");(0,n.useEffect)(()=>{k(!0)},[]);let A={searchTerm:j,tagFilter:f,sortBy:w,sortOrder:N},L={setSearchTerm:g,setTagFilter:v,setSortBy:y,setSortOrder:b},T=()=>{g(""),v(""),y("name"),b("asc")},M=()=>x(e=>e+1),P=e=>{i(e),h(!1),z&&I("editor")},D=()=>{i(null),h(!0),z&&I("editor")},E=e=>{M(),i(e),h(!1),z&&I("editor")},$=()=>{M(),i(null),h(!1),z&&I("list")},B=()=>{u&&(h(!1),i(null),z&&I("list"))},{toast:V}=(0,p.dj)(),F=async e=>{try{let t=await c(e);t?(d(t),s("live")):V({variant:"destructive",title:"Error",description:"Could not find dungeon to run."})}catch(e){V({variant:"destructive",title:"Error",description:"Failed to load dungeon data."})}};return"live"===e&&o?(0,r.jsx)(eT,{dungeon:o,onEndDungeon:()=>{d(null),s("preparation")}}):C?z?(0,r.jsx)(a.A,{showSidebarTrigger:!1,children:(0,r.jsx)("div",{className:"h-full w-full",children:"list"===R?(0,r.jsx)(S,{onSelectDungeon:P,onNewDungeon:D,selectedDungeonId:t,dataVersion:m,filters:A,setFilters:L,onClearFilters:T}):(0,r.jsx)("div",{className:"p-4 sm:p-6 h-full w-full overflow-y-auto",children:(0,r.jsx)(ea,{dungeonId:t,isCreatingNew:u,onSaveSuccess:E,onDeleteSuccess:$,onEditCancel:B,onRunDungeon:F,onBack:()=>{I("list"),i(null),h(!1)},dataVersion:m},null!=t?t:u?"new":"placeholder")})})}):(0,r.jsx)(l.GB,{children:(0,r.jsx)(a.A,{children:(0,r.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,r.jsx)(l.Bx,{style:{"--sidebar-width":"380px"},children:(0,r.jsx)(S,{onSelectDungeon:P,onNewDungeon:D,selectedDungeonId:t,dataVersion:m,filters:A,setFilters:L,onClearFilters:T})}),(0,r.jsx)(l.sF,{className:"flex-1 overflow-y-auto",children:(0,r.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,r.jsx)(ea,{dungeonId:t,isCreatingNew:u,onSaveSuccess:E,onDeleteSuccess:$,onEditCancel:B,onRunDungeon:F,dataVersion:m},null!=t?t:u?"new":"placeholder")})})]})})}):null}},2373:(e,s,t)=>{Promise.resolve().then(t.bind(t,288))},4691:(e,s,t)=>{"use strict";t.d(s,{Ap:()=>n,Dp:()=>l,Ld:()=>i,qp:()=>a,vm:()=>o});var r=t(2489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},6697:(e,s,t)=>{"use strict";t.d(s,{HN:()=>o,SP:()=>n,TG:()=>l,_w:()=>a,xX:()=>i});var r=t(2489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},8638:(e,s,t)=>{"use strict";t.d(s,{S9:()=>i,gL:()=>o,rD:()=>a,vV:()=>n,wo:()=>l});var r=t(2489);let n=async()=>{let e=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},a=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP),t=(0,r.$C)(),n={...e,id:t},a=s.add(n);return new Promise((e,s)=>{a.onsuccess=()=>e(t),a.onerror=()=>s(a.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},o=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}}},e=>{var s=s=>e(e.s=s);e.O(0,[294,702,238,222,120,427,909,530,347,239,1,441,684,358],()=>s(2373)),_N_E=e.O()}]);
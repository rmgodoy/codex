"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1257],{21257:(e,a,s)=>{s.r(a),s.d(a,{default:()=>eN});var t=s(95155),l=s(12115),i=s(99982),n=s(19209),r=s(66695),c=s(18186),d=s(68715),o=s(66049),h=s(57946),m=s(23767),u=s(20427),x=s(43152),p=s(83662),j=s(55166),v=s(82643),f=s(56013),g=s(18046),N=s(10518),w=s(25318),b=s(18763),y=s(77223),C=s(21887),k=s(10366),S=s(10947),A=s(47326),F=s(17657),E=s(11133),I=s(86318),z=s(50286),M=s(51920),D=s(52354),P=s(47219),$=s(7146),R=s(92745),J=s(60704),L=s(59434);let q=J.bL,T=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(J.B8,{ref:a,className:(0,L.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...l})});T.displayName=J.B8.displayName;let B=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(J.l9,{ref:a,className:(0,L.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...l})});B.displayName=J.l9.displayName;let W=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(J.UC,{ref:a,className:(0,L.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...l})});W.displayName=J.UC.displayName;var V=s(85057),U=s(62523),G=s(30285),H=s(22346),Z=s(46102),_=s(49864),O=s(74466),Y=s(124);let K=(0,O.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});l.forwardRef((e,a)=>{let{className:s,variant:l,size:i,...n}=e;return(0,t.jsx)(Y.b,{ref:a,className:(0,L.cn)(K({variant:l,size:i,className:s})),...n})}).displayName=Y.b.displayName;let Q=(0,O.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),X=l.createContext({size:"default",variant:"default"}),ee=l.forwardRef((e,a)=>{let{className:s,variant:l,size:i,children:n,...r}=e;return(0,t.jsx)(_.bL,{ref:a,className:(0,L.cn)(Q({variant:l,className:s})),...r,children:(0,t.jsx)(X.Provider,{value:{variant:l,size:i},children:n})})});ee.displayName=_.bL.displayName;let ea=l.forwardRef((e,a)=>{let{className:s,children:i,variant:n,size:r,...c}=e,d=l.useContext(X);return(0,t.jsx)(_.q7,{ref:a,className:(0,L.cn)(K({variant:d.variant||n,size:d.size||r}),s),...c,children:i})});ea.displayName=_.q7.displayName;var es=s(54165),et=s(66424),el=s(47262);function ei(e){let{items:a,initialSelectedIds:s=[],onConfirm:i,trigger:n,title:r}=e,[c,d]=(0,l.useState)(!1),[o,h]=(0,l.useState)(""),[m,u]=(0,l.useState)(new Set(s));(0,l.useEffect)(()=>{c&&u(new Set(s))},[c,s]);let x=(0,l.useMemo)(()=>a.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())),[a,o]),p=(e,a)=>{u(s=>{let t=new Set(s);return a?t.add(e):t.delete(e),t})};return(0,t.jsxs)(es.lG,{open:c,onOpenChange:d,children:[(0,t.jsx)(es.zM,{asChild:!0,children:n}),(0,t.jsxs)(es.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(es.c7,{children:(0,t.jsx)(es.L3,{children:r})}),(0,t.jsx)(U.p,{placeholder:"Search...",value:o,onChange:e=>h(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(et.F,{className:"flex-1 border rounded-md p-2",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(el.S,{id:"item-select-".concat(e.id),checked:m.has(e.id),onCheckedChange:a=>p(e.id,!!a)}),(0,t.jsx)(V.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(es.Es,{className:"pt-4",children:[(0,t.jsx)(G.$,{variant:"ghost",onClick:()=>d(!1),children:"Cancel"}),(0,t.jsx)(G.$,{onClick:()=>{i(Array.from(m)),d(!1)},children:"Confirm"})]})]})]})}var en=s(26126),er=s(59409),ec=s(87481),ed=s(90010),eo=s(83013),eh=s(47906),em=s(8643),eu=s(54059),ex=s(70154);let ep=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(eu.bL,{className:(0,L.cn)("grid gap-2",s),...l,ref:a})});ep.displayName=eu.bL.displayName;let ej=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(eu.q7,{ref:a,className:(0,L.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:(0,t.jsx)(eu.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(ex.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});ej.displayName=eu.q7.displayName;let ev=[{name:"Home",component:c.A},{name:"Trees",component:d.A},{name:"Mountain",component:o.A},{name:"Castle",component:h.A},{name:"TowerControl",component:m.A},{name:"Tent",component:u.A},{name:"Waves",component:x.A},{name:"MapPin",component:p.A},{name:"Landmark",component:j.A},{name:"Skull",component:v.A}],ef=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function eg(e){let{maps:a,onMapsUpdate:s}=e,[i,n]=(0,l.useState)(!1),[r,c]=(0,l.useState)(""),[d,o]=(0,l.useState)("radial"),[h,m]=(0,l.useState)(20),[u,x]=(0,l.useState)(30),[p,j]=(0,l.useState)(20),[v,C]=(0,l.useState)(null),[k,S]=(0,l.useState)(""),{toast:A}=(0,ec.dj)(),F=async()=>{let e,a;if(!r.trim())return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name."});if("radial"===d){if(!h||h<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide a valid radius."});e=(0,$.Xk)(h),a={name:r.trim(),shape:"radial",radius:h,tiles:e,paths:[]}}else{if(!u||u<=0||!p||p<=0)return void A({variant:"destructive",title:"Invalid Input",description:"Please provide valid width and height."});e=(0,$.z0)(u,p),a={name:r.trim(),shape:"rectangular",width:u,height:p,tiles:e,paths:[]}}try{let e=await (0,R.Ys)(a);A({title:"Map Created",description:"'".concat(r,"' has been added.")}),c(""),m(20),x(30),j(20),s(e),n(!1)}catch(e){A({variant:"destructive",title:"Error",description:"Failed to create map."})}},E=e=>{C(e.id),S(e.name)},I=()=>{C(null),S("")},z=async()=>{if(!v||!k.trim())return;let e=a.find(e=>e.id===v);if(e)try{await (0,R.cA)({...e,name:k.trim()}),A({title:"Map Renamed"}),s(),I()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to rename map."})}},M=async e=>{try{await (0,R.GY)(e),A({title:"Map Deleted"}),s()}catch(e){A({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(es.lG,{open:i,onOpenChange:n,children:[(0,t.jsx)(es.zM,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(f.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(es.Cf,{children:[(0,t.jsxs)(es.c7,{children:[(0,t.jsx)(es.L3,{children:"Manage Maps"}),(0,t.jsx)(es.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-4 p-3 border rounded-md",children:[(0,t.jsx)(V.J,{children:"New Map"}),(0,t.jsx)(U.p,{placeholder:"New map name...",value:r,onChange:e=>c(e.target.value)}),(0,t.jsxs)(ep,{value:d,onValueChange:e=>o(e),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"radial",id:"radial"}),(0,t.jsx)(V.J,{htmlFor:"radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"rectangular",id:"rectangular"}),(0,t.jsx)(V.J,{htmlFor:"rectangular",children:"Rectangular"})]})]}),"radial"===d?(0,t.jsx)(U.p,{placeholder:"Radius",type:"number",value:h,onChange:e=>m(parseInt(e.target.value,10)||0)}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(U.p,{placeholder:"Width",type:"number",value:u,onChange:e=>x(parseInt(e.target.value,10)||0)}),(0,t.jsx)(U.p,{placeholder:"Height",type:"number",value:p,onChange:e=>j(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(G.$,{onClick:F,className:"w-full",children:[(0,t.jsx)(g.A,{className:"h-4 w-4"})," Add Map"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:v===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.p,{value:k,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key&&z()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(G.$,{size:"icon",className:"h-7 w-7",onClick:z,"aria-label":"Save",children:(0,t.jsx)(N.A,{className:"h-4 w-4"})}),(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:I,"aria-label":"Cancel",children:(0,t.jsx)(w.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>E(e),"aria-label":"Edit",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})}),(0,t.jsxs)(ed.Lt,{children:[(0,t.jsx)(ed.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(y.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(ed.EO,{children:[(0,t.jsxs)(ed.wd,{children:[(0,t.jsx)(ed.r7,{children:"Are you sure?"}),(0,t.jsxs)(ed.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(ed.ck,{children:[(0,t.jsx)(ed.Zr,{children:"Cancel"}),(0,t.jsx)(ed.Rx,{onClick:()=>M(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function eN(){let[e,a]=(0,l.useState)([]),[s,c]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[h,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(null),[j,v]=(0,l.useState)("settings"),[f,g]=(0,l.useState)("brush"),[N,b]=(0,l.useState)("#8A2BE2"),[y,D]=(0,l.useState)(null),[P,J]=(0,l.useState)(null),[_,O]=(0,l.useState)("#E0D6F0"),[Y,K]=(0,l.useState)(!0),[Q,X]=(0,l.useState)("#E0D6F0"),[es,et]=(0,l.useState)([]),[el,ed]=(0,l.useState)([]),[eu,ex]=(0,l.useState)([]),[eN,eb]=(0,l.useState)(!1),[ey,eC]=(0,l.useState)(!1),[ek,eS]=(0,l.useState)(!1),[eA,eF]=(0,l.useState)(!1),{toast:eE}=(0,ec.dj)(),eI=(0,eh.a)(),[ez,eM]=(0,l.useState)(!0);(0,l.useEffect)(()=>{eM(!eI)},[eI]),(0,l.useEffect)(()=>{let e=e=>{"Control"===e.key&&eb(!0),"Alt"===e.key&&(e.preventDefault(),eC(!0)),"Shift"===e.key&&eS(!0)},a=e=>{"Control"===e.key&&eb(!1),"Alt"===e.key&&eC(!1),"Shift"===e.key&&eS(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]);let eD=(0,l.useCallback)(async e=>{let t=(await (0,R.xW)()).sort((e,a)=>e.name.localeCompare(a.name));if(a(t),e)return void c(e);s&&!t.some(e=>e.id===s)?c(t.length>0?t[0].id:null):!s&&t.length>0?c(t[0].id):0===t.length&&(c(null),o(null))},[s]);(0,l.useEffect)(()=>{eD(),(0,R.J0)().then(et),(0,R.vq)().then(ed),(0,R.bj)().then(ex)},[]),(0,l.useEffect)(()=>{s?((0,R.zU)(s).then(e=>{e&&o(e)}),x(null),J(null)):o(null)},[s]),(0,l.useEffect)(()=>{d?m({name:d.name,shape:d.shape||"radial",radius:d.radius||20,width:d.width||30,height:d.height||20}):m(null)},[d]);let eP=e=>{let a=parseInt((e=e.replace("#","")).substring(0,2),16),s=parseInt(e.substring(2,4),16);return(.2126*a+.7152*s+.0722*parseInt(e.substring(4,6),16))/255};(0,l.useEffect)(()=>{Y?X(eP(N)>.5?"#000000":"#FFFFFF"):X(_)},[Y,N,_]);let e$=(0,l.useCallback)(e=>{o(e),(0,R.cA)(e).catch(()=>{eE({variant:"destructive",title:"Auto-save failed."})})},[eE]),eR=(0,l.useCallback)(e=>{d&&e$({...d,tiles:e})},[d,e$]),eJ=(e,a)=>{if(d){let s=d.tiles.map(s=>s.hex.q===e.q&&s.hex.r===e.r?{...s,data:{...s.data,...a}}:s);e$({...d,tiles:s})}},eL=(0,l.useCallback)(e=>{d&&e$({...d,paths:e})},[d,e$]),eq=(0,l.useCallback)(e=>{d&&P&&eL((d.paths||[]).map(a=>a.id===P?{...a,points:[...a.points,e]}:a))},[d,P,eL]),eT=async()=>{let e,s;if(d&&h){if(!h.name.trim())return void eE({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if("radial"===h.shape){if(isNaN(h.radius)||h.radius<=0||h.radius>100)return void eE({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});e=(0,$.YS)(d.tiles,h.radius),s={...d,name:h.name,shape:"radial",radius:h.radius,width:void 0,height:void 0,tiles:e}}else{if(isNaN(h.width)||h.width<=0||h.width>200||isNaN(h.height)||h.height<=0||h.height>200)return void eE({variant:"destructive",title:"Validation Error",description:"Width and Height must be between 1 and 200."});e=(0,$.z0)(h.width,h.height,d.tiles),s={...d,name:h.name,shape:"rectangular",width:h.width,height:h.height,radius:void 0,tiles:e}}try{await (0,R.cA)(s),o(s),a(e=>e.map(e=>e.id===s.id?{...e,name:s.name}:e)),eE({title:"Map settings saved!"})}catch(e){eE({variant:"destructive",title:"Save failed"})}}},eB="erase"===f,eW=(0,l.useMemo)(()=>null==d?void 0:d.tiles.find(e=>e.hex.q===(null==u?void 0:u.q)&&e.hex.r===(null==u?void 0:u.r)),[d,u]),eV=(0,l.useMemo)(()=>new Map(es.map(e=>[e.id,e])),[es]),eU=(0,l.useMemo)(()=>new Map(el.map(e=>[e.id,e])),[el]),eG=(0,l.useMemo)(()=>eW&&d?eu.filter(e=>e.location&&e.location.mapId===d.id&&e.location.hex.q===eW.hex.q&&e.location.hex.r===eW.hex.r&&e.location.hex.s===eW.hex.s):[],[eW,d,eu]);return(0,t.jsx)(i.A,{children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[d?(0,t.jsx)(n.A,{mapData:d,hexSize:25,className:(0,L.cn)("w-full h-full",(eA||ey&&"paint"===j&&"brush"===f)&&"cursor-crosshair"),style:{touchAction:"none"},onGridUpdate:eR,onHexClick:x,onAddPointToPath:eq,activeTool:j,paintMode:f,paintColor:N,paintIcon:y,paintIconColor:Q,selectedHex:u,isCtrlPressed:eN,isAltPressed:ey,isShiftPressed:ek,isEyedropperActive:eA,onEyedropperClick:e=>{if(!d)return;let a=d.tiles.find(a=>a.hex.q===e.q&&a.hex.r===e.r);a&&(b(a.data.color||"#8A2BE2"),D(a.data.icon||null),a.data.iconColor&&(O(a.data.iconColor),K(!1))),eF(!1),eE({title:"Tile properties copied to brush."})},pathDrawingId:P}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(em.Nt,{open:!eI||ez,onOpenChange:eI?eM:void 0,className:(0,L.cn)("fixed z-10 w-80 shadow-lg top-20 left-4"),children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(r.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),eI&&(0,t.jsx)(em.R6,{asChild:!0,children:(0,t.jsxs)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(C.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(em.Ke,{children:(0,t.jsx)(r.Wu,{children:(0,t.jsxs)(q,{value:j,onValueChange:e=>v(e),className:"w-full",children:[(0,t.jsxs)(T,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(B,{value:"settings",children:"Settings"}),(0,t.jsx)(B,{value:"paint",children:"Paint"}),(0,t.jsx)(B,{value:"path",children:"Path"}),(0,t.jsx)(B,{value:"data",children:"Data"})]}),(0,t.jsxs)(W,{value:"settings",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(er.l6,{value:s||"",onValueChange:c,children:[(0,t.jsx)(er.bq,{className:"flex-1",children:(0,t.jsx)(er.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(er.gC,{children:e.map(e=>(0,t.jsx)(er.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(eg,{maps:e,onMapsUpdate:e=>{eD(e)}})]})]}),(0,t.jsx)(H.w,{}),d&&h?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(U.p,{id:"map-name",value:h.name,onChange:e=>m(a=>a?{...a,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{children:"Shape"}),(0,t.jsxs)(ep,{value:h.shape,onValueChange:e=>m(a=>a?{...a,shape:e}:null),className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"radial",id:"edit-radial"}),(0,t.jsx)(V.J,{htmlFor:"edit-radial",children:"Radial"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ej,{value:"rectangular",id:"edit-rectangular"}),(0,t.jsx)(V.J,{htmlFor:"edit-rectangular",children:"Rectangular"})]})]})]}),"radial"===h.shape?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(U.p,{id:"map-radius",type:"number",value:h.radius,onChange:e=>m(a=>a?{...a,radius:parseInt(e.target.value)||0}:null),min:"1",max:"100"})]}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{htmlFor:"map-width",children:"Width"}),(0,t.jsx)(U.p,{id:"map-width",type:"number",value:h.width,onChange:e=>m(a=>a?{...a,width:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{htmlFor:"map-height",children:"Height"}),(0,t.jsx)(U.p,{id:"map-height",type:"number",value:h.height,onChange:e=>m(a=>a?{...a,height:parseInt(e.target.value)||0}:null),min:"1",max:"200"})]})]}),(0,t.jsx)(G.$,{onClick:eT,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]}),(0,t.jsx)(W,{value:"paint",className:"mt-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{children:"Paint Mode"}),(0,t.jsxs)(ee,{type:"single",value:ek&&"brush"===f?"erase":eN&&"brush"===f?"bucket":f,onValueChange:e=>{e&&g(e)},className:"w-full",children:[(0,t.jsxs)(ea,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(ea,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(ea,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(H.w,{}),(0,t.jsxs)("fieldset",{disabled:eB||eA,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(U.p,{id:"color-picker",type:"color",value:N,onChange:e=>b(e.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(V.J,{children:"Terrain Colors"}),(0,t.jsx)(Z.Bc,{children:(0,t.jsxs)(Z.m_,{children:[(0,t.jsx)(Z.k$,{asChild:!0,children:(0,t.jsx)(G.$,{variant:eA?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>eF(e=>!e),children:(0,t.jsx)(F.A,{className:"h-4 w-4"})})}),(0,t.jsx)(Z.ZI,{children:(0,t.jsx)("p",{children:"Pick Tile Properties (or hold Alt)"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ef.map(e=>{let{name:a,color:s}=e;return(0,t.jsxs)(G.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>b(s),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:s}}),(0,t.jsx)("span",{className:"ml-2",children:a})]},a)})})]}),(0,t.jsx)(H.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(V.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!Y&&(0,t.jsx)(Z.Bc,{children:(0,t.jsxs)(Z.m_,{children:[(0,t.jsx)(Z.k$,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>K(!0),children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})}),(0,t.jsx)(Z.ZI,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(U.p,{id:"icon-color-picker",type:"color",value:_,onChange:e=>{O(e.target.value),K(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:ev.map(e=>{let{name:a,component:s}=e;return(0,t.jsx)(G.$,{variant:"outline",size:"icon",onClick:()=>D(e=>e===a?null:a),className:(0,L.cn)(y===a&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(s,{className:"h-5 w-5"})},a)})}),y&&(0,t.jsxs)(G.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>D(null),children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}),(0,t.jsx)(W,{value:"path",className:"mt-4",children:(0,t.jsx)(ew,{activeMap:d,onPathUpdate:eL,pathDrawingId:P,setPathDrawingId:J})}),(0,t.jsx)(W,{value:"data",className:"mt-4",children:u&&eW?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",u.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",u.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",u.s]})]}),(0,t.jsx)(H.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(V.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(ei,{title:"Link Dungeons",items:es,initialSelectedIds:eW.data.dungeonIds||[],onConfirm:e=>eJ(u,{dungeonIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(I.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eW.data.dungeonIds||[]).map(e=>{var a;return(0,t.jsx)(en.E,{variant:"secondary",children:null==(a=eV.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(H.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(V.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(ei,{title:"Link Factions",items:el,initialSelectedIds:eW.data.factionIds||[],onConfirm:e=>eJ(u,{factionIds:e}),trigger:(0,t.jsx)(G.$,{size:"sm",variant:"outline",children:(0,t.jsx)(I.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(eW.data.factionIds||[]).map(e=>{var a;return(0,t.jsx)(en.E,{variant:"secondary",children:null==(a=eU.get(e))?void 0:a.name},e)})})]}),(0,t.jsx)(H.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(V.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(M.A,{className:"h-4 w-4"}),"Events"]}),eG.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:eG.map(e=>(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,eo.GP)(new Date(e.startDate),"P")," - ",(0,eo.GP)(new Date(e.endDate),"P")]})]},e.id))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."})})]})})})]})})]})})}function ew(e){let{activeMap:a,onPathUpdate:s,pathDrawingId:l,setPathDrawingId:i}=e,n=(e,t)=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,...t}:a))},r=e=>{l===e&&i(null),s(((null==a?void 0:a.paths)||[]).filter(a=>a.id!==e))},c=e=>{s(((null==a?void 0:a.paths)||[]).map(a=>a.id===e?{...a,points:a.points.slice(0,-1)}:a))};return a?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(G.$,{onClick:()=>{let e={id:crypto.randomUUID(),name:"Path ".concat(((null==a?void 0:a.paths)||[]).length+1),color:"#FFD700",strokeWidth:3,points:[]};s([e,...(null==a?void 0:a.paths)||[]]),i(e.id)},className:"w-full",children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Add New Path"]}),(0,t.jsx)(H.w,{}),(0,t.jsx)(et.F,{className:"h-96",children:(0,t.jsx)("div",{className:"space-y-3 pr-2",children:(a.paths||[]).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-md bg-muted/50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(U.p,{value:e.name,onChange:a=>n(e.id,{name:a.target.value}),className:"h-8 flex-1"}),(0,t.jsxs)(ed.Lt,{children:[(0,t.jsx)(ed.tv,{asChild:!0,children:(0,t.jsx)(G.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(ed.EO,{children:[(0,t.jsxs)(ed.wd,{children:[(0,t.jsx)(ed.r7,{children:"Delete Path?"}),(0,t.jsxs)(ed.$v,{children:['Are you sure you want to delete "',e.name,'"? This cannot be undone.']})]}),(0,t.jsxs)(ed.ck,{children:[(0,t.jsx)(ed.Zr,{children:"Cancel"}),(0,t.jsx)(ed.Rx,{onClick:()=>r(e.id),className:"bg-destructive",children:"Delete"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(V.J,{children:"Color:"}),(0,t.jsx)(U.p,{type:"color",value:e.color,onChange:a=>n(e.id,{color:a.target.value}),className:"h-8 w-16 p-1"}),(0,t.jsx)(V.J,{children:"Width:"}),(0,t.jsx)(U.p,{type:"number",value:e.strokeWidth,min:"1",max:"20",onChange:a=>n(e.id,{strokeWidth:parseInt(a.target.value,10)||1}),className:"h-8 flex-1"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(G.$,{variant:l===e.id?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>i(a=>a===e.id?null:e.id),children:[l===e.id?(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2"}),l===e.id?"Drawing...":"Draw Path"]}),(0,t.jsx)(G.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>c(e.id),disabled:0===e.points.length,"aria-label":"Remove last point",children:(0,t.jsx)(P.A,{className:"h-4 w-4"})})]})]},e.id))})})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to manage paths."})}}}]);
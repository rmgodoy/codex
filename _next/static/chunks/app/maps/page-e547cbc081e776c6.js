(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{8643:(e,s,a)=>{"use strict";a.d(s,{Ke:()=>i,Nt:()=>r,R6:()=>n});var t=a(27242);let r=t.bL,n=t.R6,i=t.Ke},20945:(e,s,a)=>{Promise.resolve().then(a.bind(a,97265))},26126:(e,s,a)=>{"use strict";a.d(s,{E:()=>l});var t=a(95155);a(12115);var r=a(74466),n=a(59434);let i=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("div",{className:(0,n.cn)(i({variant:a}),s),...r})}},46102:(e,s,a)=>{"use strict";a.d(s,{Bc:()=>l,ZI:()=>o,k$:()=>c,m_:()=>d});var t=a(95155),r=a(12115),n=a(78082),i=a(59434);let l=n.Kq,d=n.bL,c=n.l9,o=r.forwardRef((e,s)=>{let{className:a,sideOffset:r=4,...l}=e;return(0,t.jsx)(n.UC,{ref:s,sideOffset:r,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})});o.displayName=n.UC.displayName},47262:(e,s,a)=>{"use strict";a.d(s,{S:()=>d});var t=a(95155),r=a(12115),n=a(76981),i=a(10518),l=a(59434);let d=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.bL,{ref:s,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,t.jsx)(n.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})})});d.displayName=n.bL.displayName},59409:(e,s,a)=>{"use strict";a.d(s,{bq:()=>u,eb:()=>p,gC:()=>f,l6:()=>o,yv:()=>m});var t=a(95155),r=a(12115),n=a(43433),i=a(79556),l=a(77381),d=a(10518),c=a(59434);let o=n.bL;n.YJ;let m=n.WT,u=r.forwardRef((e,s)=>{let{className:a,children:r,...l}=e;return(0,t.jsxs)(n.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[r,(0,t.jsx)(n.In,{asChild:!0,children:(0,t.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.l9.displayName;let x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(l.A,{className:"h-4 w-4"})})});x.displayName=n.PP.displayName;let h=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})});h.displayName=n.wn.displayName;let f=r.forwardRef((e,s)=>{let{className:a,children:r,position:i="popper",...l}=e;return(0,t.jsx)(n.ZL,{children:(0,t.jsxs)(n.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...l,children:[(0,t.jsx)(x,{}),(0,t.jsx)(n.LM,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(h,{})]})})});f.displayName=n.UC.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=n.JU.displayName;let p=r.forwardRef((e,s)=>{let{className:a,children:r,...i}=e;return(0,t.jsxs)(n.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(n.VF,{children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})}),(0,t.jsx)(n.p4,{children:r})]})});p.displayName=n.q7.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=n.wv.displayName},62523:(e,s,a)=>{"use strict";a.d(s,{p:()=>i});var t=a(95155),r=a(12115),n=a(59434);let i=r.forwardRef((e,s)=>{let{className:a,type:r,...i}=e;return(0,t.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...i})});i.displayName="Input"},95376:(e,s,a)=>{"use strict";a.d(s,{J0:()=>r,OO:()=>d,RT:()=>n,sO:()=>l,yV:()=>i});var t=a(82489);let r=async()=>{let e=(await (0,t.Lf)()).transaction(t.Qu,"readonly").objectStore(t.Qu).getAll();return new Promise((s,a)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>a(e.error)})},n=async e=>{let s=(await (0,t.Lf)()).transaction(t.Qu,"readonly").objectStore(t.Qu).get(e);return new Promise((e,a)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>a(s.error)})},i=async e=>{let s=(await (0,t.Lf)()).transaction(t.Qu,"readwrite").objectStore(t.Qu),a=(0,t.$C)(),r={...e,id:a},n=s.add(r);return new Promise((e,s)=>{n.onsuccess=()=>e(a),n.onerror=()=>s(n.error)})},l=async e=>{let s=(await (0,t.Lf)()).transaction(t.Qu,"readwrite").objectStore(t.Qu).put(e);return new Promise((e,a)=>{s.onsuccess=()=>e(),s.onerror=()=>a(s.error)})},d=async e=>{let s=(await (0,t.Lf)()).transaction(t.Qu,"readwrite").objectStore(t.Qu).delete(e);return new Promise((e,a)=>{s.onsuccess=()=>e(),s.onerror=()=>a(s.error)})}},97265:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>eN});var t=a(95155),r=a(12115),n=a(62709),i=a(19209),l=a(66695),d=a(18186),c=a(68715),o=a(66049),m=a(57946),u=a(23767),x=a(20427),h=a(43152),f=a(83662),p=a(55166),j=a(82643),v=a(56013),g=a(18046),N=a(10518),b=a(25318),w=a(18763),y=a(77223),C=a(21887),k=a(3235),S=a(52354),A=a(45727),E=a(10366),F=a(10947),z=a(47326),R=a(17657),L=a(11133),M=a(86318),I=a(50286),P=a(51920),$=a(7146),q=a(22604),J=a(95376),D=a(15510),T=a(2868),B=a(60704),Q=a(59434);let U=B.bL,O=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(B.B8,{ref:s,className:(0,Q.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});O.displayName=B.B8.displayName;let V=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(B.l9,{ref:s,className:(0,Q.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});V.displayName=B.l9.displayName;let _=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(B.UC,{ref:s,className:(0,Q.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});_.displayName=B.UC.displayName;var G=a(85057),Z=a(62523),H=a(30285),K=a(22346),W=a(46102),Y=a(49864),X=a(74466),ee=a(124);let es=(0,X.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});r.forwardRef((e,s)=>{let{className:a,variant:r,size:n,...i}=e;return(0,t.jsx)(ee.b,{ref:s,className:(0,Q.cn)(es({variant:r,size:n,className:a})),...i})}).displayName=ee.b.displayName;let ea=(0,X.F)("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",{variants:{variant:{default:"gap-1",outline:"gap-px"}},defaultVariants:{variant:"default"}}),et=r.createContext({size:"default",variant:"default"}),er=r.forwardRef((e,s)=>{let{className:a,variant:r,size:n,children:i,...l}=e;return(0,t.jsx)(Y.bL,{ref:s,className:(0,Q.cn)(ea({variant:r,className:a})),...l,children:(0,t.jsx)(et.Provider,{value:{variant:r,size:n},children:i})})});er.displayName=Y.bL.displayName;let en=r.forwardRef((e,s)=>{let{className:a,children:n,variant:i,size:l,...d}=e,c=r.useContext(et);return(0,t.jsx)(Y.q7,{ref:s,className:(0,Q.cn)(es({variant:c.variant||i,size:c.size||l}),a),...d,children:n})});en.displayName=Y.q7.displayName;var ei=a(54165),el=a(66424),ed=a(47262);function ec(e){let{items:s,initialSelectedIds:a=[],onConfirm:n,trigger:i,title:l}=e,[d,c]=(0,r.useState)(!1),[o,m]=(0,r.useState)(""),[u,x]=(0,r.useState)(new Set(a));(0,r.useEffect)(()=>{d&&x(new Set(a))},[d,a]);let h=(0,r.useMemo)(()=>s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())),[s,o]),f=(e,s)=>{x(a=>{let t=new Set(a);return s?t.add(e):t.delete(e),t})};return(0,t.jsxs)(ei.lG,{open:d,onOpenChange:c,children:[(0,t.jsx)(ei.zM,{asChild:!0,children:i}),(0,t.jsxs)(ei.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,t.jsx)(ei.c7,{children:(0,t.jsx)(ei.L3,{children:l})}),(0,t.jsx)(Z.p,{placeholder:"Search...",value:o,onChange:e=>m(e.target.value),className:"mb-4 shrink-0"}),(0,t.jsx)(el.F,{className:"flex-1 border rounded-md p-2",children:h.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-accent",children:[(0,t.jsx)(ed.S,{id:"item-select-".concat(e.id),checked:u.has(e.id),onCheckedChange:s=>f(e.id,!!s)}),(0,t.jsx)(G.J,{htmlFor:"item-select-".concat(e.id),className:"flex-1 font-normal cursor-pointer",children:e.name})]},e.id))}),(0,t.jsxs)(ei.Es,{className:"pt-4",children:[(0,t.jsx)(H.$,{variant:"ghost",onClick:()=>c(!1),children:"Cancel"}),(0,t.jsx)(H.$,{onClick:()=>{n(Array.from(u)),c(!1)},children:"Confirm"})]})]})]})}var eo=a(26126),em=a(59409),eu=a(87481),ex=a(90010),eh=a(83013),ef=a(47906),ep=a(8643);let ej=[{name:"Home",component:d.A},{name:"Trees",component:c.A},{name:"Mountain",component:o.A},{name:"Castle",component:m.A},{name:"TowerControl",component:u.A},{name:"Tent",component:x.A},{name:"Waves",component:h.A},{name:"MapPin",component:f.A},{name:"Landmark",component:p.A},{name:"Skull",component:j.A}],ev=[{name:"Water",color:"#4A90E2"},{name:"Grass",color:"#7ED321"},{name:"Forest",color:"#417505"},{name:"Stone",color:"#9B9B9B"},{name:"Desert",color:"#F5A623"},{name:"Snow",color:"#FFFFFF"}];function eg(e){let{maps:s,onMapsUpdate:a}=e,[n,i]=(0,r.useState)(!1),[l,d]=(0,r.useState)(""),[c,o]=(0,r.useState)(20),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)(""),{toast:f}=(0,eu.dj)(),p=async()=>{if(!l.trim()||!c||c<=0)return void f({variant:"destructive",title:"Invalid Input",description:"Please provide a valid name and radius."});try{let e=(0,$.Xk)(c),s={name:l.trim(),radius:c,tiles:e},t=await (0,q.Ys)(s);f({title:"Map Created",description:"'".concat(l,"' has been added.")}),d(""),o(20),a(t),i(!1)}catch(e){f({variant:"destructive",title:"Error",description:"Failed to create map."})}},j=e=>{u(e.id),h(e.name)},C=()=>{u(null),h("")},k=async()=>{if(!m||!x.trim())return;let e=s.find(e=>e.id===m);if(e)try{await (0,q.cA)({...e,name:x.trim()}),f({title:"Map Renamed"}),a(),C()}catch(e){f({variant:"destructive",title:"Error",description:"Failed to rename map."})}},S=async e=>{try{await (0,q.GY)(e),f({title:"Map Deleted"}),a()}catch(e){f({variant:"destructive",title:"Error",description:"Failed to delete map."})}};return(0,t.jsxs)(ei.lG,{open:n,onOpenChange:i,children:[(0,t.jsx)(ei.zM,{asChild:!0,children:(0,t.jsx)(H.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(v.A,{className:"h-5 w-5"})})}),(0,t.jsxs)(ei.Cf,{children:[(0,t.jsxs)(ei.c7,{children:[(0,t.jsx)(ei.L3,{children:"Manage Maps"}),(0,t.jsx)(ei.rr,{children:"Add, rename, or delete your maps."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"flex items-end gap-2 p-3 border rounded-md",children:[(0,t.jsxs)("div",{className:"grid gap-2 flex-1",children:[(0,t.jsx)(G.J,{children:"New Map"}),(0,t.jsx)(Z.p,{placeholder:"New map name...",value:l,onChange:e=>d(e.target.value)}),(0,t.jsx)(Z.p,{placeholder:"Radius",type:"number",value:c,onChange:e=>o(parseInt(e.target.value,10)||0)})]}),(0,t.jsxs)(H.$,{onClick:p,disabled:!l.trim()||!c||c<=0,children:[(0,t.jsx)(g.A,{className:"h-4 w-4"})," Add"]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:m===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z.p,{value:x,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&k()},className:"h-8",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(H.$,{size:"icon",className:"h-7 w-7",onClick:k,"aria-label":"Save",children:(0,t.jsx)(N.A,{className:"h-4 w-4"})}),(0,t.jsx)(H.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:C,"aria-label":"Cancel",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,t.jsx)(H.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>j(e),"aria-label":"Edit",children:(0,t.jsx)(w.A,{className:"h-4 w-4"})}),(0,t.jsxs)(ex.Lt,{children:[(0,t.jsx)(ex.tv,{asChild:!0,children:(0,t.jsx)(H.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,t.jsx)(y.A,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(ex.EO,{children:[(0,t.jsxs)(ex.wd,{children:[(0,t.jsx)(ex.r7,{children:"Are you sure?"}),(0,t.jsxs)(ex.$v,{children:['This will permanently delete the "',e.name,'" map and all of its tiles.']})]}),(0,t.jsxs)(ex.ck,{children:[(0,t.jsx)(ex.Zr,{children:"Cancel"}),(0,t.jsx)(ex.Rx,{onClick:()=>S(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function eN(){let[e,s]=(0,r.useState)([]),[a,d]=(0,r.useState)(null),[c,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)(null),[p,j]=(0,r.useState)("settings"),[v,g]=(0,r.useState)("brush"),[N,w]=(0,r.useState)("#8A2BE2"),[y,B]=(0,r.useState)(null),[Y,X]=(0,r.useState)("#E0D6F0"),[ee,es]=(0,r.useState)(!0),[ea,et]=(0,r.useState)("#E0D6F0"),[ei,el]=(0,r.useState)([]),[ed,ex]=(0,r.useState)([]),[eN,eb]=(0,r.useState)([]),[ew,ey]=(0,r.useState)(!1),[eC,ek]=(0,r.useState)(!1),{toast:eS}=(0,eu.dj)(),eA=(0,ef.a)(),[eE,eF]=(0,r.useState)(!0);(0,r.useEffect)(()=>{eF(!eA)},[eA]),(0,r.useEffect)(()=>{let e=e=>{"Control"===e.key&&ey(!0)},s=e=>{"Control"===e.key&&ey(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[]);let ez=(0,r.useCallback)(async e=>{let t=(await (0,q.xW)()).sort((e,s)=>e.name.localeCompare(s.name));if(s(t),e)return void d(e);a&&!t.some(e=>e.id===a)?d(t.length>0?t[0].id:null):!a&&t.length>0?d(t[0].id):0===t.length&&(d(null),o(null))},[a]);(0,r.useEffect)(()=>{ez(),(0,J.J0)().then(el),(0,D.vq)().then(ex),(0,T.bj)().then(eb)},[]),(0,r.useEffect)(()=>{a?((0,q.zU)(a).then(e=>{e&&o(e)}),h(null)):o(null)},[a]),(0,r.useEffect)(()=>{c?u({name:c.name,radius:String(c.radius)}):u(null)},[c]);let eR=e=>{let s=parseInt((e=e.replace("#","")).substring(0,2),16),a=parseInt(e.substring(2,4),16);return(.2126*s+.7152*a+.0722*parseInt(e.substring(4,6),16))/255};(0,r.useEffect)(()=>{ee?et(eR(N)>.5?"#000000":"#FFFFFF"):et(Y)},[ee,N,Y]);let eL=(0,r.useCallback)(e=>{if(c){let s={...c,tiles:e};o(s),(0,q.cA)(s).catch(()=>{eS({variant:"destructive",title:"Auto-save failed during painting."})})}},[c,eS]),eM=(e,s)=>{if(c){let a=c.tiles.map(a=>a.hex.q===e.q&&a.hex.r===e.r?{...a,data:{...a.data,...s}}:a),t={...c,tiles:a};o(t),(0,q.cA)(t).catch(()=>{eS({variant:"destructive",title:"Data linking failed to save."})})}},eI=async()=>{if(!c||!m)return;let e=Number(m.radius);if(!m.name.trim())return void eS({variant:"destructive",title:"Validation Error",description:"Map name cannot be empty."});if(isNaN(e)||e<=0||e>100)return void eS({variant:"destructive",title:"Validation Error",description:"Radius must be a number between 1 and 100."});let a=(0,$.YS)(c.tiles,e),t={...c,name:m.name,radius:e,tiles:a};try{await (0,q.cA)(t),o(t),s(e=>e.map(e=>e.id===t.id?{...e,name:t.name}:e)),eS({title:"Map settings saved!"})}catch(e){eS({variant:"destructive",title:"Save failed"})}},eP="erase"===v,e$=(0,r.useMemo)(()=>null==c?void 0:c.tiles.find(e=>e.hex.q===(null==x?void 0:x.q)&&e.hex.r===(null==x?void 0:x.r)),[c,x]),eq=(0,r.useMemo)(()=>new Map(ei.map(e=>[e.id,e])),[ei]),eJ=(0,r.useMemo)(()=>new Map(ed.map(e=>[e.id,e])),[ed]),eD=(0,r.useMemo)(()=>e$&&c?eN.filter(e=>e.location&&e.location.mapId===c.id&&e.location.hex.q===e$.hex.q&&e.location.hex.r===e$.hex.r&&e.location.hex.s===e$.hex.s):[],[e$,c,eN]);return(0,t.jsx)(n.A,{showSidebarTrigger:!1,children:(0,t.jsxs)("div",{className:"w-full h-full bg-background relative",children:[c?(0,t.jsx)(i.A,{grid:c.tiles,hexSize:25,className:(0,Q.cn)("w-full h-full",eC&&"cursor-crosshair"),onGridUpdate:eL,onHexHover:()=>{},onHexClick:h,activeTool:p,paintMode:v,paintColor:N,paintIcon:y,paintIconColor:ea,selectedHex:x,isCtrlPressed:ew,isEyedropperActive:eC,onEyedropperClick:e=>{if(!c)return;let s=c.tiles.find(s=>s.hex.q===e.q&&s.hex.r===e.r);s&&(w(s.data.color||"#8A2BE2"),B(s.data.icon||null),s.data.iconColor&&(X(s.data.iconColor),es(!1))),ek(!1),eS({title:"Tile properties copied to brush."})}}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a map to begin, or create a new one."})}),(0,t.jsx)(ep.Nt,{open:!eA||eE,onOpenChange:eA?eF:void 0,className:(0,Q.cn)("fixed z-10 w-80 shadow-lg top-20 left-4"),children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(l.ZB,{className:"flex items-center gap-2 text-lg",children:"Map Tools"}),eA&&(0,t.jsx)(ep.R6,{asChild:!0,children:(0,t.jsxs)(H.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)(C.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Toggle tools panel"})]})})]})}),(0,t.jsx)(ep.Ke,{children:(0,t.jsx)(l.Wu,{children:(0,t.jsxs)(U,{value:p,onValueChange:e=>j(e),className:"w-full",children:[(0,t.jsxs)(O,{className:"grid w-full grid-cols-3",children:[(0,t.jsxs)(V,{value:"settings",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Settings"]}),(0,t.jsxs)(V,{value:"paint",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Paint"]}),(0,t.jsxs)(V,{value:"data",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Data"]})]}),(0,t.jsxs)(_,{value:"settings",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(G.J,{children:"Map Selection"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(em.l6,{value:a||"",onValueChange:d,children:[(0,t.jsx)(em.bq,{className:"flex-1",children:(0,t.jsx)(em.yv,{placeholder:"Select a map..."})}),(0,t.jsx)(em.gC,{children:e.map(e=>(0,t.jsx)(em.eb,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(eg,{maps:e,onMapsUpdate:e=>{ez(e)}})]})]}),(0,t.jsx)(K.w,{}),c&&m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(G.J,{htmlFor:"map-name",children:"Map Name"}),(0,t.jsx)(Z.p,{id:"map-name",value:m.name,onChange:e=>u(s=>s?{...s,name:e.target.value}:null)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(G.J,{htmlFor:"map-radius",children:"Map Radius"}),(0,t.jsx)(Z.p,{id:"map-radius",type:"number",value:m.radius,onChange:e=>u(s=>s?{...s,radius:e.target.value}:null),min:"1",max:"100"})]}),(0,t.jsx)(H.$,{onClick:eI,className:"w-full",children:"Save Settings"})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center pt-4",children:"Select a map to view its settings, or create a new one."})]}),(0,t.jsx)(_,{value:"paint",className:"mt-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(G.J,{children:"Paint Mode"}),(0,t.jsxs)(er,{type:"single",value:ew&&"brush"===v?"bucket":v,onValueChange:e=>{e&&g(e)},className:"w-full",children:[(0,t.jsxs)(en,{value:"brush","aria-label":"Brush",className:"w-1/3",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-2"})," Brush"]}),(0,t.jsxs)(en,{value:"bucket","aria-label":"Bucket",className:"w-1/3",children:[(0,t.jsx)(F.A,{className:"h-4 w-4 mr-2"})," Bucket"]}),(0,t.jsxs)(en,{value:"erase","aria-label":"Erase",className:"w-1/3",children:[(0,t.jsx)(z.A,{className:"h-4 w-4 mr-2"})," Erase"]})]})]}),(0,t.jsx)(K.w,{}),(0,t.jsxs)("fieldset",{disabled:eP||eC,className:"space-y-4 disabled:opacity-50",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(G.J,{htmlFor:"color-picker",children:"Tile Color"}),(0,t.jsx)(Z.p,{id:"color-picker",type:"color",value:N,onChange:e=>w(e.target.value),className:"w-full h-10 p-1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(G.J,{children:"Terrain Colors"}),(0,t.jsx)(W.Bc,{children:(0,t.jsxs)(W.m_,{children:[(0,t.jsx)(W.k$,{asChild:!0,children:(0,t.jsx)(H.$,{variant:eC?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ek(e=>!e),children:(0,t.jsx)(R.A,{className:"h-4 w-4"})})}),(0,t.jsx)(W.ZI,{children:(0,t.jsx)("p",{children:"Pick Tile Properties"})})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:ev.map(e=>{let{name:s,color:a}=e;return(0,t.jsxs)(H.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>w(a),children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:a}}),(0,t.jsx)("span",{className:"ml-2",children:s})]},s)})})]}),(0,t.jsx)(K.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)(G.J,{children:"Tile Icon"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!ee&&(0,t.jsx)(W.Bc,{children:(0,t.jsxs)(W.m_,{children:[(0,t.jsx)(W.k$,{asChild:!0,children:(0,t.jsx)(H.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>es(!0),children:(0,t.jsx)(L.A,{className:"h-4 w-4"})})}),(0,t.jsx)(W.ZI,{children:(0,t.jsx)("p",{children:"Reset to automatic color"})})]})}),(0,t.jsx)(Z.p,{id:"icon-color-picker",type:"color",value:Y,onChange:e=>{X(e.target.value),es(!1)},className:"w-10 h-10 p-1"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-2",children:ej.map(e=>{let{name:s,component:a}=e;return(0,t.jsx)(H.$,{variant:"outline",size:"icon",onClick:()=>B(e=>e===s?null:s),className:(0,Q.cn)(y===s&&"ring-2 ring-ring ring-offset-2 bg-accent text-accent-foreground"),children:(0,t.jsx)(a,{className:"h-5 w-5"})},s)})}),y&&(0,t.jsxs)(H.$,{variant:"ghost",size:"sm",className:"w-full h-8",onClick:()=>B(null),children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2"})," Clear Icon Selection"]})]})]})]})}),(0,t.jsx)(_,{value:"data",className:"mt-4",children:x&&e$?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-base",children:"Selected Tile"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Q:"})," ",x.q,", ",(0,t.jsx)("span",{className:"font-semibold",children:"R:"})," ",x.r,", ",(0,t.jsx)("span",{className:"font-semibold",children:"S:"})," ",x.s]})]}),(0,t.jsx)(K.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(G.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),"Dungeons"]}),(0,t.jsx)(ec,{title:"Link Dungeons",items:ei,initialSelectedIds:e$.data.dungeonIds||[],onConfirm:e=>eM(x,{dungeonIds:e}),trigger:(0,t.jsx)(H.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(e$.data.dungeonIds||[]).map(e=>{var s;return(0,t.jsx)(eo.E,{variant:"secondary",children:null==(s=eq.get(e))?void 0:s.name},e)})})]}),(0,t.jsx)(K.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(G.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"h-4 w-4"}),"Factions"]}),(0,t.jsx)(ec,{title:"Link Factions",items:ed,initialSelectedIds:e$.data.factionIds||[],onConfirm:e=>eM(x,{factionIds:e}),trigger:(0,t.jsx)(H.$,{size:"sm",variant:"outline",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(e$.data.factionIds||[]).map(e=>{var s;return(0,t.jsx)(eo.E,{variant:"secondary",children:null==(s=eJ.get(e))?void 0:s.name},e)})})]}),(0,t.jsx)(K.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(G.J,{className:"flex items-center gap-2",children:[(0,t.jsx)(P.A,{className:"h-4 w-4"}),"Events"]}),eD.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:eD.map(e=>(0,t.jsxs)("div",{className:"p-1 rounded bg-muted/50",children:[(0,t.jsx)("p",{className:"font-semibold text-sm",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,eh.GP)(new Date(e.startDate),"P")," - ",(0,eh.GP)(new Date(e.endDate),"P")]})]},e.id))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No events linked to this tile."})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click on a tile to see or edit its data."})})]})})})]})})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[222,194,160,841,923,632,541,347,352,441,684,358],()=>s(20945)),_N_E=e.O()}]);
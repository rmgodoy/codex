"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3485],{33485:(e,t,a)=>{a.r(t),a.d(t,{default:()=>er});var n=a(95155),l=a(12115),s=a(52873),r=a(7860),i=a(76959),d=a(1077),c=a(6195),o=a(66695),h=a(30285),x=a(87481),m=a(62177),u=a(90221),j=a(55594),f=a(34239),p=a(54165),y=a(17759),v=a(62523),g=a(88539),N=a(14636),b=a(90648),C=a(59434),w=a(51920),D=a(25318),S=a(50286),I=a(91721),k=a(83662),A=a(965),$=a(73158),z=a(58049);function E(e){let{className:t,classNames:a,showOutsideDays:l=!0,...s}=e;return(0,n.jsx)(z.hv,{showOutsideDays:l,className:(0,C.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,C.cn)((0,h.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,C.cn)((0,h.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,n.jsx)(A.A,{className:(0,C.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,n.jsx)($.A,{className:(0,C.cn)("h-4 w-4",t),...a})}},...s})}E.displayName="Calendar";var M=a(66424);function T(e){let{items:t,onSelectItem:a,trigger:s,title:r}=e,[i,d]=(0,l.useState)(!1),[c,o]=(0,l.useState)(""),x=(0,l.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),[t,c]),m=e=>{a(e),d(!1),o("")};return(0,n.jsxs)(p.lG,{open:i,onOpenChange:d,children:[(0,n.jsx)(p.zM,{asChild:!0,children:s}),(0,n.jsxs)(p.Cf,{className:"max-w-md h-[60vh] flex flex-col",children:[(0,n.jsx)(p.c7,{children:(0,n.jsx)(p.L3,{children:r})}),(0,n.jsx)(v.p,{placeholder:"Search...",value:c,onChange:e=>o(e.target.value),className:"mb-4 shrink-0"}),(0,n.jsx)(M.F,{className:"flex-1 border rounded-md p-2",children:x.map(e=>(0,n.jsx)(h.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>m(e),children:e.name},e.id))})]})]})}var F=a(69253),U=a(77266),_=a(99865);function O(e){let{calendarModel:t,initialDate:a,onDateSelect:s,children:r}=e,[i,d]=(0,l.useState)(!1);return(0,n.jsxs)(p.lG,{open:i,onOpenChange:d,children:[(0,n.jsx)(p.zM,{asChild:!0,children:r}),(0,n.jsxs)(p.Cf,{className:"max-w-3xl h-[80vh] p-4 flex flex-col",children:[(0,n.jsx)(p.c7,{children:(0,n.jsx)(p.L3,{children:"Select a Date"})}),(0,n.jsx)(U.r,{calendar:t,onDateSelect:e=>{s(e),d(!1)},disableEditing:!0,initialDate:a?(0,_.$k)(a):void 0,selectedDate:a})]})]})}let L=j.z.object({year:j.z.number(),monthIndex:j.z.number(),day:j.z.number()}),R=j.z.object({title:j.z.string().min(1,"Title is required."),description:j.z.string().optional(),tags:j.z.array(j.z.string()).optional(),startDate:L.or(j.z.string()),endDate:L.or(j.z.string()).optional(),location:j.z.object({mapId:j.z.string(),hex:j.z.object({q:j.z.number(),r:j.z.number(),s:j.z.number()})}).optional()}).superRefine((e,t)=>{e.endDate&&(0,_.$k)(e.startDate)>(0,_.$k)(e.endDate)&&t.addIssue({path:["endDate"],message:"End date cannot be before start date."})});function P(e){let{isOpen:t,onOpenChange:a,onSaveSuccess:s,event:r,calendar:i,calendarModel:d,initialDate:c}=e,{toast:o}=(0,x.dj)(),[j,A]=(0,l.useState)([]),[$,z]=(0,l.useState)([]),[U,L]=(0,l.useState)([]),[P,B]=(0,l.useState)([]),[q,G]=(0,l.useState)(null),[Z,W]=(0,l.useState)(null);(0,l.useEffect)(()=>{Promise.all([(0,f.OG)(),(0,f.vq)(),(0,f.xW)(),(0,f.Qg)()]).then(e=>{let[t,a,n,l]=e;A(t),z(a),B(n),L(l)})},[]);let Y=(0,m.mN)({resolver:(0,u.u)(R)}),{watch:J,setValue:X}=Y,V=J("startDate");(0,l.useEffect)(()=>{if(t)if(r)if(Y.reset({title:r.title,description:r.description,tags:r.tags||[],startDate:r.startDate,endDate:r.endDate,location:r.location}),G(r.party||null),r.location&&P.length>0){var e;let t=(null==(e=P.find(e=>e.id===r.location.mapId))?void 0:e.name)||"Unknown Map";W({...r.location,mapName:t})}else W(null);else Y.reset({title:"",description:"",tags:[],startDate:c,endDate:void 0,location:void 0}),G(null),W(null)},[r,t,Y,c,P]);let Q=async e=>{let t;if(q&&(t={type:q.type,id:q.id,name:q.name}),!i)return void o({variant:"destructive",title:"Error",description:"No calendar selected to add the event to."});"string"==typeof e.startDate&&(e.startDate=(0,_.Xo)(e.startDate)),"string"==typeof e.endDate&&(e.endDate=(0,_.Xo)(e.endDate));let a={title:e.title,calendarId:i.id,description:e.description||"",startDate:e.startDate,endDate:e.endDate||e.startDate,tags:e.tags||[],party:t,location:Z?{mapId:Z.mapId,hex:Z.hex}:void 0};try{e.tags&&await (0,f.JE)(e.tags,"calendar"),r?(await (0,f._1)({...a,id:r.id}),o({title:"Event Updated"})):(await (0,f.UU)(a),o({title:"Event Created"})),s()}catch(e){o({variant:"destructive",title:"Save Failed",description:"Could not save event."})}};return(0,n.jsx)(p.lG,{open:t,onOpenChange:a,children:(0,n.jsxs)(p.Cf,{className:"max-h-[90vh] flex flex-col p-0",children:[(0,n.jsxs)(p.c7,{className:"p-6 pb-4",children:[(0,n.jsx)(p.L3,{children:r?"Edit Event":"Add New Event"}),(0,n.jsx)(p.rr,{children:r?"Editing event.":"Create a new event."})]}),(0,n.jsx)(M.F,{className:"flex-1 px-6",children:(0,n.jsx)(y.lV,{...Y,children:(0,n.jsxs)("form",{id:"event-form",onSubmit:Y.handleSubmit(Q),className:"space-y-4 pb-4",children:[(0,n.jsx)(y.zB,{name:"title",control:Y.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"Title"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(v.p,{...t})}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{name:"description",control:Y.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"Description"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(g.T,{...t})})]})}}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(y.zB,{name:"startDate",control:Y.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(y.eI,{className:"flex flex-col",children:[(0,n.jsx)(y.lR,{children:"Start Date"}),d?(0,n.jsx)(O,{calendarModel:d,onDateSelect:e=>t.onChange(e),initialDate:t.value,children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full pl-3 text-left font-normal",children:[(0,n.jsx)("span",{children:t.value&&d.months[t.value.monthIndex]?"".concat(d.months[t.value.monthIndex].name," ").concat(t.value.day,", ").concat(t.value.year):"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})}):(0,n.jsxs)(N.AM,{children:[(0,n.jsx)(N.Wv,{asChild:!0,children:(0,n.jsx)(y.MJ,{children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:(0,C.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,_.$k)(t.value).toUTCString().slice(5,16):(0,n.jsx)("span",{children:"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,n.jsx)(N.hl,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(E,{mode:"single",selected:(0,_.$k)(t.value),onSelect:e=>e&&t.onChange((0,_.Xo)(e)),defaultMonth:(0,_.$k)(t.value),disabled:e=>e<(0,_.aL)(),initialFocus:!0})})]}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{name:"endDate",control:Y.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(y.eI,{className:"flex flex-col",children:[(0,n.jsx)(y.lR,{children:"End Date (Optional)"}),d?(0,n.jsx)(O,{calendarModel:d,onDateSelect:e=>t.onChange(e),initialDate:t.value,children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full pl-3 text-left font-normal",children:[(0,n.jsx)("span",{children:t.value&&d.months[t.value.monthIndex]?"".concat(d.months[t.value.monthIndex].name," ").concat(t.value.day,", ").concat(t.value.year):"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})}):(0,n.jsxs)(N.AM,{children:[(0,n.jsx)(N.Wv,{asChild:!0,children:(0,n.jsx)(y.MJ,{children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:(0,C.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,_.$k)(t.value).toUTCString().slice(5,16):(0,n.jsx)("span",{children:"Pick a date"}),(0,n.jsx)(w.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,n.jsx)(N.hl,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(E,{mode:"single",selected:t.value?(0,_.$k)(t.value):void 0,onSelect:e=>e&&t.onChange((0,_.Xo)(e)),defaultMonth:(0,_.$k)(t.value||V),disabled:e=>e<((0,_.$k)(V)||(0,_.aL)()),initialFocus:!0})})]}),(0,n.jsx)(y.C5,{})]})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(y.lR,{children:"Responsible Party (Optional)"}),q?(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,n.jsxs)("p",{className:"font-semibold",children:[q.name," ",(0,n.jsxs)("span",{className:"text-sm text-muted-foreground capitalize",children:["(",q.type,")"]})]}),(0,n.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>G(null),children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]}):(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[(0,n.jsx)(T,{items:$,onSelectItem:e=>G({...e,type:"faction"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Faction"]}),title:"Select a Faction"}),(0,n.jsx)(T,{items:j,onSelectItem:e=>G({...e,type:"creature"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Creature"]}),title:"Select a Creature"}),(0,n.jsx)(T,{items:U,onSelectItem:e=>G({...e,type:"npc"}),trigger:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"NPC"]}),title:"Select an NPC"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(y.lR,{children:"Location (Optional)"}),Z?(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 mt-2 border rounded-md",children:[(0,n.jsxs)("p",{className:"font-semibold text-sm",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Map:"})," ",Z.mapName,(0,n.jsx)("span",{className:"text-muted-foreground ml-2",children:"Tile:"})," ","Q:",Z.hex.q,", R:",Z.hex.r]}),(0,n.jsx)(h.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(null),children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]}):(0,n.jsx)(F.G,{onLocationSelect:e=>{var t;let{mapId:a,hex:n}=e,l=(null==(t=P.find(e=>e.id===a))?void 0:t.name)||"Unknown Map";W({mapId:a,mapName:l,hex:n})},children:(0,n.jsxs)(h.$,{type:"button",variant:"outline",className:"w-full mt-2",children:[(0,n.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Select Location on Map"]})})]}),(0,n.jsx)(y.zB,{name:"tags",control:Y.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"Tags"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(b.F,{value:t.value||[],onChange:t.onChange,tagSource:"calendar",placeholder:"Add tags..."})})]})}})]})})}),(0,n.jsxs)(p.Es,{className:"p-6 pt-4 border-t",children:[(0,n.jsx)(h.$,{type:"button",variant:"ghost",onClick:()=>a(!1),children:"Cancel"}),(0,n.jsx)(h.$,{type:"submit",form:"event-form",children:"Save Event"})]})]})})}var B=a(90010),q=a(26126),G=a(56013),Z=a(18046),W=a(10518),Y=a(18763),J=a(77223),X=a(2868),V=a(59409),Q=a(20031),H=a(22346),K=a(82940),ee=a.n(K),et=a(38914);let ea=new Date(Date.UTC(1,0,1));ea.setUTCFullYear(1);let en=e=>{"string"==typeof e&&(e=el(ee()(e).utc().endOf("day").toDate()));let t=ee()().utc().endOf("day").toDate();return t.setUTCFullYear(e.year,e.monthIndex,e.day),t},el=e=>({year:e.getUTCFullYear(),monthIndex:e.getUTCMonth(),day:e.getUTCDate()});function es(e){let{calendars:t,customCalendars:a,onCalendarsUpdate:s}=e,[r,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(""),[o,m]=(0,l.useState)("traditional"),[u,j]=(0,l.useState)(null),[y,g]=(0,l.useState)(""),{toast:N}=(0,x.dj)(),b=async()=>{if(d.trim())try{let e={name:d.trim(),modelId:"traditional"===o?void 0:o},t=await (0,f.ep)(e);N({title:"Calendar Created",description:'"'.concat(d,'" has been added.')}),c(""),m("traditional"),s(t),i(!1)}catch(e){N({variant:"destructive",title:"Error",description:"Failed to create calendar."})}},C=e=>{j(e.id),g(e.name)},w=()=>{j(null),g("")},S=async()=>{if(!u||!y.trim())return;let e=t.find(e=>e.id===u);if(e)try{await (0,f.md)({...e,name:y.trim()}),N({title:"Calendar Renamed"}),s(),w()}catch(e){N({variant:"destructive",title:"Error",description:"Failed to rename calendar."})}},I=async e=>{try{await (0,f.A$)(e),N({title:"Calendar Deleted"}),s()}catch(e){N({variant:"destructive",title:"Error",description:"Failed to delete calendar and its events."})}};return(0,n.jsxs)(p.lG,{open:r,onOpenChange:i,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",children:(0,n.jsx)(G.A,{className:"h-5 w-5"})})}),(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Manage Calendars"}),(0,n.jsx)(p.rr,{children:"Add, rename, or delete your calendars."})]}),(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2 p-3 border rounded-md",children:[(0,n.jsx)(v.p,{placeholder:"New calendar name...",value:d,onChange:e=>c(e.target.value)}),(0,n.jsxs)(V.l6,{value:o,onValueChange:m,children:[(0,n.jsx)(V.bq,{children:(0,n.jsx)(V.yv,{placeholder:"Select a model"})}),(0,n.jsxs)(V.gC,{children:[(0,n.jsx)(V.eb,{value:"traditional",children:"Traditional Calendar"}),a.map(e=>(0,n.jsx)(V.eb,{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(h.$,{onClick:b,disabled:!d.trim(),children:[(0,n.jsx)(Z.A,{className:"h-4 w-4"})," Add"]})]}),(0,n.jsx)(H.w,{}),(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(e=>(0,n.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 gap-2",children:u===e.id?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.p,{value:y,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&S()},className:"h-8",autoFocus:!0}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(h.$,{size:"icon",className:"h-7 w-7",onClick:S,"aria-label":"Save",children:(0,n.jsx)(W.A,{className:"h-4 w-4"})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:w,"aria-label":"Cancel",children:(0,n.jsx)(D.A,{className:"h-4 w-4"})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-1 truncate",title:e.name,children:e.name}),(0,n.jsxs)("div",{className:"flex items-center shrink-0",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>C(e),"aria-label":"Edit",children:(0,n.jsx)(Y.A,{className:"h-4 w-4"})}),(0,n.jsxs)(B.Lt,{children:[(0,n.jsx)(B.tv,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7","aria-label":"Delete",children:(0,n.jsx)(J.A,{className:"h-4 w-4 text-destructive"})})}),(0,n.jsxs)(B.EO,{children:[(0,n.jsxs)(B.wd,{children:[(0,n.jsx)(B.r7,{children:"Are you sure?"}),(0,n.jsxs)(B.$v,{children:['This will permanently delete the "',e.name,'" calendar and all of its events.']})]}),(0,n.jsxs)(B.ck,{children:[(0,n.jsx)(B.Zr,{children:"Cancel"}),(0,n.jsx)(B.Rx,{onClick:()=>I(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})},e.id))})]})]})]})}function er(e){let{selectedId:t,selectedDate:a}=e,[m,u]=(0,l.useState)([]),[j,p]=(0,l.useState)([]),[y,v]=(0,l.useState)([]),[g,N]=(0,l.useState)(null),[b,C]=(0,l.useState)(null),[w,D]=(0,l.useState)(void 0),[S,I]=(0,l.useState)(!1),[A,$]=(0,l.useState)(null),{toast:z}=(0,x.dj)(),{worldSlug:E}=(0,et.q)(),T=(0,l.useMemo)(()=>j.find(e=>e.id===g),[j,g]),F=(0,l.useMemo)(()=>T&&T.modelId&&y.find(e=>e.id===T.modelId)||null,[T,y]),_=!!F,O=e=>({year:1,monthIndex:0,day:1}),L=async e=>{try{let[a,n]=await Promise.all([(0,f.FO)(),(0,f.Ul)()]);v(n);let l=e;if(!l||!a.some(e=>e.id===l)){var t;l=(null==(t=a[0])?void 0:t.id)||null}if(p(a),g===l&&a.length>0)return;N(l)}catch(e){z({variant:"destructive",title:"Error",description:"Failed to load calendar data."})}};(0,l.useEffect)(()=>{L(t||g),a&&C(a)},[t,a]),(0,l.useEffect)(()=>{(async()=>{let e;if(!g)return u([]);let t=await (0,X.bj)(g);u(t);let a=y.find(e=>{var t;return e.id===(null==(t=j.find(e=>e.id===g))?void 0:t.modelId)})||null;b||C(t.length>0?[...t].sort((e,t)=>en(e.startDate).getTime()-en(t.startDate).getTime())[0].startDate:O(a))})()},[g]),(0,l.useEffect)(()=>{!_&&b&&D(en(b))},[b,_]);let R=async e=>{g&&u(await (0,X.bj)(g)),await L(e||null)},G=e=>{$(e),I(!0)},Z=async e=>{try{await (0,X.At)(e),z({title:"Event Deleted"}),g&&(0,X.bj)(g).then(u)}catch(e){z({variant:"destructive",title:"Error",description:"Failed to delete event."})}},W=e=>{let t;return String("string"==typeof e?ee()(e).utc().endOf("day").toDate().getUTCDate():e.day).padStart(2,"0")},K=e=>{let t;return String("string"==typeof e?ee()(e).utc().endOf("day").toDate().getUTCMonth()+1:e.monthIndex+1).padStart(2,"0")},er=e=>{let t;return String("string"==typeof e?ee()(e).utc().endOf("day").toDate().getUTCFullYear():e.year).padStart(4,"0")},ei=(0,l.useMemo)(()=>{if(!b)return[];let e=en(b);return m.filter(t=>{let a=en(t.startDate),n=en(t.endDate);return(0,s.v)(e,{start:a,end:n})}).sort((e,t)=>e.startDate.day-t.startDate.day)},[m,b]),ed=(0,l.useMemo)(()=>m.flatMap(e=>{let t=en(e.startDate),a=en(e.endDate);return(0,r.k)({start:t,end:a}).map(el)}),[m]),ec=(0,l.useMemo)(()=>{if(!b)return"...";if(_&&F){let{year:e,monthIndex:t,day:a}=b,n=F.months[t];return n?"".concat(n.name," ").concat(a,", ").concat(e):"Invalid Date"}return en(b).toUTCString().slice(5,16)},[b,F,_]),eo=(0,l.useMemo)(()=>b||O(F),[b,F]),eh=e=>{if(!e)return"#";let t={creature:"bestiary",faction:"factions",npc:"npcs"}[e.type];return"#/".concat(E,"/").concat(t,"/").concat(e.id)},ex=(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(V.l6,{value:g||"",onValueChange:e=>{N(e),C(null)},disabled:0===j.length,children:[(0,n.jsx)(V.bq,{className:"flex-1",children:(0,n.jsx)(V.yv,{placeholder:"Select a calendar"})}),(0,n.jsx)(V.gC,{children:j.map(e=>(0,n.jsx)(V.eb,{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)(es,{calendars:j,customCalendars:y,onCalendarsUpdate:R})]});return 0===j.length?(0,n.jsx)(c.A,{children:(0,n.jsx)("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center bg-background/50",children:(0,n.jsxs)(o.Zp,{className:"max-w-md",children:[(0,n.jsxs)(o.aR,{children:[(0,n.jsx)(o.ZB,{children:"Welcome to the Calendar"}),(0,n.jsx)(o.BT,{children:"Create your first calendar to start tracking important dates and events in your world."})]}),(0,n.jsx)(o.Wu,{children:ex})]})})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(Q.SidebarProvider,{children:[(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,n.jsx)(Q.Bx,{style:{"--sidebar-width":"380px"},children:(0,n.jsxs)("div",{className:"p-4 space-y-4 h-full flex flex-col",children:[ex,(0,n.jsx)(h.$,{onClick:()=>{$(null),I(!0)},children:"Add Event"}),(0,n.jsx)(H.w,{}),(0,n.jsxs)(o.Zp,{className:"flex-1 flex flex-col min-h-0",children:[(0,n.jsx)(o.aR,{children:(0,n.jsxs)(o.ZB,{children:["Events for ",ec]})}),(0,n.jsx)(o.Wu,{className:"flex-1 min-h-0",children:(0,n.jsx)(M.F,{className:"h-full",children:ei.length>0?(0,n.jsx)("div",{className:"space-y-4 pr-4",children:ei.map(e=>(0,n.jsxs)(o.Zp,{className:"bg-card-foreground/5",children:[(0,n.jsx)(o.aR,{className:"pb-2",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsx)("div",{children:(0,n.jsx)(o.ZB,{className:"text-lg",children:e.title})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>G(e),children:(0,n.jsx)(Y.A,{className:"h-4 w-4"})}),(0,n.jsxs)(B.Lt,{children:[(0,n.jsx)(B.tv,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-7 w-7",children:(0,n.jsx)(J.A,{className:"h-4 w-4 text-destructive"})})}),(0,n.jsxs)(B.EO,{children:[(0,n.jsxs)(B.wd,{children:[(0,n.jsx)(B.r7,{children:"Are you sure?"}),(0,n.jsxs)(B.$v,{children:['This will permanently delete "',e.title,'".']})]}),(0,n.jsxs)(B.ck,{children:[(0,n.jsx)(B.Zr,{children:"Cancel"}),(0,n.jsx)(B.Rx,{onClick:()=>Z(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})}),(0,n.jsxs)(o.Wu,{children:[(0,n.jsxs)(o.BT,{className:"text-xs",children:["From: ",W(e.startDate),"/",K(e.startDate),"/",er(e.startDate)," To:"," ",W(e.endDate),"/",K(e.endDate),"/",er(e.endDate)]}),e.description&&(0,n.jsx)("p",{className:"text-sm mt-2",children:e.description}),e.party&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Party:"," ",(0,n.jsxs)("a",{href:eh(e.party),className:"font-semibold text-accent hover:underline",children:[e.party.name," (",e.party.type,")"]})]}),e.location&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[(0,n.jsx)(k.A,{className:"h-3 w-3"})," Location set"]}),e.tags&&e.tags.length>0&&(0,n.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map(e=>(0,n.jsx)(q.E,{variant:"secondary",children:e},e))})]})]},e.id))}):(0,n.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No events for this day."})})})]})]})}),(0,n.jsx)(Q.sF,{className:"flex-1 flex flex-col overflow-hidden bg-background/50 p-4",children:_&&F?(0,n.jsx)(U.r,{calendar:F,disableEditing:!0,initialDate:b,selectedDate:b,onDateSelect:C,events:m}):(0,n.jsx)(d.Ay,{onChange:e=>{e instanceof Date&&C(el(e))},value:b?en(b):void 0,activeStartDate:w,onActiveStartDateChange:e=>{let{activeStartDate:t}=e;return t&&D(t)},minDate:ea,maxDate:new Date(Date.UTC(9999,11,31)),tileContent:e=>{let{date:t,view:a}=e;return"month"===a&&ed.some(e=>(0,i.r)(en(e),t))?(0,n.jsx)("div",{className:"event-dot"}):null},className:"w-full h-full",weekStartsOn:1,next2Label:null,prev2Label:null})})]})}),(0,n.jsx)(P,{isOpen:S,onOpenChange:I,onSaveSuccess:()=>{g&&(0,X.bj)(g).then(u),I(!1),$(null)},event:A,calendar:T,calendarModel:F,initialDate:eo})]})})}},69253:(e,t,a)=>{a.d(t,{G:()=>o});var n=a(95155),l=a(12115),s=a(54165),r=a(30285),i=a(59409),d=a(34239),c=a(19209);function o(e){let{children:t,onLocationSelect:a}=e,[o,h]=(0,l.useState)(!1),[x,m]=(0,l.useState)([]),[u,j]=(0,l.useState)(null),[f,p]=(0,l.useState)(null),[y,v]=(0,l.useState)(null);return(0,l.useEffect)(()=>{o&&(0,d.xW)().then(e=>{m(e),e.length>0&&j(e[0].id)})},[o]),(0,l.useEffect)(()=>{u?(0,d.zU)(u).then(e=>{p(e||null),v(null)}):p(null)},[u]),(0,n.jsxs)(s.lG,{open:o,onOpenChange:h,children:[(0,n.jsx)(s.zM,{asChild:!0,children:t}),(0,n.jsxs)(s.Cf,{className:"sm:max-w-4xl h-[90vh] sm:h-[80vh] flex flex-col",children:[(0,n.jsx)(s.c7,{children:(0,n.jsx)(s.L3,{children:"Select a Location"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4 p-4 border-b",children:[(0,n.jsxs)(i.l6,{value:u||"",onValueChange:j,children:[(0,n.jsx)(i.bq,{className:"w-[250px]",children:(0,n.jsx)(i.yv,{placeholder:"Select a map..."})}),(0,n.jsx)(i.gC,{children:x.map(e=>(0,n.jsx)(i.eb,{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)("div",{className:"flex-1 text-right text-sm text-muted-foreground",children:y?"Selected: Q:".concat(y.q,", R:").concat(y.r):"Click a tile to select it"})]}),(0,n.jsx)("div",{className:"flex-1 relative bg-background/50",children:f?(0,n.jsx)(c.A,{mapData:f,hexSize:20,className:"w-full h-full",onHexClick:v,selectedHex:y,onGridUpdate:()=>{},onAddPointToPath:()=>{},activeTool:"data",paintMode:"brush",paintColor:"",paintIcon:null,paintIconColor:"",isCtrlPressed:!1,isAltPressed:!1,isShiftPressed:!1,isEyedropperActive:!1,onEyedropperClick:()=>{},pathDrawingId:null}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:(0,n.jsx)("p",{children:"Select a map to view it."})})}),(0,n.jsxs)(s.Es,{children:[(0,n.jsx)(r.$,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),(0,n.jsx)(r.$,{onClick:()=>{u&&y&&(a({mapId:u,hex:y}),h(!1))},disabled:!y,children:"Confirm Location"})]})]})]})}},77266:(e,t,a)=>{a.d(t,{r:()=>p});var n=a(95155),l=a(12115),s=a(30285),r=a(15599),i=a(965),d=a(73158),c=a(66695),o=a(59434),h=a(62523),x=a(82940),m=a.n(x),u=a(99865);let j=(e,t)=>!!e&&!!t&&e.year===t.year&&e.monthIndex===t.monthIndex&&e.day===t.day,f=e=>"".concat(e.year,"-").concat(e.monthIndex,"-").concat(e.day);function p(e){let{calendar:t,disableEditing:a=!1,initialDate:x,selectedDate:p,events:y=[],onEdit:v,onDateSelect:g}=e,[N,b]=(0,l.useState)((()=>{if("string"==typeof x&&(x=(0,u.Xo)(m()(x).utc().endOf("day").toDate())),x&&"year"in x&&void 0!==x.year){let e=x.monthIndex;return e>=t.months.length&&(e=0),{year:x.year,monthIndex:e,day:x.day}}return{year:1,monthIndex:0,day:1}})()),[C,w]=(0,l.useState)("day"),[D,S]=(0,l.useState)(0),[I,k]=(0,l.useState)(!1),[A,$]=(0,l.useState)("");(0,l.useEffect)(()=>{N&&(S(10*Math.floor((N.year-1)/10)+1),$(N.year.toString()))},[N]),(0,l.useEffect)(()=>{p&&b({year:p.year,monthIndex:p.monthIndex,day:p.day})},[p]);let z=(0,l.useMemo)(()=>t&&N?t.months[N.monthIndex]:null,[t,N]),E=(0,l.useMemo)(()=>{let e=new Set;return y.forEach(a=>{let n=a.startDate,l=a.endDate,s=t.months.length,r=n.year,i=n.monthIndex,d=n.day;for(;;){var c;let a=f({year:r,monthIndex:i,day:d});if(e.add(a),r===l.year&&i===l.monthIndex&&d===l.day)break;++d>((null==(c=t.months[i])?void 0:c.days)||30)&&(d=1,++i>=s&&(i=0,r++))}}),e},[y,t.months]),M=e=>{b(t=>t?{...t,monthIndex:e,day:1}:{year:new Date().getFullYear(),monthIndex:e,day:1}),w("day")},T=e=>{b(t=>t?{...t,year:e}:{year:e,monthIndex:0,day:1}),w("month")},F=e=>{if(!N)return;let t={year:N.year,monthIndex:N.monthIndex,day:e};g&&g(t)};return(0,n.jsxs)(c.Zp,{className:"h-full flex flex-col p-4",children:[!a&&(0,n.jsx)("div",{className:"flex justify-end mb-2",children:(0,n.jsxs)(s.$,{variant:"outline",size:"sm",onClick:v,children:[(0,n.jsx)(r.A,{className:"h-4 w-4 mr-2"}),"Template"]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)(s.$,{variant:"ghost",size:"icon",onClick:()=>{"day"===C?b(e=>{if(!e)return null;let a=e.monthIndex-1,n=e.year;return a<0&&(a=t.months.length-1,n-=1),{...e,year:n,monthIndex:a}}):"month"===C?b(e=>e?{...e,year:e.year-1}:null):S(e=>e-10)},children:(0,n.jsx)(i.A,{className:"h-5 w-5"})}),I?(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=parseInt(A,10);isNaN(t)||(b(e=>e?{...e,year:t}:{year:t,monthIndex:0,day:1}),w("month"),k(!1))},className:"flex-1 px-4",children:(0,n.jsx)(h.p,{type:"number",value:A,onChange:e=>$(e.target.value),onBlur:()=>k(!1),className:"text-center text-xl font-bold h-10",autoFocus:!0})}):(0,n.jsx)(s.$,{variant:"ghost",className:"text-xl font-bold",onClick:()=>{N&&("day"===C?w("month"):"month"===C?(S(10*Math.floor((N.year-1)/10)+1),w("year")):"year"===C&&($(N.year.toString()),k(!0)))},children:z&&N?"day"===C?"".concat(z.name,", ").concat(N.year):"month"===C?"".concat(N.year):"".concat(D," - ").concat(D+9):"..."}),(0,n.jsx)(s.$,{variant:"ghost",size:"icon",onClick:()=>{"day"===C?b(e=>{if(!e)return null;let a=e.monthIndex+1,n=e.year;return a>=t.months.length&&(a=0,n+=1),{...e,year:n,monthIndex:a}}):"month"===C?b(e=>e?{...e,year:e.year+1}:null):S(e=>e+10)},children:(0,n.jsx)(d.A,{className:"h-5 w-5"})})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:["day"===C&&(()=>{if(!z||!N)return null;let e=t.weekdays.length,a=z.days,l={year:N.year,monthIndex:N.monthIndex,day:1},s=0;for(let e=1;e<l.year;e++)s+=t.months.reduce((e,t)=>e+t.days,0);for(let e=0;e<l.monthIndex;e++)s+=t.months[e].days;let r=s%e,i=Array(r+a).fill(null);for(let e=0;e<a;e++)i[e+r]=e+1;return(0,n.jsxs)("div",{className:"grid flex-1 grid-cols-1",style:{gridTemplateRows:"auto 1fr"},children:[(0,n.jsx)("div",{style:{"--cols":e},className:"grid grid-cols-[repeat(var(--cols),_minmax(0,_1fr))] shrink-0",children:t.weekdays.map(e=>(0,n.jsx)("div",{className:"text-center font-semibold text-muted-foreground p-2 text-sm",children:e},e))}),(0,n.jsx)("div",{style:{"--cols":e},className:"grid grid-cols-[repeat(var(--cols),_minmax(0,_1fr))] grid-rows-auto flex-1 gap-2",children:i.map((e,t)=>{if(!e)return(0,n.jsx)("div",{},t);let a={year:N.year,monthIndex:N.monthIndex,day:e},l=j(p,a),s=f(a),r=E.has(s);return(0,n.jsxs)("button",{className:(0,o.cn)("flex items-start justify-start p-2 rounded-lg transition-colors relative","hover:bg-muted",l&&"bg-primary text-primary-foreground hover:bg-primary/90"),onClick:()=>F(e),disabled:!g,children:[(0,n.jsx)("span",{className:"text-sm",children:e}),r&&(0,n.jsx)("div",{className:(0,o.cn)("absolute bottom-2 left-1/2 -translate-x-1/2 w-1.5 h-1.5 rounded-full",l?"bg-primary-foreground":"bg-accent")})]},t)})})]})})(),"month"===C&&(0,n.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4 p-4 flex-1",children:t.months.map((e,t)=>(0,n.jsx)(s.$,{variant:"outline",className:"h-24 text-lg",onClick:()=>M(t),children:e.name},e.name))}),"year"===C&&(()=>{let e=Array.from({length:10},(e,t)=>D+t);return(0,n.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-4 p-4 flex-1",children:e.map(e=>(0,n.jsx)(s.$,{variant:"outline",className:"h-24 text-lg",onClick:()=>T(e),children:e},e))})})()]})]})}},99865:(e,t,a)=>{a.d(t,{$k:()=>i,Xo:()=>r,aL:()=>s});var n=a(82940),l=a.n(n);let s=()=>{let e=new Date(Date.UTC(1,0,1));return e.setUTCFullYear(1),e},r=e=>{let t;return{year:(t="string"==typeof e?l()(e).utc().startOf("day").toDate():e).getUTCFullYear(),monthIndex:t.getUTCMonth(),day:t.getUTCDate()}},i=e=>{let t;t="string"==typeof e?r(e):e;let a=l()().utc().endOf("day").toDate();return a.setUTCFullYear(t.year,t.monthIndex,t.day),a}}}]);
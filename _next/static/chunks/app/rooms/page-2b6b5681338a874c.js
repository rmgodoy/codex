(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{8643:(e,s,t)=>{"use strict";t.d(s,{Ke:()=>n,Nt:()=>a,R6:()=>l});var r=t(27242);let a=r.bL,l=r.R6,n=r.Ke},15584:(e,s,t)=>{Promise.resolve().then(t.bind(t,46395))},22945:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(40157).A)("FlaskConical",[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]])},36697:(e,s,t)=>{"use strict";t.d(s,{HN:()=>c,SP:()=>a,TG:()=>n,_w:()=>l,xX:()=>i});var r=t(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readonly").objectStore(r.NK).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},n=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK),t=(0,r.$C)(),a={...e,id:t},l=s.add(a);return new Promise((e,s)=>{l.onsuccess=()=>e(t),l.onerror=()=>s(l.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},c=async e=>{let s=(await (0,r.Lf)()).transaction(r.NK,"readwrite").objectStore(r.NK).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},46395:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Q});var r=t(95155),a=t(12115),l=t(62709),n=t(20031),i=t(47906),c=t(36697),o=t(62523),d=t(30285),u=t(66424),m=t(22346),x=t(87481),h=t(34301),j=t(75074),f=t(20203),p=t(73926),g=t(85057),w=t(59409),N=t(90648);function v(e){let{onSelectItem:s,onNewItem:t,selectedItemId:l,dataVersion:n,filters:i,setFilters:v,onClearFilters:y}=e,[b,S]=(0,a.useState)([]),[C,z]=(0,a.useState)(!0),{toast:k}=(0,x.dj)();(0,a.useEffect)(()=>{(async()=>{z(!0);try{S(await (0,c.SP)())}catch(e){k({variant:"destructive",title:"Error",description:"Could not fetch rooms from database."})}finally{z(!1)}})()},[n,k]);let I=(0,a.useMemo)(()=>{let e=b.filter(e=>{let s=e.name.toLowerCase().includes(i.searchTerm.toLowerCase()),t=!0,r=i.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return r.length>0&&(t=!!e.tags&&r.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>e.name.localeCompare(s.name));return"desc"===i.sortOrder&&e.reverse(),e},[b,i]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)(d.$,{onClick:t,className:"w-full",children:[(0,r.jsx)(h.A,{})," New Room"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(j.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(o.p,{placeholder:"Search rooms...",value:i.searchTerm,onChange:e=>v.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(g.J,{children:"Filter"}),(0,r.jsx)(d.$,{variant:"ghost",size:"sm",onClick:y,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,r.jsx)(N.F,{value:i.tagFilter?i.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>v.setTagFilter(e.join(",")),placeholder:"Tags (e.g. dungeon, trap)",tagSource:"room"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(g.J,{children:"Sort by"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(w.l6,{value:i.sortBy,onValueChange:e=>v.setSortBy(e),children:[(0,r.jsx)(w.bq,{children:(0,r.jsx)(w.yv,{placeholder:"Sort by"})}),(0,r.jsx)(w.gC,{children:(0,r.jsx)(w.eb,{value:"name",children:"Name"})})]}),(0,r.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>v.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===i.sortOrder?(0,r.jsx)(f.A,{className:"h-4 w-4"}):(0,r.jsx)(p.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,r.jsx)(m.w,{}),(0,r.jsx)(u.F,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4",children:C?(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading rooms..."}):I.length>0?(0,r.jsx)("ul",{className:"space-y-1",children:I.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(l===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No rooms found."})})})]})}var y=t(62177),b=t(90221),S=t(55594),C=t(87189),z=t(74691),k=t(98638),I=t(44218),L=t(66695),A=t(88539),F=t(90010),P=t(17759),T=t(12543),V=t(18763),R=t(73503),E=t(98917),M=t(22945),$=t(77223),B=t(25318),_=t(53054),G=t(18046),D=t(21887),K=t(68856),J=t(26126),Z=t(54165),O=t(47262),q=t(8643);let H=S.z.object({id:S.z.string(),title:S.z.string().min(1,"Feature title is required"),description:S.z.string().min(1,"Feature description is required"),encounterIds:S.z.array(S.z.string()),treasureIds:S.z.array(S.z.string()),alchemicalItemIds:S.z.array(S.z.string())}),U=S.z.object({name:S.z.string().min(1,"Room name is required"),description:S.z.string().optional(),size:S.z.string().optional(),tags:S.z.array(S.z.string()).optional(),features:S.z.array(H),totalTreasureValue:S.z.coerce.number()}),W=e=>{let{triggerButton:s,dialogTitle:t,items:l,onSelectItems:n,initialSelectedIds:i=[]}=e,[c,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)(new Set(i)),[j,f]=(0,a.useState)(""),p=(0,a.useMemo)(()=>{let e=l.filter(e=>e.name.toLowerCase().includes(j.toLowerCase()));return e.sort((e,s)=>{let t=x.has(e.id),r=x.has(s.id);return t&&!r?-1:!t&&r?1:e.name.localeCompare(s.name)}),e},[l,j,x]),g=e=>{h(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})};return(0,r.jsxs)(Z.lG,{open:c,onOpenChange:e=>{e&&h(new Set(i)),m(e)},children:[(0,r.jsx)(Z.zM,{asChild:!0,children:s}),(0,r.jsxs)(Z.Cf,{className:"max-w-lg h-[70vh] flex flex-col",children:[(0,r.jsx)(Z.c7,{children:(0,r.jsx)(Z.L3,{children:t})}),(0,r.jsx)(o.p,{placeholder:"Search...",value:j,onChange:e=>f(e.target.value),className:"mb-4 shrink-0"}),(0,r.jsx)(u.F,{className:"flex-1 border rounded-md p-2",children:(0,r.jsx)("div",{className:"space-y-1",children:p.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-md",children:[(0,r.jsx)(O.S,{id:"item-".concat(e.id),onCheckedChange:()=>g(e.id),checked:x.has(e.id)}),(0,r.jsxs)("label",{htmlFor:"item-".concat(e.id),className:"flex-1",children:[(0,r.jsx)("p",{className:"font-semibold",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[void 0!==e.value&&"Value: ".concat(e.value),e.type&&"Type: ".concat(e.type)]})]})]},e.id))})}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4 shrink-0",children:[(0,r.jsx)(d.$,{variant:"ghost",onClick:()=>m(!1),children:"Cancel"}),(0,r.jsx)(d.$,{onClick:()=>{n(Array.from(x)),m(!1)},children:"Confirm"})]})]})]})},X={name:"",description:"",size:"",tags:[],features:[],totalTreasureValue:0};function Y(e){let{roomId:s,isCreatingNew:t,onSaveSuccess:l,onDeleteSuccess:n,onEditCancel:u,onFilterByClick:h,onBack:j,dataVersion:f}=e,{toast:p}=(0,x.dj)(),[g,w]=(0,a.useState)(t),[v,S]=(0,a.useState)(!t&&!!s),[Z,O]=(0,a.useState)(null),[H,Y]=(0,a.useState)([]),[Q,ee]=(0,a.useState)([]),[es,et]=(0,a.useState)([]),er=(0,i.a)(),ea=(0,a.useMemo)(()=>({encounters:new Map(H.map(e=>[e.id,e])),treasures:new Map(Q.map(e=>[e.id,e])),alchemicalItems:new Map(es.map(e=>[e.id,e]))}),[H,Q,es]),el=(0,y.mN)({resolver:(0,b.u)(U),defaultValues:X}),{fields:en,append:ei,remove:ec}=(0,y.jz)({control:el.control,name:"features"}),eo=el.watch("features");(0,a.useEffect)(()=>{if(g){let e=eo.reduce((e,s)=>e+s.treasureIds.reduce((e,s)=>{let t=ea.treasures.get(s);return e+((null==t?void 0:t.value)||0)},0),0);el.getValues("totalTreasureValue")!==e&&el.setValue("totalTreasureValue",e,{shouldValidate:!0})}},[eo,ea.treasures,el,g]),(0,a.useEffect)(()=>{Promise.all([(0,C.eS)(),(0,z.Ap)(),(0,k.vV)()]).then(e=>{let[s,t,r]=e;Y(s),ee(t),et(r)})},[]),(0,a.useEffect)(()=>{(async()=>{if(t){el.reset(X),O(null),w(!0),S(!1);return}if(!s){w(!1),S(!1),O(null);return}S(!0),w(!1);try{let e=await (0,c._w)(s);e?(el.reset(e),O(e)):O(null)}catch(e){p({variant:"destructive",title:"Error",description:"Could not load room data."})}finally{S(!1)}})()},[s,t,el,p,f]);let ed=()=>{t?u():Z&&(el.reset(Z),w(!1))},eu=async e=>{try{let r,a={...e,tags:e.tags||[]},n=e.tags||[];if(n.length>0&&await (0,I.JE)(n,"room"),t)r=await (0,c.TG)(a),p({title:"Room Created!",description:"".concat(e.name," has been added.")});else{if(!s)return;r=s,await (0,c.xX)({...a,id:s}),p({title:"Save Successful",description:"".concat(e.name," has been updated.")})}l(r),w(!1)}catch(e){p({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},em=async()=>{if(s)try{await (0,c.HN)(s),p({title:"Room Deleted",description:"The room has been removed."}),n()}catch(e){p({variant:"destructive",title:"Deletion Failed",description:"Could not delete the room."})}};return v?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(L.Zp,{children:[(0,r.jsx)(L.aR,{children:(0,r.jsx)(K.E,{className:"h-8 w-48"})}),(0,r.jsx)(L.Wu,{children:(0,r.jsx)(K.E,{className:"h-40 w-full"})})]})}):s||t?!g&&Z?(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsxs)(L.Zp,{children:[(0,r.jsx)(L.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[er&&j&&(0,r.jsx)(d.$,{variant:"ghost",size:"icon",onClick:j,className:"shrink-0 -ml-2 -mt-1",children:(0,r.jsx)(T.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(L.ZB,{className:"text-3xl font-bold",children:Z.name}),(0,r.jsxs)(L.BT,{className:"flex flex-wrap gap-x-4",children:[Z.size&&(0,r.jsxs)("span",{children:["Size: ",Z.size]}),(0,r.jsxs)("span",{children:["Total Value: ",Z.totalTreasureValue]})]})]})]}),(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[(0,r.jsx)(V.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,r.jsx)(L.Wu,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[Z.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,r.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:Z.description})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Features"}),Z.features.length>0?(0,r.jsx)("ul",{className:"space-y-4",children:Z.features.map(e=>(0,r.jsxs)("li",{className:"p-3 bg-card-foreground/5 rounded-lg",children:[(0,r.jsx)("p",{className:"font-semibold",children:e.title}),e.encounterIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(R.A,{className:"h-4 w-4"})," Linked Encounters"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.encounterIds.map(e=>{var s;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(s=ea.encounters.get(e))?void 0:s.name)||"..."},e)})})]}),e.treasureIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(E.A,{className:"h-4 w-4"})," Linked Treasures"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.treasureIds.map(e=>{var s;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(s=ea.treasures.get(e))?void 0:s.name)||"..."},e)})})]}),e.alchemicalItemIds.length>0&&(0,r.jsxs)("div",{className:"mt-2 pl-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(M.A,{className:"h-4 w-4"})," Linked Alchemy"]}),(0,r.jsx)("ul",{className:"list-disc list-inside mt-1",children:e.alchemicalItemIds.map(e=>{var s;return(0,r.jsx)("li",{className:"text-sm text-accent",children:(null==(s=ea.alchemicalItems.get(e))?void 0:s.name)||"..."},e)})})]})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No features defined for this room."})]}),Z.tags&&Z.tags.length>0&&(0,r.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:Z.tags.map(e=>(0,r.jsx)("button",{onClick:s=>h({tagFilter:e},s),className:"bg-transparent border-none p-0 m-0",children:(0,r.jsx)(J.E,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80",children:e})},e))})})]})}),(0,r.jsx)(L.wL,{children:(0,r.jsxs)(F.Lt,{children:[(0,r.jsx)(F.tv,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(F.EO,{children:[(0,r.jsxs)(F.wd,{children:[(0,r.jsx)(F.r7,{children:"Are you sure?"}),(0,r.jsxs)(F.$v,{children:['This will permanently delete "',Z.name,'".']})]}),(0,r.jsxs)(F.ck,{children:[(0,r.jsx)(F.Zr,{children:"Cancel"}),(0,r.jsx)(F.Rx,{onClick:em,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(L.Zp,{children:(0,r.jsx)(P.lV,{...el,children:(0,r.jsxs)("form",{onSubmit:el.handleSubmit(eu),className:"space-y-6",children:[(0,r.jsx)(L.aR,{children:(0,r.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[er&&j&&(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2",children:(0,r.jsx)(T.A,{className:"h-5 w-5"})}),(0,r.jsx)(L.ZB,{children:t?"Create New Room":"Editing: ".concat(el.getValues("name")||"...")})]}),!er&&(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:ed,className:"text-muted-foreground hover:text-foreground",children:(0,r.jsx)(B.A,{className:"h-5 w-5"})})]})}),(0,r.jsxs)(L.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(P.zB,{name:"name",control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Name"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(o.p,{...s})}),(0,r.jsx)(P.C5,{})]})}}),(0,r.jsx)(P.zB,{name:"size",control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Size"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(o.p,{...s,placeholder:"e.g., 30ft x 40ft"})})]})}})]}),(0,r.jsx)(P.zB,{name:"totalTreasureValue",control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Total Treasure Value"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(o.p,{type:"number",...s,readOnly:!0,className:"w-28 bg-muted border-none"})})]})}}),(0,r.jsx)(P.zB,{name:"description",control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Description"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(A.T,{...s,rows:4})})]})}}),(0,r.jsx)(P.zB,{name:"tags",control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsxs)(P.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(_.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(N.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"room"})}),(0,r.jsx)(P.C5,{})]})}}),(0,r.jsx)(m.w,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground",children:"Room Features"}),(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{ei({id:crypto.randomUUID(),title:"",description:"",encounterIds:[],treasureIds:[],alchemicalItemIds:[]})},children:[(0,r.jsx)(G.A,{className:"h-4 w-4 mr-2"})," Add Feature"]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[en.map((e,s)=>(0,r.jsxs)(q.Nt,{className:"border bg-card-foreground/5 rounded-lg p-3",defaultOpen:!el.watch("features.".concat(s,".title")),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(q.R6,{asChild:!0,children:(0,r.jsxs)("button",{type:"button",className:"flex items-center gap-3 text-left w-full",children:[(0,r.jsx)(D.A,{className:"h-5 w-5 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-lg font-semibold text-primary-foreground",children:el.watch("features.".concat(s,".title"))||"New Feature"})]})}),(0,r.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ec(s),className:"text-muted-foreground hover:text-destructive shrink-0",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)(q.Ke,{className:"mt-4 space-y-4",children:[(0,r.jsx)(P.zB,{name:"features.".concat(s,".title"),control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Title"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(o.p,{...s})}),(0,r.jsx)(P.C5,{})]})}}),(0,r.jsx)(P.zB,{name:"features.".concat(s,".description"),control:el.control,render:e=>{let{field:s}=e;return(0,r.jsxs)(P.eI,{children:[(0,r.jsx)(P.lR,{children:"Description"}),(0,r.jsx)(P.MJ,{children:(0,r.jsx)(A.T,{...s,rows:2})}),(0,r.jsx)(P.C5,{})]})}}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 justify-end",children:[(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(R.A,{className:"h-4 w-4 mr-2"})," Encounters"]}),dialogTitle:"Link Encounters",items:H.map(e=>({id:e.id,name:e.name,value:e.totalTR||0})),onSelectItems:e=>el.setValue("features.".concat(s,".encounterIds"),e),initialSelectedIds:el.getValues("features.".concat(s,".encounterIds"))}),(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(E.A,{className:"h-4 w-4 mr-2"})," Treasures"]}),dialogTitle:"Link Treasures",items:Q,onSelectItems:e=>el.setValue("features.".concat(s,".treasureIds"),e),initialSelectedIds:el.getValues("features.".concat(s,".treasureIds"))}),(0,r.jsx)(W,{triggerButton:(0,r.jsxs)(d.$,{type:"button",size:"sm",variant:"outline",children:[(0,r.jsx)(M.A,{className:"h-4 w-4 mr-2"})," Alchemy"]}),dialogTitle:"Link Alchemical Items",items:es.map(e=>({id:e.id,name:e.name,type:e.type})),onSelectItems:e=>el.setValue("features.".concat(s,".alchemicalItemIds"),e),initialSelectedIds:el.getValues("features.".concat(s,".alchemicalItemIds"))})]})]})]},e.id)),0===en.length&&(0,r.jsx)("p",{className:"text-muted-foreground text-center text-sm py-4",children:"No features added to this room."})]})]})]}),(0,r.jsxs)(L.wL,{className:"flex items-center gap-2",children:[!t&&(0,r.jsxs)(F.Lt,{children:[(0,r.jsx)(F.tv,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"destructive",size:"sm",children:(0,r.jsx)($.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(F.EO,{children:[(0,r.jsxs)(F.wd,{children:[(0,r.jsx)(F.r7,{children:"Are you sure?"}),(0,r.jsxs)(F.$v,{children:['This will permanently delete "',el.getValues("name"),'".']})]}),(0,r.jsxs)(F.ck,{children:[(0,r.jsx)(F.Zr,{children:"Cancel"}),(0,r.jsx)(F.Rx,{onClick:em,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,r.jsx)("div",{className:"flex-grow"}),!er&&(0,r.jsx)(d.$,{type:"button",variant:"outline",onClick:ed,children:"Cancel"}),(0,r.jsx)(d.$,{type:"submit",children:t?"Create Room":"Save Changes"})]})]})})})}):(0,r.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,r.jsx)(L.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,r.jsx)(L.Wu,{className:"text-center pt-6",children:(0,r.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a room to view or create a new one."})})})})}function Q(){let[e,s]=(0,a.useState)(null),[t,c]=(0,a.useState)(!1),[o,d]=(0,a.useState)(0),[u,m]=(0,a.useState)(""),[x,h]=(0,a.useState)(""),[j,f]=(0,a.useState)("name"),[p,g]=(0,a.useState)("asc"),[w,N]=(0,a.useState)(!1),y=(0,i.a)(),[b,S]=(0,a.useState)("list");(0,a.useEffect)(()=>{N(!0)},[]);let C={searchTerm:u,tagFilter:x,sortBy:j,sortOrder:p},z={setSearchTerm:m,setTagFilter:h,setSortBy:f,setSortOrder:g},k=(e,s)=>{s.shiftKey?e.tagFilter&&h(s=>s?s.split(",").map(e=>e.trim()).includes(e.tagFilter)?s:"".concat(s,", ").concat(e.tagFilter):e.tagFilter):h(e.tagFilter||"")},I=()=>{m(""),h(""),f("name"),g("asc")},L=()=>d(e=>e+1),A=e=>{s(e),c(!1),y&&S("editor")},F=()=>{s(null),c(!0),y&&S("editor")},P=e=>{L(),s(e),c(!1),y&&S("editor")},T=()=>{L(),s(null),c(!1),y&&S("list")},V=()=>{t&&(c(!1),s(null),y&&S("list"))};return w?y?(0,r.jsx)(l.A,{showSidebarTrigger:!1,children:(0,r.jsx)("div",{className:"h-full w-full",children:"list"===b?(0,r.jsx)(v,{onSelectItem:A,onNewItem:F,selectedItemId:e,dataVersion:o,filters:C,setFilters:z,onClearFilters:I}):(0,r.jsx)("div",{className:"p-4 sm:p-6 h-full w-full overflow-y-auto",children:(0,r.jsx)(Y,{roomId:e,isCreatingNew:t,onSaveSuccess:P,onDeleteSuccess:T,onEditCancel:V,onFilterByClick:k,onBack:()=>{S("list"),s(null),c(!1)},dataVersion:o},null!=e?e:t?"new":"placeholder")})})}):(0,r.jsx)(n.GB,{children:(0,r.jsx)(l.A,{children:(0,r.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,r.jsx)(n.Bx,{style:{"--sidebar-width":"380px"},children:(0,r.jsx)(v,{onSelectItem:A,onNewItem:F,selectedItemId:e,dataVersion:o,filters:C,setFilters:z,onClearFilters:I})}),(0,r.jsx)(n.sF,{className:"flex-1 overflow-y-auto",children:(0,r.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,r.jsx)(Y,{roomId:e,isCreatingNew:t,onSaveSuccess:P,onDeleteSuccess:T,onEditCancel:V,onFilterByClick:k,dataVersion:o},null!=e?e:t?"new":"placeholder")})})]})})}):null}},47262:(e,s,t)=>{"use strict";t.d(s,{S:()=>c});var r=t(95155),a=t(12115),l=t(76981),n=t(10518),i=t(59434);let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.bL,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...a,children:(0,r.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})})});c.displayName=l.bL.displayName},54165:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>m,Es:()=>h,L3:()=>j,c7:()=>x,lG:()=>c,rr:()=>f,zM:()=>o});var r=t(95155),a=t(12115),l=t(45821),n=t(25318),i=t(59434);let c=l.bL,o=l.l9,d=l.ZL;l.bm;let u=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.hJ,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a})});u.displayName=l.hJ.displayName;let m=a.forwardRef((e,s)=>{let{className:t,children:a,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(l.UC,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...c,children:[a,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let x=e=>{let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};x.displayName="DialogHeader";let h=e=>{let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};h.displayName="DialogFooter";let j=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.hE,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...a})});j.displayName=l.hE.displayName;let f=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.VY,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});f.displayName=l.VY.displayName},68856:(e,s,t)=>{"use strict";t.d(s,{E:()=>l});var r=t(95155),a=t(59434);function l(e){let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",s),...t})}},73503:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(40157).A)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]])},74691:(e,s,t)=>{"use strict";t.d(s,{Ap:()=>a,Dp:()=>n,Ld:()=>i,qp:()=>l,vm:()=>c});var r=t(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readonly").objectStore(r.zG).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},n=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG),t=(0,r.$C)(),a={...e,id:t},l=s.add(a);return new Promise((e,s)=>{l.onsuccess=()=>e(t),l.onerror=()=>s(l.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},c=async e=>{let s=(await (0,r.Lf)()).transaction(r.zG,"readwrite").objectStore(r.zG).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},87189:(e,s,t)=>{"use strict";t.d(s,{Fs:()=>n,H$:()=>i,ZJ:()=>c,eS:()=>a,eq:()=>l});var r=t(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.l_,"readonly").objectStore(r.l_).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.l_,"readonly").objectStore(r.l_).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},n=async e=>{let s=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_),t=(0,r.$C)(),a={...e,id:t},l=s.add(a);return new Promise((e,s)=>{l.onsuccess=()=>e(t),l.onerror=()=>s(l.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},c=async e=>{let s=(await (0,r.Lf)()).transaction(r.l_,"readwrite").objectStore(r.l_).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},98638:(e,s,t)=>{"use strict";t.d(s,{S9:()=>i,gL:()=>c,rD:()=>l,vV:()=>a,wo:()=>n});var r=t(82489);let a=async()=>{let e=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},l=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readonly").objectStore(r.rP).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},n=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP),t=(0,r.$C)(),a={...e,id:t},l=s.add(a);return new Promise((e,s)=>{l.onsuccess=()=>e(t),l.onerror=()=>s(l.error)})},i=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},c=async e=>{let s=(await (0,r.Lf)()).transaction(r.rP,"readwrite").objectStore(r.rP).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},98917:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(40157).A)("Gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[222,676,670,49,208,347,516,441,684,358],()=>s(15584)),_N_E=e.O()}]);
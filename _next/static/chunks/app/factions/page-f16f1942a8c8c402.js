(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[950],{12543:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},15510:(e,s,t)=>{"use strict";t.d(s,{UU:()=>c,mu:()=>i,sB:()=>n,vR:()=>l,vq:()=>r});var a=t(82489);let r=async()=>{let e=(await (0,a.Lf)()).transaction(a.U3,"readonly").objectStore(a.U3).getAll();return new Promise((s,t)=>{e.onsuccess=()=>s(e.result),e.onerror=()=>t(e.error)})},l=async e=>{let s=(await (0,a.Lf)()).transaction(a.U3,"readonly").objectStore(a.U3).get(e);return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},n=async e=>{let s=(await (0,a.Lf)()).transaction(a.U3,"readwrite").objectStore(a.U3),t=(0,a.$C)(),r={...e,id:t},l=s.add(r);return new Promise((e,s)=>{l.onsuccess=()=>e(t),l.onerror=()=>s(l.error)})},i=async e=>{let s=(await (0,a.Lf)()).transaction(a.U3,"readwrite").objectStore(a.U3).put(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})},c=async e=>{let s=(await (0,a.Lf)()).transaction(a.U3,"readwrite").objectStore(a.U3).delete(e);return new Promise((e,t)=>{s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}},20203:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},34301:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},53054:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},68856:(e,s,t)=>{"use strict";t.d(s,{E:()=>l});var a=t(95155),r=t(59434);function l(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",s),...t})}},71608:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>I});var a=t(95155),r=t(12115),l=t(15510),n=t(62523),i=t(30285),c=t(66424),o=t(22346),d=t(87481),x=t(34301),h=t(75074),u=t(20203),m=t(73926),j=t(85057),p=t(59409),f=t(90648);function v(e){let{onSelectFaction:s,onNewFaction:t,selectedFactionId:v,dataVersion:w,filters:g,setFilters:N,onClearFilters:y}=e,[b,C]=(0,r.useState)([]),[S,k]=(0,r.useState)(!0),{toast:A}=(0,d.dj)();(0,r.useEffect)(()=>{(async()=>{k(!0);try{C(await (0,l.vq)())}catch(e){A({variant:"destructive",title:"Error",description:"Could not fetch factions from database."})}finally{k(!1)}})()},[w,A]);let F=(0,r.useMemo)(()=>{let e=b.filter(e=>{let s=e.name.toLowerCase().includes(g.searchTerm.toLowerCase()),t=!0,a=g.tagFilter.toLowerCase().split(",").map(e=>e.trim()).filter(Boolean);return a.length>0&&(t=!!e.tags&&a.every(s=>e.tags.some(e=>e.toLowerCase().includes(s)))),s&&t}).sort((e,s)=>e.name.localeCompare(s.name));return"desc"===g.sortOrder&&e.reverse(),e},[b,g]);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)(i.$,{onClick:t,className:"w-full",children:[(0,a.jsx)(x.A,{})," New Faction"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(n.p,{placeholder:"Search factions...",value:g.searchTerm,onChange:e=>N.setSearchTerm(e.target.value),className:"pl-9"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.J,{children:"Filter"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:y,className:"text-xs h-auto p-1",children:"Clear"})]}),(0,a.jsx)(f.F,{value:g.tagFilter?g.tagFilter.split(",").map(e=>e.trim()).filter(Boolean):[],onChange:e=>N.setTagFilter(e.join(",")),placeholder:"Tags...",tagSource:"faction"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j.J,{children:"Sort by"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(p.l6,{value:g.sortBy,onValueChange:e=>N.setSortBy(e),children:[(0,a.jsx)(p.bq,{children:(0,a.jsx)(p.yv,{placeholder:"Sort by"})}),(0,a.jsx)(p.gC,{children:(0,a.jsx)(p.eb,{value:"name",children:"Name"})})]}),(0,a.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>N.setSortOrder(e=>"asc"===e?"desc":"asc"),children:["asc"===g.sortOrder?(0,a.jsx)(u.A,{className:"h-4 w-4"}):(0,a.jsx)(m.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle sort order"})]})]})]})]}),(0,a.jsx)(o.w,{}),(0,a.jsx)(c.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:S?(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"Loading factions..."}):F.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:F.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>s(e.id),className:"w-full text-left p-2 rounded-md transition-colors ".concat(v===e.id?"bg-primary text-primary-foreground":"hover:bg-accent/50"),children:e.name})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:"No factions found."})})})]})}var w=t(62177),g=t(90221),N=t(55594),y=t(44218),b=t(66695),C=t(88539),S=t(90010),k=t(17759),A=t(12543),F=t(18763),z=t(77223),E=t(25318),B=t(53054),L=t(68856),T=t(26126),U=t(47906);let $=N.z.object({name:N.z.string().min(1,"Faction name is required"),description:N.z.string().optional(),goals:N.z.string().optional(),tags:N.z.array(N.z.string()).optional()}),M={name:"",description:"",goals:"",tags:[]};function R(e){let{factionId:s,isCreatingNew:t,onSaveSuccess:c,onDeleteSuccess:x,onEditCancel:h,onBack:u}=e,{toast:m}=(0,d.dj)(),[j,p]=(0,r.useState)(t),[v,N]=(0,r.useState)(!t&&!!s),[R,q]=(0,r.useState)(null),D=(0,U.a)(),I=(0,w.mN)({resolver:(0,g.u)($),defaultValues:M});(0,r.useEffect)(()=>{(async()=>{if(t){I.reset(M),q(null),p(!0),N(!1);return}if(!s){p(!1),N(!1),q(null);return}N(!0),p(!1);try{let e=await (0,l.vR)(s);e?(I.reset(e),q(e)):q(null)}catch(e){m({variant:"destructive",title:"Error",description:"Could not load faction data."})}finally{N(!1)}})()},[s,t,I,m]);let V=()=>{t?h():R&&(I.reset(R),p(!1))},Z=async e=>{try{let a={...e,tags:e.tags||[]},r=e.tags||[];if(r.length>0&&await (0,y.JE)(r,"faction"),t){let s=await (0,l.sB)(a);m({title:"Faction Created!",description:"".concat(e.name," has been added.")}),c(s)}else s&&(await (0,l.mu)({...a,id:s}),m({title:"Save Successful",description:"".concat(e.name," has been updated.")}),c(s));p(!1)}catch(e){m({variant:"destructive",title:"Save Failed",description:"Could not save changes."})}},J=async()=>{if(s)try{await (0,l.UU)(s),m({title:"Faction Deleted",description:"The faction has been removed."}),x()}catch(e){m({variant:"destructive",title:"Deletion Failed",description:"Could not delete the faction."})}};return v?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(b.Zp,{children:[(0,a.jsx)(b.aR,{children:(0,a.jsx)(L.E,{className:"h-8 w-48"})}),(0,a.jsx)(b.Wu,{children:(0,a.jsx)(L.E,{className:"h-40 w-full"})})]})}):s||t?!j&&R?(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsxs)(b.Zp,{children:[(0,a.jsx)(b.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[D&&u&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:u,className:"shrink-0 -ml-2 -mt-1",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{children:(0,a.jsx)(b.ZB,{className:"text-3xl font-bold",children:R.name})})]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>p(!0),children:[(0,a.jsx)(F.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-2",children:"Edit"})]})]})}),(0,a.jsx)(b.Wu,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:R.description||"No description provided."})]}),(0,a.jsx)(o.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Goals"}),(0,a.jsx)("p",{className:"text-foreground/80 whitespace-pre-wrap",children:R.goals||"No goals provided."})]}),R.tags&&R.tags.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-border/50",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:R.tags.map(e=>(0,a.jsx)(T.E,{variant:"secondary",children:e},e))})})]})}),(0,a.jsx)(b.wL,{children:(0,a.jsxs)(S.Lt,{children:[(0,a.jsx)(S.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(z.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(S.EO,{children:[(0,a.jsxs)(S.wd,{children:[(0,a.jsx)(S.r7,{children:"Are you sure?"}),(0,a.jsxs)(S.$v,{children:['This will permanently delete "',R.name,'". This action cannot be undone.']})]}),(0,a.jsxs)(S.ck,{children:[(0,a.jsx)(S.Zr,{children:"Cancel"}),(0,a.jsx)(S.Rx,{onClick:J,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})})]})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(b.Zp,{children:(0,a.jsx)(k.lV,{...I,children:(0,a.jsxs)("form",{onSubmit:I.handleSubmit(Z),className:"space-y-6",children:[(0,a.jsx)(b.aR,{children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[D&&u&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:h,className:"shrink-0 -ml-2",children:(0,a.jsx)(A.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{children:(0,a.jsx)(b.ZB,{children:t?D?"New Faction":"Create New Faction":"Editing: ".concat(I.getValues("name")||"...")})})]}),!D&&(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:V,className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(E.A,{className:"h-5 w-5"})})]})}),(0,a.jsxs)(b.Wu,{className:"space-y-6",children:[(0,a.jsx)(k.zB,{name:"name",control:I.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsx)(k.lR,{children:"Name"}),(0,a.jsx)(k.MJ,{children:(0,a.jsx)(n.p,{...s})}),(0,a.jsx)(k.C5,{})]})}}),(0,a.jsx)(k.zB,{name:"description",control:I.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsx)(k.lR,{children:"Description"}),(0,a.jsx)(k.MJ,{children:(0,a.jsx)(C.T,{...s,rows:4})})]})}}),(0,a.jsx)(k.zB,{name:"goals",control:I.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsx)(k.lR,{children:"Goals"}),(0,a.jsx)(k.MJ,{children:(0,a.jsx)(C.T,{...s,rows:4})})]})}}),(0,a.jsx)(k.zB,{name:"tags",control:I.control,render:e=>{let{field:s}=e;return(0,a.jsxs)(k.eI,{children:[(0,a.jsxs)(k.lR,{className:"flex items-center gap-2",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 text-accent"}),"Tags"]}),(0,a.jsx)(k.MJ,{children:(0,a.jsx)(f.F,{value:s.value||[],onChange:s.onChange,placeholder:"Add tags...",tagSource:"faction"})}),(0,a.jsx)(k.C5,{})]})}})]}),(0,a.jsxs)(b.wL,{className:"flex items-center gap-2",children:[!t&&(0,a.jsxs)(S.Lt,{children:[(0,a.jsx)(S.tv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"destructive",size:"sm",children:(0,a.jsx)(z.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(S.EO,{children:[(0,a.jsxs)(S.wd,{children:[(0,a.jsx)(S.r7,{children:"Are you sure?"}),(0,a.jsxs)(S.$v,{children:['This will permanently delete "',I.getValues("name"),'".']})]}),(0,a.jsxs)(S.ck,{children:[(0,a.jsx)(S.Zr,{children:"Cancel"}),(0,a.jsx)(S.Rx,{onClick:J,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]}),(0,a.jsx)("div",{className:"flex-grow"}),!D&&(0,a.jsx)(i.$,{type:"button",variant:"outline",onClick:V,children:"Cancel"}),(0,a.jsx)(i.$,{type:"submit",children:t?"Create Faction":"Save Changes"})]})]})})})}):(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto",children:(0,a.jsx)(b.Zp,{className:"h-full flex items-center justify-center min-h-[300px]",children:(0,a.jsxs)(b.Wu,{className:"text-center pt-6",children:[(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"Select a faction to view"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"or create a new one."})]})})})}var q=t(62709),D=t(20031);function I(){let[e,s]=(0,r.useState)(null),[t,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(0),[c,o]=(0,r.useState)(""),[d,x]=(0,r.useState)(""),[h,u]=(0,r.useState)("name"),[m,j]=(0,r.useState)("asc"),[p,f]=(0,r.useState)(!1),w=(0,U.a)(),[g,N]=(0,r.useState)("list");(0,r.useEffect)(()=>{f(!0)},[]);let y={searchTerm:c,tagFilter:d,sortBy:h,sortOrder:m},b={setSearchTerm:o,setTagFilter:x,setSortBy:u,setSortOrder:j},C=()=>{o(""),x(""),u("name"),j("asc")},S=()=>i(e=>e+1),k=e=>{s(e),l(!1),w&&N("editor")},A=()=>{s(null),l(!0),w&&N("editor")},F=e=>{S(),s(e),l(!1),w&&N("editor")},z=()=>{S(),s(null),l(!1),w&&N("list")},E=()=>{t&&(l(!1),s(null),w&&N("list"))};return p?w?(0,a.jsx)(q.A,{showSidebarTrigger:!1,children:(0,a.jsx)("div",{className:"h-full w-full",children:"list"===g?(0,a.jsx)(v,{onSelectFaction:k,onNewFaction:A,selectedFactionId:e,dataVersion:n,filters:y,setFilters:b,onClearFilters:C}):(0,a.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsx)(R,{factionId:e,isCreatingNew:t,onSaveSuccess:F,onDeleteSuccess:z,onEditCancel:E,onBack:()=>{N("list"),s(null),l(!1)}},null!=e?e:t?"new":"placeholder")})})})}):(0,a.jsx)(D.GB,{children:(0,a.jsx)(q.A,{children:(0,a.jsxs)("div",{className:"flex w-full h-full overflow-hidden",children:[(0,a.jsx)(D.Bx,{style:{"--sidebar-width":"380px"},children:(0,a.jsx)(v,{onSelectFaction:k,onNewFaction:A,selectedFactionId:e,dataVersion:n,filters:y,setFilters:b,onClearFilters:C})}),(0,a.jsx)(D.sF,{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-background/50 p-4 sm:p-6 md:p-8 w-full",children:(0,a.jsx)(R,{factionId:e,isCreatingNew:t,onSaveSuccess:F,onDeleteSuccess:z,onEditCancel:E},null!=e?e:t?"new":"placeholder")})})]})})}):null}},73926:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},75074:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(40157).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},84931:(e,s,t)=>{Promise.resolve().then(t.bind(t,71608))}},e=>{var s=s=>e(e.s=s);e.O(0,[222,194,160,49,347,516,441,684,358],()=>s(84931)),_N_E=e.O()}]);